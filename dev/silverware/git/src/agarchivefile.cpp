#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "dev/silverware/git/sdk/util/agdebugchannels.h"
#include "dev/silverware/git/sdk/agpointer.h"
#include "dev/silverware/git/sdk/util/agperformancecounter.h"
#include "dev/silverware/git/sdk/agclock.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "dev/silverware/git/sdk/filesystem/agfile.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "dev/silverware/git/sdk/agmutex.h"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/algorithm"
#include "dev/silverware/git/sdk/filesystem/agpath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "dev/silverware/git/sdk/filesystem/agdirectory.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "dev/silverware/git/sdk/memory/agallocators.h"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/silverware/git/sdk/agcondition.inl"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/silverware/git/sdk/agcondition.h"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "dev/silverware/git/sdk/agreference.h"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "dev/silverware/git/sdk/agmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "dev/silverware/git/sdk/agreferenceinl.h"
#include "dev/silverware/git/sdk/agarchive.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "dev/silverware/git/sdk/filesystem/agmount.h"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "dev/silverware/git/sdk/agarchivefile.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"

struct AgArchiveFileInternalData
{
	AgPointer<AgStream> m_sourceFileHandle; // 0x0
	AgArchiveFileInternalData(AgArchiveFileInternalData &);
	AgArchiveFileInternalData(const AgArchiveFileInternalData &);
	AgArchiveFileInternalData();
	~AgArchiveFileInternalData();
	AgArchiveFileInternalData & operator=(AgArchiveFileInternalData &);
	AgArchiveFileInternalData & operator=(const AgArchiveFileInternalData &);
};
AgArchiveFile::AgArchiveFile(AgReference<AgArchive> archive, unsigned long long startOffset, unsigned long long size, const AgPath & fileName, long isEncrypted); // 0x14068E860
AgArchiveFile::~AgArchiveFile(); // 0x14068ED80
unsigned long AgArchiveFile::read(unsigned char * buffer, unsigned long size); // 0x14068F010
unsigned long AgArchiveFile::write(const unsigned char * buffer, unsigned long size); // 0x1400470F0
unsigned long long AgArchiveFile::getSize(); // 0x14068F000
void AgArchiveFile::setPosition(unsigned long long position); // 0x14068F130
unsigned long long AgArchiveFile::getPosition(); // 0x14068EF60void __fastcall AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
        AgPointer<AgPlayer> *this,
        const AgPointer<AgPlayer> *rhs)
{
  AgReferenceCount *m_ref; // rsi
  int m_strongCount; // ebx

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  m_ref = rhs->m_ref;
  if ( rhs->m_ref )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( m_ref->m_strongCount )
    {
      while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
      {
        m_strongCount = m_ref->m_strongCount;
        if ( !m_ref->m_strongCount )
          return;
      }
      if ( m_strongCount != -1 )
      {
        this->m_ref = rhs->m_ref;
        this->m_ptr = rhs->m_ptr;
      }
    }
  }
}

AgPointer<AgMount> *__fastcall AgPointer<AgArchive>::operator<AgMount> AgPointer<AgMount>(
        AgPointer<AgArchive> *this,
        AgPointer<AgMount> *result)
{
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
    (AgPointer<AgPlayer> *)result,
    (const AgPointer<AgPlayer> *)this);
  return result;
}

void __fastcall AgPointer<AgArchive>::AgPointer<AgArchive>(
        AgPointer<AgArchive> *this,
        const AgReference<AgArchive> *rhs)
{
  AgReferenceCount *m_ref; // rsi
  int m_strongCount; // ebx

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  m_ref = rhs->m_ref;
  if ( m_ref )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( m_ref->m_strongCount )
    {
      while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
      {
        m_strongCount = m_ref->m_strongCount;
        if ( !m_ref->m_strongCount )
          return;
      }
      if ( m_strongCount != -1 )
      {
        this->m_ref = rhs->m_ref;
        this->m_ptr = rhs->m_ptr;
      }
    }
  }
}

void __fastcall AgReference<AgArchive>::AgReference<AgArchive>(
        AgReference<AgArchive> *this,
        const AgReference<AgArchive> *rhs)
{
  AgArchive *m_ptr; // rsi
  AgReferenceCount *m_ref; // rdi
  int v5; // ebp
  AgPointer<AgArchive> result; // [rsp+28h] [rbp-30h] BYREF

  this->__vftable = (AgReference<AgArchive>_vtbl *)&AgReference<AgArchive>::`vftable';
  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  AgReference<AgArchive>::getPtr((AgReference<AgArchive> *)rhs, &result);
  if ( result.m_ref && (unsigned int)AgReferenceCount::incWeakRef(result.m_ref) )
    *(AgPointer<AgArchive> *)&this->m_ref = result;
  m_ptr = result.m_ptr;
  result.m_ptr = 0i64;
  m_ref = result.m_ref;
  if ( result.m_ref )
  {
    result.m_ref = 0i64;
    v5 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v5 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgArchive *, __int64))m_ptr->~AgMount)(m_ptr, 1i64);
      if ( v5 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
}

void __fastcall AgArchiveFile::AgArchiveFile(
        AgArchiveFile *this,
        AgReference<AgArchive> *archive,
        unsigned __int64 startOffset,
        unsigned __int64 size,
        const AgPath *fileName,
        int isEncrypted)
{
  AgReferenceCount *m_ref; // rsi
  int m_strongCount; // ebx
  AgReferenceCount *v11; // rbx
  AgPointer<AgMount> *v12; // rax
  AgPath *v13; // r12
  AgArchive *m_ptr; // rsi
  int v15; // er15
  int v16; // er15
  AgArchiveFileInternalData *v17; // rax
  AgReferenceCount *v18; // rsi
  int v19; // ebx
  AgPointer<AgStream> *v20; // rax
  AgStream *v21; // rcx
  AgPointer<AgArchive> *Ptr; // rax
  bool v23; // bl
  const char *CString; // rax
  signed int v25; // er9
  int v26; // ebx
  AgBlowfish *v27; // rax
  AgBlowfish *v28; // rax
  AgBlowfish *v29; // rbx
  AgReferenceCount *v30; // rax
  int v31; // eax
  AgReferenceCount *m_refCount; // rsi
  int v33; // er15
  unsigned __int8 *v34; // rax
  int v35; // er15
  AgArchive *v36; // rsi
  AgArchive *v37; // rbx
  int v38; // er15
  AgReferenceCount *v39; // rbx
  AgPointer<AgArchive> v40; // [rsp+30h] [rbp-59h] BYREF
  AgArchive *v41[2]; // [rsp+40h] [rbp-49h]
  __int128 v42; // [rsp+50h] [rbp-39h]
  AgPointer<AgMount> result; // [rsp+60h] [rbp-29h] BYREF
  AgPointer<AgStream> v44; // [rsp+70h] [rbp-19h] BYREF
  AgPointer<AgArchive> v45; // [rsp+80h] [rbp-9h] BYREF

  v40 = 0i64;
  m_ref = archive->m_ref;
  if ( !m_ref )
    goto LABEL_8;
  m_strongCount = m_ref->m_strongCount;
  if ( !m_ref->m_strongCount )
    goto LABEL_8;
  while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( !m_ref->m_strongCount )
      goto LABEL_8;
  }
  if ( m_strongCount != -1 )
  {
    v11 = archive->m_ref;
    v40.m_ref = v11;
    v40.m_ptr = archive->m_ptr;
  }
  else
  {
LABEL_8:
    v11 = v40.m_ref;
  }
  v12 = AgPointer<AgArchive>::operator<AgMount> AgPointer<AgMount>(&v40, &result);
  v13 = (AgPath *)fileName;
  AgFile::AgFile(this, v12, fileName, 1u);
  m_ptr = v40.m_ptr;
  v40.m_ptr = 0i64;
  if ( v11 )
  {
    v40.m_ref = 0i64;
    v15 = 0;
    if ( !AgAtomicDecrement(&v11->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v11->m_weakCount) )
        v15 = 1;
      v11->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgArchive *, __int64))m_ptr->~AgMount)(m_ptr, 1i64);
      if ( v15 )
        AgReferenceCount::operator delete(v11);
      v13 = (AgPath *)fileName;
    }
  }
  this->__vftable = (AgArchiveFile_vtbl *)&AgArchiveFile::`vftable';
  AgReference<AgArchive>::AgReference<AgArchive>(&this->m_archive, archive);
  this->m_startOffset = startOffset;
  v16 = size;
  this->m_size = size;
  this->m_internalData = 0i64;
  v17 = (AgArchiveFileInternalData *)operator new(0x10ui64);
  if ( v17 )
  {
    v17->m_sourceFileHandle.m_ref = 0i64;
    v17->m_sourceFileHandle.m_ptr = 0i64;
  }
  else
  {
    v17 = 0i64;
  }
  this->m_internalData = v17;
  *(_OWORD *)v41 = 0i64;
  v18 = archive->m_ref;
  if ( v18 )
  {
    v19 = v18->m_strongCount;
    if ( v18->m_strongCount )
    {
      while ( AgAtomicCompareExchange(&v18->m_strongCount, v19, v19 + 1) != v19 )
      {
        v19 = v18->m_strongCount;
        if ( !v18->m_strongCount )
          goto LABEL_29;
      }
      if ( v19 != -1 )
      {
        v41[0] = (AgArchive *)archive->m_ref;
        v41[1] = archive->m_ptr;
      }
LABEL_29:
      v16 = size;
    }
  }
  if ( v41[1] )
  {
    v20 = AgArchive::createSourceStreamPtr(v41[1], &v44);
    AgPointer<AgStream>::operator=(&this->m_internalData->m_sourceFileHandle, v20);
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v44);
  }
  else
  {
    AgPointer<AgStream>::operator=(&this->m_internalData->m_sourceFileHandle, 0i64);
  }
  v21 = this->m_internalData->m_sourceFileHandle.m_ptr;
  if ( v21 )
    v21->setPosition(v21, startOffset);
  Ptr = AgReference<AgArchive>::getPtr(archive, &v45);
  v23 = (unsigned int)AgArchive::isEncrypted(Ptr->m_ptr) && isEncrypted;
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v45);
  if ( v23 )
  {
    CString = AgString::getCString(&v13->m_path);
    v25 = *CString ^ (unsigned __int8)v16 | v16 & 0xFF00 ^ (CString[1] << 8) | v16 & 0xFF000000 ^ (CString[3] << 24) | v16 & 0xFF0000 ^ (CString[2] << 16);
    v26 = ((unsigned __int8)(HIBYTE(v25) ^ v25 ^ ((unsigned __int16)(v25 ^ (v25 >> 8)) >> 8)) ^ ((int)(HIBYTE(v25) ^ (unsigned __int8)(v25 ^ ((unsigned __int16)(v25 ^ (v25 >> 8)) >> 8))) >> 4)) & 0xF;
    v27 = (AgBlowfish *)operator new(0x1050ui64);
    if ( v27 )
    {
      AgBlowfish::AgBlowfish(v27, keyTable[v26], 16);
      v29 = v28;
    }
    else
    {
      v29 = 0i64;
    }
    v42 = 0i64;
    if ( v29 )
    {
      if ( v29->m_refCount )
      {
        v31 = 0;
      }
      else
      {
        v30 = (AgReferenceCount *)AgReferenceCount::operator new(0x10ui64);
        if ( v30 )
        {
          v30->m_strongCount = 1;
          v30->m_weakCount = 1;
          v30->m_data = v29;
        }
        else
        {
          v30 = 0i64;
        }
        v29->m_refCount = v30;
        v31 = 1;
      }
      m_refCount = v29->m_refCount;
      if ( !v31 )
        AgReferenceCount::incRef(v29->m_refCount);
      *(_QWORD *)&v42 = m_refCount;
      *((_QWORD *)&v42 + 1) = v29;
    }
    else
    {
      v29 = (AgBlowfish *)*((_QWORD *)&v42 + 1);
      m_refCount = (AgReferenceCount *)v42;
    }
    v33 = 8;
    if ( (this->m_size & 7) != 0 )
      v33 = 8 - (this->m_size & 7);
    v34 = (unsigned __int8 *)operator new[](size + v33);
    this->m_decryptBuffer = v34;
    this->m_decryptBufferPos = 0;
    this->m_internalData->m_sourceFileHandle.m_ptr->read(
      this->m_internalData->m_sourceFileHandle.m_ptr,
      v34,
      v33 + LODWORD(this->m_size));
    AgBlowfish::Decrypt(v29, this->m_decryptBuffer, v33 + LODWORD(this->m_size));
    *((_QWORD *)&v42 + 1) = 0i64;
    if ( m_refCount )
    {
      *(_QWORD *)&v42 = 0i64;
      v35 = 0;
      if ( !AgAtomicDecrement(&m_refCount->m_strongCount) )
      {
        if ( !AgAtomicDecrement(&m_refCount->m_weakCount) )
          v35 = 1;
        m_refCount->m_data = 0i64;
        operator delete(v29, 0x1050ui64);
        if ( v35 )
          AgReferenceCount::operator delete(m_refCount);
      }
    }
  }
  else
  {
    this->m_decryptBuffer = 0i64;
  }
  AgFile::setOpen(this, 1);
  v36 = v41[1];
  v41[1] = 0i64;
  v37 = v41[0];
  if ( v41[0] )
  {
    v41[0] = 0i64;
    v38 = 0;
    if ( !AgAtomicDecrement((volatile int *)v37) )
    {
      if ( !AgAtomicDecrement((volatile int *)&v37->__vftable + 1) )
        v38 = 1;
      v37->m_refCount = 0i64;
      if ( v36 )
        ((void (__fastcall *)(AgArchive *, __int64))v36->~AgMount)(v36, 1i64);
      if ( v38 )
        AgReferenceCount::operator delete(v37);
    }
  }
  archive->__vftable = (AgReference<AgArchive>_vtbl *)&AgReference<AgArchive>::`vftable';
  archive->m_ptr = 0i64;
  v39 = archive->m_ref;
  if ( v39 )
  {
    archive->m_ref = 0i64;
    if ( !AgAtomicDecrement(&v39->m_weakCount) )
      AgReferenceCount::operator delete(v39);
  }
}

void __fastcall AgArchiveFile::~AgArchiveFile(AgArchiveFile *this, unsigned __int64 a2)
{
  AgPointer<KOFApplication> *m_internalData; // rdi
  unsigned __int8 *m_decryptBuffer; // rcx
  AgReferenceCount *m_ref; // rdi

  this->__vftable = (AgArchiveFile_vtbl *)&AgArchiveFile::`vftable';
  m_internalData = (AgPointer<KOFApplication> *)this->m_internalData;
  if ( m_internalData )
  {
    AgPointer<AgUser>::~AgPointer<AgUser>(m_internalData);
    operator delete(m_internalData, 0x10ui64);
  }
  this->m_internalData = 0i64;
  m_decryptBuffer = this->m_decryptBuffer;
  if ( m_decryptBuffer )
  {
    operator delete(m_decryptBuffer, a2);
    this->m_decryptBuffer = 0i64;
  }
  this->m_archive.__vftable = (AgReference<AgArchive>_vtbl *)&AgReference<AgArchive>::`vftable';
  this->m_archive.m_ptr = 0i64;
  m_ref = this->m_archive.m_ref;
  if ( m_ref )
  {
    this->m_archive.m_ref = 0i64;
    if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
      AgReferenceCount::operator delete(m_ref);
  }
  AgFile::~AgFile(this);
}

AgPointer<AgStream> *__fastcall AgPointer<AgStream>::operator=(AgPointer<AgStream> *this, AgPointer<AgStream> *rhs)
{
  AgReferenceCount *m_ref; // r8
  AgStream *m_ptr; // rax
  AgReferenceCount *v5; // rdi
  AgStream *v6; // rsi
  int v7; // ebp

  m_ref = rhs->m_ref;
  m_ptr = rhs->m_ptr;
  rhs->m_ref = 0i64;
  rhs->m_ptr = 0i64;
  v5 = this->m_ref;
  v6 = this->m_ptr;
  this->m_ref = m_ref;
  this->m_ptr = m_ptr;
  if ( v5 )
  {
    v7 = 0;
    if ( !AgAtomicDecrement(&v5->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v5->m_weakCount) )
        v7 = 1;
      v5->m_data = 0i64;
      if ( v6 )
        ((void (__fastcall *)(AgStream *, __int64))v6->~AgStream)(v6, 1i64);
      if ( v7 )
        AgReferenceCount::operator delete(v5);
    }
  }
  return this;
}

void __fastcall ActorWeapon::ActionFlagCheck(_SETJMP_FLOAT128 *JumpBuffer)
{
  ;
}

unsigned __int64 __fastcall AgArchiveFile::getPosition(AgArchiveFile *this)
{
  unsigned __int64 v2; // rax
  unsigned __int64 m_startOffset; // r9

  v2 = this->m_internalData->m_sourceFileHandle.m_ptr->getPosition(this->m_internalData->m_sourceFileHandle.m_ptr);
  m_startOffset = this->m_startOffset;
  if ( v2 < m_startOffset )
    return 0i64;
  if ( v2 < m_startOffset + this->m_size )
    return v2 - m_startOffset;
  if ( v2 >= m_startOffset )
    return this->m_size;
  else
    return 0i64;
}

AgPointer<AgArchive> *__fastcall AgReference<AgArchive>::getPtr(
        AgReference<AgArchive> *this,
        AgPointer<AgArchive> *result)
{
  AgPointer<AgArchive>::AgPointer<AgArchive>(result, this);
  return result;
}

unsigned __int64 __fastcall AgArchiveFile::getSize(AgArchiveFile *this)
{
  return this->m_size;
}

__int64 __fastcall AgArchiveFile::read(AgArchiveFile *this, unsigned __int8 *buffer, size_t size)
{
  unsigned __int8 *m_decryptBuffer; // r10
  __int64 v5; // rbx
  unsigned __int64 m_decryptBufferPos; // rcx
  unsigned __int64 m_size; // rdx
  unsigned __int8 *v9; // rdx
  unsigned __int64 v11; // rax
  unsigned __int64 v12; // r8

  m_decryptBuffer = this->m_decryptBuffer;
  v5 = (unsigned int)size;
  if ( m_decryptBuffer )
  {
    m_decryptBufferPos = this->m_decryptBufferPos;
    m_size = this->m_size;
    if ( (unsigned int)(m_decryptBufferPos + size) <= m_size )
    {
      size = (unsigned int)size;
      v9 = &m_decryptBuffer[m_decryptBufferPos];
LABEL_4:
      memmove(buffer, v9, size);
      this->m_decryptBufferPos += v5;
      return (unsigned int)v5;
    }
    if ( m_decryptBufferPos < m_size )
    {
      v9 = &m_decryptBuffer[m_decryptBufferPos];
      LODWORD(v5) = this->m_size - m_decryptBufferPos;
      size = (unsigned int)v5;
      goto LABEL_4;
    }
  }
  else
  {
    v11 = this->m_internalData->m_sourceFileHandle.m_ptr->getPosition(this->m_internalData->m_sourceFileHandle.m_ptr);
    v12 = this->m_startOffset + this->m_size;
    if ( v11 + v5 <= v12 )
      return ((__int64 (__fastcall *)(AgStream *, unsigned __int8 *, _QWORD))this->m_internalData->m_sourceFileHandle.m_ptr->read)(
               this->m_internalData->m_sourceFileHandle.m_ptr,
               buffer,
               (unsigned int)v5);
    if ( v11 < v12 )
      return ((__int64 (__fastcall *)(AgStream *, unsigned __int8 *, _QWORD))this->m_internalData->m_sourceFileHandle.m_ptr->read)(
               this->m_internalData->m_sourceFileHandle.m_ptr,
               buffer,
               (unsigned int)(LODWORD(this->m_startOffset) + LODWORD(this->m_size) - v11));
  }
  return 0i64;
}

void __fastcall AgArchiveFile::setPosition(AgArchiveFile *this, unsigned __int64 position)
{
  unsigned __int64 m_size; // r10
  unsigned __int64 v3; // rdx

  m_size = this->m_size;
  if ( position < m_size )
  {
    if ( this->m_decryptBuffer )
    {
      this->m_decryptBufferPos = position;
      return;
    }
    v3 = this->m_startOffset + position;
  }
  else
  {
    if ( this->m_decryptBuffer )
    {
      this->m_decryptBufferPos = m_size;
      return;
    }
    v3 = m_size + this->m_startOffset;
  }
  ((void (__fastcall *)(AgStream *, unsigned __int64, AgStream_vtbl *, AgArchiveFile *))this->m_internalData->m_sourceFileHandle.m_ptr->setPosition)(
    this->m_internalData->m_sourceFileHandle.m_ptr,
    v3,
    this->m_internalData->m_sourceFileHandle.m_ptr->__vftable,
    this);
}

__int64 __fastcall AgHttp::onSingletonExit(__crt_locale_data *__formal)
{
  return 0i64;
}

