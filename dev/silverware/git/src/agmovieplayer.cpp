#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "dev/silverware/git/sdk/agpointer.h"
#include "dev/silverware/git/sdk/audio/agaudiotypes.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "dev/silverware/git/sdk/agmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "dev/silverware/git/sdk/agreferenceinl.h"
#include "dev/silverware/git/sdk/agcondition.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "dev/silverware/git/sdk/agmemorystream.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "dev/silverware/git/sdk/util/agdebugchannels.h"
#include "dev/silverware/git/sdk/util/agperformancecounter.h"
#include "dev/silverware/git/sdk/agclock.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/silverware/git/sdk/agcondition.h"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "dev/silverware/git/sdk/agcurve.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "dev/silverware/git/sdk/filesystem/agpath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "dev/silverware/git/sdk/filesystem/agfile.h"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "dev/silverware/git/sdk/audio/agaudioeffects.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "dev/silverware/git/src/3rdparty/libvpx/vp8dx.h"
#include "dev/silverware/git/src/3rdparty/libvpx/vp8.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "dev/silverware/git/sdk/audio/agaudiomanager.h"
#include "dev/silverware/git/sdk/agmovieplayer.h"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "dev/silverware/git/sdk/audio/agaudiochannel.h"
#include "dev/silverware/git/sdk/agvector3.h"
#include "dev/silverware/git/sdk/agvector2.h"
#include "dev/silverware/git/sdk/agendian.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "dev/silverware/git/sdk/agthread.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "dev/silverware/git/sdk/agmutex.h"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"

struct AgMoviePlayer::InternalData
{
	AgPointer<AgFile> m_videoFile; // 0x0
	AgPointer<AgFile> m_audioFile; // 0x10
	AgPointer<AgAudioSource> m_audioSource; // 0x20
	AgPointer<AgAudioChannel> m_audioChannel; // 0x30
	AgMoviePlayerPlaybackThreadHost * m_playbackThreadHost; // 0x40
	AgPointer<AgThread> m_playbackThread; // 0x48
	AgMoviePlayerDecodeThreadHost * m_decodeThreadHost; // 0x58
	AgPointer<AgThread> m_decodeThread; // 0x60
	long m_playbackRunning; // 0x70
	long m_decodeRunning; // 0x74
	volatile long m_decodeStarted; // 0x78
	long m_stop; // 0x7C
	long m_eof; // 0x80
	vpx_codec_ctx m_codecContext; // 0x88
	AgMutex m_codecLock; // 0xC0
	float m_frameRate; // 0xE8
	long m_frameCount; // 0xEC
	long m_currentFrame; // 0xF0
	AgClock m_clock; // 0xF8
	unsigned char * m_frameBuffer; // 0x120
	unsigned long m_frameBufferSize; // 0x128
	long m_currentWriteFrameBuffer; // 0x12C
	long m_currentReadFrameBuffer; // 0x130
	volatile long m_freeBuffers; // 0x134
	AgPointer<AgMemoryStream> m_frameBufferData[3][64]; // 0x138
	unsigned long m_frameSize; // 0xD38
	AgPointer<AgMemoryStream> m_frameData[3]; // 0xD40
	long m_width; // 0xD70
	long m_height; // 0xD74
	long m_stride; // 0xD78
	InternalData();
	~InternalData();
};
AgMoviePlayer::AgMoviePlayer(); // 0x140665570
AgMoviePlayer::InternalData::InternalData(); // 0x140665780
AgMoviePlayer::~AgMoviePlayer(); // 0x140665860
AgMoviePlayer::InternalData::~InternalData(); // 0x140665950
long AgMoviePlayer::start(const AgString & fileName, long playMusic); // 0x140666370
struct AgMoviePlayer::start::__l2::IVFHeader
{
	char signature[4]; // 0x0
	unsigned short version; // 0x4
	unsigned short length; // 0x6
	char fourCC[4]; // 0x8
	unsigned short width; // 0xC
	unsigned short height; // 0xE
	unsigned long frameRate; // 0x10
	unsigned long timeScale; // 0x14
	unsigned long frameCount; // 0x18
	unsigned long _pad; // 0x1C
};
typedef vpx_color_range vpx_color_range_t;
typedef vpx_codec_ctx vpx_codec_ctx_t;
typedef void(*vpx_decrypt_cb)(void *, const unsigned char *, unsigned char *, long);
typedef const void * vpx_codec_iter_t;
typedef vpx_ref_frame vpx_ref_frame_t;
typedef vp9_ref_frame vp9_ref_frame_t;
typedef long vpx_codec_flags_t;
typedef vpx_color_space vpx_color_space_t;
typedef vpx_img_fmt vpx_img_fmt_t;
typedef vpx_ref_frame_type vpx_ref_frame_type_t;
typedef vpx_codec_dec_cfg vpx_codec_dec_cfg_t;
typedef vpx_image vpx_image_t;
typedef vp8_postproc_cfg vp8_postproc_cfg_t;
typedef const vpx_codec_iface vpx_codec_iface_t;
void AgMoviePlayer::stop(); // 0x140666AC0
void AgMoviePlayerPlaybackThreadHost::onExecuteThread(); // 0x140666020
void AgMoviePlayerPlaybackThreadHost::onJoinThread(); // 0x140666360
long AgMoviePlayerPlaybackThreadHost::getThreadIsRunning(); // 0x140665C50
void AgMoviePlayerDecodeThreadHost::onExecuteThread(); // 0x140665CB0
struct AgMoviePlayerDecodeThreadHost::onExecuteThread::__l4::IVFFrameHeader
{
	unsigned long size; // 0x0
	unsigned long long timeStamp; // 0x4
};
void AgMoviePlayerDecodeThreadHost::onJoinThread(); // 0x140666350
long AgMoviePlayerDecodeThreadHost::getThreadIsRunning(); // 0x140665C40
AgPointer<AgMemoryStream> AgMoviePlayer::getFrame(long index); // 0x140665BD0
long AgMoviePlayer::getWidth(); // 0x140665C60
long AgMoviePlayer::getHeight(); // 0x140665C20
long AgMoviePlayer::getStride(); // 0x140665C30
long AgMoviePlayer::isStarted(); // 0x140665CA0
long AgMoviePlayer::isFinished(); // 0x140665C70
long AgMoviePlayer::getElapsedTimeMS(); // 0x140665BA0void __fastcall AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
        AgPointer<AgPlayer> *this,
        const AgPointer<AgPlayer> *rhs)
{
  AgReferenceCount *m_ref; // rsi
  int m_strongCount; // ebx

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  m_ref = rhs->m_ref;
  if ( rhs->m_ref )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( m_ref->m_strongCount )
    {
      while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
      {
        m_strongCount = m_ref->m_strongCount;
        if ( !m_ref->m_strongCount )
          return;
      }
      if ( m_strongCount != -1 )
      {
        this->m_ref = rhs->m_ref;
        this->m_ptr = rhs->m_ptr;
      }
    }
  }
}

void __fastcall AgPointer<AgController>::AgPointer<AgController>(AgPointer<AgMemoryStream> *this)
{
  this->m_ref = 0i64;
  this->m_ptr = 0i64;
}

void __fastcall AgMoviePlayer::AgMoviePlayer(AgMoviePlayer *this)
{
  AgMoviePlayer::InternalData *v2; // rax
  AgMoviePlayer::InternalData *v3; // rax
  __int64 v4; // rdi
  __int64 v5; // rsi
  AgMemoryStream *v6; // rax
  AgMemoryStream *v7; // rax
  AgMemoryStream *v8; // rdx
  AgMemoryStream *v9; // rax
  AgMemoryStream *v10; // rax
  AgMemoryStream *v11; // rdx
  AgMemoryStream *v12; // rax
  AgMemoryStream *v13; // rax
  AgMemoryStream *v14; // rdx
  AgMemoryStream *v15; // rax
  AgMemoryStream *v16; // rax
  AgMemoryStream *v17; // rax
  AgMemoryStream *v18; // rax
  AgMemoryStream *v19; // rax
  AgMemoryStream *v20; // rax

  this->m_refCount = 0i64;
  this->m_internalData = 0i64;
  v2 = (AgMoviePlayer::InternalData *)operator new(0xD80ui64);
  if ( v2 )
    AgMoviePlayer::InternalData::InternalData(v2);
  else
    v3 = 0i64;
  this->m_internalData = v3;
  v3->m_frameBufferSize = 0x20000;
  this->m_internalData->m_frameBuffer = (unsigned __int8 *)operator new[](this->m_internalData->m_frameBufferSize);
  v4 = 0i64;
  v5 = 64i64;
  do
  {
    v6 = (AgMemoryStream *)AgMemoryPoolImpl<AgMutex,AgMutex>::_alloc(&AgMemoryStream::s_pool);
    if ( v6 )
    {
      AgMemoryStream::AgMemoryStream(v6);
      v8 = v7;
    }
    else
    {
      v8 = 0i64;
    }
    AgPointer<AgMemoryStream>::operator=(this->m_internalData->m_frameBufferData[v4], v8);
    v9 = (AgMemoryStream *)AgMemoryPoolImpl<AgMutex,AgMutex>::_alloc(&AgMemoryStream::s_pool);
    if ( v9 )
    {
      AgMemoryStream::AgMemoryStream(v9);
      v11 = v10;
    }
    else
    {
      v11 = 0i64;
    }
    AgPointer<AgMemoryStream>::operator=(&this->m_internalData->m_frameBufferData[v4][1], v11);
    v12 = (AgMemoryStream *)AgMemoryPoolImpl<AgMutex,AgMutex>::_alloc(&AgMemoryStream::s_pool);
    if ( v12 )
    {
      AgMemoryStream::AgMemoryStream(v12);
      v14 = v13;
    }
    else
    {
      v14 = 0i64;
    }
    AgPointer<AgMemoryStream>::operator=(&this->m_internalData->m_frameBufferData[v4++][2], v14);
    --v5;
  }
  while ( v5 );
  this->m_internalData->m_currentWriteFrameBuffer = 0;
  this->m_internalData->m_currentReadFrameBuffer = 0;
  v15 = (AgMemoryStream *)AgMemoryPoolImpl<AgMutex,AgMutex>::_alloc(&AgMemoryStream::s_pool);
  if ( v15 )
    AgMemoryStream::AgMemoryStream(v15);
  else
    v16 = 0i64;
  AgPointer<AgMemoryStream>::operator=(this->m_internalData->m_frameData, v16);
  v17 = (AgMemoryStream *)AgMemoryPoolImpl<AgMutex,AgMutex>::_alloc(&AgMemoryStream::s_pool);
  if ( v17 )
    AgMemoryStream::AgMemoryStream(v17);
  else
    v18 = 0i64;
  AgPointer<AgMemoryStream>::operator=(&this->m_internalData->m_frameData[1], v18);
  v19 = (AgMemoryStream *)AgMemoryPoolImpl<AgMutex,AgMutex>::_alloc(&AgMemoryStream::s_pool);
  if ( v19 )
    AgMemoryStream::AgMemoryStream(v19);
  else
    v20 = 0i64;
  AgPointer<AgMemoryStream>::operator=(&this->m_internalData->m_frameData[2], v20);
  this->m_internalData->m_playbackRunning = 0;
  this->m_internalData->m_decodeRunning = 0;
  this->m_internalData->m_decodeStarted = 0;
  this->m_internalData->m_stop = 0;
}

void __fastcall AgMoviePlayer::InternalData::InternalData(AgMoviePlayer::InternalData *this)
{
  this->m_videoFile.m_ref = 0i64;
  this->m_videoFile.m_ptr = 0i64;
  this->m_audioFile.m_ref = 0i64;
  this->m_audioFile.m_ptr = 0i64;
  this->m_audioSource.m_ref = 0i64;
  this->m_audioSource.m_ptr = 0i64;
  this->m_audioChannel.m_ref = 0i64;
  this->m_audioChannel.m_ptr = 0i64;
  this->m_playbackThread.m_ref = 0i64;
  this->m_playbackThread.m_ptr = 0i64;
  this->m_decodeThread.m_ref = 0i64;
  this->m_decodeThread.m_ptr = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->m_codecLock);
  AgClock::AgClock(&this->m_clock, -1.0);
  this->m_freeBuffers = 64;
  `eh vector constructor iterator'(
    this->m_frameBufferData,
    0x10ui64,
    0xC0ui64,
    (void (__fastcall *)(void *))AgPointer<AgController>::AgPointer<AgController>,
    (void (__fastcall *)(void *))AgPointer<AgUser>::~AgPointer<AgUser>);
  `eh vector constructor iterator'(
    this->m_frameData,
    0x10ui64,
    3ui64,
    (void (__fastcall *)(void *))AgPointer<AgController>::AgPointer<AgController>,
    (void (__fastcall *)(void *))AgPointer<AgUser>::~AgPointer<AgUser>);
}

void __fastcall AgMoviePlayer::~AgMoviePlayer(AgMoviePlayer *this)
{
  AgMoviePlayer::InternalData *m_internalData; // rcx
  AgMoviePlayerPlaybackThreadHost *m_playbackThreadHost; // rcx
  AgMoviePlayer::InternalData *v4; // rcx
  unsigned __int64 v5; // rdx
  AgMoviePlayerDecodeThreadHost *m_decodeThreadHost; // rcx
  AgMoviePlayer::InternalData *v7; // rdi

  this->m_internalData->m_stop = 1;
  this->m_internalData->m_currentFrame = -1;
  m_internalData = this->m_internalData;
  if ( m_internalData->m_playbackRunning )
    AgThread::join(m_internalData->m_playbackThread.m_ptr);
  AgPointer<AgThread>::operator=((AgPointer<AgController> *)&this->m_internalData->m_playbackThread, 0i64);
  m_playbackThreadHost = this->m_internalData->m_playbackThreadHost;
  if ( m_playbackThreadHost )
    ((void (__fastcall *)(AgMoviePlayerPlaybackThreadHost *, __int64))m_playbackThreadHost->~AgIThreadHost)(
      m_playbackThreadHost,
      1i64);
  v4 = this->m_internalData;
  if ( v4->m_decodeRunning )
    AgThread::join(v4->m_decodeThread.m_ptr);
  AgPointer<AgThread>::operator=((AgPointer<AgController> *)&this->m_internalData->m_decodeThread, 0i64);
  m_decodeThreadHost = this->m_internalData->m_decodeThreadHost;
  if ( m_decodeThreadHost )
    ((void (__fastcall *)(AgMoviePlayerDecodeThreadHost *, __int64))m_decodeThreadHost->~AgIThreadHost)(
      m_decodeThreadHost,
      1i64);
  operator delete(this->m_internalData->m_frameBuffer, v5);
  v7 = this->m_internalData;
  if ( v7 )
  {
    AgMoviePlayer::InternalData::~InternalData(this->m_internalData);
    operator delete(v7, 0xD80ui64);
  }
  this->m_internalData = 0i64;
}

void __fastcall AgMoviePlayer::InternalData::~InternalData(AgMoviePlayer::InternalData *this)
{
  `eh vector destructor iterator'(
    this->m_frameData,
    0x10ui64,
    3ui64,
    (void (__fastcall *)(void *))AgPointer<AgUser>::~AgPointer<AgUser>);
  `eh vector destructor iterator'(
    this->m_frameBufferData,
    0x10ui64,
    0xC0ui64,
    (void (__fastcall *)(void *))AgPointer<AgUser>::~AgPointer<AgUser>);
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->m_codecLock);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&this->m_decodeThread);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&this->m_playbackThread);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&this->m_audioChannel);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&this->m_audioSource);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&this->m_audioFile);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)this);
}

AgPointer<AgMemoryStream> *__fastcall AgPointer<AgMemoryStream>::operator=(
        AgPointer<AgMemoryStream> *this,
        AgMemoryStream *t)
{
  AgMemoryStream *v2; // rdi
  AgReferenceCount *v4; // rax
  int v5; // eax
  AgReferenceCount *m_refCount; // rbp
  AgReferenceCount *m_ref; // rsi
  AgMemoryStream *m_ptr; // r14
  int v9; // edi

  v2 = t;
  if ( t )
  {
    if ( t->m_refCount )
    {
      v5 = 0;
    }
    else
    {
      v4 = (AgReferenceCount *)AgReferenceCount::operator new(0x10ui64);
      if ( v4 )
      {
        v4->m_strongCount = 1;
        v4->m_weakCount = 1;
        v4->m_data = v2;
      }
      v2->m_refCount = v4;
      v5 = 1;
    }
    m_refCount = v2->m_refCount;
    if ( !v5 )
      AgReferenceCount::incRef(v2->m_refCount);
  }
  else
  {
    v2 = 0i64;
    m_refCount = 0i64;
  }
  m_ref = this->m_ref;
  m_ptr = this->m_ptr;
  this->m_ref = m_refCount;
  this->m_ptr = v2;
  if ( m_ref )
  {
    v9 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v9 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgMemoryStream *, __int64))m_ptr->~AgStream)(m_ptr, 1i64);
      if ( v9 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
  return this;
}

__int64 __fastcall AgMoviePlayer::getElapsedTimeMS(AgMoviePlayer *this)
{
  return (unsigned int)(int)(float)((float)(1000 * this->m_internalData->m_currentFrame)
                                  / this->m_internalData->m_frameRate);
}

AgPointer<AgMemoryStream> *__fastcall AgMoviePlayer::getFrame(
        AgMoviePlayer *this,
        AgPointer<AgMemoryStream> *result,
        int index)
{
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
    (AgPointer<AgPlayer> *)result,
    (const AgPointer<AgPlayer> *)&this->m_internalData->m_frameData[index]);
  return result;
}

__int64 __fastcall AgMoviePlayer::getHeight(AgMoviePlayer *this)
{
  return (unsigned int)this->m_internalData->m_height;
}

__int64 __fastcall AgMoviePlayer::getStride(AgMoviePlayer *this)
{
  return (unsigned int)this->m_internalData->m_stride;
}

__int64 __fastcall AgMoviePlayerDecodeThreadHost::getThreadIsRunning(AgMoviePlayerDecodeThreadHost *this)
{
  return (unsigned int)this->m_internalData->m_decodeRunning;
}

__int64 __fastcall AgMoviePlayerPlaybackThreadHost::getThreadIsRunning(AgMoviePlayerPlaybackThreadHost *this)
{
  return (unsigned int)this->m_internalData->m_playbackRunning;
}

__int64 __fastcall AgMoviePlayer::getWidth(AgMoviePlayer *this)
{
  return (unsigned int)this->m_internalData->m_width;
}

_BOOL8 __fastcall AgMoviePlayer::isFinished(AgMoviePlayer *this)
{
  AgMoviePlayer::InternalData *m_internalData; // rdx
  int m_frameCount; // ecx

  m_internalData = this->m_internalData;
  if ( m_internalData->m_stop )
    return 1i64;
  m_frameCount = m_internalData->m_frameCount;
  return m_frameCount == -1 || m_internalData->m_currentFrame >= m_frameCount;
}

_BOOL8 __fastcall AgMoviePlayer::isStarted(AgMoviePlayer *this)
{
  return this->m_internalData->m_currentFrame >= 0;
}

void __fastcall AgMoviePlayerDecodeThreadHost::onExecuteThread(AgMoviePlayerDecodeThreadHost *this)
{
  AgProgram *Instance; // rax
  unsigned __int64 v3; // rdx
  AgMoviePlayer::InternalData *m_internalData; // rax
  unsigned int m_frameSize; // ecx
  unsigned int v6; // eax
  AgMoviePlayer::InternalData *v7; // rcx
  vpx_codec_ctx *p_m_codecContext; // rcx
  __int64 i; // rax
  int v10; // er12
  const void *v11; // rsi
  const void *v12; // r14
  const void *v13; // r13
  int v14; // edi
  int v15; // ebp
  int v16; // er15
  AgAudioChannelData *InternalData; // rax
  AgAudioChannelData *v18; // rax
  AgAudioChannelData *v19; // rax
  AgMoviePlayer::InternalData *v20; // rax
  AgProgram *v21; // rax
  AgMoviePlayer::InternalData *v22; // rax
  AgMoviePlayer::InternalData *v23; // rax
  __int64 v24; // [rsp+30h] [rbp-48h] BYREF
  unsigned int v25[4]; // [rsp+38h] [rbp-40h] BYREF

  while ( this->m_internalData->m_decodeRunning )
  {
    Instance = AgProgram::getInstance();
    if ( (unsigned int)AgProgram::getShutdownRequested(Instance) )
      break;
    if ( this->m_internalData->m_videoFile.m_ptr->read(
           this->m_internalData->m_videoFile.m_ptr,
           (unsigned __int8 *)v25,
           12u) == 12 )
    {
      this->m_internalData->m_frameSize = v25[0];
      m_internalData = this->m_internalData;
      m_frameSize = m_internalData->m_frameSize;
      if ( m_frameSize > m_internalData->m_frameBufferSize )
      {
        m_internalData->m_frameBufferSize = m_frameSize;
        operator delete(this->m_internalData->m_frameBuffer, v3);
        this->m_internalData->m_frameBuffer = (unsigned __int8 *)operator new[](this->m_internalData->m_frameBufferSize);
      }
      v6 = this->m_internalData->m_videoFile.m_ptr->read(
             this->m_internalData->m_videoFile.m_ptr,
             this->m_internalData->m_frameBuffer,
             this->m_internalData->m_frameSize);
      v7 = this->m_internalData;
      if ( v6 != v7->m_frameSize )
        v7->m_eof = 1;
    }
    else
    {
      this->m_internalData->m_eof = 1;
    }
    EnterCriticalSection((LPCRITICAL_SECTION)&this->m_internalData->m_codecLock);
    if ( !(unsigned int)vpx_codec_decode(
                          (unsigned int)this->m_internalData + 136,
                          this->m_internalData->m_frameBuffer,
                          this->m_internalData->m_frameSize,
                          0,
                          10000) )
    {
      p_m_codecContext = &this->m_internalData->m_codecContext;
      v24 = 0i64;
      for ( i = vpx_codec_get_frame(p_m_codecContext, &v24);
            i;
            i = vpx_codec_get_frame(&this->m_internalData->m_codecContext, &v24) )
      {
        v10 = *(_DWORD *)(i + 28);
        v11 = *(const void **)(i + 48);
        v12 = *(const void **)(i + 56);
        v13 = *(const void **)(i + 64);
        v14 = *(_DWORD *)(i + 80);
        v15 = *(_DWORD *)(i + 84);
        v16 = *(_DWORD *)(i + 88);
        AgAtomicDecrement(&this->m_internalData->m_freeBuffers);
        InternalData = AgAudioChannel::getInternalData((AgAudioChannel *)this->m_internalData->m_frameBufferData[this->m_internalData->m_currentWriteFrameBuffer][0].m_ptr);
        memmove(InternalData, v11, v10 * v14);
        v18 = AgAudioChannel::getInternalData((AgAudioChannel *)this->m_internalData->m_frameBufferData[this->m_internalData->m_currentWriteFrameBuffer][1].m_ptr);
        memmove(v18, v12, v10 * v15 / 2);
        v19 = AgAudioChannel::getInternalData((AgAudioChannel *)this->m_internalData->m_frameBufferData[this->m_internalData->m_currentWriteFrameBuffer][2].m_ptr);
        memmove(v19, v13, v10 * v16 / 2);
        v20 = this->m_internalData;
        if ( v20->m_currentWriteFrameBuffer > 2 )
          v20->m_decodeStarted = 1;
        while ( this->m_internalData->m_freeBuffers <= 0 )
        {
          if ( !this->m_internalData->m_decodeRunning )
            break;
          v21 = AgProgram::getInstance();
          if ( (unsigned int)AgProgram::getShutdownRequested(v21) )
            break;
          AgThread::sleep(0);
        }
        ++this->m_internalData->m_currentWriteFrameBuffer;
        v22 = this->m_internalData;
        if ( v22->m_currentWriteFrameBuffer >= 64 )
          v22->m_currentWriteFrameBuffer = 0;
      }
    }
    LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_internalData->m_codecLock);
    v23 = this->m_internalData;
    if ( v23->m_eof )
      v23->m_decodeRunning = 0;
  }
}

void __fastcall AgMoviePlayerPlaybackThreadHost::onExecuteThread(AgMoviePlayerPlaybackThreadHost *this)
{
  AgProgram *Instance; // rax
  long double TotalElapsedTime; // xmm0_8
  AgMoviePlayer::InternalData *m_internalData; // rax
  __int64 m_freeBuffers; // rdx
  AgProgram *v6; // rax
  AgMoviePlayer::InternalData *v7; // rdx
  AgAudioChannel *m_ptr; // rbx
  AgAudioChannel *v9; // rsi
  size_t v10; // rdi
  AgAudioChannelData *InternalData; // rbx
  AgAudioChannelData *v12; // rax
  AgMoviePlayer::InternalData *v13; // rcx
  AgAudioChannel *v14; // rbx
  AgAudioChannel *v15; // rsi
  size_t v16; // rdi
  AgAudioChannelData *v17; // rbx
  AgAudioChannelData *v18; // rax
  AgMoviePlayer::InternalData *v19; // rdx
  AgAudioChannel *v20; // rbx
  AgAudioChannel *v21; // rsi
  size_t v22; // rdi
  AgAudioChannelData *v23; // rbx
  AgAudioChannelData *v24; // rax
  AgMoviePlayer::InternalData *v25; // rax
  AgMoviePlayer::InternalData *v26; // rax
  int m_frameCount; // ecx
  AgMoviePlayer *m_moviePlayer; // rcx
  AgMoviePlayer::InternalData *v29; // rax
  AgAudioChannel *v30; // rcx
  const AgPointer<AgPlayer> *v31; // rdx
  AgPointer<AgUser> *v32; // rax
  AgFile *v33; // rcx
  AgPointer<AgPlayer> v34; // [rsp+28h] [rbp-40h] BYREF

  while ( this->m_internalData->m_playbackRunning )
  {
    Instance = AgProgram::getInstance();
    if ( (unsigned int)AgProgram::getShutdownRequested(Instance) )
      break;
    AgClock::tick(&this->m_internalData->m_clock);
    TotalElapsedTime = AgClock::getTotalElapsedTime(&this->m_internalData->m_clock);
    m_internalData = this->m_internalData;
    if ( TotalElapsedTime > (float)(1.0 / m_internalData->m_frameRate) && m_internalData->m_decodeStarted )
    {
      AgClock::reset(&this->m_internalData->m_clock);
      m_freeBuffers = (unsigned int)this->m_internalData->m_freeBuffers;
      if ( (int)m_freeBuffers >= 64 )
      {
        AgTrace("Movie playback caught up with decode, free buffers: %d", m_freeBuffers);
        while ( this->m_internalData->m_freeBuffers >= 64 )
        {
          v6 = AgProgram::getInstance();
          if ( (unsigned int)AgProgram::getShutdownRequested(v6) )
            break;
          AgThread::sleep(0);
        }
      }
      v7 = this->m_internalData;
      m_ptr = (AgAudioChannel *)v7->m_frameBufferData[v7->m_currentReadFrameBuffer][0].m_ptr;
      v9 = (AgAudioChannel *)v7->m_frameData[0].m_ptr;
      v10 = ((__int64 (__fastcall *)(AgAudioChannel *))m_ptr->__vftable[4].~AgAudioChannel)(m_ptr);
      InternalData = AgAudioChannel::getInternalData(m_ptr);
      v12 = AgAudioChannel::getInternalData(v9);
      memmove(v12, InternalData, v10);
      v13 = this->m_internalData;
      v14 = (AgAudioChannel *)v13->m_frameBufferData[v13->m_currentReadFrameBuffer][1].m_ptr;
      v15 = (AgAudioChannel *)v13->m_frameData[1].m_ptr;
      v16 = ((__int64 (__fastcall *)(AgAudioChannel *))v14->__vftable[4].~AgAudioChannel)(v14);
      v17 = AgAudioChannel::getInternalData(v14);
      v18 = AgAudioChannel::getInternalData(v15);
      memmove(v18, v17, v16);
      v19 = this->m_internalData;
      v20 = (AgAudioChannel *)v19->m_frameBufferData[v19->m_currentReadFrameBuffer][2].m_ptr;
      v21 = (AgAudioChannel *)v19->m_frameData[2].m_ptr;
      v22 = ((__int64 (__fastcall *)(AgAudioChannel *))v20->__vftable[4].~AgAudioChannel)(v20);
      v23 = AgAudioChannel::getInternalData(v20);
      v24 = AgAudioChannel::getInternalData(v21);
      memmove(v24, v23, v22);
      AgAtomicIncrement(&this->m_internalData->m_freeBuffers);
      ++this->m_internalData->m_currentReadFrameBuffer;
      v25 = this->m_internalData;
      if ( v25->m_currentReadFrameBuffer >= 64 )
        v25->m_currentReadFrameBuffer = 0;
      ++this->m_internalData->m_currentFrame;
      v26 = this->m_internalData;
      m_frameCount = v26->m_frameCount;
      if ( m_frameCount != -1 && v26->m_currentFrame >= m_frameCount )
      {
        m_moviePlayer = this->m_moviePlayer;
        m_moviePlayer->m_internalData->m_stop = 1;
        m_moviePlayer->m_internalData->m_currentFrame = -1;
      }
      v29 = this->m_internalData;
      if ( v29->m_stop )
      {
        v30 = v29->m_audioChannel.m_ptr;
        if ( v30 )
          AgAudioChannel::stop(v30);
        v31 = (const AgPointer<AgPlayer> *)this->m_internalData;
        if ( v31[2].m_ptr )
        {
          AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(&v34, v31 + 2);
          AgSession::pauseUser((AgSession *)AgSingleton<AgAudioManager>::ms_instance, v32);
        }
        v33 = this->m_internalData->m_audioFile.m_ptr;
        if ( v33 )
          v33->close(v33);
        EnterCriticalSection((LPCRITICAL_SECTION)&this->m_internalData->m_codecLock);
        vpx_codec_destroy(&this->m_internalData->m_codecContext);
        LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_internalData->m_codecLock);
        this->m_internalData->m_videoFile.m_ptr->close(this->m_internalData->m_videoFile.m_ptr);
        this->m_internalData->m_playbackRunning = 0;
        this->m_internalData->m_decodeRunning = 0;
      }
    }
  }
}

void __fastcall AgMoviePlayerDecodeThreadHost::onJoinThread(AgMoviePlayerDecodeThreadHost *this)
{
  this->m_internalData->m_decodeRunning = 0;
}

void __fastcall AgMoviePlayerPlaybackThreadHost::onJoinThread(AgMoviePlayerPlaybackThreadHost *this)
{
  this->m_internalData->m_playbackRunning = 0;
}

__int64 __fastcall AgMoviePlayer::start(AgMoviePlayer *this, const AgString *fileName, int playMusic)
{
  int v3; // er12
  const AgString *v6; // rax
  AgPointer<AgFile> *v7; // rax
  AgFile *m_ptr; // r15
  AgController *v9; // rsi
  AgReferenceCount *m_ref; // rbx
  int v11; // er12
  AgFile *v12; // rcx
  unsigned int v13; // eax
  const AgString *v14; // rax
  int v15; // ebx
  const AgString *v16; // rax
  AgPointer<AgFile> *v17; // rax
  AgString *v18; // rcx
  const AgString *v19; // rax
  int v20; // ebx
  const AgString *v21; // rax
  AgPointer<AgFile> *v22; // rax
  AgMoviePlayer::InternalData *m_internalData; // rcx
  AgFile *v24; // rax
  AgPointer<AgFile> *v25; // rax
  AgPointer<AgFile> *Source; // rax
  AgPointer<AgFile> *v27; // rax
  int v28; // eax
  __int64 i; // rbx
  AgMoviePlayerPlaybackThreadHost *v30; // rax
  AgMoviePlayerPlaybackThreadHost *v31; // rdx
  AgMoviePlayer::InternalData *v32; // rcx
  AgThread *v33; // rax
  AgController *v34; // rax
  AgMoviePlayerDecodeThreadHost *v35; // rax
  AgMoviePlayerDecodeThreadHost *v36; // rdx
  AgMoviePlayer::InternalData *v37; // rcx
  AgThread *v38; // rax
  AgController *v39; // rax
  AgPointer<AgFile> v42; // [rsp+38h] [rbp-C8h] BYREF
  AgString v43; // [rsp+48h] [rbp-B8h] BYREF
  AgString v44; // [rsp+58h] [rbp-A8h] BYREF
  AgString v45; // [rsp+68h] [rbp-98h] BYREF
  AgString v46; // [rsp+78h] [rbp-88h] BYREF
  AgString v47; // [rsp+88h] [rbp-78h] BYREF
  __int64 v48; // [rsp+98h] [rbp-68h]
  AgString result; // [rsp+A0h] [rbp-60h] BYREF
  AgString v50; // [rsp+B0h] [rbp-50h] BYREF
  AgPointer<AgFile> v51; // [rsp+C0h] [rbp-40h] BYREF
  AgString v52; // [rsp+D0h] [rbp-30h] BYREF
  AgString v53; // [rsp+E0h] [rbp-20h] BYREF
  AgPointer<AgFile> v54; // [rsp+F0h] [rbp-10h] BYREF
  AgString v55; // [rsp+100h] [rbp+0h] BYREF
  AgPointer<AgPlayer> v56; // [rsp+110h] [rbp+10h] BYREF
  AgPointer<KOFApplication> v57; // [rsp+120h] [rbp+20h] BYREF
  AgPointer<AgAudioChannel> v58; // [rsp+130h] [rbp+30h] BYREF
  char v59[4]; // [rsp+140h] [rbp+40h] BYREF
  int v60; // [rsp+144h] [rbp+44h]
  char v61; // [rsp+148h] [rbp+48h]
  char v62; // [rsp+149h] [rbp+49h]
  char v63; // [rsp+14Ah] [rbp+4Ah]
  char v64; // [rsp+14Bh] [rbp+4Bh]
  unsigned __int16 v65; // [rsp+14Ch] [rbp+4Ch]
  unsigned __int16 v66; // [rsp+14Eh] [rbp+4Eh]
  int v67; // [rsp+150h] [rbp+50h]
  int v68; // [rsp+154h] [rbp+54h]
  int v69; // [rsp+158h] [rbp+58h]

  v48 = -2i64;
  v3 = playMusic;
  v6 = operator+(&result, fileName, ".ivf");
  AgString::AgString(&v43, v6);
  AgPath::clean((AgPath *)&v43);
  v7 = AgFile::open(&v42, (const AgPath *)&v43, 1u, 1);
  AgPointer<AgAudioChannel>::operator=(&this->m_internalData->m_videoFile, v7);
  m_ptr = v42.m_ptr;
  v9 = 0i64;
  v42.m_ptr = 0i64;
  m_ref = v42.m_ref;
  if ( v42.m_ref )
  {
    v42.m_ref = 0i64;
    v11 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v11 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgFile *, __int64))m_ptr->~AgStream)(m_ptr, 1i64);
      if ( v11 )
        AgReferenceCount::operator delete(m_ref);
    }
    v3 = playMusic;
  }
  AgString::~AgString(&v43);
  AgString::~AgString(&result);
  v12 = this->m_internalData->m_videoFile.m_ptr;
  if ( !v12 )
    return 0i64;
  if ( !v12->m_open )
    return 0i64;
  v13 = v12->read(v12, (unsigned __int8 *)v59, 32u);
  if ( v13 != 32
    || v59[0] != 68
    || v59[1] != 75
    || v59[2] != 73
    || v59[3] != 70
    || v60 != __PAIR32__(v13, 0)
    || v61 != 86
    || v62 != 80
    || v63 != 56
    || v64 != 48 )
  {
    return 0i64;
  }
  if ( !v3 )
    goto LABEL_28;
  v14 = operator+(&v50, fileName, ".ogg");
  AgString::AgString(&v44, v14);
  AgPath::clean((AgPath *)&v44);
  v15 = AgFile::exists((const AgPath *)&v44);
  AgString::~AgString(&v44);
  AgString::~AgString(&v50);
  if ( v15 )
  {
    v16 = operator+(&v52, fileName, ".ogg");
    AgString::AgString(&v45, v16);
    AgPath::clean((AgPath *)&v45);
    v17 = AgFile::open(&v51, (const AgPath *)&v45, 1u, 1);
    AgPointer<AgAudioChannel>::operator=(&this->m_internalData->m_audioFile, v17);
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v51);
    AgString::~AgString(&v45);
    v18 = &v52;
LABEL_27:
    AgString::~AgString(v18);
    goto LABEL_28;
  }
  v19 = operator+(&v53, fileName, ".mp3");
  AgString::AgString(&v46, v19);
  AgPath::clean((AgPath *)&v46);
  v20 = AgFile::exists((const AgPath *)&v46);
  AgString::~AgString(&v46);
  AgString::~AgString(&v53);
  if ( v20 )
  {
    AgTrace("AgMoviePlayer Warning: Using mp3 format audio, make sure licensing is in order!");
    v21 = operator+(&v55, fileName, ".mp3");
    AgString::AgString(&v47, v21);
    AgPath::clean((AgPath *)&v47);
    v22 = AgFile::open(&v54, (const AgPath *)&v47, 1u, 1);
    AgPointer<AgAudioChannel>::operator=(&this->m_internalData->m_audioFile, v22);
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v54);
    AgString::~AgString(&v47);
    v18 = &v55;
    goto LABEL_27;
  }
LABEL_28:
  m_internalData = this->m_internalData;
  v24 = m_internalData->m_audioFile.m_ptr;
  if ( v24 && v24->m_open )
  {
    AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
      &v56,
      (const AgPointer<AgPlayer> *)&m_internalData->m_audioFile);
    Source = (AgPointer<AgFile> *)AgAudioManager::createSource(
                                    (AgAudioManager *)AgSingleton<AgAudioManager>::ms_instance,
                                    (AgPointer<AgAudioSource> *)&v57,
                                    v25,
                                    AgAudioSourceType_Stream,
                                    0,
                                    1.0);
    AgPointer<AgAudioChannel>::operator=((AgPointer<AgFile> *)&this->m_internalData->m_audioSource, Source);
    AgPointer<AgUser>::~AgPointer<AgUser>(&v57);
    v27 = (AgPointer<AgFile> *)AgAudioSource::createChannel(this->m_internalData->m_audioSource.m_ptr, &v58);
    AgPointer<AgAudioChannel>::operator=((AgPointer<AgFile> *)&this->m_internalData->m_audioChannel, v27);
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v58);
    AgAudioChannel::play(this->m_internalData->m_audioChannel.m_ptr, 1u);
  }
  else
  {
    AgPointer<AgThread>::operator=((AgPointer<AgController> *)&m_internalData->m_audioSource, 0i64);
    AgPointer<AgThread>::operator=((AgPointer<AgController> *)&this->m_internalData->m_audioChannel, 0i64);
  }
  v28 = vpx_codec_vp8_dx();
  if ( (unsigned int)vpx_codec_dec_init_ver(LODWORD(this->m_internalData) + 136, v28, 0, 0, 10) )
    return 0i64;
  this->m_internalData->m_frameRate = (double)v67 / (double)v68;
  this->m_internalData->m_frameCount = v69;
  this->m_internalData->m_currentFrame = -1;
  this->m_internalData->m_width = v65;
  this->m_internalData->m_height = v66;
  this->m_internalData->m_stride = ((this->m_internalData->m_width + 15) & 0xFFFFFFF0) + 64;
  AgMemoryStream::setSize(
    this->m_internalData->m_frameData[0].m_ptr,
    this->m_internalData->m_height * this->m_internalData->m_stride);
  AgMemoryStream::setSize(
    this->m_internalData->m_frameData[1].m_ptr,
    this->m_internalData->m_height * (this->m_internalData->m_stride / 2) / 2);
  AgMemoryStream::setSize(
    this->m_internalData->m_frameData[2].m_ptr,
    this->m_internalData->m_height * (this->m_internalData->m_stride / 2) / 2);
  for ( i = 0i64; i < 64; ++i )
  {
    AgMemoryStream::setSize(
      this->m_internalData->m_frameBufferData[i][0].m_ptr,
      this->m_internalData->m_height * this->m_internalData->m_stride);
    AgMemoryStream::setSize(
      this->m_internalData->m_frameBufferData[i][1].m_ptr,
      this->m_internalData->m_height * (this->m_internalData->m_stride / 2) / 2);
    AgMemoryStream::setSize(
      this->m_internalData->m_frameBufferData[i][2].m_ptr,
      this->m_internalData->m_height * (this->m_internalData->m_stride / 2) / 2);
  }
  this->m_internalData->m_playbackRunning = 1;
  this->m_internalData->m_decodeRunning = 1;
  this->m_internalData->m_stop = 0;
  this->m_internalData->m_eof = 0;
  v30 = (AgMoviePlayerPlaybackThreadHost *)operator new(0x18ui64);
  v31 = v30;
  if ( v30 )
  {
    v32 = this->m_internalData;
    v30->__vftable = (AgMoviePlayerPlaybackThreadHost_vtbl *)&AgIThreadHost::`vftable';
    v30->__vftable = (AgMoviePlayerPlaybackThreadHost_vtbl *)&AgMoviePlayerPlaybackThreadHost::`vftable';
    v30->m_moviePlayer = this;
    v30->m_internalData = v32;
  }
  else
  {
    v31 = 0i64;
  }
  this->m_internalData->m_playbackThreadHost = v31;
  v33 = (AgThread *)operator new(0x28ui64);
  if ( v33 )
    AgThread::AgThread(v33, this->m_internalData->m_playbackThreadHost, 0x100000ui64, 75, "AgMoviePlayer Playback");
  else
    v34 = 0i64;
  AgPointer<AgThread>::operator=((AgPointer<AgController> *)&this->m_internalData->m_playbackThread, v34);
  v35 = (AgMoviePlayerDecodeThreadHost *)operator new(0x18ui64);
  v36 = v35;
  if ( v35 )
  {
    v37 = this->m_internalData;
    v35->__vftable = (AgMoviePlayerDecodeThreadHost_vtbl *)&AgIThreadHost::`vftable';
    v35->__vftable = (AgMoviePlayerDecodeThreadHost_vtbl *)&AgMoviePlayerDecodeThreadHost::`vftable';
    v35->m_moviePlayer = this;
    v35->m_internalData = v37;
  }
  else
  {
    v36 = 0i64;
  }
  this->m_internalData->m_decodeThreadHost = v36;
  v38 = (AgThread *)operator new(0x28ui64);
  if ( v38 )
  {
    AgThread::AgThread(v38, this->m_internalData->m_decodeThreadHost, 0x100000ui64, 0, "AgMoviePlayer Decode");
    v9 = v39;
  }
  AgPointer<AgThread>::operator=((AgPointer<AgController> *)&this->m_internalData->m_decodeThread, v9);
  return 1i64;
}

void __fastcall AgMoviePlayer::stop(AgMoviePlayer *this)
{
  this->m_internalData->m_stop = 1;
  this->m_internalData->m_currentFrame = -1;
}

