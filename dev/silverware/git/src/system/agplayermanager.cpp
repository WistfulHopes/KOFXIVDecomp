#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "dev/silverware/git/sdk/util/agworkerpool.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "dev/silverware/git/sdk/agthreadpool.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "dev/silverware/git/sdk/agsemaphore.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "dev/silverware/git/sdk/agsemaphore.inl"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/algorithm"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "dev/silverware/git/sdk/util/agdelegate.h"
#include "dev/silverware/git/sdk/system/agusermanager.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "dev/silverware/git/sdk/input/aginputmanager.h"
#include "dev/silverware/git/sdk/input/agcontroller.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "dev/silverware/git/sdk/agvector2.h"
#include "dev/silverware/git/sdk/input/agcontrollercomponent.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "dev/silverware/git/sdk/agmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/list"
#include "dev/silverware/git/sdk/agcondition.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "dev/silverware/git/sdk/util/agservice.h"
#include "dev/silverware/git/sdk/agthread.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "dev/silverware/git/sdk/util/agservicecommand.h"
#include "dev/silverware/git/sdk/memory/agallocators.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "dev/silverware/git/sdk/util/agdebugchannels.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/silverware/git/sdk/util/agperformancecounter.h"
#include "dev/silverware/git/sdk/agclock.h"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/silverware/git/sdk/agreferenceinl.h"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "dev/silverware/git/sdk/agcondition.inl"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "dev/silverware/git/sdk/agmemorystream.h"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "dev/silverware/git/sdk/system/agplayer.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "dev/silverware/git/sdk/agpointer.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "dev/silverware/git/sdk/input/agcontrollerbuttoncomponent.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "dev/silverware/git/sdk/system/agplayermanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/util/ageventdispatcher.h"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "dev/silverware/git/sdk/agmutex.h"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"

std::piecewise_construct_t std::piecewise_construct; // 0x1408687B7
AgPlayerManager::AgPlayerManager(); // 0x1406719F0
AgEventDispatcher<AgPlayerAddedEvent>::~AgEventDispatcher<AgPlayerAddedEvent>(); // 0x140671B10
AgEventDispatcher<AgPlayerRemovedEvent>::~AgEventDispatcher<AgPlayerRemovedEvent>(); // 0x140671B70
AgEventDispatcher<AgPlayerUpdatedEvent>::~AgEventDispatcher<AgPlayerUpdatedEvent>(); // 0x140671BD0
AgEventDispatcherBase<AgPlayerAddedEvent>::~AgEventDispatcherBase<AgPlayerAddedEvent>(); // 0x140671C30
AgEventDispatcherBase<AgPlayerRemovedEvent>::~AgEventDispatcherBase<AgPlayerRemovedEvent>(); // 0x140671C90
AgEventDispatcherBase<AgPlayerUpdatedEvent>::~AgEventDispatcherBase<AgPlayerUpdatedEvent>(); // 0x140671CF0
AgPlayerManager::~AgPlayerManager(); // 0x140671E60
long AgPlayerManager::onSingletonInit(); // 0x140672FE0
long AgPlayerManager::onSingletonExit(); // 0x140672F50
AgPointer<AgPlayer> AgPlayerManager::getPlayer(long playerId); // 0x1406726E0
AgPointer<AgPlayer> AgPlayerManager::getPlayerForUser(long long userId); // 0x140672790
AgPointer<AgPlayer> AgPlayerManager::getPrimaryPlayer(); // 0x140672910
void AgPlayerManager::flagPlayersDirty(); // 0x140672630
AgPointer<AgPlayer> AgPlayerManager::createPlayer(); // 0x140672520
void AgPlayerManager::onUserAdded(const AgUserAddedEvent & e); // 0x140673160
void AgPlayerManager::onUserRemoved(const AgUserRemovedEvent & e); // 0x1406731C0
void AgPlayerManager::onControllerAdded(const AgControllerAddedEvent & e); // 0x1406729F0
void AgPlayerManager::initializePrimaryPlayer(); // 0x140672950
void AgPlayerManager::update(); // 0x140673780//decompilation failure at 1408687B7!
void __fastcall std::_Destroy_range<std::allocator<AgPointer<AgPlayer>>,AgPointer<AgPlayer> *>(
        AgPointer<AgPlayer> *_First,
        AgPointer<AgPlayer> *_Last,
        std::_Wrap_alloc<std::allocator<AgPointer<AgPlayer> > > *_Al)
{
  AgPointer<AgPlayer> *v4; // rbx

  if ( _First != _Last )
  {
    v4 = _First;
    do
      AgPointer<AgPlayer>::~AgPointer<AgPlayer>(v4++);
    while ( v4 != _Last );
  }
}

AgPointer<AgController> *__fastcall std::_Move_unchecked1<AgPointer<AgController> *,AgPointer<AgController> *>(
        AgPointer<AgController> *_First,
        AgPointer<AgController> *_Last,
        AgPointer<AgController> *_Dest,
        std::_General_ptr_iterator_tag __formal)
{
  AgPointer<AgController> *i; // rbx
  AgReferenceCount *m_ref; // r9
  AgController *m_ptr; // rax
  AgReferenceCount *v9; // rdi
  AgController *v10; // r14
  int v11; // ebp

  for ( i = _First; i != _Last; ++i )
  {
    m_ref = i->m_ref;
    m_ptr = i->m_ptr;
    i->m_ref = 0i64;
    i->m_ptr = 0i64;
    v9 = _Dest->m_ref;
    v10 = _Dest->m_ptr;
    _Dest->m_ref = m_ref;
    _Dest->m_ptr = m_ptr;
    if ( v9 )
    {
      v11 = 0;
      if ( !(unsigned int)AgAtomicDecrement(&v9->m_strongCount) )
      {
        if ( !(unsigned int)AgAtomicDecrement(&v9->m_weakCount) )
          v11 = 1;
        v9->m_data = 0i64;
        if ( v10 )
          ((void (__fastcall *)(AgController *, __int64))v10->~AgController)(v10, 1i64);
        if ( v11 )
          AgReferenceCount::operator delete(v9);
      }
    }
    ++_Dest;
  }
  return _Dest;
}

AgDelegate1<AgUserAddedEvent const &,void> *__fastcall std::_Uninitialized_move_al_unchecked1<AgDelegate1<AgUserAddedEvent const &,void> *,AgDelegate1<AgUserAddedEvent const &,void> *,std::allocator<AgDelegate1<AgUserAddedEvent const &,void>>>(
        AgDelegate1<AgUserAddedEvent const &,void> *_First,
        AgDelegate1<AgUserAddedEvent const &,void> *_Last,
        AgDelegate1<AgUserAddedEvent const &,void> *_Dest,
        std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserAddedEvent const &,void> > > *_Al)
{
  while ( _First != _Last )
  {
    if ( _Dest )
    {
      _Dest->m_Closure.m_pthis = 0i64;
      _Dest->m_Closure.m_pFunction = 0i64;
      *_Dest = *_First;
    }
    ++_Dest;
    ++_First;
  }
  return _Dest;
}

AgDelegate1<AgUserRemovedEvent const &,void> *__fastcall std::_Uninitialized_move_al_unchecked1<AgDelegate1<AgUserRemovedEvent const &,void> *,AgDelegate1<AgUserRemovedEvent const &,void> *,std::allocator<AgDelegate1<AgUserRemovedEvent const &,void>>>(
        AgDelegate1<AgUserRemovedEvent const &,void> *_First,
        AgDelegate1<AgUserRemovedEvent const &,void> *_Last,
        AgDelegate1<AgUserRemovedEvent const &,void> *_Dest,
        std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserRemovedEvent const &,void> > > *_Al)
{
  while ( _First != _Last )
  {
    if ( _Dest )
    {
      _Dest->m_Closure.m_pthis = 0i64;
      _Dest->m_Closure.m_pFunction = 0i64;
      *_Dest = *_First;
    }
    ++_Dest;
    ++_First;
  }
  return _Dest;
}

AgPointer<AgPlayer> *__fastcall std::_Uninitialized_move_al_unchecked1<AgPointer<AgPlayer> *,AgPointer<AgPlayer> *,std::allocator<AgPointer<AgPlayer>>>(
        AgPointer<AgPlayer> *_First,
        AgPointer<AgPlayer> *_Last,
        AgPointer<AgPlayer> *_Dest,
        std::_Wrap_alloc<std::allocator<AgPointer<AgPlayer> > > *_Al)
{
  while ( _First != _Last )
  {
    if ( _Dest )
    {
      *_Dest = *_First;
      _First->m_ref = 0i64;
      _First->m_ptr = 0i64;
    }
    ++_Dest;
    ++_First;
  }
  return _Dest;
}

void __fastcall AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
        AgPointer<AgPlayer> *this,
        const AgPointer<AgPlayer> *rhs)
{
  AgReferenceCount *m_ref; // rsi
  int m_strongCount; // ebx

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  m_ref = rhs->m_ref;
  if ( rhs->m_ref )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( m_ref->m_strongCount )
    {
      while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
      {
        m_strongCount = m_ref->m_strongCount;
        if ( !m_ref->m_strongCount )
          return;
      }
      if ( m_strongCount != -1 )
      {
        this->m_ref = rhs->m_ref;
        this->m_ptr = rhs->m_ptr;
      }
    }
  }
}

void __fastcall AgPointer<AgPlayer>::AgPointer<AgPlayer>(AgPointer<AgPlayer> *this, AgPlayer *t)
{
  AgReferenceCount *v4; // rax
  int v5; // ecx
  AgReferenceCount *m_refCount; // rsi

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  if ( t )
  {
    if ( t->m_refCount )
    {
      v5 = 0;
    }
    else
    {
      v4 = (AgReferenceCount *)AgReferenceCount::operator new(0x10ui64);
      v5 = 1;
      if ( v4 )
      {
        v4->m_strongCount = 1;
        v4->m_weakCount = 1;
        v4->m_data = t;
      }
      else
      {
        v4 = 0i64;
      }
      t->m_refCount = v4;
    }
    m_refCount = t->m_refCount;
    if ( !v5 )
      AgReferenceCount::incRef(t->m_refCount);
    this->m_ref = m_refCount;
    this->m_ptr = t;
  }
}

void __fastcall AgPlayerManager::AgPlayerManager(AgPlayerManager *this)
{
  char *v2; // rax
  char *v3; // rbx

  this->__vftable = (AgPlayerManager_vtbl *)&AgSingleton<AgPlayerManager>::`vftable';
  this->__vftable = (AgPlayerManager_vtbl *)&AgPlayerManager::`vftable';
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  this->m_players._Mypair._Myval2._Myfirst = 0i64;
  this->m_players._Mypair._Myval2._Mylast = 0i64;
  this->m_players._Mypair._Myval2._Myend = 0i64;
  this->m_primaryPlayerId = -1;
  v2 = (char *)operator new(0x68ui64);
  v3 = v2;
  if ( v2 )
  {
    *(_QWORD *)v2 = 0i64;
    InitializeCriticalSection((LPCRITICAL_SECTION)(v2 + 8));
    *((_DWORD *)v3 + 12) = -1;
    *(_QWORD *)(v3 + 52) = 0i64;
    *((_QWORD *)v3 + 8) = 0i64;
    *((_QWORD *)v3 + 9) = 0i64;
    *((_QWORD *)v3 + 10) = 0i64;
    *((_QWORD *)v3 + 11) = 0i64;
    *((_QWORD *)v3 + 12) = 0i64;
  }
  else
  {
    v3 = 0i64;
  }
  AgPointer<AgPlayer>::AgPointer<AgPlayer>(&this->m_invalidPlayer, (AgPlayer *)v3);
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->PlayerAdded);
  this->PlayerAdded.m_bindings._Mypair._Myval2._Myfirst = 0i64;
  this->PlayerAdded.m_bindings._Mypair._Myval2._Mylast = 0i64;
  this->PlayerAdded.m_bindings._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->PlayerRemoved);
  this->PlayerRemoved.m_bindings._Mypair._Myval2._Myfirst = 0i64;
  this->PlayerRemoved.m_bindings._Mypair._Myval2._Mylast = 0i64;
  this->PlayerRemoved.m_bindings._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->PlayerUpdated);
  this->PlayerUpdated.m_bindings._Mypair._Myval2._Myfirst = 0i64;
  this->PlayerUpdated.m_bindings._Mypair._Myval2._Mylast = 0i64;
  this->PlayerUpdated.m_bindings._Mypair._Myval2._Myend = 0i64;
}

void __fastcall AgEventDispatcher<AgPlayerAddedEvent>::~AgEventDispatcher<AgPlayerAddedEvent>(
        AgEventDispatcher<AgPlayerAddedEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcher<AgPlayerRemovedEvent>::~AgEventDispatcher<AgPlayerRemovedEvent>(
        AgEventDispatcher<AgPlayerRemovedEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcher<AgPlayerUpdatedEvent>::~AgEventDispatcher<AgPlayerUpdatedEvent>(
        AgEventDispatcher<AgPlayerUpdatedEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgPlayerAddedEvent>::~AgEventDispatcherBase<AgPlayerAddedEvent>(
        AgEventDispatcherBase<AgPlayerAddedEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgPlayerRemovedEvent>::~AgEventDispatcherBase<AgPlayerRemovedEvent>(
        AgEventDispatcherBase<AgPlayerRemovedEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgPlayerUpdatedEvent>::~AgEventDispatcherBase<AgPlayerUpdatedEvent>(
        AgEventDispatcherBase<AgPlayerUpdatedEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgSingleton<AgPlayerManager>::~AgSingleton<AgPlayerManager>(AgSingleton<AgPlayerManager> *this)
{
  this->__vftable = (AgSingleton<AgPlayerManager>_vtbl *)&AgSingleton<AgPlayerManager>::`vftable';
}

void __fastcall std::vector<AgDelegate1<AgPlayerAddedEvent const &,void>>::~vector<AgDelegate1<AgPlayerAddedEvent const &,void>>(
        std::vector<AgDelegate1<AgPlayerAddedEvent const &,void>> *this)
{
  if ( this->_Mypair._Myval2._Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgDelegate1<AgPlayerRemovedEvent const &,void>>::~vector<AgDelegate1<AgPlayerRemovedEvent const &,void>>(
        std::vector<AgDelegate1<AgPlayerRemovedEvent const &,void>> *this)
{
  if ( this->_Mypair._Myval2._Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgDelegate1<AgPlayerUpdatedEvent const &,void>>::~vector<AgDelegate1<AgPlayerUpdatedEvent const &,void>>(
        std::vector<AgDelegate1<AgPlayerUpdatedEvent const &,void>> *this)
{
  if ( this->_Mypair._Myval2._Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgPointer<AgPlayer>>::~vector<AgPointer<AgPlayer>>(std::vector<AgPointer<AgPlayer>> *this)
{
  std::vector<AgPointer<AgPlayer>>::_Tidy(this);
}

void __fastcall std::vector<AgPointer<AgUser>>::~vector<AgPointer<AgUser>>(std::vector<AgPointer<AgUser>> *this)
{
  std::vector<AgPointer<AgThread>>::_Tidy(this);
}

void __fastcall AgPlayerManager::~AgPlayerManager(AgPlayerManager *this)
{
  AgEventDispatcher<AgPlayerUpdatedEvent> *p_PlayerUpdated; // rsi
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx
  AgDelegate1<AgUserUpdatedEvent const &,void> *v4; // rdx
  AgDelegate1<AgUserUpdatedEvent const &,void> *v5; // rdx

  this->__vftable = (AgPlayerManager_vtbl *)&AgPlayerManager::`vftable';
  p_PlayerUpdated = &this->PlayerUpdated;
  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->PlayerUpdated.m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->PlayerUpdated.m_bindings,
      Myfirst,
      ((char *)this->PlayerUpdated.m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    p_PlayerUpdated->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    p_PlayerUpdated->m_bindings._Mypair._Myval2._Mylast = 0i64;
    p_PlayerUpdated->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)p_PlayerUpdated);
  v4 = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->PlayerRemoved.m_bindings._Mypair._Myval2._Myfirst;
  if ( v4 )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->PlayerRemoved.m_bindings,
      v4,
      ((char *)this->PlayerRemoved.m_bindings._Mypair._Myval2._Myend - (char *)v4) >> 4);
    this->PlayerRemoved.m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->PlayerRemoved.m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->PlayerRemoved.m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->PlayerRemoved);
  v5 = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->PlayerAdded.m_bindings._Mypair._Myval2._Myfirst;
  if ( v5 )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->PlayerAdded.m_bindings,
      v5,
      ((char *)this->PlayerAdded.m_bindings._Mypair._Myval2._Myend - (char *)v5) >> 4);
    this->PlayerAdded.m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->PlayerAdded.m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->PlayerAdded.m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->PlayerAdded);
  AgPointer<AgPlayer>::~AgPointer<AgPlayer>(&this->m_invalidPlayer);
  std::vector<AgPointer<AgPlayer>>::_Tidy(&this->m_players);
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  this->__vftable = (AgPlayerManager_vtbl *)&AgSingleton<AgPlayerManager>::`vftable';
}

char __fastcall AgServiceCommand<AgAllocator<1>,AgPlayerManager *,void (void),void (void)>::operator()(
        AgServiceCommand<AgAllocator<1>,AgPlayerManager *,void __cdecl(void),void __cdecl(void)> *this)
{
  this->m_delegate.m_Closure.m_pFunction(this->m_delegate.m_Closure.m_pthis);
  return 1;
}

void __fastcall std::vector<AgDelegate1<AgUserAddedEvent const &,void>>::_Reallocate(
        std::vector<AgDelegate1<AgUserAddedEvent const &,void>> *this,
        unsigned __int64 _Count)
{
  AgDelegate1<AgUserAddedEvent const &,void> *v4; // r14
  signed __int64 v5; // rdi

  v4 = (AgDelegate1<AgUserAddedEvent const &,void> *)std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
                                                       (std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *)this,
                                                       _Count);
  std::_Uninitialized_move_al_unchecked1<AgDelegate1<AgUserAddedEvent const &,void> *,AgDelegate1<AgUserAddedEvent const &,void> *,std::allocator<AgDelegate1<AgUserAddedEvent const &,void>>>(
    this->_Mypair._Myval2._Myfirst,
    this->_Mypair._Myval2._Mylast,
    v4,
    (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserAddedEvent const &,void> > > *)this);
  v5 = (char *)this->_Mypair._Myval2._Mylast - (char *)this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
  this->_Mypair._Myval2._Myend = &v4[_Count];
  this->_Mypair._Myval2._Mylast = (AgDelegate1<AgUserAddedEvent const &,void> *)((char *)v4
                                                                               + (v5 & 0xFFFFFFFFFFFFFFF0ui64));
  this->_Mypair._Myval2._Myfirst = v4;
}

void __fastcall std::vector<AgDelegate1<AgUserRemovedEvent const &,void>>::_Reallocate(
        std::vector<AgDelegate1<AgUserRemovedEvent const &,void>> *this,
        unsigned __int64 _Count)
{
  AgDelegate1<AgUserRemovedEvent const &,void> *v4; // r14
  signed __int64 v5; // rdi

  v4 = (AgDelegate1<AgUserRemovedEvent const &,void> *)std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
                                                         (std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *)this,
                                                         _Count);
  std::_Uninitialized_move_al_unchecked1<AgDelegate1<AgUserRemovedEvent const &,void> *,AgDelegate1<AgUserRemovedEvent const &,void> *,std::allocator<AgDelegate1<AgUserRemovedEvent const &,void>>>(
    this->_Mypair._Myval2._Myfirst,
    this->_Mypair._Myval2._Mylast,
    v4,
    (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserRemovedEvent const &,void> > > *)this);
  v5 = (char *)this->_Mypair._Myval2._Mylast - (char *)this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
  this->_Mypair._Myval2._Myend = &v4[_Count];
  this->_Mypair._Myval2._Mylast = (AgDelegate1<AgUserRemovedEvent const &,void> *)((char *)v4
                                                                                 + (v5 & 0xFFFFFFFFFFFFFFF0ui64));
  this->_Mypair._Myval2._Myfirst = v4;
}

void __fastcall std::vector<AgPointer<AgPlayer>>::_Reallocate(
        std::vector<AgPointer<AgPlayer>> *this,
        unsigned __int64 _Count)
{
  AgPointer<AgPlayer> *v4; // r12
  AgPointer<AgPlayer> *Mylast; // r14
  AgPointer<AgPlayer> *Myfirst; // rbx
  signed __int64 v7; // rsi

  v4 = (AgPointer<AgPlayer> *)std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
                                (std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *)this,
                                _Count);
  std::_Uninitialized_move_al_unchecked1<AgPointer<AgPlayer> *,AgPointer<AgPlayer> *,std::allocator<AgPointer<AgPlayer>>>(
    this->_Mypair._Myval2._Myfirst,
    this->_Mypair._Myval2._Mylast,
    v4,
    (std::_Wrap_alloc<std::allocator<AgPointer<AgPlayer> > > *)this);
  Mylast = this->_Mypair._Myval2._Mylast;
  Myfirst = this->_Mypair._Myval2._Myfirst;
  v7 = (char *)Mylast - (char *)this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( ; Myfirst != Mylast; ++Myfirst )
      AgPointer<AgPlayer>::~AgPointer<AgPlayer>(Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
  }
  this->_Mypair._Myval2._Myend = &v4[_Count];
  this->_Mypair._Myval2._Mylast = (AgPointer<AgPlayer> *)((char *)v4 + (v7 & 0xFFFFFFFFFFFFFFF0ui64));
  this->_Mypair._Myval2._Myfirst = v4;
}

void __fastcall std::vector<AgDelegate1<AgUserAddedEvent const &,void>>::_Reserve(
        std::vector<AgDelegate1<AgUserAddedEvent const &,void>> *this,
        unsigned __int64 _Count)
{
  AgDelegate1<AgUserAddedEvent const &,void> *Myend; // r10
  AgDelegate1<AgUserAddedEvent const &,void> *Mylast; // r8
  AgDelegate1<AgUserAddedEvent const &,void> *Myfirst; // rcx
  __int64 v6; // r8
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // r10
  unsigned __int64 v9; // rcx

  Myend = this->_Mypair._Myval2._Myend;
  Mylast = this->_Mypair._Myval2._Mylast;
  if ( Myend - Mylast < _Count )
  {
    Myfirst = this->_Mypair._Myval2._Myfirst;
    v6 = Mylast - Myfirst;
    if ( 0xFFFFFFFFFFFFFFFi64 - v6 < _Count )
      std::_Xlength_error("vector<T> too long");
    v7 = v6 + _Count;
    v8 = Myend - Myfirst;
    v9 = 0i64;
    if ( 0xFFFFFFFFFFFFFFFi64 - (v8 >> 1) >= v8 )
      v9 = v8 + (v8 >> 1);
    if ( v9 >= v7 )
      v7 = v9;
    std::vector<AgDelegate1<AgUserAddedEvent const &,void>>::_Reallocate(this, v7);
  }
}

void __fastcall std::vector<AgDelegate1<AgUserRemovedEvent const &,void>>::_Reserve(
        std::vector<AgDelegate1<AgUserRemovedEvent const &,void>> *this,
        unsigned __int64 _Count)
{
  AgDelegate1<AgUserRemovedEvent const &,void> *Myend; // r10
  AgDelegate1<AgUserRemovedEvent const &,void> *Mylast; // r8
  AgDelegate1<AgUserRemovedEvent const &,void> *Myfirst; // rcx
  __int64 v6; // r8
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // r10
  unsigned __int64 v9; // rcx

  Myend = this->_Mypair._Myval2._Myend;
  Mylast = this->_Mypair._Myval2._Mylast;
  if ( Myend - Mylast < _Count )
  {
    Myfirst = this->_Mypair._Myval2._Myfirst;
    v6 = Mylast - Myfirst;
    if ( 0xFFFFFFFFFFFFFFFi64 - v6 < _Count )
      std::_Xlength_error("vector<T> too long");
    v7 = v6 + _Count;
    v8 = Myend - Myfirst;
    v9 = 0i64;
    if ( 0xFFFFFFFFFFFFFFFi64 - (v8 >> 1) >= v8 )
      v9 = v8 + (v8 >> 1);
    if ( v9 >= v7 )
      v7 = v9;
    std::vector<AgDelegate1<AgUserRemovedEvent const &,void>>::_Reallocate(this, v7);
  }
}

void __fastcall std::vector<AgPointer<AgPlayer>>::_Reserve(
        std::vector<AgPointer<AgPlayer>> *this,
        unsigned __int64 _Count)
{
  AgPointer<AgPlayer> *Myend; // r10
  AgPointer<AgPlayer> *Mylast; // r8
  AgPointer<AgPlayer> *Myfirst; // rcx
  __int64 v6; // r8
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // r10
  unsigned __int64 v9; // rcx

  Myend = this->_Mypair._Myval2._Myend;
  Mylast = this->_Mypair._Myval2._Mylast;
  if ( Myend - Mylast < _Count )
  {
    Myfirst = this->_Mypair._Myval2._Myfirst;
    v6 = Mylast - Myfirst;
    if ( 0xFFFFFFFFFFFFFFFi64 - v6 < _Count )
      std::_Xlength_error("vector<T> too long");
    v7 = v6 + _Count;
    v8 = Myend - Myfirst;
    v9 = 0i64;
    if ( 0xFFFFFFFFFFFFFFFi64 - (v8 >> 1) >= v8 )
      v9 = v8 + (v8 >> 1);
    if ( v9 >= v7 )
      v7 = v9;
    std::vector<AgPointer<AgPlayer>>::_Reallocate(this, v7);
  }
}

void __fastcall std::vector<AgPointer<AgPlayer>>::_Tidy(std::vector<AgPointer<AgPlayer>> *this)
{
  AgPointer<AgPlayer> *Myfirst; // rbx
  AgPointer<AgPlayer> *i; // rdi

  Myfirst = this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( i = this->_Mypair._Myval2._Mylast; Myfirst != i; ++Myfirst )
      AgPointer<AgPlayer>::~AgPointer<AgPlayer>(Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgPointer<AgThread>>::_Tidy(std::vector<AgPointer<AgUser>> *this)
{
  AgPointer<AgUser> *Myfirst; // rbx
  AgPointer<AgUser> *i; // rdi

  Myfirst = this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( i = this->_Mypair._Myval2._Mylast; Myfirst != i; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

AgDelegate1<AgShutdownEvent const &,void> *__fastcall std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
        std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *this,
        unsigned __int64 _Count)
{
  AgDelegate1<AgShutdownEvent const &,void> *result; // rax
  unsigned __int64 v3; // rdx
  void (__fastcall *v4)(detail::GenericClass *); // rax
  void (__fastcall *v5)(detail::GenericClass *); // rcx

  if ( !_Count )
    return 0i64;
  if ( _Count > 0xFFFFFFFFFFFFFFFi64 )
    std::_Xbad_alloc();
  v3 = 16 * _Count;
  if ( v3 < 0x1000 )
  {
    result = (AgDelegate1<AgShutdownEvent const &,void> *)operator new(v3);
    if ( !result )
      invalid_parameter_noinfo_noreturn();
  }
  else
  {
    if ( v3 + 39 <= v3 )
      std::_Xbad_alloc();
    v4 = (void (__fastcall *)(detail::GenericClass *))operator new(v3 + 39);
    v5 = v4;
    if ( !v4 )
      invalid_parameter_noinfo_noreturn();
    result = (AgDelegate1<AgShutdownEvent const &,void> *)(((unsigned __int64)v4 + 39) & 0xFFFFFFFFFFFFFFE0ui64);
    result[-1].m_Closure.m_pFunction = v5;
  }
  return result;
}

void __fastcall AgPlayer::clearControllers(AgPlayer *this)
{
  AgMutex *p_m_mutex; // rbp
  AgPointer<AgController> *Mylast; // rdi
  AgPointer<AgController> *i; // rbx

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  Mylast = this->m_controllers._Mypair._Myval2._Mylast;
  for ( i = this->m_controllers._Mypair._Myval2._Myfirst; i != Mylast; ++i )
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)i);
  this->m_controllers._Mypair._Myval2._Mylast = this->m_controllers._Mypair._Myval2._Myfirst;
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
}

AgPointer<AgPlayer> *__fastcall AgPlayerManager::createPlayer(AgPlayerManager *this, AgPointer<AgPlayer> *result)
{
  AgMutex *p_m_mutex; // r14
  char *v5; // rax
  char *v6; // rdi
  signed __int64 v7; // rbx

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  v5 = (char *)operator new(0x68ui64);
  v6 = v5;
  if ( v5 )
  {
    v7 = this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst;
    *(_QWORD *)v5 = 0i64;
    InitializeCriticalSection((LPCRITICAL_SECTION)(v5 + 8));
    *((_DWORD *)v6 + 12) = v7;
    *(_QWORD *)(v6 + 52) = 0i64;
    *((_QWORD *)v6 + 8) = 0i64;
    *((_QWORD *)v6 + 9) = 0i64;
    *((_QWORD *)v6 + 10) = 0i64;
    *((_QWORD *)v6 + 11) = 0i64;
    *((_QWORD *)v6 + 12) = 0i64;
  }
  else
  {
    v6 = 0i64;
  }
  AgPointer<AgPlayer>::AgPointer<AgPlayer>(result, (AgPlayer *)v6);
  std::vector<AgPointer<AgPlayer>>::push_back(&this->m_players, result);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  return result;
}

void __fastcall std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
        std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *this,
        AgDelegate1<AgUserUpdatedEvent const &,void> *_Ptr,
        unsigned __int64 _Count)
{
  void (__fastcall *m_pFunction)(detail::GenericClass *); // rax
  char *v4; // rdx

  if ( _Count > 0xFFFFFFFFFFFFFFFi64 )
    invalid_parameter_noinfo_noreturn();
  if ( 16 * _Count >= 0x1000 )
  {
    if ( ((unsigned __int8)_Ptr & 0x1F) != 0 )
      invalid_parameter_noinfo_noreturn();
    m_pFunction = _Ptr[-1].m_Closure.m_pFunction;
    if ( (AgDelegate1<AgUserUpdatedEvent const &,void> *)m_pFunction >= _Ptr )
      invalid_parameter_noinfo_noreturn();
    v4 = (char *)((char *)_Ptr - (char *)m_pFunction);
    if ( (unsigned __int64)v4 < 8 )
      invalid_parameter_noinfo_noreturn();
    if ( (unsigned __int64)v4 > 0x27 )
      invalid_parameter_noinfo_noreturn();
    _Ptr = (AgDelegate1<AgUserUpdatedEvent const &,void> *)m_pFunction;
  }
  operator delete(_Ptr);
}

void __fastcall AgServiceCommand<AgAllocator<1>,AgPlayerManager *,void (void),void (void)>::destroy(
        AgServiceCommand<AgAllocator<1>,AgPlayerManager *,void __cdecl(void),void __cdecl(void)> *this)
{
  ((void (__fastcall *)(AgServiceCommand<AgAllocator<1>,AgPlayerManager *,void __cdecl(void),void __cdecl(void)> *, _QWORD))this->~AgServiceCommandBase)(
    this,
    0i64);
  AgAllocator<1>::deallocate(&this->m_allocator, this);
}

void __fastcall AgPlayerManager::flagPlayersDirty(AgPlayerManager *this)
{
  int v2; // er14
  __int64 v3; // rbp
  AgPlayer *m_ptr; // rbx

  v2 = 0;
  if ( (int)(this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst) > 0 )
  {
    v3 = 0i64;
    do
    {
      m_ptr = this->m_players._Mypair._Myval2._Myfirst[v3].m_ptr;
      EnterCriticalSection((LPCRITICAL_SECTION)&m_ptr->m_mutex);
      m_ptr->m_dirty = 1;
      LeaveCriticalSection((LPCRITICAL_SECTION)&m_ptr->m_mutex);
      ++v2;
      ++v3;
    }
    while ( v2 < (int)(this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst) );
  }
}

AgPointer<AgPlayer> *__fastcall AgPlayerManager::getPlayer(
        AgPlayerManager *this,
        AgPointer<AgPlayer> *result,
        int playerId)
{
  __int64 v3; // rbp
  AgMutex *p_m_mutex; // rsi

  v3 = playerId;
  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  if ( (_DWORD)v3 == -1
    || (int)v3 >= (int)(this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst) )
  {
    AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(result, &this->m_invalidPlayer);
  }
  else
  {
    AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
      result,
      &this->m_players._Mypair._Myval2._Myfirst[v3]);
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  return result;
}

AgPointer<AgPlayer> *__fastcall AgPlayerManager::getPlayerForUser(
        AgPlayerManager *this,
        AgPointer<AgPlayer> *result,
        __int64 userId)
{
  int v6; // ecx
  AgPointer<AgPlayer> *Myfirst; // rsi
  AgUser *m_ptr; // rax
  __int64 v9; // rax
  AgReferenceCount *v10; // rdi
  int v11; // ebx
  AgReferenceCount *m_ref; // rdi
  int m_strongCount; // ebx
  _RTL_CRITICAL_SECTION *lpCriticalSection; // [rsp+38h] [rbp-20h]

  lpCriticalSection = (_RTL_CRITICAL_SECTION *)&this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  v6 = 0;
  if ( (int)(this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst) <= 0 )
  {
LABEL_17:
    result->m_ref = 0i64;
    result->m_ptr = 0i64;
    m_ref = this->m_invalidPlayer.m_ref;
    if ( m_ref )
    {
      m_strongCount = m_ref->m_strongCount;
      if ( m_ref->m_strongCount )
      {
        while ( (unsigned int)AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
        {
          m_strongCount = m_ref->m_strongCount;
          if ( !m_ref->m_strongCount )
            goto LABEL_24;
        }
        if ( m_strongCount != -1 )
        {
          result->m_ref = this->m_invalidPlayer.m_ref;
          result->m_ptr = this->m_invalidPlayer.m_ptr;
        }
      }
    }
  }
  else
  {
    Myfirst = this->m_players._Mypair._Myval2._Myfirst;
    while ( 1 )
    {
      m_ptr = Myfirst->m_ptr->m_user.m_ptr;
      v9 = m_ptr ? m_ptr->m_id : -1i64;
      if ( v9 == userId )
        break;
      ++v6;
      ++Myfirst;
      if ( v6 >= (int)(this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst) )
        goto LABEL_17;
    }
    result->m_ref = 0i64;
    result->m_ptr = 0i64;
    v10 = Myfirst->m_ref;
    if ( Myfirst->m_ref )
    {
      v11 = v10->m_strongCount;
      if ( v10->m_strongCount )
      {
        while ( (unsigned int)AgAtomicCompareExchange(&v10->m_strongCount, v11, v11 + 1) != v11 )
        {
          v11 = v10->m_strongCount;
          if ( !v10->m_strongCount )
            goto LABEL_24;
        }
        if ( v11 != -1 )
        {
          result->m_ref = Myfirst->m_ref;
          result->m_ptr = Myfirst->m_ptr;
        }
      }
    }
  }
LABEL_24:
  LeaveCriticalSection(lpCriticalSection);
  return result;
}

AgPointer<AgPlayer> *__fastcall AgPlayerManager::getPrimaryPlayer(AgPlayerManager *this, AgPointer<AgPlayer> *result)
{
  AgPlayerManager::getPlayer(this, result, this->m_primaryPlayerId);
  return result;
}

void __fastcall AgPlayerManager::initializePrimaryPlayer(AgPlayerManager *this)
{
  AgPointer<AgPlayer> *PlayerForUser; // rax
  AgPointer<AgPlayer> v3; // xmm6
  int m_id; // ecx
  AgPointer<AgPlayer> v5; // [rsp+30h] [rbp-48h] BYREF
  AgPointer<AgPlayer> v6; // [rsp+40h] [rbp-38h] BYREF
  AgPointer<AgPlayer> result; // [rsp+50h] [rbp-28h] BYREF

  v6 = 0i64;
  PlayerForUser = AgPlayerManager::getPlayerForUser(this, &result, 0i64);
  v5 = *PlayerForUser;
  PlayerForUser->m_ref = 0i64;
  PlayerForUser->m_ptr = 0i64;
  v3 = v5;
  v6 = v5;
  v5 = 0i64;
  AgPointer<AgPlayer>::~AgPointer<AgPlayer>(&v5);
  AgPointer<AgPlayer>::~AgPointer<AgPlayer>(&result);
  v6.m_ptr = (AgPlayer *)_mm_srli_si128((__m128i)v3, 8).m128i_u64[0];
  m_id = v6.m_ptr->m_id;
  if ( m_id != -1 )
    this->m_primaryPlayerId = m_id;
  AgPointer<AgPlayer>::~AgPointer<AgPlayer>(&v6);
}

void __fastcall AgPlayerManager::onControllerAdded(AgPlayerManager *this, const AgControllerAddedEvent *e)
{
  const AgControllerAddedEvent *v2; // rbx
  __int64 v4; // rcx
  volatile int **v5; // r14
  volatile int *v6; // rdi
  int v7; // ebx
  int v8; // esi
  signed int v9; // er15
  unsigned int m_id; // ecx
  AgController *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v13; // er14
  int v14; // er15
  AgPointer<KOFApplication> *v15; // rbx
  AgPointer<KOFApplication> *j; // r14
  char *v17; // rcx
  unsigned __int64 v18; // rax
  char *v19; // rax
  unsigned __int64 v20; // rcx
  volatile int *p_m_strongCount; // rdi
  int v22; // ebx
  AgController *v23; // rdi
  AgReferenceCount *v24; // rbx
  int v25; // esi
  int v26; // er15
  AgPointer<KOFApplication> *v27; // rbx
  AgPointer<KOFApplication> *k; // r14
  char *v29; // rcx
  unsigned __int64 v30; // rax
  char *v31; // rax
  unsigned __int64 v32; // rcx
  __int128 v33; // [rsp+28h] [rbp-50h]
  AgPointer<AgController> result; // [rsp+38h] [rbp-40h] BYREF
  AgPointer<AgController> _Val; // [rsp+48h] [rbp-30h] BYREF
  int v36; // [rsp+58h] [rbp-20h]
  __int64 v37; // [rsp+60h] [rbp-18h]
  int v38; // [rsp+C0h] [rbp+48h]
  __int64 i; // [rsp+D0h] [rbp+58h]

  v2 = e;
  v4 = 0i64;
  v38 = 0;
  if ( (int)(this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst) > 0 )
  {
    for ( i = 0i64; ; i += 16i64 )
    {
      v5 = (volatile int **)((char *)this->m_players._Mypair._Myval2._Myfirst + v4);
      v33 = 0i64;
      v6 = *v5;
      if ( *v5 )
      {
        v7 = *v6;
        if ( *v6 )
        {
          while ( 1 )
          {
            v8 = v7 + 1;
            if ( (unsigned int)AgAtomicCompareExchange(v6, v7, v7 + 1) == v7 )
              break;
            v7 = *v6;
            if ( !*v6 )
              goto LABEL_10;
          }
          v2 = e;
          if ( v8 )
            v33 = *(_OWORD *)v5;
        }
        else
        {
LABEL_10:
          v2 = e;
        }
      }
      v9 = 0;
      if ( (int)((__int64)(*(_QWORD *)(*((_QWORD *)&v33 + 1) + 88i64) - *(_QWORD *)(*((_QWORD *)&v33 + 1) + 80i64)) >> 4) > 0 )
        break;
LABEL_22:
      if ( (_QWORD)v33 )
      {
        v14 = 0;
        if ( !(unsigned int)AgAtomicDecrement((volatile int *)v33) )
        {
          if ( !(unsigned int)AgAtomicDecrement((volatile int *)(v33 + 4)) )
            v14 = 1;
          *(_QWORD *)(v33 + 8) = 0i64;
          if ( *((_QWORD *)&v33 + 1) )
          {
            v15 = *(AgPointer<KOFApplication> **)(*((_QWORD *)&v33 + 1) + 80i64);
            if ( v15 )
            {
              for ( j = *(AgPointer<KOFApplication> **)(*((_QWORD *)&v33 + 1) + 88i64); v15 != j; ++v15 )
                AgPointer<AgUser>::~AgPointer<AgUser>(v15);
              v17 = *(char **)(*((_QWORD *)&v33 + 1) + 80i64);
              v18 = (__int64)(*(_QWORD *)(*((_QWORD *)&v33 + 1) + 96i64) - (_QWORD)v17) >> 4;
              if ( v18 > 0xFFFFFFFFFFFFFFFi64 )
                invalid_parameter_noinfo_noreturn();
              if ( 16 * v18 >= 0x1000 )
              {
                if ( ((unsigned __int8)v17 & 0x1F) != 0 )
                  invalid_parameter_noinfo_noreturn();
                v19 = (char *)*((_QWORD *)v17 - 1);
                if ( v19 >= v17 )
                  invalid_parameter_noinfo_noreturn();
                v20 = v17 - v19;
                if ( v20 < 8 )
                  invalid_parameter_noinfo_noreturn();
                if ( v20 > 0x27 )
                  invalid_parameter_noinfo_noreturn();
                v17 = v19;
              }
              operator delete(v17);
              *(_OWORD *)(*((_QWORD *)&v33 + 1) + 80i64) = 0ui64;
              *(_QWORD *)(*((_QWORD *)&v33 + 1) + 96i64) = 0i64;
            }
            AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)(*((_QWORD *)&v33 + 1) + 64i64));
            DeleteCriticalSection((LPCRITICAL_SECTION)(*((_QWORD *)&v33 + 1) + 8i64));
            operator delete(*((void **)&v33 + 1), 0x68ui64);
          }
          if ( v14 )
            AgReferenceCount::operator delete((void *)v33);
        }
      }
      ++v38;
      v4 = i + 16;
      if ( v38 >= (int)(this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst) )
        return;
      v2 = e;
    }
    while ( 1 )
    {
      AgPlayer::getController(*((AgPlayer **)&v33 + 1), &result, v9);
      m_id = result.m_ptr->m_id;
      if ( m_id == v2->controller.m_ptr->m_id )
        break;
      m_ptr = result.m_ptr;
      result.m_ptr = 0i64;
      m_ref = result.m_ref;
      if ( result.m_ref )
      {
        result.m_ref = 0i64;
        v13 = 0;
        if ( !(unsigned int)AgAtomicDecrement(&m_ref->m_strongCount) )
        {
          if ( !(unsigned int)AgAtomicDecrement(&m_ref->m_weakCount) )
            v13 = 1;
          m_ref->m_data = 0i64;
          if ( m_ptr )
            ((void (__fastcall *)(AgController *, __int64))m_ptr->~AgController)(m_ptr, 1i64);
          if ( v13 )
            AgReferenceCount::operator delete(m_ref);
        }
      }
      ++v9;
      v2 = e;
      if ( v9 >= (int)((__int64)(*(_QWORD *)(*((_QWORD *)&v33 + 1) + 88i64) - *(_QWORD *)(*((_QWORD *)&v33 + 1) + 80i64)) >> 4) )
        goto LABEL_22;
    }
    AgPlayer::removeController(*((AgPlayer **)&v33 + 1), m_id);
    _Val = 0i64;
    p_m_strongCount = &v2->controller.m_ref->m_strongCount;
    if ( v2->controller.m_ref )
    {
      v22 = *p_m_strongCount;
      if ( *p_m_strongCount )
      {
        while ( (unsigned int)AgAtomicCompareExchange(p_m_strongCount, v22, v22 + 1) != v22 )
        {
          v22 = *p_m_strongCount;
          if ( !*p_m_strongCount )
            goto LABEL_50;
        }
        if ( v22 != -1 )
          _Val = (AgPointer<AgController>)e->AgControllerEvent;
      }
    }
LABEL_50:
    v36 = 0;
    v37 = *((_QWORD *)&v33 + 1) + 8i64;
    EnterCriticalSection((LPCRITICAL_SECTION)(*((_QWORD *)&v33 + 1) + 8i64));
    v36 = 1;
    std::vector<AgPointer<AgController>>::push_back(
      (std::vector<AgPointer<AgController>> *)(*((_QWORD *)&v33 + 1) + 80i64),
      &_Val);
    LeaveCriticalSection((LPCRITICAL_SECTION)(*((_QWORD *)&v33 + 1) + 8i64));
    v36 = 0;
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&_Val);
    v23 = result.m_ptr;
    result.m_ptr = 0i64;
    v24 = result.m_ref;
    if ( result.m_ref )
    {
      result.m_ref = 0i64;
      v25 = 0;
      if ( !(unsigned int)AgAtomicDecrement(&v24->m_strongCount) )
      {
        if ( !(unsigned int)AgAtomicDecrement(&v24->m_weakCount) )
          v25 = 1;
        v24->m_data = 0i64;
        if ( v23 )
          ((void (__fastcall *)(AgController *, __int64))v23->~AgController)(v23, 1i64);
        if ( v25 )
          AgReferenceCount::operator delete(v24);
      }
    }
    if ( (_QWORD)v33 )
    {
      v26 = 0;
      if ( !(unsigned int)AgAtomicDecrement((volatile int *)v33) )
      {
        if ( !(unsigned int)AgAtomicDecrement((volatile int *)(v33 + 4)) )
          v26 = 1;
        *(_QWORD *)(v33 + 8) = 0i64;
        if ( *((_QWORD *)&v33 + 1) )
        {
          v27 = *(AgPointer<KOFApplication> **)(*((_QWORD *)&v33 + 1) + 80i64);
          if ( v27 )
          {
            for ( k = *(AgPointer<KOFApplication> **)(*((_QWORD *)&v33 + 1) + 88i64); v27 != k; ++v27 )
              AgPointer<AgUser>::~AgPointer<AgUser>(v27);
            v29 = *(char **)(*((_QWORD *)&v33 + 1) + 80i64);
            v30 = (__int64)(*(_QWORD *)(*((_QWORD *)&v33 + 1) + 96i64) - (_QWORD)v29) >> 4;
            if ( v30 > 0xFFFFFFFFFFFFFFFi64 )
              invalid_parameter_noinfo_noreturn();
            if ( 16 * v30 >= 0x1000 )
            {
              if ( ((unsigned __int8)v29 & 0x1F) != 0 )
                invalid_parameter_noinfo_noreturn();
              v31 = (char *)*((_QWORD *)v29 - 1);
              if ( v31 >= v29 )
                invalid_parameter_noinfo_noreturn();
              v32 = v29 - v31;
              if ( v32 < 8 )
                invalid_parameter_noinfo_noreturn();
              if ( v32 > 0x27 )
                invalid_parameter_noinfo_noreturn();
              v29 = v31;
            }
            operator delete(v29);
            *(_OWORD *)(*((_QWORD *)&v33 + 1) + 80i64) = 0ui64;
            *(_QWORD *)(*((_QWORD *)&v33 + 1) + 96i64) = 0i64;
          }
          AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)(*((_QWORD *)&v33 + 1) + 64i64));
          DeleteCriticalSection((LPCRITICAL_SECTION)(*((_QWORD *)&v33 + 1) + 8i64));
          operator delete(*((void **)&v33 + 1), 0x68ui64);
        }
        if ( v26 )
          AgReferenceCount::operator delete((void *)v33);
      }
    }
  }
}

__int64 __fastcall AgPlayerManager::onSingletonExit(AgPlayerManager *this)
{
  AgEventDispatcherBase<AgUserRemovedEvent> *v1; // rbx
  AgDelegate1<AgControllerAddedEvent const &,void> v4; // [rsp+20h] [rbp-18h] BYREF

  v1 = (AgEventDispatcherBase<AgUserRemovedEvent> *)AgSingleton<AgUserManager>::ms_instance;
  v4.m_Closure.m_pthis = (detail::GenericClass *)this;
  v4.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgPlayerManager::onUserAdded;
  AgEventDispatcherBase<AgUserAddedEvent>::unbind(
    (AgEventDispatcherBase<AgUserAddedEvent> *)&AgSingleton<AgUserManager>::ms_instance[8],
    (AgDelegate1<AgUserAddedEvent const &,void> *)&v4);
  v4.m_Closure.m_pthis = (detail::GenericClass *)this;
  v4.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgPlayerManager::onUserRemoved;
  AgEventDispatcherBase<AgUserRemovedEvent>::unbind(v1 + 3, (AgDelegate1<AgUserRemovedEvent const &,void> *)&v4);
  v4.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgPlayerManager::onControllerAdded;
  v4.m_Closure.m_pthis = (detail::GenericClass *)this;
  AgEventDispatcherBase<AgEditedInputEvent>::unbind(
    (AgEventDispatcherBase<AgControllerAddedEvent> *)&AgSingleton<AgInputManager>::ms_instance[20],
    &v4);
  return 1i64;
}

__int64 __fastcall AgPlayerManager::onSingletonInit(AgPlayerManager *this)
{
  AgSingleton<AgUserManager> *v2; // rdi
  AgSingleton<AgUserManager> *v3; // rbx
  AgSingleton<AgInputManager> *v4; // rbx
  AgServiceCommandBase *v5; // rax
  AgDelegate1<AgUserAddedEvent const &,void> _Val; // [rsp+58h] [rbp-18h] BYREF
  AgAllocator<1> v8; // [rsp+A0h] [rbp+30h] BYREF
  AgServiceCommandBase *v9; // [rsp+A8h] [rbp+38h]
  AgServiceCommandBase *v10; // [rsp+B0h] [rbp+40h]

  v2 = AgSingleton<AgUserManager>::ms_instance;
  v3 = AgSingleton<AgUserManager>::ms_instance + 8;
  _Val.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgPlayerManager::onUserAdded;
  _Val.m_Closure.m_pthis = (detail::GenericClass *)this;
  EnterCriticalSection((LPCRITICAL_SECTION)&AgSingleton<AgUserManager>::ms_instance[8]);
  std::vector<AgDelegate1<AgUserAddedEvent const &,void>>::push_back(
    (std::vector<AgDelegate1<AgUserAddedEvent const &,void>> *)&v3[5],
    &_Val);
  LeaveCriticalSection((LPCRITICAL_SECTION)v3);
  _Val.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgPlayerManager::onUserRemoved;
  _Val.m_Closure.m_pthis = (detail::GenericClass *)this;
  EnterCriticalSection((LPCRITICAL_SECTION)&v2[24]);
  std::vector<AgDelegate1<AgUserRemovedEvent const &,void>>::push_back(
    (std::vector<AgDelegate1<AgUserRemovedEvent const &,void>> *)&v2[29],
    (const AgDelegate1<AgUserRemovedEvent const &,void> *)&_Val);
  LeaveCriticalSection((LPCRITICAL_SECTION)&v2[24]);
  v4 = AgSingleton<AgInputManager>::ms_instance + 20;
  _Val.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgPlayerManager::onControllerAdded;
  _Val.m_Closure.m_pthis = (detail::GenericClass *)this;
  EnterCriticalSection((LPCRITICAL_SECTION)&AgSingleton<AgInputManager>::ms_instance[20]);
  std::vector<AgDelegate1<AgControllerAddedEvent const &,void>>::push_back(
    (std::vector<AgDelegate1<AgControllerAddedEvent const &,void>> *)&v4[5],
    (const AgDelegate1<AgControllerAddedEvent const &,void> *)&_Val);
  LeaveCriticalSection((LPCRITICAL_SECTION)v4);
  v5 = (AgServiceCommandBase *)AgAllocator<1>::allocate(&v8, 0x28ui64);
  v9 = v5;
  v10 = v5;
  if ( v5 )
  {
    v5->__vftable = (AgServiceCommandBase_vtbl *)&AgServiceCommandBase::`vftable';
    v5->__vftable = (AgServiceCommandBase_vtbl *)&AgServiceCommand<AgAllocator<1>,AgPlayerManager *,void (void),void (void)>::`vftable';
    v5[1].__vftable = (AgServiceCommandBase_vtbl *)this;
    v5[3].__vftable = (AgServiceCommandBase_vtbl *)AgPlayerManager::initializePrimaryPlayer;
    v5[2].__vftable = (AgServiceCommandBase_vtbl *)this;
  }
  else
  {
    v5 = 0i64;
  }
  AgService::post((AgService *)AgSingleton<AgWorkerPool>::ms_instance[31].__vftable, v5);
  return 1i64;
}

void __fastcall AgPlayerManager::onUserAdded(AgPlayerManager *this, const AgUserAddedEvent *e)
{
  AgPointer<AgUser> *v3; // rax
  AgPointer<AgPlayer> result; // [rsp+28h] [rbp-30h] BYREF
  AgPointer<AgPlayer> v5; // [rsp+38h] [rbp-20h] BYREF

  AgPlayerManager::createPlayer(this, &result);
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(&v5, (const AgPointer<AgPlayer> *)e);
  AgPlayer::setUser(result.m_ptr, v3);
  AgPointer<AgPlayer>::~AgPointer<AgPlayer>(&result);
}

void __fastcall AgPlayerManager::onUserRemoved(AgPlayerManager *this, const AgUserRemovedEvent *e)
{
  AgPlayer *m_ptr; // rbx
  AgMutex *p_m_mutex; // rdi
  AgPointer<AgUser> v4; // [rsp+28h] [rbp-30h] BYREF
  AgPointer<AgPlayer> result; // [rsp+38h] [rbp-20h] BYREF

  AgPlayerManager::getPlayerForUser(this, &result, e->user.m_ptr->m_id);
  m_ptr = result.m_ptr;
  p_m_mutex = &result.m_ptr->m_mutex;
  v4.m_ptr = (AgUser *)&result.m_ptr->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&result.m_ptr->m_mutex);
  LODWORD(v4.m_ref) = 1;
  LODWORD(m_ptr) = m_ptr->m_locked;
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  LODWORD(v4.m_ref) = 0;
  if ( !(_DWORD)m_ptr )
  {
    v4 = 0i64;
    AgPlayer::setUser(result.m_ptr, &v4);
  }
  AgPointer<AgPlayer>::~AgPointer<AgPlayer>(&result);
}

void __fastcall std::vector<AgDelegate1<AgUserAddedEvent const &,void>>::push_back(
        std::vector<AgDelegate1<AgUserAddedEvent const &,void>> *this,
        const AgDelegate1<AgUserAddedEvent const &,void> *_Val)
{
  AgDelegate1<AgUserAddedEvent const &,void> *Mylast; // rax
  AgDelegate1<AgUserAddedEvent const &,void> *Myfirst; // rcx
  signed __int64 v6; // rdi
  AgDelegate1<AgUserAddedEvent const &,void> *v7; // rcx
  detail::GenericClass **v8; // rdi
  AgDelegate1<AgUserAddedEvent const &,void> *v9; // rcx

  Mylast = this->_Mypair._Myval2._Mylast;
  if ( _Val >= Mylast || (Myfirst = this->_Mypair._Myval2._Myfirst, Myfirst > _Val) )
  {
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgDelegate1<AgUserAddedEvent const &,void>>::_Reserve(this, 1ui64);
    v9 = this->_Mypair._Myval2._Mylast;
    if ( v9 )
    {
      v9->m_Closure.m_pthis = 0i64;
      v9->m_Closure.m_pFunction = 0i64;
      v9->m_Closure.m_pFunction = _Val->m_Closure.m_pFunction;
      v9->m_Closure.m_pthis = _Val->m_Closure.m_pthis;
    }
  }
  else
  {
    v6 = (char *)_Val - (char *)Myfirst;
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgDelegate1<AgUserAddedEvent const &,void>>::_Reserve(this, 1ui64);
    v7 = this->_Mypair._Myval2._Mylast;
    v8 = (detail::GenericClass **)((char *)&this->_Mypair._Myval2._Myfirst->m_Closure.m_pthis
                                 + (v6 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v7 )
    {
      v7->m_Closure.m_pthis = 0i64;
      v7->m_Closure.m_pFunction = 0i64;
      v7->m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))v8[1];
      v7->m_Closure.m_pthis = *v8;
    }
  }
  ++this->_Mypair._Myval2._Mylast;
}

void __fastcall std::vector<AgDelegate1<AgUserRemovedEvent const &,void>>::push_back(
        std::vector<AgDelegate1<AgUserRemovedEvent const &,void>> *this,
        const AgDelegate1<AgUserRemovedEvent const &,void> *_Val)
{
  AgDelegate1<AgUserRemovedEvent const &,void> *Mylast; // rax
  AgDelegate1<AgUserRemovedEvent const &,void> *Myfirst; // rcx
  signed __int64 v6; // rdi
  AgDelegate1<AgUserRemovedEvent const &,void> *v7; // rcx
  detail::GenericClass **v8; // rdi
  AgDelegate1<AgUserRemovedEvent const &,void> *v9; // rcx

  Mylast = this->_Mypair._Myval2._Mylast;
  if ( _Val >= Mylast || (Myfirst = this->_Mypair._Myval2._Myfirst, Myfirst > _Val) )
  {
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgDelegate1<AgUserRemovedEvent const &,void>>::_Reserve(this, 1ui64);
    v9 = this->_Mypair._Myval2._Mylast;
    if ( v9 )
    {
      v9->m_Closure.m_pthis = 0i64;
      v9->m_Closure.m_pFunction = 0i64;
      v9->m_Closure.m_pFunction = _Val->m_Closure.m_pFunction;
      v9->m_Closure.m_pthis = _Val->m_Closure.m_pthis;
    }
  }
  else
  {
    v6 = (char *)_Val - (char *)Myfirst;
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgDelegate1<AgUserRemovedEvent const &,void>>::_Reserve(this, 1ui64);
    v7 = this->_Mypair._Myval2._Mylast;
    v8 = (detail::GenericClass **)((char *)&this->_Mypair._Myval2._Myfirst->m_Closure.m_pthis
                                 + (v6 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v7 )
    {
      v7->m_Closure.m_pthis = 0i64;
      v7->m_Closure.m_pFunction = 0i64;
      v7->m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))v8[1];
      v7->m_Closure.m_pthis = *v8;
    }
  }
  ++this->_Mypair._Myval2._Mylast;
}

void __fastcall std::vector<AgPointer<AgPlayer>>::push_back(
        std::vector<AgPointer<AgPlayer>> *this,
        const AgPointer<AgPlayer> *_Val)
{
  AgPointer<AgPlayer> *Mylast; // rax
  AgPointer<AgPlayer> *Myfirst; // rcx
  signed __int64 v6; // rdi
  AgPointer<AgPlayer> *v7; // rcx
  const AgPointer<AgPlayer> *v8; // rdi
  AgPointer<AgPlayer> *v9; // rcx

  Mylast = this->_Mypair._Myval2._Mylast;
  if ( _Val >= Mylast || (Myfirst = this->_Mypair._Myval2._Myfirst, Myfirst > _Val) )
  {
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgPointer<AgPlayer>>::_Reserve(this, 1ui64);
    v9 = this->_Mypair._Myval2._Mylast;
    if ( v9 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(v9, _Val);
  }
  else
  {
    v6 = (char *)_Val - (char *)Myfirst;
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgPointer<AgPlayer>>::_Reserve(this, 1ui64);
    v7 = this->_Mypair._Myval2._Mylast;
    v8 = (AgPointer<AgPlayer> *)((char *)this->_Mypair._Myval2._Myfirst + (v6 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v7 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(v7, v8);
  }
  ++this->_Mypair._Myval2._Mylast;
}

void __fastcall AgPlayer::removeController(AgPlayer *this, unsigned int controllerId)
{
  AgMutex *p_m_mutex; // rbp
  unsigned int v5; // er8
  AgPointer<AgController> *Myfirst; // rax
  __int64 v7; // rdx
  __int64 v8; // rdx
  AgPointer<AgController> *Mylast; // rsi
  AgPointer<KOFApplication> *v10; // rbx

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  v5 = 0;
  if ( this->m_controllers._Mypair._Myval2._Mylast - this->m_controllers._Mypair._Myval2._Myfirst )
  {
    Myfirst = this->m_controllers._Mypair._Myval2._Myfirst;
    v7 = 0i64;
    while ( 1 )
    {
      v8 = v7;
      if ( Myfirst[v8].m_ptr->m_id == controllerId )
        break;
      v7 = ++v5;
      if ( v5 >= (unsigned __int64)(this->m_controllers._Mypair._Myval2._Mylast - Myfirst) )
        goto LABEL_9;
    }
    std::_Move_unchecked1<AgPointer<AgController> *,AgPointer<AgController> *>(
      &Myfirst[v8 + 1],
      this->m_controllers._Mypair._Myval2._Mylast,
      &Myfirst[v8],
      0);
    Mylast = this->m_controllers._Mypair._Myval2._Mylast;
    v10 = (AgPointer<KOFApplication> *)&Mylast[-1];
    if ( &Mylast[-1] != Mylast )
    {
      do
        AgPointer<AgUser>::~AgPointer<AgUser>(v10++);
      while ( v10 != (AgPointer<KOFApplication> *)Mylast );
    }
    --this->m_controllers._Mypair._Myval2._Mylast;
  }
LABEL_9:
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
}

void __fastcall AgPlayer::setUser(AgPlayer *this, AgPointer<AgUser> *user)
{
  AgMutex *p_m_mutex; // rbx

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  AgPointer<AgUser>::operator=(&this->m_user, user);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)user);
}

void __fastcall AgEventDispatcherBase<AgUserAddedEvent>::unbind(
        AgEventDispatcherBase<AgUserAddedEvent> *this,
        AgDelegate1<AgUserAddedEvent const &,void> *f)
{
  AgDelegate1<AgUserAddedEvent const &,void> *Myfirst; // rax
  AgDelegate1<AgUserAddedEvent const &,void> *Mylast; // r8
  void (__fastcall **p_m_pFunction)(detail::GenericClass *); // rdx

  EnterCriticalSection((LPCRITICAL_SECTION)this);
  Myfirst = this->m_bindings._Mypair._Myval2._Myfirst;
  Mylast = this->m_bindings._Mypair._Myval2._Mylast;
  if ( Myfirst != Mylast )
  {
    while ( f->m_Closure.m_pthis != Myfirst->m_Closure.m_pthis
         || f->m_Closure.m_pFunction != Myfirst->m_Closure.m_pFunction )
    {
      if ( ++Myfirst == Mylast )
        goto LABEL_10;
    }
    if ( &Myfirst[1] != Mylast )
    {
      p_m_pFunction = &Myfirst[1].m_Closure.m_pFunction;
      do
      {
        *(p_m_pFunction - 2) = *p_m_pFunction;
        *(p_m_pFunction - 3) = *(p_m_pFunction - 1);
        p_m_pFunction += 2;
      }
      while ( p_m_pFunction - 1 != (void (__fastcall **)(detail::GenericClass *))Mylast );
    }
    --this->m_bindings._Mypair._Myval2._Mylast;
  }
LABEL_10:
  LeaveCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgUserRemovedEvent>::unbind(
        AgEventDispatcherBase<AgUserRemovedEvent> *this,
        AgDelegate1<AgUserRemovedEvent const &,void> *f)
{
  AgDelegate1<AgUserRemovedEvent const &,void> *Myfirst; // rax
  AgDelegate1<AgUserRemovedEvent const &,void> *Mylast; // r8
  void (__fastcall **p_m_pFunction)(detail::GenericClass *); // rdx

  EnterCriticalSection((LPCRITICAL_SECTION)this);
  Myfirst = this->m_bindings._Mypair._Myval2._Myfirst;
  Mylast = this->m_bindings._Mypair._Myval2._Mylast;
  if ( Myfirst != Mylast )
  {
    while ( f->m_Closure.m_pthis != Myfirst->m_Closure.m_pthis
         || f->m_Closure.m_pFunction != Myfirst->m_Closure.m_pFunction )
    {
      if ( ++Myfirst == Mylast )
        goto LABEL_10;
    }
    if ( &Myfirst[1] != Mylast )
    {
      p_m_pFunction = &Myfirst[1].m_Closure.m_pFunction;
      do
      {
        *(p_m_pFunction - 2) = *p_m_pFunction;
        *(p_m_pFunction - 3) = *(p_m_pFunction - 1);
        p_m_pFunction += 2;
      }
      while ( p_m_pFunction - 1 != (void (__fastcall **)(detail::GenericClass *))Mylast );
    }
    --this->m_bindings._Mypair._Myval2._Mylast;
  }
LABEL_10:
  LeaveCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgPlayerManager::update(AgPlayerManager *this)
{
  AgPlayerManager *v1; // rbx
  AgMutex *p_m_mutex; // rsi
  int v3; // er15
  __int64 v4; // r12
  int v5; // er14
  __int64 v6; // rcx
  char *v7; // r13
  __int64 v8; // rbx
  _RTL_CRITICAL_SECTION *v9; // rdi
  AgPointer<AgUser> *User; // rax
  AgPointer<AgUser> *Mylast; // rsi
  AgPointer<AgUser> *Myfirst; // rbx
  AgReferenceCount *m_ref; // rax
  AgUser *m_ptr; // r14
  __int64 v15; // r15
  AgReferenceCount *v16; // rdi
  int v17; // er12
  AgPlayer *v18; // rbx
  unsigned int v19; // eax
  AgPointer<AgController> *v20; // r14
  AgReferenceCount *v21; // rdi
  int m_strongCount; // ebx
  AgReferenceCount *v23; // rbx
  __int64 PairedUserId; // rax
  __int64 v25; // rcx
  __int64 v26; // rcx
  int v27; // edi
  __int64 v28; // rsi
  int v29; // er14
  __int64 v30; // rbx
  AgController *v31; // rbx
  AgPointer<AgController> *v32; // rdi
  unsigned __int64 v33; // rax
  AgController *v34; // rax
  unsigned __int64 v35; // rbx
  AgUser *v36; // rbx
  AgPointer<AgUser> *v37; // rdi
  unsigned __int64 v38; // rax
  AgUser *m_text; // rax
  unsigned __int64 v40; // rbx
  AgPointer<AgController> value; // [rsp+20h] [rbp-B9h]
  std::vector<AgPointer<AgUser>> users; // [rsp+30h] [rbp-A9h] BYREF
  std::vector<AgPointer<AgController>> controllers; // [rsp+48h] [rbp-91h] BYREF
  __int64 v44; // [rsp+60h] [rbp-79h]
  AgPointer<AgController> _Val; // [rsp+70h] [rbp-69h] BYREF
  AgPointer<AgUser> result; // [rsp+80h] [rbp-59h] BYREF
  int v47; // [rsp+90h] [rbp-49h]
  AgMutex *v48; // [rsp+98h] [rbp-41h]
  AgPointer<AgController> *p_Val; // [rsp+A0h] [rbp-39h]
  AgPointer<AgUser> v50; // [rsp+A8h] [rbp-31h] BYREF
  int v51; // [rsp+B8h] [rbp-21h]
  __int64 v52; // [rsp+C0h] [rbp-19h]
  int v53; // [rsp+C8h] [rbp-11h]
  __int64 v54; // [rsp+D0h] [rbp-9h]
  int v55; // [rsp+D8h] [rbp-1h]
  __int64 v56; // [rsp+E0h] [rbp+7h]
  __int64 v57; // [rsp+E8h] [rbp+Fh]
  unsigned int v59; // [rsp+148h] [rbp+6Fh]
  unsigned int v60; // [rsp+150h] [rbp+77h]
  int v61; // [rsp+158h] [rbp+7Fh]

  v57 = -2i64;
  v1 = this;
  p_m_mutex = &this->m_mutex;
  v48 = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  v47 = 1;
  memset(&users, 0, sizeof(users));
  memset(&controllers, 0, sizeof(controllers));
  v3 = -1;
  v60 = -1;
  v4 = 0xFFFFFFFFi64;
  v59 = -1;
  v5 = 0;
  v61 = 0;
  if ( (int)(v1->m_players._Mypair._Myval2._Mylast - v1->m_players._Mypair._Myval2._Myfirst) > 0 )
  {
    v6 = 0i64;
    v44 = 0i64;
    do
    {
      v7 = (char *)v1->m_players._Mypair._Myval2._Myfirst + v6;
      v8 = *((_QWORD *)v7 + 1);
      v51 = 0;
      v9 = (_RTL_CRITICAL_SECTION *)(v8 + 8);
      v52 = v8 + 8;
      EnterCriticalSection((LPCRITICAL_SECTION)(v8 + 8));
      v51 = 1;
      LODWORD(v8) = *(_DWORD *)(v8 + 56);
      LeaveCriticalSection(v9);
      v51 = 0;
      if ( (_DWORD)v8 )
      {
        if ( v3 == -1 )
          v60 = AgUserManager::getUsers((AgUserManager *)AgSingleton<AgUserManager>::ms_instance, &users);
        User = AgPlayer::getUser(*((AgPlayer **)v7 + 1), &result);
        Mylast = users._Mypair._Myval2._Mylast;
        Myfirst = users._Mypair._Myval2._Myfirst;
        if ( users._Mypair._Myval2._Myfirst != users._Mypair._Myval2._Mylast )
        {
          m_ref = User->m_ref;
          do
          {
            if ( Myfirst->m_ref == m_ref )
              break;
            ++Myfirst;
          }
          while ( Myfirst != users._Mypair._Myval2._Mylast );
        }
        m_ptr = result.m_ptr;
        v15 = 0i64;
        result.m_ptr = 0i64;
        v16 = result.m_ref;
        if ( result.m_ref )
        {
          result.m_ref = 0i64;
          v17 = 0;
          if ( !(unsigned int)AgAtomicDecrement(&v16->m_strongCount) )
          {
            if ( !(unsigned int)AgAtomicDecrement(&v16->m_weakCount) )
              v17 = 1;
            v16->m_data = 0i64;
            if ( m_ptr )
              ((void (__fastcall *)(AgUser *, __int64))m_ptr->~AgUser)(m_ptr, 1i64);
            if ( v17 )
              AgReferenceCount::operator delete(v16);
          }
          v4 = v59;
        }
        if ( Myfirst == Mylast )
        {
          v18 = (AgPlayer *)*((_QWORD *)v7 + 1);
          p_Val = (AgPointer<AgController> *)&v50;
          v50 = 0i64;
          AgPlayer::setUser(v18, &v50);
          AgPlayer::clearControllers(v18);
        }
        else
        {
          if ( (_DWORD)v4 == -1 )
          {
            v19 = AgInputManager::getControllers(
                    (AgInputManager *)AgSingleton<AgInputManager>::ms_instance,
                    &controllers);
            v4 = v19;
            v59 = v19;
          }
          AgPlayer::clearControllers(*((AgPlayer **)v7 + 1));
          if ( (_DWORD)v4 )
          {
            do
            {
              v20 = controllers._Mypair._Myval2._Myfirst;
              value = 0i64;
              v21 = controllers._Mypair._Myval2._Myfirst[v15].m_ref;
              if ( !v21 )
                goto LABEL_31;
              m_strongCount = v21->m_strongCount;
              if ( !v21->m_strongCount )
                goto LABEL_31;
              while ( (unsigned int)AgAtomicCompareExchange(&v21->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
              {
                m_strongCount = v21->m_strongCount;
                if ( !v21->m_strongCount )
                  goto LABEL_31;
              }
              if ( m_strongCount != -1 )
              {
                v23 = v20[v15].m_ref;
                value.m_ref = v23;
                value.m_ptr = v20[v15].m_ptr;
              }
              else
              {
LABEL_31:
                v23 = 0i64;
              }
              PairedUserId = AgInputManager::getPairedUserId(
                               (AgInputManager *)AgSingleton<AgInputManager>::ms_instance,
                               value.m_ptr->m_id);
              v25 = *(_QWORD *)(*((_QWORD *)v7 + 1) + 72i64);
              if ( v25 )
                v26 = *(_QWORD *)(v25 + 24);
              else
                v26 = -1i64;
              if ( PairedUserId == v26 )
              {
                p_Val = &_Val;
                _Val = 0i64;
                if ( v23 )
                {
                  v27 = v23->m_strongCount;
                  if ( v23->m_strongCount )
                  {
                    while ( 1 )
                    {
                      v23 = value.m_ref;
                      if ( (unsigned int)AgAtomicCompareExchange(&value.m_ref->m_strongCount, v27, v27 + 1) == v27 )
                        break;
                      v27 = value.m_ref->m_strongCount;
                      if ( !value.m_ref->m_strongCount )
                        goto LABEL_43;
                    }
                    if ( v27 != -1 )
                      _Val = value;
                  }
                  else
                  {
LABEL_43:
                    v23 = value.m_ref;
                  }
                }
                v50.m_ref = (AgReferenceCount *)&_Val;
                v28 = *((_QWORD *)v7 + 1);
                v29 = 0;
                v53 = 0;
                v54 = v28 + 8;
                EnterCriticalSection((LPCRITICAL_SECTION)(v28 + 8));
                v53 = 1;
                std::vector<AgPointer<AgController>>::push_back(
                  (std::vector<AgPointer<AgController>> *)(v28 + 80),
                  &_Val);
                LeaveCriticalSection((LPCRITICAL_SECTION)(v28 + 8));
                v53 = 0;
                AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&_Val);
              }
              else
              {
                v29 = 0;
              }
              if ( v23 && !(unsigned int)AgAtomicDecrement(&v23->m_strongCount) )
              {
                if ( !(unsigned int)AgAtomicDecrement(&v23->m_weakCount) )
                  v29 = 1;
                v23->m_data = 0i64;
                if ( value.m_ptr )
                  ((void (__fastcall *)(AgController *, __int64))value.m_ptr->~AgController)(value.m_ptr, 1i64);
                if ( v29 )
                  AgReferenceCount::operator delete(v23);
              }
              ++v15;
              --v4;
            }
            while ( v4 );
          }
        }
        v30 = *((_QWORD *)v7 + 1);
        v55 = 0;
        v56 = v30 + 8;
        EnterCriticalSection((LPCRITICAL_SECTION)(v30 + 8));
        v55 = 1;
        *(_DWORD *)(v30 + 56) = 0;
        LeaveCriticalSection((LPCRITICAL_SECTION)(v30 + 8));
        v55 = 0;
        v4 = v59;
        v5 = v61;
        v3 = v60;
      }
      v61 = ++v5;
      v6 = v44 + 16;
      v44 += 16i64;
      v1 = this;
    }
    while ( v5 < (int)(this->m_players._Mypair._Myval2._Mylast - this->m_players._Mypair._Myval2._Myfirst) );
    p_m_mutex = v48;
  }
  v31 = (AgController *)controllers._Mypair._Myval2._Myfirst;
  if ( controllers._Mypair._Myval2._Myfirst )
  {
    v32 = controllers._Mypair._Myval2._Mylast;
    if ( controllers._Mypair._Myval2._Myfirst != controllers._Mypair._Myval2._Mylast )
    {
      do
      {
        AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)v31);
        v31 = (AgController *)((char *)v31 + 16);
      }
      while ( v31 != (AgController *)v32 );
      v31 = (AgController *)controllers._Mypair._Myval2._Myfirst;
    }
    v33 = ((char *)controllers._Mypair._Myval2._Myend - (char *)v31) >> 4;
    if ( v33 > 0xFFFFFFFFFFFFFFFi64 )
      invalid_parameter_noinfo_noreturn();
    if ( 16 * v33 >= 0x1000 )
    {
      if ( ((unsigned __int8)v31 & 0x1F) != 0 )
        invalid_parameter_noinfo_noreturn();
      v34 = *(AgController **)&v31[-1].m_connected;
      if ( v34 >= v31 )
        invalid_parameter_noinfo_noreturn();
      v35 = (char *)v31 - (char *)v34;
      if ( v35 < 8 )
        invalid_parameter_noinfo_noreturn();
      if ( v35 > 0x27 )
        invalid_parameter_noinfo_noreturn();
      v31 = v34;
    }
    operator delete(v31);
    memset(&controllers, 0, sizeof(controllers));
  }
  v36 = (AgUser *)users._Mypair._Myval2._Myfirst;
  if ( users._Mypair._Myval2._Myfirst )
  {
    v37 = users._Mypair._Myval2._Mylast;
    if ( users._Mypair._Myval2._Myfirst != users._Mypair._Myval2._Mylast )
    {
      do
      {
        AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)v36);
        v36 = (AgUser *)((char *)v36 + 16);
      }
      while ( v36 != (AgUser *)v37 );
      v36 = (AgUser *)users._Mypair._Myval2._Myfirst;
    }
    v38 = ((char *)users._Mypair._Myval2._Myend - (char *)v36) >> 4;
    if ( v38 > 0xFFFFFFFFFFFFFFFi64 )
      invalid_parameter_noinfo_noreturn();
    if ( 16 * v38 >= 0x1000 )
    {
      if ( ((unsigned __int8)v36 & 0x1F) != 0 )
        invalid_parameter_noinfo_noreturn();
      m_text = (AgUser *)v36[-1].m_userName.m_text;
      if ( m_text >= v36 )
        invalid_parameter_noinfo_noreturn();
      v40 = (char *)v36 - (char *)m_text;
      if ( v40 < 8 )
        invalid_parameter_noinfo_noreturn();
      if ( v40 > 0x27 )
        invalid_parameter_noinfo_noreturn();
      v36 = m_text;
    }
    operator delete(v36);
    memset(&users, 0, sizeof(users));
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
}

