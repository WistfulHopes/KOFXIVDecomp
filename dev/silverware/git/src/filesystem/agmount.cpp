#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "dev/silverware/git/sdk/util/agservicecommand.h"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/agstream.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "dev/silverware/git/sdk/filesystem/agfile.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "dev/silverware/git/sdk/agsemaphore.inl"
#include "dev/silverware/git/sdk/agmutex.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "dev/silverware/git/sdk/filesystem/agpath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "dev/silverware/git/sdk/util/agdebugchannels.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "dev/silverware/git/sdk/util/agperformancecounter.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "dev/silverware/git/sdk/agclock.h"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "dev/silverware/git/sdk/system/agusermanager.h"
#include "dev/silverware/git/sdk/util/agdelegate.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "dev/silverware/git/sdk/filesystem/agdirectory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/silverware/git/sdk/agcondition.inl"
#include "dev/silverware/git/sdk/memory/agallocators.h"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "dev/silverware/git/sdk/agcondition.h"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "dev/silverware/git/sdk/agthreadpool.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "dev/silverware/git/sdk/util/agservice.h"
#include "dev/silverware/git/sdk/agsemaphore.h"
#include "dev/silverware/git/sdk/agthread.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "dev/silverware/git/sdk/agreferenceinl.h"
#include "dev/silverware/git/sdk/filesystem/agmount.h"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "dev/silverware/git/sdk/agpointer.h"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "dev/silverware/git/sdk/agmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"

AgMount::AgMount(const AgString & mountPoint, AgPointer<AgUser> user); // 0x14066F650
AgMountEvent::~AgMountEvent(); // 0x14066F750
AgUnmountEvent::~AgUnmountEvent(); // 0x14066F770
long AgMount::waitMounted(); // 0x14066FC20
long AgMount::waitFinishedWriting(); // 0x14066FB50
void AgMount::unmount(); // 0x14066FB30
void AgMount::cancelMount(); // 0x14002E7C0
void AgMount::setMounted(long mounted); // 0x14066F8F0
void AgMount::setError(long error); // 0x14066F840
void AgMount::setError(const AgMountErrorData & error); // 0x14066F790
void AgMount::signalFinishedWriting(); // 0x14066FAD0void __fastcall AgMount::AgMount(AgMount *this, const AgString *mountPoint, AgPointer<AgUser> *user)
{
  AgStringRef *v6; // rax
  AgStringRef v7; // [rsp+30h] [rbp-38h] BYREF
  AgStringRef v8; // [rsp+40h] [rbp-28h] BYREF

  this->m_refCount = 0i64;
  this->__vftable = (AgMount_vtbl *)&AgMount::`vftable';
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  this->m_mounted = 0;
  this->m_error.error = AgMountError_None;
  this->m_error.systemError = 0i64;
  this->m_modified = 0;
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
    (AgPointer<AgPlayer> *)&this->m_user,
    (const AgPointer<AgPlayer> *)user);
  AgString::AgString(&this->m_mountPoint, mountPoint);
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->m_stateChanged);
  this->m_stateChanged.m_conditionVariable.m_mutex = &this->m_stateChanged.m_mutex;
  InitializeConditionVariable((PCONDITION_VARIABLE)&this->m_stateChanged.m_conditionVariable.m_data);
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->m_finishedWriting);
  this->m_finishedWriting.m_conditionVariable.m_mutex = &this->m_finishedWriting.m_mutex;
  InitializeConditionVariable((PCONDITION_VARIABLE)&this->m_finishedWriting.m_conditionVariable.m_data);
  this->m_activeWriteOperations = 0;
  AgStringRef::AgStringRef(&v8, "FileSystem.Mount");
  v7 = *v6;
  AgSilverWareDebugChannel::AgSilverWareDebugChannel(&this->m_channel, &v7);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)user);
}

void __fastcall AgMountEvent::~AgMountEvent(AgMountEvent *this)
{
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)this);
}

void __fastcall AgUnmountEvent::~AgUnmountEvent(AgUnmountEvent *this)
{
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)this);
}

void __fastcall ActorWeapon::ActionFlagCheck(_SETJMP_FLOAT128 *JumpBuffer)
{
  ;
}

void __fastcall AgMount::setError(AgMount *this, const AgMountErrorData *error)
{
  AgMutex *p_m_mutex; // rsi

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  this->m_error = *error;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_stateChanged);
  WakeAllConditionVariable((PCONDITION_VARIABLE)&this->m_stateChanged.m_conditionVariable.m_data);
  LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_stateChanged);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
}

void __fastcall AgMount::setError(AgMount *this, int error)
{
  AgMutex *p_m_mutex; // rsi

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  this->m_error.error = error != 0;
  this->m_error.systemError = 0i64;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_stateChanged);
  WakeAllConditionVariable((PCONDITION_VARIABLE)&this->m_stateChanged.m_conditionVariable.m_data);
  LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_stateChanged);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
}

void __fastcall AgMount::setMounted(AgMount *this, int mounted)
{
  AgMutex *p_m_mutex; // rsi
  AgReferenceCount *v5; // rax
  int v6; // eax
  AgReferenceCount *m_refCount; // rdi
  AgPointer<AgMount> *v8; // rcx
  AgReferenceCount *v9; // rax
  int v10; // eax
  AgReferenceCount *v11; // rdi
  AgCondition *p_m_stateChanged; // rbx
  AgPointer<AgMount> rhs; // [rsp+30h] [rbp-21h] BYREF
  AgPointer<AgMount> v14; // [rsp+40h] [rbp-11h] BYREF
  AgPointer<AgMount> v15; // [rsp+50h] [rbp-1h] BYREF
  AgPointer<AgMount> v16; // [rsp+60h] [rbp+Fh] BYREF
  int v17; // [rsp+70h] [rbp+1Fh]
  AgCondition *v18; // [rsp+78h] [rbp+27h]
  int v19; // [rsp+80h] [rbp+2Fh]
  AgMutex *v20; // [rsp+88h] [rbp+37h]

  p_m_mutex = &this->m_mutex;
  v20 = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  v19 = 1;
  if ( this->m_mounted != mounted )
  {
    this->m_mounted = mounted;
    if ( mounted )
    {
      v15 = 0i64;
      rhs = 0i64;
      if ( this->m_refCount )
      {
        v6 = 0;
      }
      else
      {
        v5 = (AgReferenceCount *)AgReferenceCount::operator new(0x10ui64);
        if ( v5 )
        {
          v5->m_strongCount = 1;
          v5->m_weakCount = 1;
          v5->m_data = this;
        }
        else
        {
          v5 = 0i64;
        }
        this->m_refCount = v5;
        v6 = 1;
      }
      m_refCount = this->m_refCount;
      if ( !v6 )
        AgReferenceCount::incRef(this->m_refCount);
      rhs.m_ref = m_refCount;
      rhs.m_ptr = this;
      AgPointer<AgMount>::operator=(&v15, &rhs);
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&rhs);
      AgFileSystem::onMounted((AgFileSystem *)AgSingleton<AgFileSystem>::ms_instance, (const AgMountEvent *)&v15);
      v8 = &v15;
    }
    else
    {
      v16 = 0i64;
      v14 = 0i64;
      if ( this->m_refCount )
      {
        v10 = 0;
      }
      else
      {
        v9 = (AgReferenceCount *)AgReferenceCount::operator new(0x10ui64);
        if ( v9 )
        {
          v9->m_strongCount = 1;
          v9->m_weakCount = 1;
          v9->m_data = this;
        }
        else
        {
          v9 = 0i64;
        }
        this->m_refCount = v9;
        v10 = 1;
      }
      v11 = this->m_refCount;
      if ( !v10 )
        AgReferenceCount::incRef(this->m_refCount);
      v14.m_ref = v11;
      v14.m_ptr = this;
      AgPointer<AgMount>::operator=(&v16, &v14);
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v14);
      AgFileSystem::onUnmounted((AgFileSystem *)AgSingleton<AgFileSystem>::ms_instance, (const AgUnmountEvent *)&v16);
      v8 = &v16;
    }
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)v8);
    p_m_stateChanged = &this->m_stateChanged;
    v17 = 0;
    v18 = p_m_stateChanged;
    EnterCriticalSection((LPCRITICAL_SECTION)p_m_stateChanged);
    v17 = 1;
    WakeAllConditionVariable((PCONDITION_VARIABLE)&p_m_stateChanged->m_conditionVariable.m_data);
    LeaveCriticalSection((LPCRITICAL_SECTION)p_m_stateChanged);
    v17 = 0;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
}

void __fastcall AgMount::signalFinishedWriting(AgMount *this)
{
  AgCondition *p_m_finishedWriting; // rbx

  p_m_finishedWriting = &this->m_finishedWriting;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_finishedWriting);
  WakeAllConditionVariable((PCONDITION_VARIABLE)&p_m_finishedWriting->m_conditionVariable.m_data);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_finishedWriting);
}

void __fastcall AgMount::unmount(AgMount *this)
{
  AgMount::waitFinishedWriting(this);
  AgMount::setMounted(this, 0);
}

_BOOL8 __fastcall AgMount::waitFinishedWriting(AgMount *this)
{
  AgMutex *p_m_mutex; // rsi
  BOOL v3; // ebx
  _RTL_CRITICAL_SECTION *lpCriticalSection; // [rsp+30h] [rbp-18h]

  p_m_mutex = &this->m_mutex;
  lpCriticalSection = (_RTL_CRITICAL_SECTION *)&this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  while ( this->m_activeWriteOperations > 0 )
  {
    if ( this->m_error.error )
      break;
    EnterCriticalSection((LPCRITICAL_SECTION)&this->m_finishedWriting);
    LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
    SleepConditionVariableCS(
      (PCONDITION_VARIABLE)&this->m_finishedWriting.m_conditionVariable.m_data,
      (PCRITICAL_SECTION)this->m_finishedWriting.m_conditionVariable.m_mutex,
      0xFFFFFFFF);
    LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_finishedWriting);
    EnterCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  }
  v3 = this->m_activeWriteOperations <= 0;
  LeaveCriticalSection(lpCriticalSection);
  return v3;
}

__int64 __fastcall AgMount::waitMounted(AgMount *this)
{
  AgMutex *p_m_mutex; // rsi
  unsigned int m_mounted; // ebx

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  while ( !this->m_mounted )
  {
    if ( this->m_error.error )
      break;
    EnterCriticalSection((LPCRITICAL_SECTION)&this->m_stateChanged);
    LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
    SleepConditionVariableCS(
      (PCONDITION_VARIABLE)&this->m_stateChanged.m_conditionVariable.m_data,
      (PCRITICAL_SECTION)this->m_stateChanged.m_conditionVariable.m_mutex,
      0xFFFFFFFF);
    LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_stateChanged);
    EnterCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  }
  m_mounted = this->m_mounted;
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  return m_mounted;
}

