#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "dev/silverware/git/sdk/filesystem/agfile.h"
#include "dev/silverware/git/sdk/agcondition.h"
#include "dev/silverware/git/sdk/agthreadpool.h"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "dev/silverware/git/sdk/system/agdialogmanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "dev/silverware/git/sdk/system/agsystemmanager.h"
#include "dev/silverware/git/sdk/util/agservice.h"
#include "dev/silverware/git/sdk/agsemaphore.h"
#include "dev/silverware/git/sdk/agmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "dev/silverware/git/sdk/system/agsystemconfig.h"
#include "dev/silverware/git/sdk/agthread.h"
#include "dev/silverware/git/sdk/filesystem/agmount.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "dev/silverware/git/sdk/util/agjsondata.h"
#include "dev/silverware/git/sdk/filesystem/agpath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "dev/silverware/git/sdk/util/agdelegate.h"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/list"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "dev/silverware/git/sdk/agreferenceinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "dev/silverware/git/sdk/util/agservicecommand.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/silverware/git/sdk/agsemaphore.inl"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "dev/silverware/git/sdk/filesystem/agdirectory.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "dev/silverware/git/sdk/memory/agbuffer.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "dev/silverware/git/sdk/memory/agallocators.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "dev/silverware/git/sdk/agpointer.h"
#include "dev/silverware/git/sdk/agarchive.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/algorithm"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "dev/silverware/git/sdk/system/agplayermanager.h"
#include "dev/silverware/git/sdk/util/agdebugchannels.h"
#include "dev/silverware/git/sdk/system/agplayer.h"
#include "dev/silverware/git/sdk/util/agperformancecounter.h"
#include "dev/silverware/git/sdk/input/agcontroller.h"
#include "dev/silverware/git/sdk/agclock.h"
#include "dev/silverware/git/sdk/system/agusermanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/util/ageventdispatcher.h"
#include "dev/silverware/git/sdk/input/agcontrollercomponent.h"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "dev/silverware/git/sdk/agmutex.h"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "dev/silverware/git/sdk/input/agcontrollerbuttoncomponent.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "dev/silverware/git/sdk/agcondition.inl"

class RemoveMountEventPredicate
{
public:
	RemoveMountEventPredicate(RemoveMountEventPredicate &);
	RemoveMountEventPredicate(const RemoveMountEventPredicate &);
	RemoveMountEventPredicate(AgPointer<AgMount>);
	long operator()(const AgMountErrorEvent &);
private:
	AgPointer<AgMount> m_mount; // 0x0
public:
	~RemoveMountEventPredicate();
	RemoveMountEventPredicate & operator=(RemoveMountEventPredicate &);
	RemoveMountEventPredicate & operator=(const RemoveMountEventPredicate &);
};
std::piecewise_construct_t std::piecewise_construct; // 0x140865D44
void(*??ms_mountPointPaths$initializer$@AgFileSystem@@0P6AXXZEA@@3P6AXXZEA)(); // 0x1407406B8
AgPath AgFileSystem::ms_mountPointPaths[8]; // 0x140A8FE20
long AgFileSystem::ms_nextInternalId; // 0x140A8FE10
typedef AgPCFileSystem AgPlatformFileSystem;
AgFileSystem::AgFileSystem(); // 0x140661090
AgAsyncEventDispatcher<AgMountErrorEvent>::~AgAsyncEventDispatcher<AgMountErrorEvent>(); // 0x140661220
AgAsyncEventDispatcher<AgMountEvent>::~AgAsyncEventDispatcher<AgMountEvent>(); // 0x1406612A0
AgAsyncEventDispatcher<AgMountWriteBeginEvent>::~AgAsyncEventDispatcher<AgMountWriteBeginEvent>(); // 0x140661320
AgAsyncEventDispatcher<AgMountWriteEndEvent>::~AgAsyncEventDispatcher<AgMountWriteEndEvent>(); // 0x1406613A0
AgAsyncEventDispatcher<AgUnmountEvent>::~AgAsyncEventDispatcher<AgUnmountEvent>(); // 0x140661420
AgEventDispatcherBase<AgMountErrorEvent>::~AgEventDispatcherBase<AgMountErrorEvent>(); // 0x1406614A0
AgEventDispatcherBase<AgMountEvent>::~AgEventDispatcherBase<AgMountEvent>(); // 0x140661500
AgEventDispatcherBase<AgMountWriteBeginEvent>::~AgEventDispatcherBase<AgMountWriteBeginEvent>(); // 0x140661560
AgEventDispatcherBase<AgMountWriteEndEvent>::~AgEventDispatcherBase<AgMountWriteEndEvent>(); // 0x1406615C0
AgEventDispatcherBase<AgUnmountEvent>::~AgEventDispatcherBase<AgUnmountEvent>(); // 0x140661620
std::map<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > > >::~map<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > > >(); // 0x140661970
std::pair<AgString const ,AgPointer<AgMount> >::~pair<AgString const ,AgPointer<AgMount> >(); // 0x1406619B0
AgFileSystem::~AgFileSystem(); // 0x140661BC0
AgMountErrorEvent::~AgMountErrorEvent(); // 0x140661C70
AgPointer<AgMount> AgFileSystem::getMount(const AgString & mountPoint); // 0x1406641D0
AgMountWriteBeginEvent::~AgMountWriteBeginEvent(); // 0x140661CB0
AgMountWriteEndEvent::~AgMountWriteEndEvent(); // 0x140661CD0
RemoveMountEventPredicate::~RemoveMountEventPredicate(); // 0x140661CF0
AgPointer<AgFile> AgFileSystem::open(const AgPath & path, unsigned long accessMode); // 0x140664B10
long AgFileSystem::createDirectory(const AgPath & path, long recursive); // 0x140663780
long AgFileSystem::exists(const AgPath & path); // 0x140664090
long AgFileSystem::directoryExists(const AgPath & path); // 0x140663A50
AgFileSystem * AgFileSystem::createSingleton(); // 0x1406639A0
void AgFileSystem::update(); // 0x140665460
AgPointer<AgMount> AgFileSystem::createMount(const AgString & mountPoint, AgMountType type, AgStringRef configString, AgPointer<AgUser> user); // 0x1406638E0
void AgFileSystem::onWriteBegin(AgPointer<AgMount> mount); // 0x140664810
void AgFileSystem::onMounted(const AgMountEvent & event); // 0x140664730
void AgFileSystem::onUnmounted(const AgUnmountEvent & event); // 0x140664790
void AgFileSystem::onWriteEnd(AgPointer<AgMount> mount); // 0x140664980
long AgFileSystem::onSingletonInit(); // 0x1400482A0
long AgFileSystem::onSingletonExit(); // 0x140664740
void AgFileSystem::mount(AgPointer<AgMount> storage); // 0x1406646D0
void AgFileSystem::addMount(AgPointer<AgMount> mount); // 0x140663320
AgString AgFileSystem::getMountName(AgMountPoint mountPoint); // 0x1406642C0
AgPath AgFileSystem::getUserMountName(AgPointer<AgUser> user); // 0x140664450
AgPath AgFileSystem::getUserMountPath(AgPointer<AgUser> user); // 0x140664540
void AgFileSystem::setMountPointPath(AgMountPoint mountPoint, const AgPath & path, long overwrite); // 0x140665400
const AgPath & AgFileSystem::getMountPath(AgMountPoint mountPoint); // 0x1406643F0
void AgFileSystem::registerSaveErrorHandler(); // 0x140664E40
void AgFileSystem::_mountError(const AgMountErrorEvent & error); // 0x140662FF0
void AgFileSystem::_handleSaveError(AgPointer<AgDialog> dialog); // 0x140662EF0
void AgFileSystem::_showConfirmDelete(const AgMountErrorEvent & error); // 0x140663190
void AgFileSystem::_handleConfirmDelete(AgPointer<AgDialog> dialog); // 0x140662D00//decompilation failure at 140865D44!
//decompilation failure at 1407406B8!
//decompilation failure at 140A8FE20!
//decompilation failure at 140A8FE10!
void __fastcall AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
        AgPointer<AgPlayer> *this,
        const AgPointer<AgPlayer> *rhs)
{
  AgReferenceCount *m_ref; // rsi
  int m_strongCount; // ebx

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  m_ref = rhs->m_ref;
  if ( rhs->m_ref )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( m_ref->m_strongCount )
    {
      while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
      {
        m_strongCount = m_ref->m_strongCount;
        if ( !m_ref->m_strongCount )
          return;
      }
      if ( m_strongCount != -1 )
      {
        this->m_ref = rhs->m_ref;
        this->m_ptr = rhs->m_ptr;
      }
    }
  }
}

AgPointer<AgSaveErrorDialog> *__fastcall AgPointer<AgDialog>::operator<AgSaveErrorDialog> AgPointer<AgSaveErrorDialog>(
        AgPointer<AgDialog> *this,
        AgPointer<AgSaveErrorDialog> *result)
{
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
    (AgPointer<AgPlayer> *)result,
    (const AgPointer<AgPlayer> *)this);
  return result;
}

std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *__fastcall std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Buynode<std::piecewise_construct_t const &,std::tuple<AgString const &>,std::tuple<>>(
        std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this,
        const std::piecewise_construct_t *<_Val_0>,
        std::tuple<AgString const &> *<_Val_1>,
        std::tuple<> *<_Val_2>)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v5; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v6; // rdi
  std::pair<AgString const ,AgPointer<AgMount> > *p_Myval; // rbx

  v5 = std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Buynode0(this);
  v6 = v5;
  *(_WORD *)&v5->_Color = 0;
  p_Myval = &v5->_Myval;
  if ( v5 != (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)-32i64 )
  {
    AgString::AgString((AgString *)&v5->_Myval.first, <_Val_1>->_Myfirst._Val);
    p_Myval->second.m_ref = 0i64;
    p_Myval->second.m_ptr = 0i64;
  }
  return v6;
}

void __fastcall std::_Destroy_range<std::allocator<AgMountEvent>,AgMountEvent *>(
        AgMountEvent *_First,
        AgMountEvent *_Last,
        std::_Wrap_alloc<std::allocator<AgMountEvent> > *_Al)
{
  AgMountEvent *v4; // rdi

  if ( _First != _Last )
  {
    v4 = _First;
    do
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)v4++);
    while ( v4 != _Last );
  }
}

void __fastcall std::_Destroy_range<std::allocator<AgMountWriteBeginEvent>,AgMountWriteBeginEvent *>(
        AgMountWriteBeginEvent *_First,
        AgMountWriteBeginEvent *_Last,
        std::_Wrap_alloc<std::allocator<AgMountWriteBeginEvent> > *_Al)
{
  AgMountWriteBeginEvent *v4; // rdi

  if ( _First != _Last )
  {
    v4 = _First;
    do
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)v4++);
    while ( v4 != _Last );
  }
}

void __fastcall std::_Destroy_range<std::allocator<AgMountWriteEndEvent>,AgMountWriteEndEvent *>(
        AgMountWriteEndEvent *_First,
        AgMountWriteEndEvent *_Last,
        std::_Wrap_alloc<std::allocator<AgMountWriteEndEvent> > *_Al)
{
  AgMountWriteEndEvent *v4; // rdi

  if ( _First != _Last )
  {
    v4 = _First;
    do
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)v4++);
    while ( v4 != _Last );
  }
}

void __fastcall std::_Destroy_range<std::allocator<AgUnmountEvent>,AgUnmountEvent *>(
        AgUnmountEvent *_First,
        AgUnmountEvent *_Last,
        std::_Wrap_alloc<std::allocator<AgUnmountEvent> > *_Al)
{
  AgUnmountEvent *v4; // rdi

  if ( _First != _Last )
  {
    v4 = _First;
    do
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)v4++);
    while ( v4 != _Last );
  }
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *__fastcall std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *result,
        bool _Addleft,
        std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *_Wherenode,
        std::pair<AgString const ,AgPointer<AgMount> > *_Val,
        std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *_Node)
{
  unsigned __int64 Mysize; // rax
  unsigned __int64 v9; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Myhead; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v11; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Parent; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v13; // r8
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Left; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Right; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v16; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v17; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v18; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v19; // r8
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v20; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v21; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v22; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v23; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v24; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v25; // rcx

  Mysize = this->_Mypair._Myval2._Myval2._Mysize;
  if ( Mysize >= 0x3FFFFFFFFFFFFFEi64 )
  {
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&_Node->_Myval.second);
    AgString::~AgString((AgString *)&_Node->_Myval.first, v9);
    operator delete(_Node);
    std::_Xlength_error("map/set<T> too long");
  }
  this->_Mypair._Myval2._Myval2._Mysize = Mysize + 1;
  _Node->_Parent = _Wherenode;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = _Node;
    this->_Mypair._Myval2._Myval2._Myhead->_Left = _Node;
    Myhead = this->_Mypair._Myval2._Myval2._Myhead;
LABEL_9:
    Myhead->_Right = _Node;
    goto LABEL_10;
  }
  if ( !_Addleft )
  {
    _Wherenode->_Right = _Node;
    Myhead = this->_Mypair._Myval2._Myval2._Myhead;
    if ( _Wherenode != this->_Mypair._Myval2._Myval2._Myhead->_Right )
      goto LABEL_10;
    goto LABEL_9;
  }
  _Wherenode->_Left = _Node;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead->_Left )
    this->_Mypair._Myval2._Myval2._Myhead->_Left = _Node;
LABEL_10:
  v11 = _Node;
  while ( !v11->_Parent->_Color )
  {
    Parent = v11->_Parent;
    v13 = Parent->_Parent;
    Left = v13->_Left;
    if ( Parent == v13->_Left )
    {
      Right = v13->_Right;
      if ( Right->_Color )
      {
        if ( v11 == Parent->_Right )
        {
          v11 = v11->_Parent;
          v16 = Parent->_Right;
          Parent->_Right = v16->_Left;
          if ( !v16->_Left->_Isnil )
            v16->_Left->_Parent = Parent;
          v16->_Parent = Parent->_Parent;
          if ( Parent == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
          {
            this->_Mypair._Myval2._Myval2._Myhead->_Parent = v16;
          }
          else
          {
            v17 = Parent->_Parent;
            if ( v11 == v17->_Left )
              v17->_Left = v16;
            else
              v17->_Right = v16;
          }
          v16->_Left = v11;
          v11->_Parent = v16;
        }
        v11->_Parent->_Color = 1;
        v11->_Parent->_Parent->_Color = 0;
        v18 = v11->_Parent->_Parent;
        v19 = v18->_Left;
        v18->_Left = v18->_Left->_Right;
        v20 = v19->_Right;
        if ( !v20->_Isnil )
          v20->_Parent = v18;
        v19->_Parent = v18->_Parent;
        if ( v18 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
        {
          this->_Mypair._Myval2._Myval2._Myhead->_Parent = v19;
        }
        else
        {
          v21 = v18->_Parent;
          if ( v18 == v21->_Right )
            v21->_Right = v19;
          else
            v21->_Left = v19;
        }
        v19->_Right = v18;
LABEL_50:
        v18->_Parent = v19;
        continue;
      }
      Parent->_Color = 1;
      Right->_Color = 1;
      v11->_Parent->_Parent->_Color = 0;
      v11 = v11->_Parent->_Parent;
    }
    else
    {
      if ( Left->_Color )
      {
        if ( v11 == Parent->_Left )
        {
          v11 = v11->_Parent;
          v22 = Parent->_Left;
          Parent->_Left = Parent->_Left->_Right;
          v23 = v22->_Right;
          if ( !v23->_Isnil )
            v23->_Parent = v11;
          v22->_Parent = v11->_Parent;
          if ( v11 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
          {
            this->_Mypair._Myval2._Myval2._Myhead->_Parent = v22;
          }
          else
          {
            v24 = v11->_Parent;
            if ( v11 == v24->_Right )
              v24->_Right = v22;
            else
              v24->_Left = v22;
          }
          v22->_Right = v11;
          v11->_Parent = v22;
        }
        v11->_Parent->_Color = 1;
        v11->_Parent->_Parent->_Color = 0;
        v18 = v11->_Parent->_Parent;
        v19 = v18->_Right;
        v18->_Right = v19->_Left;
        if ( !v19->_Left->_Isnil )
          v19->_Left->_Parent = v18;
        v19->_Parent = v18->_Parent;
        if ( v18 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
        {
          this->_Mypair._Myval2._Myval2._Myhead->_Parent = v19;
        }
        else
        {
          v25 = v18->_Parent;
          if ( v18 == v25->_Left )
            v25->_Left = v19;
          else
            v25->_Right = v19;
        }
        v19->_Left = v18;
        goto LABEL_50;
      }
      Parent->_Color = 1;
      Left->_Color = 1;
      v11->_Parent->_Parent->_Color = 0;
      v11 = v11->_Parent->_Parent;
    }
  }
  this->_Mypair._Myval2._Myval2._Myhead->_Parent->_Color = 1;
  result->_Ptr = _Node;
  return result;
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *__fastcall std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_hint<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *result,
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > _Where,
        std::pair<AgString const ,AgPointer<AgMount> > *_Val,
        std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *_Newnode)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Myhead; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Ptr; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Right; // rcx
  std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *Parent; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v13; // rdi
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v14; // rbx
  std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<__int64 const ,AgPointer<AgUser> > > > > v15; // [rsp+30h] [rbp-38h] BYREF
  __int64 v16; // [rsp+38h] [rbp-30h]
  std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >,bool> resulta; // [rsp+40h] [rbp-28h] BYREF

  v16 = -2i64;
  v15._Ptr = 0i64;
  if ( !this->_Mypair._Myval2._Myval2._Mysize )
  {
    std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
      this,
      result,
      1,
      this->_Mypair._Myval2._Myval2._Myhead,
      _Val,
      _Newnode);
    return result;
  }
  Myhead = this->_Mypair._Myval2._Myval2._Myhead;
  if ( _Where._Ptr == Myhead->_Left )
  {
    if ( operator<(&_Val->first, &_Where._Ptr->_Myval.first) )
    {
      std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
        this,
        result,
        1,
        _Where._Ptr,
        _Val,
        _Newnode);
      return result;
    }
    goto LABEL_33;
  }
  if ( _Where._Ptr == Myhead )
  {
    if ( operator<(&Myhead->_Right->_Myval.first, &_Val->first) )
    {
      std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
        this,
        result,
        0,
        this->_Mypair._Myval2._Myval2._Myhead->_Right,
        _Val,
        _Newnode);
      return result;
    }
    goto LABEL_33;
  }
  if ( operator<(&_Val->first, &_Where._Ptr->_Myval.first) )
  {
    Ptr = _Where._Ptr;
    v15._Ptr = (std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *)_Where._Ptr;
    if ( _Where._Ptr->_Isnil )
    {
      Right = _Where._Ptr->_Right;
    }
    else
    {
      Right = _Where._Ptr->_Left;
      if ( _Where._Ptr->_Left->_Isnil )
      {
        while ( 1 )
        {
          Parent = (std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *)Ptr->_Parent;
          if ( Parent->_Isnil
            || Ptr != (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)Parent->_Left )
          {
            break;
          }
          Ptr = Ptr->_Parent;
          v15._Ptr = Parent;
        }
        Right = Ptr;
        if ( !Ptr->_Isnil )
          Right = Ptr->_Parent;
      }
      else
      {
        while ( !Right->_Right->_Isnil )
          Right = Right->_Right;
      }
    }
    v15._Ptr = (std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *)Right;
    if ( operator<(&Right->_Myval.first, &_Val->first) )
    {
      if ( v15._Ptr->_Right->_Isnil )
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
          this,
          result,
          0,
          (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)v15._Ptr,
          _Val,
          _Newnode);
      else
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
          this,
          result,
          1,
          _Where._Ptr,
          _Val,
          _Newnode);
      return result;
    }
  }
  if ( !operator<(&_Where._Ptr->_Myval.first, &_Val->first) )
    goto LABEL_33;
  v13 = _Where._Ptr;
  v15._Ptr = (std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *)_Where._Ptr;
  v14 = this->_Mypair._Myval2._Myval2._Myhead;
  if ( (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringKey const,AgPointer<AgLeaderboard>>>>>::operator++(&v15)->_Ptr != v14 )
  {
    if ( operator<(&_Val->first, (const AgString *)&v15._Ptr->_Myval) )
    {
      v13 = _Where._Ptr;
      goto LABEL_29;
    }
LABEL_33:
    result->_Ptr = (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_nohint<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
                                                                                               this,
                                                                                               &resulta,
                                                                                               0,
                                                                                               _Val,
                                                                                               _Newnode)->first;
    return result;
  }
LABEL_29:
  if ( v13->_Right->_Isnil )
    std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
      this,
      result,
      0,
      v13,
      _Val,
      _Newnode);
  else
    std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
      this,
      result,
      1,
      (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)v15._Ptr,
      _Val,
      _Newnode);
  return result;
}

std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >,bool> *__fastcall std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_nohint<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this,
        std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >,bool> *result,
        bool _Leftish,
        std::pair<AgString const ,AgPointer<AgMount> > *_Val,
        std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *_Newnode)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Myhead; // rsi
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Parent; // rbx
  bool v11; // di
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Right; // rbx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v14; // rax
  unsigned __int64 v15; // rdx
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > resulta; // [rsp+40h] [rbp-38h] BYREF

  Myhead = this->_Mypair._Myval2._Myval2._Myhead;
  Parent = this->_Mypair._Myval2._Myval2._Myhead->_Parent;
  v11 = 1;
  while ( !Parent->_Isnil )
  {
    Myhead = Parent;
    if ( _Leftish )
      v11 = !operator<(&Parent->_Myval.first, &_Val->first);
    else
      v11 = operator<(&_Val->first, &Parent->_Myval.first);
    if ( v11 )
      Parent = Parent->_Left;
    else
      Parent = Parent->_Right;
  }
  Right = Myhead;
  if ( v11 )
  {
    if ( Myhead == this->_Mypair._Myval2._Myval2._Myhead->_Left )
    {
      result->first = (std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(this, &resulta, 1, Myhead, _Val, _Newnode)->_Ptr;
      result->second = 1;
      return result;
    }
    if ( Myhead->_Isnil )
    {
      Right = Myhead->_Right;
    }
    else if ( Myhead->_Left->_Isnil )
    {
      while ( 1 )
      {
        v14 = Right->_Parent;
        if ( v14->_Isnil || Right != v14->_Left )
          break;
        Right = Right->_Parent;
      }
      if ( !Right->_Isnil )
        Right = Right->_Parent;
    }
    else
    {
      for ( Right = Myhead->_Left; !Right->_Right->_Isnil; Right = Right->_Right )
        ;
    }
  }
  if ( operator<(&Right->_Myval.first, &_Val->first) )
  {
    result->first = (std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_at<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(this, &resulta, v11, Myhead, _Val, _Newnode)->_Ptr;
    result->second = 1;
  }
  else
  {
    resulta._Ptr = (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)&_Newnode->_Myval;
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&_Newnode->_Myval.second);
    AgString::~AgString((AgString *)&_Newnode->_Myval.first, v15);
    operator delete(_Newnode);
    result->first._Ptr = Right;
    result->second = 0;
  }
  return result;
}

std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >,bool> *__fastcall std::map<AgString,AgPointer<AgMount>>::_Try_emplace<AgString const &,>(
        std::map<AgString,AgPointer<AgMount>> *this,
        std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >,bool> *result,
        const AgString *_Keyval)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Myhead; // rdi
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Parent; // rbx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *_Newnode; // rax
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > resulta; // [rsp+50h] [rbp+8h] BYREF
  std::tuple<AgString const &> v11; // [rsp+68h] [rbp+20h] BYREF

  Myhead = this->_Mypair._Myval2._Myval2._Myhead;
  Parent = this->_Mypair._Myval2._Myval2._Myhead->_Parent;
  while ( !Parent->_Isnil )
  {
    if ( operator<(&Parent->_Myval.first, _Keyval) )
    {
      Parent = Parent->_Right;
    }
    else
    {
      Myhead = Parent;
      Parent = Parent->_Left;
    }
  }
  if ( Myhead == this->_Mypair._Myval2._Myval2._Myhead || operator<(_Keyval, &Myhead->_Myval.first) )
  {
    v11._Myfirst._Val = _Keyval;
    _Newnode = std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Buynode<std::piecewise_construct_t const &,std::tuple<AgString const &>,std::tuple<>>(
                 this,
                 &std::piecewise_construct_2,
                 &v11,
                 (std::tuple<> *)&resulta);
    std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Insert_hint<std::pair<AgString const,AgPointer<AgMount>> &,std::_Tree_node<std::pair<AgString const,AgPointer<AgMount>>,void *> *>(
      this,
      &resulta,
      (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)Myhead,
      &_Newnode->_Myval,
      _Newnode);
    result->first = resulta;
    result->second = 1;
  }
  else
  {
    result->first._Ptr = Myhead;
    result->second = 0;
  }
  return result;
}

AgMountEvent *__fastcall std::_Uninitialized_move_al_unchecked1<AgMountEvent *,AgMountEvent *,std::allocator<AgMountEvent>>(
        AgMountEvent *_First,
        AgMountEvent *_Last,
        AgMountEvent *_Dest,
        std::_Wrap_alloc<std::allocator<AgMountEvent> > *_Al)
{
  while ( _First != _Last )
  {
    if ( _Dest )
    {
      *_Dest = *_First;
      _First->mount.m_ref = 0i64;
      _First->mount.m_ptr = 0i64;
    }
    ++_Dest;
    ++_First;
  }
  return _Dest;
}

AgMountWriteBeginEvent *__fastcall std::_Uninitialized_move_al_unchecked1<AgMountWriteBeginEvent *,AgMountWriteBeginEvent *,std::allocator<AgMountWriteBeginEvent>>(
        AgMountWriteBeginEvent *_First,
        AgMountWriteBeginEvent *_Last,
        AgMountWriteBeginEvent *_Dest,
        std::_Wrap_alloc<std::allocator<AgMountWriteBeginEvent> > *_Al)
{
  while ( _First != _Last )
  {
    if ( _Dest )
    {
      *_Dest = *_First;
      _First->mount.m_ref = 0i64;
      _First->mount.m_ptr = 0i64;
    }
    ++_Dest;
    ++_First;
  }
  return _Dest;
}

AgMountWriteEndEvent *__fastcall std::_Uninitialized_move_al_unchecked1<AgMountWriteEndEvent *,AgMountWriteEndEvent *,std::allocator<AgMountWriteEndEvent>>(
        AgMountWriteEndEvent *_First,
        AgMountWriteEndEvent *_Last,
        AgMountWriteEndEvent *_Dest,
        std::_Wrap_alloc<std::allocator<AgMountWriteEndEvent> > *_Al)
{
  while ( _First != _Last )
  {
    if ( _Dest )
    {
      *_Dest = *_First;
      _First->mount.m_ref = 0i64;
      _First->mount.m_ptr = 0i64;
    }
    ++_Dest;
    ++_First;
  }
  return _Dest;
}

AgUnmountEvent *__fastcall std::_Uninitialized_move_al_unchecked1<AgUnmountEvent *,AgUnmountEvent *,std::allocator<AgUnmountEvent>>(
        AgUnmountEvent *_First,
        AgUnmountEvent *_Last,
        AgUnmountEvent *_Dest,
        std::_Wrap_alloc<std::allocator<AgUnmountEvent> > *_Al)
{
  while ( _First != _Last )
  {
    if ( _Dest )
    {
      *_Dest = *_First;
      _First->mount.m_ref = 0i64;
      _First->mount.m_ptr = 0i64;
    }
    ++_Dest;
    ++_First;
  }
  return _Dest;
}

AgDelegate1<AgMountErrorEvent const &,void> *__fastcall std::_Uninitialized_move_al_unchecked1<AgDelegate1<AgMountErrorEvent const &,void> *,AgDelegate1<AgMountErrorEvent const &,void> *,std::allocator<AgDelegate1<AgMountErrorEvent const &,void>>>(
        AgDelegate1<AgMountErrorEvent const &,void> *_First,
        AgDelegate1<AgMountErrorEvent const &,void> *_Last,
        AgDelegate1<AgMountErrorEvent const &,void> *_Dest,
        std::_Wrap_alloc<std::allocator<AgDelegate1<AgMountErrorEvent const &,void> > > *_Al)
{
  while ( _First != _Last )
  {
    if ( _Dest )
    {
      _Dest->m_Closure.m_pthis = 0i64;
      _Dest->m_Closure.m_pFunction = 0i64;
      *_Dest = *_First;
    }
    ++_Dest;
    ++_First;
  }
  return _Dest;
}

__int64 __fastcall AgAsyncEventDispatcher<AgMountErrorEvent>::remove<RemoveMountEventPredicate>(
        AgAsyncEventDispatcher<AgMountErrorEvent> *this,
        RemoveMountEventPredicate *pred)
{
  unsigned int v4; // er12
  AgMountErrorEvent *Myfirst; // rbx
  AgMountErrorEvent *v6; // r14
  AgMountErrorEvent *Mylast; // r15
  AgMountOperation *p_operation; // rdi
  signed __int64 v9; // rsi
  AgMountErrorEvent *v10; // rsi
  AgMountErrorEvent *i; // rdi
  unsigned __int64 v12; // rdx
  _RTL_CRITICAL_SECTION *lpCriticalSection; // [rsp+30h] [rbp-48h]

  v4 = 0;
  lpCriticalSection = (_RTL_CRITICAL_SECTION *)&this->m_queueMutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  Myfirst = this->m_eventQueue._Mypair._Myval2._Myfirst;
  if ( Myfirst != this->m_eventQueue._Mypair._Myval2._Mylast )
  {
    v6 = Myfirst + 1;
    do
    {
      if ( Myfirst->mount.m_ref == pred->m_mount.m_ref )
      {
        ++v4;
        Mylast = this->m_eventQueue._Mypair._Myval2._Mylast;
        if ( v6 != Mylast )
        {
          p_operation = &v6[-1].operation;
          v9 = (char *)v6 - (char *)Myfirst;
          do
          {
            AgPointer<AgMount>::operator=(
              (AgPointer<AgMount> *)p_operation - 2,
              (AgPointer<AgMount> *)((char *)p_operation + v9 - 32));
            AgString::operator=((AgString *)p_operation - 1, (const AgString *)((char *)p_operation + v9 - 16));
            *p_operation = *(AgMountOperation *)((char *)p_operation + v9);
            *((_QWORD *)p_operation + 1) = *(_QWORD *)((char *)p_operation + v9 + 8);
            *((_OWORD *)p_operation + 1) = *(_OWORD *)((char *)p_operation + v9 + 16);
            AgPointer<AgBuffer<AgAllocator<1>>>::operator=(
              (AgPointer<AgBuffer<AgAllocator<1> > > *)p_operation + 2,
              (AgPointer<AgBuffer<AgAllocator<1> > > *)((char *)p_operation + v9 + 32));
            p_operation += 20;
          }
          while ( (AgMountErrorEvent *)((char *)p_operation + v9 - 32) != Mylast );
        }
        v10 = this->m_eventQueue._Mypair._Myval2._Mylast;
        for ( i = v10 - 1; i != v10; ++i )
        {
          AgPointer<AgBuffer<AgAllocator<1>>>::~AgPointer<AgBuffer<AgAllocator<1>>>(&i->data);
          AgString::~AgString(&i->path.m_path, v12);
          AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)i);
        }
        --this->m_eventQueue._Mypair._Myval2._Mylast;
      }
      else
      {
        ++Myfirst;
        ++v6;
      }
    }
    while ( Myfirst != this->m_eventQueue._Mypair._Myval2._Mylast );
  }
  LeaveCriticalSection(lpCriticalSection);
  return v4;
}

void __fastcall AgFileSystem::AgFileSystem(AgFileSystem *this)
{
  this->__vftable = (AgFileSystem_vtbl *)&AgSingleton<AgFileSystem>::`vftable';
  this->__vftable = (AgFileSystem_vtbl *)&AgFileSystem::`vftable';
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  this->m_mounts._Mypair._Myval2._Myval2._Myhead = 0i64;
  this->m_mounts._Mypair._Myval2._Myval2._Mysize = 0i64;
  this->m_mounts._Mypair._Myval2._Myval2._Myhead = std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Buyheadnode(&this->m_mounts);
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->Mount);
  this->Mount.m_bindings._Mypair._Myval2._Myfirst = 0i64;
  this->Mount.m_bindings._Mypair._Myval2._Mylast = 0i64;
  this->Mount.m_bindings._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->Mount.m_queueMutex);
  this->Mount.m_eventQueue._Mypair._Myval2._Myfirst = 0i64;
  this->Mount.m_eventQueue._Mypair._Myval2._Mylast = 0i64;
  this->Mount.m_eventQueue._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->Unmount);
  this->Unmount.m_bindings._Mypair._Myval2._Myfirst = 0i64;
  this->Unmount.m_bindings._Mypair._Myval2._Mylast = 0i64;
  this->Unmount.m_bindings._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->Unmount.m_queueMutex);
  this->Unmount.m_eventQueue._Mypair._Myval2._Myfirst = 0i64;
  this->Unmount.m_eventQueue._Mypair._Myval2._Mylast = 0i64;
  this->Unmount.m_eventQueue._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->Error);
  this->Error.m_bindings._Mypair._Myval2._Myfirst = 0i64;
  this->Error.m_bindings._Mypair._Myval2._Mylast = 0i64;
  this->Error.m_bindings._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->Error.m_queueMutex);
  this->Error.m_eventQueue._Mypair._Myval2._Myfirst = 0i64;
  this->Error.m_eventQueue._Mypair._Myval2._Mylast = 0i64;
  this->Error.m_eventQueue._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->WriteBegin);
  this->WriteBegin.m_bindings._Mypair._Myval2._Myfirst = 0i64;
  this->WriteBegin.m_bindings._Mypair._Myval2._Mylast = 0i64;
  this->WriteBegin.m_bindings._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->WriteBegin.m_queueMutex);
  this->WriteBegin.m_eventQueue._Mypair._Myval2._Myfirst = 0i64;
  this->WriteBegin.m_eventQueue._Mypair._Myval2._Mylast = 0i64;
  this->WriteBegin.m_eventQueue._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->WriteEnd);
  this->WriteEnd.m_bindings._Mypair._Myval2._Myfirst = 0i64;
  this->WriteEnd.m_bindings._Mypair._Myval2._Mylast = 0i64;
  this->WriteEnd.m_bindings._Mypair._Myval2._Myend = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->WriteEnd.m_queueMutex);
  this->WriteEnd.m_eventQueue._Mypair._Myval2._Myfirst = 0i64;
  this->WriteEnd.m_eventQueue._Mypair._Myval2._Mylast = 0i64;
  this->WriteEnd.m_eventQueue._Mypair._Myval2._Myend = 0i64;
}

void __fastcall AgAsyncEventDispatcher<AgMountErrorEvent>::~AgAsyncEventDispatcher<AgMountErrorEvent>(
        AgAsyncEventDispatcher<AgMountErrorEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  std::vector<AgMountErrorEvent>::_Tidy(&this->m_eventQueue);
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgAsyncEventDispatcher<AgMountEvent>::~AgAsyncEventDispatcher<AgMountEvent>(
        AgAsyncEventDispatcher<AgMountEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  std::vector<AgMountEvent>::_Tidy(&this->m_eventQueue);
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgAsyncEventDispatcher<AgMountWriteBeginEvent>::~AgAsyncEventDispatcher<AgMountWriteBeginEvent>(
        AgAsyncEventDispatcher<AgMountWriteBeginEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  std::vector<AgMountWriteBeginEvent>::_Tidy(&this->m_eventQueue);
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgAsyncEventDispatcher<AgMountWriteEndEvent>::~AgAsyncEventDispatcher<AgMountWriteEndEvent>(
        AgAsyncEventDispatcher<AgMountWriteEndEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  std::vector<AgMountWriteEndEvent>::_Tidy(&this->m_eventQueue);
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgAsyncEventDispatcher<AgUnmountEvent>::~AgAsyncEventDispatcher<AgUnmountEvent>(
        AgAsyncEventDispatcher<AgUnmountEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  std::vector<AgUnmountEvent>::_Tidy(&this->m_eventQueue);
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgMountErrorEvent>::~AgEventDispatcherBase<AgMountErrorEvent>(
        AgEventDispatcherBase<AgMountErrorEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgMountEvent>::~AgEventDispatcherBase<AgMountEvent>(
        AgEventDispatcherBase<AgMountEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgMountWriteBeginEvent>::~AgEventDispatcherBase<AgMountWriteBeginEvent>(
        AgEventDispatcherBase<AgMountWriteBeginEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgMountWriteEndEvent>::~AgEventDispatcherBase<AgMountWriteEndEvent>(
        AgEventDispatcherBase<AgMountWriteEndEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgUnmountEvent>::~AgEventDispatcherBase<AgUnmountEvent>(
        AgEventDispatcherBase<AgUnmountEvent> *this)
{
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rdx

  Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->m_bindings._Mypair._Myval2._Myfirst;
  if ( Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&this->m_bindings,
      Myfirst,
      ((char *)this->m_bindings._Mypair._Myval2._Myend - (char *)Myfirst) >> 4);
    this->m_bindings._Mypair._Myval2._Myfirst = 0i64;
    this->m_bindings._Mypair._Myval2._Mylast = 0i64;
    this->m_bindings._Mypair._Myval2._Myend = 0i64;
  }
  DeleteCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgPointer<AgBuffer<AgAllocator<1>>>::~AgPointer<AgBuffer<AgAllocator<1>>>(
        AgPointer<AgBuffer<AgAllocator<1> > > *this)
{
  AgBuffer<AgAllocator<1> > *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v3; // esi

  m_ptr = this->m_ptr;
  this->m_ptr = 0i64;
  m_ref = this->m_ref;
  if ( this->m_ref )
  {
    this->m_ref = 0i64;
    v3 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v3 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgBuffer<AgAllocator<1> > *, __int64))m_ptr->~AgBuffer<AgAllocator<1> >)(m_ptr, 1i64);
      if ( v3 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
}

void __fastcall AgPointer<AgDialog>::~AgPointer<AgDialog>(AgPointer<AgDialog> *this)
{
  AgDialog *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v3; // esi

  m_ptr = this->m_ptr;
  this->m_ptr = 0i64;
  m_ref = this->m_ref;
  if ( this->m_ref )
  {
    this->m_ref = 0i64;
    v3 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v3 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgDialog *, __int64))m_ptr->~AgDialog)(m_ptr, 1i64);
      if ( v3 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
}

void __fastcall AgPointer<AgDirectory>::~AgPointer<AgDirectory>(AgPointer<AgDirectory> *this)
{
  AgDirectory *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v3; // esi

  m_ptr = this->m_ptr;
  this->m_ptr = 0i64;
  m_ref = this->m_ref;
  if ( this->m_ref )
  {
    this->m_ref = 0i64;
    v3 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v3 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgDirectory *, __int64))m_ptr->~AgDirectory)(m_ptr, 1i64);
      if ( v3 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
}

void __fastcall AgPointer<AgSaveErrorDialog>::~AgPointer<AgSaveErrorDialog>(AgPointer<AgSaveErrorDialog> *this)
{
  AgSaveErrorDialog *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v3; // esi

  m_ptr = this->m_ptr;
  this->m_ptr = 0i64;
  m_ref = this->m_ref;
  if ( this->m_ref )
  {
    this->m_ref = 0i64;
    v3 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v3 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgSaveErrorDialog *, __int64))m_ptr->~AgDialog)(m_ptr, 1i64);
      if ( v3 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
}

void __fastcall AgSingleton<AgFileSystem>::~AgSingleton<AgFileSystem>(AgSingleton<AgFileSystem> *this)
{
  this->__vftable = (AgSingleton<AgFileSystem>_vtbl *)&AgSingleton<AgFileSystem>::`vftable';
}

void __fastcall std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::~_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>(
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this)
{
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > result; // [rsp+48h] [rbp+10h] BYREF

  std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::erase(
    this,
    &result,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)this->_Mypair._Myval2._Myval2._Myhead->_Left,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)this->_Mypair._Myval2._Myval2._Myhead);
  operator delete(this->_Mypair._Myval2._Myval2._Myhead);
}

void __fastcall std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::~_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>(
        std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this)
{
  operator delete(this->_Mypair._Myval2._Myval2._Myhead);
}

void __fastcall std::map<AgString,AgPointer<AgMount>>::~map<AgString,AgPointer<AgMount>>(
        std::map<AgString,AgPointer<AgMount>> *this)
{
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > result; // [rsp+48h] [rbp+10h] BYREF

  std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::erase(
    this,
    &result,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)this->_Mypair._Myval2._Myval2._Myhead->_Left,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)this->_Mypair._Myval2._Myval2._Myhead);
  operator delete(this->_Mypair._Myval2._Myval2._Myhead);
}

void __fastcall std::pair<AgString const,AgPointer<AgMount>>::~pair<AgString const,AgPointer<AgMount>>(
        std::pair<AgString const ,AgPointer<AgMount> > *this)
{
  unsigned __int64 v2; // rdx

  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&this->second);
  AgString::~AgString((AgString *)&this->first, v2);
}

void __fastcall std::vector<AgMountErrorEvent>::~vector<AgMountErrorEvent>(std::vector<AgMountErrorEvent> *this)
{
  std::vector<AgMountErrorEvent>::_Tidy(this);
}

void __fastcall std::vector<AgMountEvent>::~vector<AgMountEvent>(std::vector<AgMountEvent> *this)
{
  std::vector<AgMountEvent>::_Tidy(this);
}

void __fastcall std::vector<AgMountWriteBeginEvent>::~vector<AgMountWriteBeginEvent>(
        std::vector<AgMountWriteBeginEvent> *this)
{
  std::vector<AgMountWriteBeginEvent>::_Tidy(this);
}

void __fastcall std::vector<AgMountWriteEndEvent>::~vector<AgMountWriteEndEvent>(
        std::vector<AgMountWriteEndEvent> *this)
{
  std::vector<AgMountWriteEndEvent>::_Tidy(this);
}

void __fastcall std::vector<AgUnmountEvent>::~vector<AgUnmountEvent>(std::vector<AgUnmountEvent> *this)
{
  std::vector<AgUnmountEvent>::_Tidy(this);
}

void __fastcall std::vector<AgDelegate1<AgMountErrorEvent const &,void>>::~vector<AgDelegate1<AgMountErrorEvent const &,void>>(
        std::vector<AgDelegate1<AgMountErrorEvent const &,void>> *this)
{
  if ( this->_Mypair._Myval2._Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgDelegate1<AgMountEvent const &,void>>::~vector<AgDelegate1<AgMountEvent const &,void>>(
        std::vector<AgDelegate1<AgMountEvent const &,void>> *this)
{
  if ( this->_Mypair._Myval2._Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgDelegate1<AgMountWriteBeginEvent const &,void>>::~vector<AgDelegate1<AgMountWriteBeginEvent const &,void>>(
        std::vector<AgDelegate1<AgMountWriteBeginEvent const &,void>> *this)
{
  if ( this->_Mypair._Myval2._Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgDelegate1<AgMountWriteEndEvent const &,void>>::~vector<AgDelegate1<AgMountWriteEndEvent const &,void>>(
        std::vector<AgDelegate1<AgMountWriteEndEvent const &,void>> *this)
{
  if ( this->_Mypair._Myval2._Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgDelegate1<AgUnmountEvent const &,void>>::~vector<AgDelegate1<AgUnmountEvent const &,void>>(
        std::vector<AgDelegate1<AgUnmountEvent const &,void>> *this)
{
  if ( this->_Mypair._Myval2._Myfirst )
  {
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall AgFileSystem::~AgFileSystem(AgFileSystem *this)
{
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > result; // [rsp+50h] [rbp+18h] BYREF

  AgAsyncEventDispatcher<AgMountWriteEndEvent>::~AgAsyncEventDispatcher<AgMountWriteEndEvent>(&this->WriteEnd);
  AgAsyncEventDispatcher<AgMountWriteBeginEvent>::~AgAsyncEventDispatcher<AgMountWriteBeginEvent>(&this->WriteBegin);
  AgAsyncEventDispatcher<AgMountErrorEvent>::~AgAsyncEventDispatcher<AgMountErrorEvent>(&this->Error);
  AgAsyncEventDispatcher<AgUnmountEvent>::~AgAsyncEventDispatcher<AgUnmountEvent>(&this->Unmount);
  AgAsyncEventDispatcher<AgMountEvent>::~AgAsyncEventDispatcher<AgMountEvent>(&this->Mount);
  std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::erase(
    &this->m_mounts,
    &result,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)this->m_mounts._Mypair._Myval2._Myval2._Myhead->_Left,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)this->m_mounts._Mypair._Myval2._Myval2._Myhead);
  operator delete(this->m_mounts._Mypair._Myval2._Myval2._Myhead);
  DeleteCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  this->__vftable = (AgFileSystem_vtbl *)&AgSingleton<AgFileSystem>::`vftable';
}

void __fastcall AgMountErrorEvent::~AgMountErrorEvent(AgMountErrorEvent *this)
{
  unsigned __int64 v2; // rdx

  AgPointer<AgBuffer<AgAllocator<1>>>::~AgPointer<AgBuffer<AgAllocator<1>>>(&this->data);
  AgString::~AgString(&this->path.m_path, v2);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)this);
}

void __fastcall AgMountWriteBeginEvent::~AgMountWriteBeginEvent(AgMountWriteBeginEvent *this)
{
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)this);
}

void __fastcall AgMountWriteEndEvent::~AgMountWriteEndEvent(AgMountWriteEndEvent *this)
{
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)this);
}

void __fastcall RemoveMountEventPredicate::~RemoveMountEventPredicate(RemoveMountEventPredicate *this)
{
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)this);
}

AgPointer<AgBuffer<AgAllocator<1> > > *__fastcall AgPointer<AgBuffer<AgAllocator<1>>>::operator=(
        AgPointer<AgBuffer<AgAllocator<1> > > *this,
        AgPointer<AgBuffer<AgAllocator<1> > > *rhs)
{
  AgReferenceCount *m_ref; // r8
  AgBuffer<AgAllocator<1> > *m_ptr; // rax
  AgReferenceCount *v5; // rdi
  AgBuffer<AgAllocator<1> > *v6; // rsi
  int v7; // ebp

  m_ref = rhs->m_ref;
  m_ptr = rhs->m_ptr;
  rhs->m_ref = 0i64;
  rhs->m_ptr = 0i64;
  v5 = this->m_ref;
  v6 = this->m_ptr;
  this->m_ref = m_ref;
  this->m_ptr = m_ptr;
  if ( v5 )
  {
    v7 = 0;
    if ( !AgAtomicDecrement(&v5->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v5->m_weakCount) )
        v7 = 1;
      v5->m_data = 0i64;
      if ( v6 )
        ((void (__fastcall *)(AgBuffer<AgAllocator<1> > *, __int64))v6->~AgBuffer<AgAllocator<1> >)(v6, 1i64);
      if ( v7 )
        AgReferenceCount::operator delete(v5);
    }
  }
  return this;
}

AgPointer<AgMount> *__fastcall AgPointer<AgMount>::operator=(AgPointer<AgMount> *this, AgPointer<AgMount> *rhs)
{
  AgReferenceCount *m_ref; // r8
  AgMount *m_ptr; // rax
  AgReferenceCount *v5; // rdi
  AgMount *v6; // rsi
  int v7; // ebp

  m_ref = rhs->m_ref;
  m_ptr = rhs->m_ptr;
  rhs->m_ref = 0i64;
  rhs->m_ptr = 0i64;
  v5 = this->m_ref;
  v6 = this->m_ptr;
  this->m_ref = m_ref;
  this->m_ptr = m_ptr;
  if ( v5 )
  {
    v7 = 0;
    if ( !AgAtomicDecrement(&v5->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v5->m_weakCount) )
        v7 = 1;
      v5->m_data = 0i64;
      if ( v6 )
        ((void (__fastcall *)(AgMount *, __int64))v6->~AgMount)(v6, 1i64);
      if ( v7 )
        AgReferenceCount::operator delete(v5);
    }
  }
  return this;
}

AgPointer<AgMount> *__fastcall AgPointer<AgMount>::operator=(AgPointer<AgMount> *this, const AgPointer<AgMount> *rhs)
{
  AgReferenceCount *m_ref; // rdi
  int m_strongCount; // ebx
  AgReferenceCount *v6; // rbx
  AgMount *m_ptr; // rdi
  int v8; // ebp
  AgPointer<AgMount> v10; // [rsp+28h] [rbp-20h]

  v10 = 0i64;
  m_ref = rhs->m_ref;
  if ( rhs->m_ref )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( m_ref->m_strongCount )
    {
      while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
      {
        m_strongCount = m_ref->m_strongCount;
        if ( !m_ref->m_strongCount )
          goto LABEL_8;
      }
      if ( m_strongCount != -1 )
        v10 = *rhs;
    }
  }
LABEL_8:
  v6 = this->m_ref;
  m_ptr = this->m_ptr;
  *this = v10;
  if ( v6 )
  {
    v8 = 0;
    if ( !AgAtomicDecrement(&v6->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v6->m_weakCount) )
        v8 = 1;
      v6->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgMount *, __int64))m_ptr->~AgMount)(m_ptr, 1i64);
      if ( v8 )
        AgReferenceCount::operator delete(v6);
    }
  }
  return this;
}

AgPointer<AgMount> *__fastcall AgPointer<AgMount>::operator=(AgPointer<AgMount> *this, AgMount *t)
{
  AgMount *v2; // rdi
  AgReferenceCount *v4; // rax
  int v5; // eax
  AgReferenceCount *m_refCount; // rbp
  AgReferenceCount *m_ref; // rsi
  AgMount *m_ptr; // r14
  int v9; // edi

  v2 = t;
  if ( t )
  {
    if ( t->m_refCount )
    {
      v5 = 0;
    }
    else
    {
      v4 = (AgReferenceCount *)AgReferenceCount::operator new(0x10ui64);
      if ( v4 )
      {
        v4->m_strongCount = 1;
        v4->m_weakCount = 1;
        v4->m_data = v2;
      }
      v2->m_refCount = v4;
      v5 = 1;
    }
    m_refCount = v2->m_refCount;
    if ( !v5 )
      AgReferenceCount::incRef(v2->m_refCount);
  }
  else
  {
    v2 = 0i64;
    m_refCount = 0i64;
  }
  m_ref = this->m_ref;
  m_ptr = this->m_ptr;
  this->m_ref = m_refCount;
  this->m_ptr = v2;
  if ( m_ref )
  {
    v9 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v9 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgMount *, __int64))m_ptr->~AgMount)(m_ptr, 1i64);
      if ( v9 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
  return this;
}

std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<__int64 const ,AgPointer<AgUser> > > > > *__fastcall std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringKey const,AgPointer<AgLeaderboard>>>>>::operator++(
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<__int64 const ,AgPointer<AgUser> > > > > *this)
{
  std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *Ptr; // rax
  std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *Right; // rcx
  std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *j; // rax
  std::_Tree_node<std::pair<__int64 const ,AgPointer<AgUser> >,void *> *i; // rax

  Ptr = this->_Ptr;
  if ( this->_Ptr->_Isnil )
    return this;
  Right = Ptr->_Right;
  if ( Right->_Isnil )
  {
    for ( i = Ptr->_Parent; !i->_Isnil; i = i->_Parent )
    {
      if ( this->_Ptr != i->_Right )
        break;
      this->_Ptr = i;
    }
    this->_Ptr = i;
    return this;
  }
  for ( j = Right->_Left; !j->_Isnil; j = j->_Left )
    Right = j;
  this->_Ptr = Right;
  return this;
}

AgPath *__fastcall AgPath::operator/(AgPath *this, AgPath *result, const AgPath *other)
{
  AgPath *v5; // rax
  unsigned __int64 v6; // rdx
  AgString v8; // [rsp+30h] [rbp-18h] BYREF

  AgString::AgString(&v8, &this->m_path);
  v5 = AgPath::append((AgPath *)&v8, &other->m_path);
  AgString::AgString(&result->m_path, &v5->m_path);
  AgString::~AgString(&v8, v6);
  return result;
}

std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *__fastcall std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Buyheadnode(
        std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *result; // rax

  result = (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)operator new(0x40ui64);
  if ( !result )
    invalid_parameter_noinfo_noreturn();
  result->_Left = result;
  if ( result != (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)-8i64 )
    result->_Parent = result;
  if ( result != (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *)-16i64 )
    result->_Right = result;
  *(_WORD *)&result->_Color = 257;
  return result;
}

std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> **__fastcall std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Buynode0(
        std::_Tree_comp_alloc<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> **v2; // rdx

  v2 = (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> **)operator new(0x40ui64);
  if ( !v2 )
    invalid_parameter_noinfo_noreturn();
  *v2 = this->_Mypair._Myval2._Myval2._Myhead;
  if ( v2 != (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> **)-8i64 )
    v2[1] = this->_Mypair._Myval2._Myval2._Myhead;
  if ( v2 != (std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> **)-16i64 )
    v2[2] = this->_Mypair._Myval2._Myval2._Myhead;
  return v2;
}

void __fastcall std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Destroy_if_not_nil(
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this,
        std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *_Newnode)
{
  std::pair<AgString const ,AgPointer<AgMount> > *p_Myval; // rbx
  unsigned __int64 v4; // rdx

  p_Myval = &_Newnode->_Myval;
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&_Newnode->_Myval.second);
  AgString::~AgString((AgString *)&p_Myval->first, v4);
  operator delete(_Newnode);
}

void __fastcall std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Erase(
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this,
        std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *_Rootnode)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v2; // rsi
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *i; // rbx
  unsigned __int64 v5; // rdx

  v2 = _Rootnode;
  for ( i = _Rootnode; !i->_Isnil; v2 = i )
  {
    std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Erase(
      this,
      i->_Right);
    i = i->_Left;
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v2->_Myval.second);
    AgString::~AgString((AgString *)&v2->_Myval.first, v5);
    operator delete(v2);
  }
}

void __fastcall std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Lrotate(
        std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *this,
        std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *_Wherenode)
{
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Right; // r8
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Parent; // rax

  Right = _Wherenode->_Right;
  _Wherenode->_Right = Right->_Left;
  if ( !Right->_Left->_Isnil )
    Right->_Left->_Parent = _Wherenode;
  Right->_Parent = _Wherenode->_Parent;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = Right;
    Right->_Left = _Wherenode;
    _Wherenode->_Parent = Right;
  }
  else
  {
    Parent = _Wherenode->_Parent;
    if ( _Wherenode == Parent->_Left )
      Parent->_Left = Right;
    else
      Parent->_Right = Right;
    Right->_Left = _Wherenode;
    _Wherenode->_Parent = Right;
  }
}

void __fastcall std::vector<AgMountEvent>::_Reallocate(std::vector<AgMountEvent> *this, unsigned __int64 _Count)
{
  AgMountEvent *v4; // r12
  AgMountEvent *Mylast; // r14
  AgMountEvent *Myfirst; // rbx
  signed __int64 v7; // rsi

  v4 = (AgMountEvent *)std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
                         (std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *)this,
                         _Count);
  std::_Uninitialized_move_al_unchecked1<AgMountEvent *,AgMountEvent *,std::allocator<AgMountEvent>>(
    this->_Mypair._Myval2._Myfirst,
    this->_Mypair._Myval2._Mylast,
    v4,
    (std::_Wrap_alloc<std::allocator<AgMountEvent> > *)this);
  Mylast = this->_Mypair._Myval2._Mylast;
  Myfirst = this->_Mypair._Myval2._Myfirst;
  v7 = (char *)Mylast - (char *)this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( ; Myfirst != Mylast; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
  }
  this->_Mypair._Myval2._Myend = &v4[_Count];
  this->_Mypair._Myval2._Mylast = (AgMountEvent *)((char *)v4 + (v7 & 0xFFFFFFFFFFFFFFF0ui64));
  this->_Mypair._Myval2._Myfirst = v4;
}

void __fastcall std::vector<AgMountWriteBeginEvent>::_Reallocate(
        std::vector<AgMountWriteBeginEvent> *this,
        unsigned __int64 _Count)
{
  AgMountWriteBeginEvent *v4; // r12
  AgMountWriteBeginEvent *Mylast; // r14
  AgMountWriteBeginEvent *Myfirst; // rbx
  signed __int64 v7; // rsi

  v4 = (AgMountWriteBeginEvent *)std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
                                   (std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *)this,
                                   _Count);
  std::_Uninitialized_move_al_unchecked1<AgMountWriteBeginEvent *,AgMountWriteBeginEvent *,std::allocator<AgMountWriteBeginEvent>>(
    this->_Mypair._Myval2._Myfirst,
    this->_Mypair._Myval2._Mylast,
    v4,
    (std::_Wrap_alloc<std::allocator<AgMountWriteBeginEvent> > *)this);
  Mylast = this->_Mypair._Myval2._Mylast;
  Myfirst = this->_Mypair._Myval2._Myfirst;
  v7 = (char *)Mylast - (char *)this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( ; Myfirst != Mylast; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
  }
  this->_Mypair._Myval2._Myend = &v4[_Count];
  this->_Mypair._Myval2._Mylast = (AgMountWriteBeginEvent *)((char *)v4 + (v7 & 0xFFFFFFFFFFFFFFF0ui64));
  this->_Mypair._Myval2._Myfirst = v4;
}

void __fastcall std::vector<AgMountWriteEndEvent>::_Reallocate(
        std::vector<AgMountWriteEndEvent> *this,
        unsigned __int64 _Count)
{
  AgMountWriteEndEvent *v4; // r12
  AgMountWriteEndEvent *Mylast; // r14
  AgMountWriteEndEvent *Myfirst; // rbx
  signed __int64 v7; // rsi

  v4 = (AgMountWriteEndEvent *)std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
                                 (std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *)this,
                                 _Count);
  std::_Uninitialized_move_al_unchecked1<AgMountWriteEndEvent *,AgMountWriteEndEvent *,std::allocator<AgMountWriteEndEvent>>(
    this->_Mypair._Myval2._Myfirst,
    this->_Mypair._Myval2._Mylast,
    v4,
    (std::_Wrap_alloc<std::allocator<AgMountWriteEndEvent> > *)this);
  Mylast = this->_Mypair._Myval2._Mylast;
  Myfirst = this->_Mypair._Myval2._Myfirst;
  v7 = (char *)Mylast - (char *)this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( ; Myfirst != Mylast; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
  }
  this->_Mypair._Myval2._Myend = &v4[_Count];
  this->_Mypair._Myval2._Mylast = (AgMountWriteEndEvent *)((char *)v4 + (v7 & 0xFFFFFFFFFFFFFFF0ui64));
  this->_Mypair._Myval2._Myfirst = v4;
}

void __fastcall std::vector<AgUnmountEvent>::_Reallocate(std::vector<AgUnmountEvent> *this, unsigned __int64 _Count)
{
  AgUnmountEvent *v4; // r12
  AgUnmountEvent *Mylast; // r14
  AgUnmountEvent *Myfirst; // rbx
  signed __int64 v7; // rsi

  v4 = (AgUnmountEvent *)std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
                           (std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *)this,
                           _Count);
  std::_Uninitialized_move_al_unchecked1<AgUnmountEvent *,AgUnmountEvent *,std::allocator<AgUnmountEvent>>(
    this->_Mypair._Myval2._Myfirst,
    this->_Mypair._Myval2._Mylast,
    v4,
    (std::_Wrap_alloc<std::allocator<AgUnmountEvent> > *)this);
  Mylast = this->_Mypair._Myval2._Mylast;
  Myfirst = this->_Mypair._Myval2._Myfirst;
  v7 = (char *)Mylast - (char *)this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( ; Myfirst != Mylast; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
  }
  this->_Mypair._Myval2._Myend = &v4[_Count];
  this->_Mypair._Myval2._Mylast = (AgUnmountEvent *)((char *)v4 + (v7 & 0xFFFFFFFFFFFFFFF0ui64));
  this->_Mypair._Myval2._Myfirst = v4;
}

void __fastcall std::vector<AgDelegate1<AgMountErrorEvent const &,void>>::_Reallocate(
        std::vector<AgDelegate1<AgMountErrorEvent const &,void>> *this,
        unsigned __int64 _Count)
{
  AgDelegate1<AgMountErrorEvent const &,void> *v4; // r14
  signed __int64 v5; // rdi

  v4 = (AgDelegate1<AgMountErrorEvent const &,void> *)std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
                                                        (std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *)this,
                                                        _Count);
  std::_Uninitialized_move_al_unchecked1<AgDelegate1<AgMountErrorEvent const &,void> *,AgDelegate1<AgMountErrorEvent const &,void> *,std::allocator<AgDelegate1<AgMountErrorEvent const &,void>>>(
    this->_Mypair._Myval2._Myfirst,
    this->_Mypair._Myval2._Mylast,
    v4,
    (std::_Wrap_alloc<std::allocator<AgDelegate1<AgMountErrorEvent const &,void> > > *)this);
  v5 = (char *)this->_Mypair._Myval2._Mylast - (char *)this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
  this->_Mypair._Myval2._Myend = &v4[_Count];
  this->_Mypair._Myval2._Mylast = (AgDelegate1<AgMountErrorEvent const &,void> *)((char *)v4
                                                                                + (v5 & 0xFFFFFFFFFFFFFFF0ui64));
  this->_Mypair._Myval2._Myfirst = v4;
}

void __fastcall std::vector<AgMountEvent>::_Reserve(std::vector<AgMountEvent> *this, unsigned __int64 _Count)
{
  AgMountEvent *Myend; // r10
  AgMountEvent *Mylast; // r8
  AgMountEvent *Myfirst; // rcx
  __int64 v6; // r8
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // r10
  unsigned __int64 v9; // rcx

  Myend = this->_Mypair._Myval2._Myend;
  Mylast = this->_Mypair._Myval2._Mylast;
  if ( Myend - Mylast < _Count )
  {
    Myfirst = this->_Mypair._Myval2._Myfirst;
    v6 = Mylast - Myfirst;
    if ( 0xFFFFFFFFFFFFFFFi64 - v6 < _Count )
      std::_Xlength_error("vector<T> too long");
    v7 = v6 + _Count;
    v8 = Myend - Myfirst;
    v9 = 0i64;
    if ( 0xFFFFFFFFFFFFFFFi64 - (v8 >> 1) >= v8 )
      v9 = v8 + (v8 >> 1);
    if ( v9 >= v7 )
      v7 = v9;
    std::vector<AgMountEvent>::_Reallocate(this, v7);
  }
}

void __fastcall std::vector<AgMountWriteBeginEvent>::_Reserve(
        std::vector<AgMountWriteBeginEvent> *this,
        unsigned __int64 _Count)
{
  AgMountWriteBeginEvent *Myend; // r10
  AgMountWriteBeginEvent *Mylast; // r8
  AgMountWriteBeginEvent *Myfirst; // rcx
  __int64 v6; // r8
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // r10
  unsigned __int64 v9; // rcx

  Myend = this->_Mypair._Myval2._Myend;
  Mylast = this->_Mypair._Myval2._Mylast;
  if ( Myend - Mylast < _Count )
  {
    Myfirst = this->_Mypair._Myval2._Myfirst;
    v6 = Mylast - Myfirst;
    if ( 0xFFFFFFFFFFFFFFFi64 - v6 < _Count )
      std::_Xlength_error("vector<T> too long");
    v7 = v6 + _Count;
    v8 = Myend - Myfirst;
    v9 = 0i64;
    if ( 0xFFFFFFFFFFFFFFFi64 - (v8 >> 1) >= v8 )
      v9 = v8 + (v8 >> 1);
    if ( v9 >= v7 )
      v7 = v9;
    std::vector<AgMountWriteBeginEvent>::_Reallocate(this, v7);
  }
}

void __fastcall std::vector<AgMountWriteEndEvent>::_Reserve(
        std::vector<AgMountWriteEndEvent> *this,
        unsigned __int64 _Count)
{
  AgMountWriteEndEvent *Myend; // r10
  AgMountWriteEndEvent *Mylast; // r8
  AgMountWriteEndEvent *Myfirst; // rcx
  __int64 v6; // r8
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // r10
  unsigned __int64 v9; // rcx

  Myend = this->_Mypair._Myval2._Myend;
  Mylast = this->_Mypair._Myval2._Mylast;
  if ( Myend - Mylast < _Count )
  {
    Myfirst = this->_Mypair._Myval2._Myfirst;
    v6 = Mylast - Myfirst;
    if ( 0xFFFFFFFFFFFFFFFi64 - v6 < _Count )
      std::_Xlength_error("vector<T> too long");
    v7 = v6 + _Count;
    v8 = Myend - Myfirst;
    v9 = 0i64;
    if ( 0xFFFFFFFFFFFFFFFi64 - (v8 >> 1) >= v8 )
      v9 = v8 + (v8 >> 1);
    if ( v9 >= v7 )
      v7 = v9;
    std::vector<AgMountWriteEndEvent>::_Reallocate(this, v7);
  }
}

void __fastcall std::vector<AgUnmountEvent>::_Reserve(std::vector<AgUnmountEvent> *this, unsigned __int64 _Count)
{
  AgUnmountEvent *Myend; // r10
  AgUnmountEvent *Mylast; // r8
  AgUnmountEvent *Myfirst; // rcx
  __int64 v6; // r8
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // r10
  unsigned __int64 v9; // rcx

  Myend = this->_Mypair._Myval2._Myend;
  Mylast = this->_Mypair._Myval2._Mylast;
  if ( Myend - Mylast < _Count )
  {
    Myfirst = this->_Mypair._Myval2._Myfirst;
    v6 = Mylast - Myfirst;
    if ( 0xFFFFFFFFFFFFFFFi64 - v6 < _Count )
      std::_Xlength_error("vector<T> too long");
    v7 = v6 + _Count;
    v8 = Myend - Myfirst;
    v9 = 0i64;
    if ( 0xFFFFFFFFFFFFFFFi64 - (v8 >> 1) >= v8 )
      v9 = v8 + (v8 >> 1);
    if ( v9 >= v7 )
      v7 = v9;
    std::vector<AgUnmountEvent>::_Reallocate(this, v7);
  }
}

void __fastcall std::vector<AgDelegate1<AgMountErrorEvent const &,void>>::_Reserve(
        std::vector<AgDelegate1<AgMountErrorEvent const &,void>> *this,
        unsigned __int64 _Count)
{
  AgDelegate1<AgMountErrorEvent const &,void> *Myend; // r10
  AgDelegate1<AgMountErrorEvent const &,void> *Mylast; // r8
  AgDelegate1<AgMountErrorEvent const &,void> *Myfirst; // rcx
  __int64 v6; // r8
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // r10
  unsigned __int64 v9; // rcx

  Myend = this->_Mypair._Myval2._Myend;
  Mylast = this->_Mypair._Myval2._Mylast;
  if ( Myend - Mylast < _Count )
  {
    Myfirst = this->_Mypair._Myval2._Myfirst;
    v6 = Mylast - Myfirst;
    if ( 0xFFFFFFFFFFFFFFFi64 - v6 < _Count )
      std::_Xlength_error("vector<T> too long");
    v7 = v6 + _Count;
    v8 = Myend - Myfirst;
    v9 = 0i64;
    if ( 0xFFFFFFFFFFFFFFFi64 - (v8 >> 1) >= v8 )
      v9 = v8 + (v8 >> 1);
    if ( v9 >= v7 )
      v7 = v9;
    std::vector<AgDelegate1<AgMountErrorEvent const &,void>>::_Reallocate(this, v7);
  }
}

void __fastcall std::_Tree<std::_Tmap_traits<enum AgControllerComponentType,std::list<AgControllerComponent *>,std::less<enum AgControllerComponentType>,std::allocator<std::pair<enum AgControllerComponentType const,std::list<AgControllerComponent *>>>,0>>::_Rrotate(
        std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *this,
        std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *_Wherenode)
{
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Left; // r8
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Right; // rax
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Parent; // rax

  Left = _Wherenode->_Left;
  _Wherenode->_Left = _Wherenode->_Left->_Right;
  Right = Left->_Right;
  if ( !Right->_Isnil )
    Right->_Parent = _Wherenode;
  Left->_Parent = _Wherenode->_Parent;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = Left;
    Left->_Right = _Wherenode;
    _Wherenode->_Parent = Left;
  }
  else
  {
    Parent = _Wherenode->_Parent;
    if ( _Wherenode == Parent->_Right )
      Parent->_Right = Left;
    else
      Parent->_Left = Left;
    Left->_Right = _Wherenode;
    _Wherenode->_Parent = Left;
  }
}

void __fastcall std::vector<AgMountErrorEvent>::_Tidy(std::vector<AgMountErrorEvent> *this)
{
  AgMountErrorEvent *Myfirst; // rbx
  AgMountErrorEvent *i; // rdi
  unsigned __int64 v4; // rdx

  Myfirst = this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( i = this->_Mypair._Myval2._Mylast; Myfirst != i; ++Myfirst )
    {
      AgPointer<AgBuffer<AgAllocator<1>>>::~AgPointer<AgBuffer<AgAllocator<1>>>(&Myfirst->data);
      AgString::~AgString(&Myfirst->path.m_path, v4);
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    }
    std::allocator<AgMountErrorEvent>::deallocate(
      (std::allocator<AgMountErrorEvent> *)this,
      this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgMountEvent>::_Tidy(std::vector<AgMountEvent> *this)
{
  AgMountEvent *Myfirst; // rbx
  AgMountEvent *i; // rdi

  Myfirst = this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( i = this->_Mypair._Myval2._Mylast; Myfirst != i; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgMountWriteBeginEvent>::_Tidy(std::vector<AgMountWriteBeginEvent> *this)
{
  AgMountWriteBeginEvent *Myfirst; // rbx
  AgMountWriteBeginEvent *i; // rdi

  Myfirst = this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( i = this->_Mypair._Myval2._Mylast; Myfirst != i; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgMountWriteEndEvent>::_Tidy(std::vector<AgMountWriteEndEvent> *this)
{
  AgMountWriteEndEvent *Myfirst; // rbx
  AgMountWriteEndEvent *i; // rdi

  Myfirst = this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( i = this->_Mypair._Myval2._Mylast; Myfirst != i; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall std::vector<AgUnmountEvent>::_Tidy(std::vector<AgUnmountEvent> *this)
{
  AgUnmountEvent *Myfirst; // rbx
  AgUnmountEvent *i; // rdi

  Myfirst = this->_Mypair._Myval2._Myfirst;
  if ( this->_Mypair._Myval2._Myfirst )
  {
    for ( i = this->_Mypair._Myval2._Mylast; Myfirst != i; ++Myfirst )
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)Myfirst);
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)this,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)this->_Mypair._Myval2._Myfirst,
      this->_Mypair._Myval2._Myend - this->_Mypair._Myval2._Myfirst);
    this->_Mypair._Myval2._Myfirst = 0i64;
    this->_Mypair._Myval2._Mylast = 0i64;
    this->_Mypair._Myval2._Myend = 0i64;
  }
}

void __fastcall AgFileSystem::_handleConfirmDelete(AgFileSystem *this, AgPointer<AgDialog> *dialog)
{
  AgSaveErrorDialog *m_ptr; // rbp
  AgReferenceCount *m_ref; // rdi
  int m_strongCount; // ebx
  AgReferenceCount *v6; // rdi
  AgMount *v7; // rbx
  AgDialog *v8; // rax
  unsigned __int64 v9; // rdx
  int v10; // esi
  AgSaveErrorDialog *v11; // rdi
  AgReferenceCount *v12; // rbx
  int v13; // esi
  AgPointer<AgSaveErrorDialog> value; // [rsp+38h] [rbp-40h] BYREF
  AgString v15; // [rsp+48h] [rbp-30h] BYREF

  AgPointer<AgDialog>::operator<AgSaveErrorDialog> AgPointer<AgSaveErrorDialog>(dialog, &value);
  m_ptr = value.m_ptr;
  m_ref = value.m_ptr->m_error.mount.m_ref;
  if ( !m_ref )
    goto LABEL_8;
  m_strongCount = m_ref->m_strongCount;
  if ( !m_ref->m_strongCount )
    goto LABEL_8;
  while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( !m_ref->m_strongCount )
      goto LABEL_8;
  }
  if ( m_strongCount != -1 )
  {
    v6 = m_ptr->m_error.mount.m_ref;
    v7 = m_ptr->m_error.mount.m_ptr;
  }
  else
  {
LABEL_8:
    v7 = 0i64;
    v6 = 0i64;
  }
  v8 = dialog->m_ptr;
  if ( v8->m_status == AgDialogStatus_Completed && v8->m_result )
  {
    if ( !v7 )
      goto LABEL_16;
    AgString::AgString(&v15, "/", -1);
    AgPath::clean((AgPath *)&v15);
    v7->removeDirectory(v7, (const AgPath *)&v15);
    AgString::~AgString(&v15, v9);
  }
  if ( v7 && v7->m_error.error == AgMountError_None )
    v7->mount(v7);
LABEL_16:
  if ( v6 )
  {
    v10 = 0;
    if ( !AgAtomicDecrement(&v6->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v6->m_weakCount) )
        v10 = 1;
      v6->m_data = 0i64;
      if ( v7 )
        ((void (__fastcall *)(AgMount *, __int64))v7->~AgMount)(v7, 1i64);
      if ( v10 )
        AgReferenceCount::operator delete(v6);
    }
  }
  v11 = value.m_ptr;
  value.m_ptr = 0i64;
  v12 = value.m_ref;
  if ( value.m_ref )
  {
    value.m_ref = 0i64;
    v13 = 0;
    if ( !AgAtomicDecrement(&v12->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v12->m_weakCount) )
        v13 = 1;
      v12->m_data = 0i64;
      if ( v11 )
        ((void (__fastcall *)(AgSaveErrorDialog *, __int64))v11->~AgDialog)(v11, 1i64);
      if ( v13 )
        AgReferenceCount::operator delete(v12);
    }
  }
  AgPointer<AgDialog>::~AgPointer<AgDialog>(dialog);
}

void __fastcall AgFileSystem::_handleSaveError(AgFileSystem *this, AgPointer<AgDialog> *dialog)
{
  AgMountError error; // eax
  AgMount *m_ptr; // rcx
  AgMount_vtbl *v6; // rax
  AgSaveErrorDialog *v7; // rdi
  AgReferenceCount *m_ref; // rbx
  int v9; // esi
  AgPointer<AgSaveErrorDialog> result; // [rsp+28h] [rbp-30h] BYREF

  AgPointer<AgDialog>::operator<AgSaveErrorDialog> AgPointer<AgSaveErrorDialog>(dialog, &result);
  error = result.m_ptr->m_error.errorData.error;
  if ( error == AgMountError_Corrupt || error == AgMountError_NotOwned )
  {
    AgFileSystem::_showConfirmDelete(this, &result.m_ptr->m_error);
  }
  else
  {
    m_ptr = result.m_ptr->m_error.mount.m_ptr;
    if ( m_ptr && m_ptr->m_error.error == AgMountError_None )
    {
      v6 = m_ptr->__vftable;
      if ( m_ptr->m_mounted )
        ((void (__fastcall *)(AgMount *))v6->retry)(m_ptr);
      else
        v6->mount(m_ptr);
    }
  }
  v7 = result.m_ptr;
  result.m_ptr = 0i64;
  m_ref = result.m_ref;
  if ( result.m_ref )
  {
    result.m_ref = 0i64;
    v9 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v9 = 1;
      m_ref->m_data = 0i64;
      if ( v7 )
        ((void (__fastcall *)(AgSaveErrorDialog *, __int64))v7->~AgDialog)(v7, 1i64);
      if ( v9 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
  AgPointer<AgDialog>::~AgPointer<AgDialog>(dialog);
}

void __fastcall AgFileSystem::_mountError(AgFileSystem *this, const AgMountErrorEvent *error)
{
  char v4; // bl
  const AgString *MountName; // rax
  bool v6; // di
  AgPointer<AgPlayer> *PrimaryPlayer; // rax
  AgReferenceCount *m_ref; // rdi
  int m_strongCount; // ebx
  AgMount *m_ptr; // rcx
  AgPointer<AgUser> v11; // [rsp+40h] [rbp-78h] BYREF
  AgPointer<AgUser> v12; // [rsp+50h] [rbp-68h] BYREF
  AgDelegate1<AgPointer<AgDialog>,void> v13; // [rsp+60h] [rbp-58h] BYREF
  AgString v14; // [rsp+70h] [rbp-48h] BYREF
  AgPointer<AgPlayer> result; // [rsp+80h] [rbp-38h] BYREF
  AgPointer<AgDialog> v16; // [rsp+90h] [rbp-28h] BYREF

  v4 = 0;
  v6 = 1;
  if ( error->mount.m_ptr )
  {
    MountName = AgFileSystem::getMountName(&v14, AgMountPoint_SaveData);
    v4 = 1;
    if ( !operator==(&error->mount.m_ptr->m_mountPoint, MountName) )
      v6 = 0;
  }
  if ( (v4 & 1) != 0 )
    AgString::~AgString(&v14, (unsigned __int64)error);
  if ( v6 )
  {
    if ( AgSingleton<AgDialogManager>::ms_instance )
    {
      PrimaryPlayer = AgPlayerManager::getPrimaryPlayer(
                        (AgPlayerManager *)AgSingleton<AgPlayerManager>::ms_instance,
                        &result);
      AgPlayer::getUser(PrimaryPlayer->m_ptr, &v12);
      AgPointer<AgPlayer>::~AgPointer<AgPlayer>(&result);
      v11 = 0i64;
      m_ref = v12.m_ref;
      if ( v12.m_ref )
      {
        m_strongCount = v12.m_ref->m_strongCount;
        if ( v12.m_ref->m_strongCount )
        {
          while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
          {
            m_strongCount = m_ref->m_strongCount;
            if ( !m_ref->m_strongCount )
              goto LABEL_16;
          }
          if ( m_strongCount != -1 )
            v11 = v12;
        }
      }
LABEL_16:
      v13.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgFileSystem::_handleSaveError;
      v13.m_Closure.m_pthis = (detail::GenericClass *)this;
      AgDialogManager::showSaveErrorDialog(
        (AgDialogManager *)AgSingleton<AgDialogManager>::ms_instance,
        &v16,
        &v11,
        error,
        &v13);
      AgPointer<AgDialog>::~AgPointer<AgDialog>(&v16);
      AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v12);
    }
  }
  else
  {
    m_ptr = error->mount.m_ptr;
    if ( m_ptr )
      AgMount::setError(m_ptr, &error->errorData);
  }
}

void __fastcall AgFileSystem::_showConfirmDelete(AgFileSystem *this, const AgMountErrorEvent *error)
{
  AgPointer<AgPlayer> *PrimaryPlayer; // rax
  AgReferenceCount *m_ref; // rdi
  int m_strongCount; // ebx
  unsigned __int64 v7; // rdx
  AgPointer<AgUser> v8; // [rsp+38h] [rbp-69h] BYREF
  AgPointer<AgUser> v9; // [rsp+48h] [rbp-59h] BYREF
  AgDelegate1<AgPointer<AgDialog>,void> v10; // [rsp+58h] [rbp-49h] BYREF
  AgMountErrorEvent v11; // [rsp+68h] [rbp-39h] BYREF
  __int64 v12; // [rsp+B8h] [rbp+17h]
  AgPointer<AgPlayer> result; // [rsp+C0h] [rbp+1Fh] BYREF
  AgPointer<AgDialog> v14; // [rsp+D0h] [rbp+2Fh] BYREF

  v12 = -2i64;
  if ( AgSingleton<AgDialogManager>::ms_instance )
  {
    AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
      (AgPointer<AgPlayer> *)&v11,
      (const AgPointer<AgPlayer> *)error);
    AgString::AgString(&v11.path.m_path, &error->path.m_path);
    v11.operation = error->operation;
    v11.expectedSize = error->expectedSize;
    v11.errorData = error->errorData;
    AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
      (AgPointer<AgPlayer> *)&v11.data,
      (const AgPointer<AgPlayer> *)&error->data);
    v11.operation = AgMountOperation_Delete;
    v11.errorData.error = AgMountError_Confirm;
    PrimaryPlayer = AgPlayerManager::getPrimaryPlayer(
                      (AgPlayerManager *)AgSingleton<AgPlayerManager>::ms_instance,
                      &result);
    AgPlayer::getUser(PrimaryPlayer->m_ptr, &v9);
    AgPointer<AgPlayer>::~AgPointer<AgPlayer>(&result);
    v8 = 0i64;
    m_ref = v9.m_ref;
    if ( v9.m_ref )
    {
      m_strongCount = v9.m_ref->m_strongCount;
      if ( v9.m_ref->m_strongCount )
      {
        while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
        {
          m_strongCount = m_ref->m_strongCount;
          if ( !m_ref->m_strongCount )
            goto LABEL_9;
        }
        if ( m_strongCount != -1 )
          v8 = v9;
      }
    }
LABEL_9:
    v10.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgFileSystem::_handleConfirmDelete;
    v10.m_Closure.m_pthis = (detail::GenericClass *)this;
    AgDialogManager::showSaveErrorDialog(
      (AgDialogManager *)AgSingleton<AgDialogManager>::ms_instance,
      &v14,
      &v8,
      &v11,
      &v10);
    AgPointer<AgDialog>::~AgPointer<AgDialog>(&v14);
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v9);
    AgPointer<AgBuffer<AgAllocator<1>>>::~AgPointer<AgBuffer<AgAllocator<1>>>(&v11.data);
    AgString::~AgString(&v11.path.m_path, v7);
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v11);
  }
}

void __fastcall AgFileSystem::addMount(AgFileSystem *this, AgPointer<AgMount> *mount)
{
  AgMutex *p_m_mutex; // rdi
  std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >,bool> result; // [rsp+38h] [rbp-20h] BYREF

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  std::map<AgString,AgPointer<AgMount>>::_Try_emplace<AgString const &,>(
    &this->m_mounts,
    &result,
    &mount->m_ptr->m_mountPoint);
  AgPointer<AgMount>::operator=(&result.first._Ptr->_Myval.second, mount);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)mount);
}

AgDelegate1<AgShutdownEvent const &,void> *__fastcall std::allocator<AgDelegate1<AgShutdownEvent const &,void>>::allocate(
        std::allocator<AgDelegate1<AgShutdownEvent const &,void> > *this,
        unsigned __int64 _Count)
{
  AgDelegate1<AgShutdownEvent const &,void> *result; // rax
  unsigned __int64 v3; // rdx
  void (__fastcall *v4)(detail::GenericClass *); // rax
  void (__fastcall *v5)(detail::GenericClass *); // rcx

  if ( !_Count )
    return 0i64;
  if ( _Count > 0xFFFFFFFFFFFFFFFi64 )
    std::_Xbad_alloc();
  v3 = 16 * _Count;
  if ( v3 < 0x1000 )
  {
    result = (AgDelegate1<AgShutdownEvent const &,void> *)operator new(v3);
    if ( !result )
      invalid_parameter_noinfo_noreturn();
  }
  else
  {
    if ( v3 + 39 <= v3 )
      std::_Xbad_alloc();
    v4 = (void (__fastcall *)(detail::GenericClass *))operator new(v3 + 39);
    v5 = v4;
    if ( !v4 )
      invalid_parameter_noinfo_noreturn();
    result = (AgDelegate1<AgShutdownEvent const &,void> *)(((unsigned __int64)v4 + 39) & 0xFFFFFFFFFFFFFFE0ui64);
    result[-1].m_Closure.m_pFunction = v5;
  }
  return result;
}

void __fastcall AgEventDispatcherBase<AgMountErrorEvent>::call(
        AgEventDispatcherBase<AgMountErrorEvent> *this,
        const AgMountErrorEvent *e)
{
  AgDelegate1<AgMountErrorEvent const &,void> *Myfirst; // rbx
  void (__fastcall *m_pFunction)(detail::GenericClass *); // rbp
  detail::GenericClass *m_pthis; // r14

  EnterCriticalSection((LPCRITICAL_SECTION)this);
  Myfirst = this->m_bindings._Mypair._Myval2._Myfirst;
  while ( Myfirst != this->m_bindings._Mypair._Myval2._Mylast )
  {
    m_pFunction = Myfirst->m_Closure.m_pFunction;
    m_pthis = Myfirst->m_Closure.m_pthis;
    ++Myfirst;
    LeaveCriticalSection((LPCRITICAL_SECTION)this);
    ((void (__fastcall *)(detail::GenericClass *, const AgMountErrorEvent *))m_pFunction)(m_pthis, e);
    EnterCriticalSection((LPCRITICAL_SECTION)this);
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgMountEvent>::call(
        AgEventDispatcherBase<AgMountEvent> *this,
        const AgMountEvent *e)
{
  AgDelegate1<AgMountEvent const &,void> *Myfirst; // rbx
  void (__fastcall *m_pFunction)(detail::GenericClass *); // rbp
  detail::GenericClass *m_pthis; // r14

  EnterCriticalSection((LPCRITICAL_SECTION)this);
  Myfirst = this->m_bindings._Mypair._Myval2._Myfirst;
  while ( Myfirst != this->m_bindings._Mypair._Myval2._Mylast )
  {
    m_pFunction = Myfirst->m_Closure.m_pFunction;
    m_pthis = Myfirst->m_Closure.m_pthis;
    ++Myfirst;
    LeaveCriticalSection((LPCRITICAL_SECTION)this);
    ((void (__fastcall *)(detail::GenericClass *, const AgMountEvent *))m_pFunction)(m_pthis, e);
    EnterCriticalSection((LPCRITICAL_SECTION)this);
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgMountWriteBeginEvent>::call(
        AgEventDispatcherBase<AgMountWriteBeginEvent> *this,
        const AgMountWriteBeginEvent *e)
{
  AgDelegate1<AgMountWriteBeginEvent const &,void> *Myfirst; // rbx
  void (__fastcall *m_pFunction)(detail::GenericClass *); // rbp
  detail::GenericClass *m_pthis; // r14

  EnterCriticalSection((LPCRITICAL_SECTION)this);
  Myfirst = this->m_bindings._Mypair._Myval2._Myfirst;
  while ( Myfirst != this->m_bindings._Mypair._Myval2._Mylast )
  {
    m_pFunction = Myfirst->m_Closure.m_pFunction;
    m_pthis = Myfirst->m_Closure.m_pthis;
    ++Myfirst;
    LeaveCriticalSection((LPCRITICAL_SECTION)this);
    ((void (__fastcall *)(detail::GenericClass *, const AgMountWriteBeginEvent *))m_pFunction)(m_pthis, e);
    EnterCriticalSection((LPCRITICAL_SECTION)this);
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgMountWriteEndEvent>::call(
        AgEventDispatcherBase<AgMountWriteEndEvent> *this,
        const AgMountWriteEndEvent *e)
{
  AgDelegate1<AgMountWriteEndEvent const &,void> *Myfirst; // rbx
  void (__fastcall *m_pFunction)(detail::GenericClass *); // rbp
  detail::GenericClass *m_pthis; // r14

  EnterCriticalSection((LPCRITICAL_SECTION)this);
  Myfirst = this->m_bindings._Mypair._Myval2._Myfirst;
  while ( Myfirst != this->m_bindings._Mypair._Myval2._Mylast )
  {
    m_pFunction = Myfirst->m_Closure.m_pFunction;
    m_pthis = Myfirst->m_Closure.m_pthis;
    ++Myfirst;
    LeaveCriticalSection((LPCRITICAL_SECTION)this);
    ((void (__fastcall *)(detail::GenericClass *, const AgMountWriteEndEvent *))m_pFunction)(m_pthis, e);
    EnterCriticalSection((LPCRITICAL_SECTION)this);
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)this);
}

void __fastcall AgEventDispatcherBase<AgUnmountEvent>::call(
        AgEventDispatcherBase<AgUnmountEvent> *this,
        const AgUnmountEvent *e)
{
  AgDelegate1<AgUnmountEvent const &,void> *Myfirst; // rbx
  void (__fastcall *m_pFunction)(detail::GenericClass *); // rbp
  detail::GenericClass *m_pthis; // r14

  EnterCriticalSection((LPCRITICAL_SECTION)this);
  Myfirst = this->m_bindings._Mypair._Myval2._Myfirst;
  while ( Myfirst != this->m_bindings._Mypair._Myval2._Mylast )
  {
    m_pFunction = Myfirst->m_Closure.m_pFunction;
    m_pthis = Myfirst->m_Closure.m_pthis;
    ++Myfirst;
    LeaveCriticalSection((LPCRITICAL_SECTION)this);
    ((void (__fastcall *)(detail::GenericClass *, const AgUnmountEvent *))m_pFunction)(m_pthis, e);
    EnterCriticalSection((LPCRITICAL_SECTION)this);
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)this);
}

__int64 __fastcall AgFileSystem::createDirectory(AgFileSystem *this, const AgPath *path, int recursive)
{
  const AgStringRef *RootName; // rax
  const AgString *MountName; // rax
  unsigned __int64 v8; // rdx
  unsigned __int64 v9; // rdx
  AgMount *m_ptr; // rbx
  AgPath *Relative; // rax
  unsigned int v12; // ebp
  unsigned __int64 v13; // rdx
  AgMount *v14; // rdi
  AgReferenceCount *m_ref; // rbx
  int v16; // esi
  AgPointer<AgMount> v18; // [rsp+28h] [rbp-60h] BYREF
  AgString mountPoint; // [rsp+38h] [rbp-50h] BYREF
  AgString result; // [rsp+48h] [rbp-40h] BYREF
  AgPath v21; // [rsp+58h] [rbp-30h] BYREF
  AgStringRef v22; // [rsp+68h] [rbp-20h] BYREF

  RootName = AgPath::getRootName((AgPath *)path, &v22);
  AgString::AgString(&mountPoint, RootName);
  if ( !(unsigned int)AgString::getLength(&mountPoint) )
  {
    MountName = AgFileSystem::getMountName(&result, AgMountPoint_Content);
    AgString::operator=(&mountPoint, MountName);
    AgString::~AgString(&result, v8);
  }
  AgFileSystem::getMount(this, &v18, &mountPoint);
  m_ptr = v18.m_ptr;
  if ( v18.m_ptr )
  {
    Relative = AgPath::getRelative((AgPath *)path, &v21);
    v12 = m_ptr->createDirectory(m_ptr, Relative, recursive);
    AgString::~AgString(&v21.m_path, v13);
  }
  else
  {
    v12 = 0;
  }
  v14 = v18.m_ptr;
  v18.m_ptr = 0i64;
  m_ref = v18.m_ref;
  if ( v18.m_ref )
  {
    v18.m_ref = 0i64;
    v16 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v16 = 1;
      m_ref->m_data = 0i64;
      if ( v14 )
        ((void (__fastcall *)(AgMount *, __int64))v14->~AgMount)(v14, 1i64);
      if ( v16 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
  AgString::~AgString(&mountPoint, v9);
  return v12;
}

AgPointer<AgMount> *__fastcall AgFileSystem::createMount(
        AgFileSystem *this,
        AgPointer<AgMount> *result,
        const AgString *mountPoint,
        AgMountType type,
        AgStringRef *configString,
        AgPointer<AgUser> *user)
{
  AgMount *v8; // rdi
  AgArchive *v9; // rax
  AgMount *v10; // rax
  unsigned __int64 v11; // rdx
  AgPath v13; // [rsp+38h] [rbp-20h] BYREF

  v8 = 0i64;
  result->m_ref = 0i64;
  result->m_ptr = 0i64;
  if ( type == AgMountType_Archive )
  {
    AgString::AgString(&v13.m_path, configString);
    AgPath::clean(&v13);
    v9 = (AgArchive *)operator new(0x180ui64);
    if ( v9 )
    {
      AgArchive::AgArchive(v9, &v13.m_path, mountPoint);
      v8 = v10;
    }
    AgPointer<AgMount>::operator=(result, v8);
    AgString::~AgString(&v13.m_path, v11);
  }
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)user);
  return result;
}

void __fastcall AgFileSystem::createSingleton()
{
  AgPCFileSystem *v0; // rax

  v0 = (AgPCFileSystem *)operator new(0x2C0ui64);
  if ( v0 )
    AgPCFileSystem::AgPCFileSystem(v0);
}

void __fastcall std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
        std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *this,
        AgDelegate1<AgUserUpdatedEvent const &,void> *_Ptr,
        unsigned __int64 _Count)
{
  void (__fastcall *m_pFunction)(detail::GenericClass *); // rax
  char *v4; // rdx

  if ( _Count > 0xFFFFFFFFFFFFFFFi64 )
    invalid_parameter_noinfo_noreturn();
  if ( 16 * _Count >= 0x1000 )
  {
    if ( ((unsigned __int8)_Ptr & 0x1F) != 0 )
      invalid_parameter_noinfo_noreturn();
    m_pFunction = _Ptr[-1].m_Closure.m_pFunction;
    if ( (AgDelegate1<AgUserUpdatedEvent const &,void> *)m_pFunction >= _Ptr )
      invalid_parameter_noinfo_noreturn();
    v4 = (char *)((char *)_Ptr - (char *)m_pFunction);
    if ( (unsigned __int64)v4 < 8 )
      invalid_parameter_noinfo_noreturn();
    if ( (unsigned __int64)v4 > 0x27 )
      invalid_parameter_noinfo_noreturn();
    _Ptr = (AgDelegate1<AgUserUpdatedEvent const &,void> *)m_pFunction;
  }
  operator delete(_Ptr);
}

void __fastcall std::allocator<AgMountErrorEvent>::deallocate(
        std::allocator<AgMountErrorEvent> *this,
        AgMountErrorEvent *_Ptr,
        unsigned __int64 _Count)
{
  AgBuffer<AgAllocator<1> > *m_ptr; // rax
  char *v4; // rdx

  if ( _Count > 0x333333333333333i64 )
    invalid_parameter_noinfo_noreturn();
  if ( 80 * _Count >= 0x1000 )
  {
    if ( ((unsigned __int8)_Ptr & 0x1F) != 0 )
      invalid_parameter_noinfo_noreturn();
    m_ptr = _Ptr[-1].data.m_ptr;
    if ( m_ptr >= (AgBuffer<AgAllocator<1> > *)_Ptr )
      invalid_parameter_noinfo_noreturn();
    v4 = (char *)((char *)_Ptr - (char *)m_ptr);
    if ( (unsigned __int64)v4 < 8 )
      invalid_parameter_noinfo_noreturn();
    if ( (unsigned __int64)v4 > 0x27 )
      invalid_parameter_noinfo_noreturn();
    _Ptr = (AgMountErrorEvent *)m_ptr;
  }
  operator delete(_Ptr);
}

__int64 __fastcall AgFileSystem::directoryExists(AgFileSystem *this, const AgPath *path)
{
  const AgStringRef *RootName; // rax
  const AgString *MountName; // rax
  unsigned __int64 v6; // rdx
  unsigned __int64 v7; // rdx
  unsigned int v8; // esi
  AgMount *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v11; // ebp
  AgPointer<AgMount> v13; // [rsp+28h] [rbp-50h] BYREF
  AgString mountPoint; // [rsp+38h] [rbp-40h] BYREF
  AgString result; // [rsp+48h] [rbp-30h] BYREF
  AgStringRef v16; // [rsp+58h] [rbp-20h] BYREF

  RootName = AgPath::getRootName((AgPath *)path, &v16);
  AgString::AgString(&mountPoint, RootName);
  if ( !(unsigned int)AgString::getLength(&mountPoint) )
  {
    MountName = AgFileSystem::getMountName(&result, AgMountPoint_Content);
    AgString::operator=(&mountPoint, MountName);
    AgString::~AgString(&result, v6);
  }
  AgFileSystem::getMount(this, &v13, &mountPoint);
  if ( v13.m_ptr )
    v8 = v13.m_ptr->directoryExists(v13.m_ptr, path);
  else
    v8 = 0;
  m_ptr = v13.m_ptr;
  v13.m_ptr = 0i64;
  m_ref = v13.m_ref;
  if ( v13.m_ref )
  {
    v13.m_ref = 0i64;
    v11 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v11 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgMount *, __int64))m_ptr->~AgMount)(m_ptr, 1i64);
      if ( v11 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
  AgString::~AgString(&mountPoint, v7);
  return v8;
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *__fastcall std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::erase(
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *result,
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > _First,
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > _Last)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Myhead; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v7; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Left; // rcx
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *v9; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v10; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Right; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *j; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *i; // rcx
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > resulta; // [rsp+30h] [rbp+8h] BYREF
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v15; // [rsp+40h] [rbp+18h]
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Ptr; // [rsp+48h] [rbp+20h]

  Ptr = _Last._Ptr;
  v15 = _First._Ptr;
  Myhead = this->_Mypair._Myval2._Myval2._Myhead;
  if ( _First._Ptr == this->_Mypair._Myval2._Myval2._Myhead->_Left && _Last._Ptr == Myhead )
  {
    std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Erase(
      this,
      Myhead->_Parent);
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = this->_Mypair._Myval2._Myval2._Myhead;
    this->_Mypair._Myval2._Myval2._Myhead->_Left = this->_Mypair._Myval2._Myval2._Myhead;
    this->_Mypair._Myval2._Myval2._Myhead->_Right = this->_Mypair._Myval2._Myval2._Myhead;
    v7 = this->_Mypair._Myval2._Myval2._Myhead;
    this->_Mypair._Myval2._Myval2._Mysize = 0i64;
    Left = v7->_Left;
    v9 = result;
    result->_Ptr = Left;
  }
  else
  {
    if ( _First._Ptr != _Last._Ptr )
    {
      do
      {
        v10 = _First._Ptr;
        if ( !_First._Ptr->_Isnil )
        {
          Right = _First._Ptr->_Right;
          if ( Right->_Isnil )
          {
            for ( i = _First._Ptr->_Parent; !i->_Isnil; i = i->_Parent )
            {
              if ( _First._Ptr != i->_Right )
                break;
              v15 = i;
              _First._Ptr = i;
            }
            v15 = i;
          }
          else
          {
            for ( j = Right->_Left; !j->_Isnil; j = j->_Left )
              Right = j;
            v15 = Right;
          }
        }
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::erase(
          this,
          &resulta,
          (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > >)v10);
        _First._Ptr = v15;
      }
      while ( v15 != Ptr );
    }
    v9 = result;
    result->_Ptr = _First._Ptr;
  }
  return v9;
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *__fastcall std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::erase(
        std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const ,AgPointer<AgMount> > >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *result,
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > _Where)
{
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v5; // rsi
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Right; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *j; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *i; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Left; // rdi
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Parent; // rbx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v11; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *k; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v13; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *m; // rax
  std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *v15; // rax
  char Color; // cl
  bool n; // zf
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v18; // rdx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v19; // r8
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *v20; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v21; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v22; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v23; // rcx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v24; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *v25; // rax
  unsigned __int64 v26; // rdx
  unsigned __int64 Mysize; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Ptr; // [rsp+60h] [rbp+18h]

  Ptr = _Where._Ptr;
  v5 = _Where._Ptr;
  if ( !_Where._Ptr->_Isnil )
  {
    Right = _Where._Ptr->_Right;
    if ( Right->_Isnil )
    {
      for ( i = _Where._Ptr->_Parent; !i->_Isnil; i = i->_Parent )
      {
        if ( _Where._Ptr != i->_Right )
          break;
        _Where._Ptr = i;
      }
      _Where._Ptr = i;
      Ptr = i;
    }
    else
    {
      _Where._Ptr = _Where._Ptr->_Right;
      for ( j = Right->_Left; !j->_Isnil; j = j->_Left )
        _Where._Ptr = j;
      Ptr = _Where._Ptr;
    }
  }
  if ( v5->_Left->_Isnil )
  {
    Left = v5->_Right;
  }
  else if ( v5->_Right->_Isnil )
  {
    Left = v5->_Left;
  }
  else
  {
    Left = _Where._Ptr->_Right;
    if ( _Where._Ptr != v5 )
    {
      v5->_Left->_Parent = _Where._Ptr;
      _Where._Ptr->_Left = v5->_Left;
      if ( _Where._Ptr == v5->_Right )
      {
        Parent = _Where._Ptr;
      }
      else
      {
        Parent = _Where._Ptr->_Parent;
        if ( !Left->_Isnil )
          Left->_Parent = Parent;
        Parent->_Left = Left;
        _Where._Ptr->_Right = v5->_Right;
        v5->_Right->_Parent = _Where._Ptr;
      }
      if ( this->_Mypair._Myval2._Myval2._Myhead->_Parent == v5 )
      {
        this->_Mypair._Myval2._Myval2._Myhead->_Parent = _Where._Ptr;
      }
      else
      {
        v15 = (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgString const ,AgPointer<AgMount> > > > > *)v5->_Parent;
        if ( v15->_Ptr == v5 )
          v15->_Ptr = _Where._Ptr;
        else
          v15[2]._Ptr = _Where._Ptr;
      }
      _Where._Ptr->_Parent = v5->_Parent;
      Color = _Where._Ptr->_Color;
      _Where._Ptr->_Color = v5->_Color;
      v5->_Color = Color;
      goto LABEL_45;
    }
  }
  Parent = v5->_Parent;
  if ( !Left->_Isnil )
    Left->_Parent = Parent;
  if ( this->_Mypair._Myval2._Myval2._Myhead->_Parent == v5 )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = Left;
  }
  else if ( Parent->_Left == v5 )
  {
    Parent->_Left = Left;
  }
  else
  {
    Parent->_Right = Left;
  }
  if ( this->_Mypair._Myval2._Myval2._Myhead->_Left == v5 )
  {
    if ( Left->_Isnil )
    {
      v11 = Parent;
    }
    else
    {
      v11 = Left;
      for ( k = Left->_Left; !k->_Isnil; k = k->_Left )
        v11 = k;
    }
    this->_Mypair._Myval2._Myval2._Myhead->_Left = v11;
  }
  if ( this->_Mypair._Myval2._Myval2._Myhead->_Right == v5 )
  {
    if ( Left->_Isnil )
    {
      v13 = Parent;
    }
    else
    {
      v13 = Left;
      for ( m = Left->_Right; !m->_Isnil; m = m->_Right )
        v13 = m;
    }
    this->_Mypair._Myval2._Myval2._Myhead->_Right = v13;
  }
LABEL_45:
  if ( v5->_Color != 1 )
    goto LABEL_84;
  for ( n = Left == this->_Mypair._Myval2._Myval2._Myhead->_Parent;
        !n;
        n = v18 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
  {
    v18 = Parent;
    v19 = Parent;
    if ( Left->_Color != 1 )
      break;
    v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Left;
    if ( Left == Parent->_Left )
    {
      v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Right;
      if ( !v20->_Color )
      {
        v20->_Color = 1;
        Parent->_Color = 0;
        v21 = Parent->_Right;
        Parent->_Right = v21->_Left;
        if ( !v21->_Left->_Isnil )
          v21->_Left->_Parent = Parent;
        v21->_Parent = Parent->_Parent;
        if ( Parent == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
        {
          this->_Mypair._Myval2._Myval2._Myhead->_Parent = v21;
        }
        else
        {
          v22 = Parent->_Parent;
          if ( Parent == v22->_Left )
            v22->_Left = v21;
          else
            v22->_Right = v21;
        }
        v21->_Left = Parent;
        Parent->_Parent = v21;
        v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Right;
      }
      if ( !v20->_Isnil )
      {
        if ( v20->_Left->_Color != 1 || v20->_Right->_Color != 1 )
        {
          if ( v20->_Right->_Color == 1 )
          {
            v20->_Left->_Color = 1;
            v20->_Color = 0;
            std::_Tree<std::_Tmap_traits<enum AgControllerComponentType,std::list<AgControllerComponent *>,std::less<enum AgControllerComponentType>,std::allocator<std::pair<enum AgControllerComponentType const,std::list<AgControllerComponent *>>>,0>>::_Rrotate(
              (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
              v20);
            v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Right;
          }
          v20->_Color = Parent->_Color;
          Parent->_Color = 1;
          v20->_Right->_Color = 1;
          std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Lrotate(
            (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
            (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent);
          break;
        }
LABEL_75:
        v20->_Color = 0;
      }
    }
    else
    {
      if ( !v20->_Color )
      {
        v20->_Color = 1;
        Parent->_Color = 0;
        v23 = Parent->_Left;
        Parent->_Left = Parent->_Left->_Right;
        v24 = v23->_Right;
        if ( !v24->_Isnil )
          v24->_Parent = Parent;
        v23->_Parent = Parent->_Parent;
        if ( Parent == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
        {
          this->_Mypair._Myval2._Myval2._Myhead->_Parent = v23;
        }
        else
        {
          v25 = Parent->_Parent;
          if ( Parent == v25->_Right )
            v25->_Right = v23;
          else
            v25->_Left = v23;
        }
        v23->_Right = Parent;
        Parent->_Parent = v23;
        v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Left;
      }
      if ( !v20->_Isnil )
      {
        if ( v20->_Right->_Color != 1 || v20->_Left->_Color != 1 )
        {
          if ( v20->_Left->_Color == 1 )
          {
            v20->_Right->_Color = 1;
            v20->_Color = 0;
            std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Lrotate(
              (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
              v20);
            v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Left;
          }
          v20->_Color = Parent->_Color;
          Parent->_Color = 1;
          v20->_Left->_Color = 1;
          std::_Tree<std::_Tmap_traits<enum AgControllerComponentType,std::list<AgControllerComponent *>,std::less<enum AgControllerComponentType>,std::allocator<std::pair<enum AgControllerComponentType const,std::list<AgControllerComponent *>>>,0>>::_Rrotate(
            (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
            (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent);
          break;
        }
        goto LABEL_75;
      }
    }
    Parent = Parent->_Parent;
    Left = v19;
  }
  Left->_Color = 1;
LABEL_84:
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v5->_Myval.second);
  AgString::~AgString((AgString *)&v5->_Myval.first, v26);
  operator delete(v5);
  Mysize = this->_Mypair._Myval2._Myval2._Mysize;
  if ( Mysize )
    this->_Mypair._Myval2._Myval2._Mysize = Mysize - 1;
  result->_Ptr = Ptr;
  return result;
}

__int64 __fastcall AgFileSystem::exists(AgFileSystem *this, const AgPath *path)
{
  const AgStringRef *RootName; // rax
  const AgString *MountName; // rax
  unsigned __int64 v6; // rdx
  unsigned __int64 v7; // rdx
  unsigned int v8; // esi
  AgMount *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v11; // ebp
  AgPointer<AgMount> v13; // [rsp+28h] [rbp-50h] BYREF
  AgString mountPoint; // [rsp+38h] [rbp-40h] BYREF
  AgString result; // [rsp+48h] [rbp-30h] BYREF
  AgStringRef v16; // [rsp+58h] [rbp-20h] BYREF

  RootName = AgPath::getRootName((AgPath *)path, &v16);
  AgString::AgString(&mountPoint, RootName);
  if ( !(unsigned int)AgString::getLength(&mountPoint) )
  {
    MountName = AgFileSystem::getMountName(&result, AgMountPoint_Content);
    AgString::operator=(&mountPoint, MountName);
    AgString::~AgString(&result, v6);
  }
  AgFileSystem::getMount(this, &v13, &mountPoint);
  if ( v13.m_ptr )
    v8 = v13.m_ptr->exists(v13.m_ptr, path);
  else
    v8 = 0;
  m_ptr = v13.m_ptr;
  v13.m_ptr = 0i64;
  m_ref = v13.m_ref;
  if ( v13.m_ref )
  {
    v13.m_ref = 0i64;
    v11 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v11 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(AgMount *, __int64))m_ptr->~AgMount)(m_ptr, 1i64);
      if ( v11 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
  AgString::~AgString(&mountPoint, v7);
  return v8;
}

AgPointer<AgMount> *__fastcall AgFileSystem::getMount(
        AgFileSystem *this,
        AgPointer<AgMount> *result,
        const AgString *mountPoint)
{
  AgMutex *p_m_mutex; // r15
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Myhead; // rdi
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Parent; // rbx

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  Myhead = this->m_mounts._Mypair._Myval2._Myval2._Myhead;
  Parent = Myhead->_Parent;
  while ( !Parent->_Isnil )
  {
    if ( operator<(&Parent->_Myval.first, mountPoint) )
    {
      Parent = Parent->_Right;
    }
    else
    {
      Myhead = Parent;
      Parent = Parent->_Left;
    }
  }
  if ( Myhead == this->m_mounts._Mypair._Myval2._Myval2._Myhead || operator<(mountPoint, &Myhead->_Myval.first) )
    Myhead = this->m_mounts._Mypair._Myval2._Myval2._Myhead;
  if ( Myhead == this->m_mounts._Mypair._Myval2._Myval2._Myhead )
  {
    result->m_ref = 0i64;
    result->m_ptr = 0i64;
  }
  else
  {
    AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
      (AgPointer<AgPlayer> *)result,
      (const AgPointer<AgPlayer> *)&Myhead->_Myval.second);
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
  return result;
}

AgString *__fastcall AgFileSystem::getMountName(AgString *result, AgMountPoint mountPoint)
{
  const char *v3; // rdx
  int v4; // edx
  const AgString *v5; // rax
  unsigned __int64 v6; // rdx
  unsigned __int64 v7; // rdx
  AgString s1; // [rsp+30h] [rbp-28h] BYREF
  AgString v10; // [rsp+40h] [rbp-18h] BYREF

  switch ( mountPoint )
  {
    case AgMountPoint_Content:
      AgString::AgString(result, "content", -1);
      return result;
    case AgMountPoint_Config:
      v3 = "config";
      goto LABEL_10;
    case AgMountPoint_SaveData:
      v3 = "savedata";
      goto LABEL_10;
    case AgMountPoint_System:
      v3 = "system";
      goto LABEL_10;
    case AgMountPoint_CloudData:
      v3 = "cloud";
      goto LABEL_10;
    case AgMountPoint_Temp:
      v3 = "temp";
      goto LABEL_10;
    case AgMountPoint_Internal:
      AgString::AgString(&s1, "__internal_", -1);
      v4 = AgFileSystem::ms_nextInternalId++;
      AgString::AgString(&v10, v4);
      operator+(result, &s1, v5);
      AgString::~AgString(&v10, v6);
      AgString::~AgString(&s1, v7);
      return result;
    default:
      v3 = &pnewText;
LABEL_10:
      AgString::AgString(result, v3, -1);
      return result;
  }
}

AgPath *__fastcall AgFileSystem::getMountPath(AgMountPoint mountPoint)
{
  return &AgFileSystem::ms_mountPointPaths[mountPoint];
}

AgPointer<AgUser> *__fastcall AgPlayer::getUser(AgPlayer *this, AgPointer<AgUser> *result)
{
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
    (AgPointer<AgPlayer> *)result,
    (const AgPointer<AgPlayer> *)&this->m_user);
  return result;
}

AgPath *__fastcall AgFileSystem::getUserMountName(AgPath *result, AgPointer<AgUser> *user)
{
  const AgString *v4; // rax
  const AgString *v5; // rax
  const AgString *v6; // rax
  unsigned __int64 v7; // rdx
  unsigned __int64 v8; // rdx
  unsigned __int64 v9; // rdx
  unsigned __int64 v10; // rdx
  AgString s1; // [rsp+30h] [rbp-48h] BYREF
  AgString v13; // [rsp+40h] [rbp-38h] BYREF
  AgString v14; // [rsp+50h] [rbp-28h] BYREF
  AgString resulta; // [rsp+60h] [rbp-18h] BYREF

  AgString::AgString(&s1, "user-", -1);
  v4 = AgString::fromUInt64(&resulta, user->m_ptr->m_id, 10);
  v5 = operator+(&v14, &s1, v4);
  v6 = operator+(&v13, v5, ":");
  AgString::AgString(&result->m_path, v6);
  AgPath::clean(result);
  AgString::~AgString(&v13, v7);
  AgString::~AgString(&v14, v8);
  AgString::~AgString(&resulta, v9);
  AgString::~AgString(&s1, v10);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)user);
  return result;
}

AgPath *__fastcall AgFileSystem::getUserMountPath(AgPath *result, AgPointer<AgUser> *user)
{
  const AgString *v4; // rax
  unsigned __int64 v5; // rdx
  unsigned __int64 v6; // rdx
  AgString v8; // [rsp+30h] [rbp-28h] BYREF
  AgString resulta; // [rsp+40h] [rbp-18h] BYREF

  v4 = AgString::fromUInt64(&resulta, user->m_ptr->m_id, 10);
  AgString::AgString(&v8, v4);
  AgPath::clean((AgPath *)&v8);
  AgPath::operator/(&AgFileSystem::ms_mountPointPaths[3], result, (const AgPath *)&v8);
  AgString::~AgString(&v8, v5);
  AgString::~AgString(&resulta, v6);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)user);
  return result;
}

void __fastcall AgAsyncEventDispatcher<AgMountEvent>::invoke(
        AgAsyncEventDispatcher<AgMountEvent> *this,
        const AgMountEvent *argument)
{
  AgMutex *p_m_queueMutex; // rdi

  p_m_queueMutex = &this->m_queueMutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  std::vector<AgMountEvent>::push_back(&this->m_eventQueue, argument);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_queueMutex);
}

void __fastcall AgAsyncEventDispatcher<AgUnmountEvent>::invoke(
        AgAsyncEventDispatcher<AgUnmountEvent> *this,
        const AgUnmountEvent *argument)
{
  AgMutex *p_m_queueMutex; // rdi

  p_m_queueMutex = &this->m_queueMutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  std::vector<AgUnmountEvent>::push_back(&this->m_eventQueue, argument);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_queueMutex);
}

void __fastcall AgFileSystem::mount(AgFileSystem *this, AgPointer<AgMount> *storage)
{
  AgPointer<AgMount> *v4; // rax
  AgPointer<AgPlayer> v5; // [rsp+28h] [rbp-20h] BYREF

  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(&v5, (const AgPointer<AgPlayer> *)storage);
  AgFileSystem::addMount(this, v4);
  storage->m_ptr->mount(storage->m_ptr);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)storage);
}

void __fastcall AgFileSystem::onMounted(AgFileSystem *this, const AgMountEvent *event)
{
  AgAsyncEventDispatcher<AgMountEvent>::invoke(&this->Mount, event);
}

__int64 __fastcall AgFileSystem::onSingletonExit(AgFileSystem *this)
{
  std::map<AgString,AgPointer<AgMount>> *p_m_mounts; // rbx
  __int64 result; // rax

  p_m_mounts = &this->m_mounts;
  std::_Tree<std::_Tmap_traits<AgString,AgPointer<AgMount>,std::less<AgString>,std::allocator<std::pair<AgString const,AgPointer<AgMount>>>,0>>::_Erase(
    &this->m_mounts,
    this->m_mounts._Mypair._Myval2._Myval2._Myhead->_Parent);
  p_m_mounts->_Mypair._Myval2._Myval2._Myhead->_Parent = p_m_mounts->_Mypair._Myval2._Myval2._Myhead;
  p_m_mounts->_Mypair._Myval2._Myval2._Myhead->_Left = p_m_mounts->_Mypair._Myval2._Myval2._Myhead;
  p_m_mounts->_Mypair._Myval2._Myval2._Myhead->_Right = p_m_mounts->_Mypair._Myval2._Myval2._Myhead;
  result = 1i64;
  p_m_mounts->_Mypair._Myval2._Myval2._Mysize = 0i64;
  return result;
}

__int64 __fastcall AgUser::isSignedIn(Concurrency::details::ThreadInternalContext *this)
{
  return 1i64;
}

void __fastcall AgFileSystem::onUnmounted(AgFileSystem *this, const AgUnmountEvent *event)
{
  const AgPointer<AgPlayer> *v4; // rax
  AgPointer<KOFApplication> *v5; // rbx
  AgPointer<AgPlayer> v6; // [rsp+28h] [rbp-30h] BYREF
  AgPointer<AgPlayer> v7; // [rsp+38h] [rbp-20h] BYREF

  AgAsyncEventDispatcher<AgUnmountEvent>::invoke(&this->Unmount, event);
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(&v7, (const AgPointer<AgPlayer> *)event);
  v5 = (AgPointer<KOFApplication> *)v4;
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(&v6, v4);
  AgPointer<AgUser>::~AgPointer<AgUser>(v5);
  AgAsyncEventDispatcher<AgMountErrorEvent>::remove<RemoveMountEventPredicate>(
    &this->Error,
    (RemoveMountEventPredicate *)&v6);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v6);
}

void __fastcall AgFileSystem::onWriteBegin(AgFileSystem *this, AgPointer<AgMount> *mount)
{
  AgPlayer *m_ptr; // rbx
  _RTL_CRITICAL_SECTION *v5; // rbp
  AgMutex *p_m_queueMutex; // r14
  std::vector<AgMountWriteBeginEvent> *p_m_eventQueue; // rdi
  AgMountWriteBeginEvent *Mylast; // rcx
  signed __int64 v9; // rbx
  AgPointer<AgPlayer> *v10; // rcx
  const AgPointer<AgPlayer> *v11; // rbx
  AgPointer<AgPlayer> *v12; // rcx
  AgPointer<AgPlayer> rhs; // [rsp+28h] [rbp-60h] BYREF
  int v14; // [rsp+38h] [rbp-50h]
  AgMutex *v15; // [rsp+40h] [rbp-48h]
  int v16; // [rsp+48h] [rbp-40h]
  unsigned __int8 *v17; // [rsp+50h] [rbp-38h]

  rhs = 0i64;
  AgPointer<AgMount>::operator=((AgPointer<AgMount> *)&rhs, mount);
  v16 = 0;
  m_ptr = rhs.m_ptr;
  v5 = (_RTL_CRITICAL_SECTION *)&rhs.m_ptr->m_mutex.m_data.m_criticalSection.data[8];
  v17 = &rhs.m_ptr->m_mutex.m_data.m_criticalSection.data[8];
  EnterCriticalSection((LPCRITICAL_SECTION)&rhs.m_ptr->m_mutex.m_data.m_criticalSection.data[8]);
  v16 = 1;
  AgAtomicIncrement((volatile int *)&m_ptr[2].m_mutex.m_data.m_criticalSection.data[16]);
  v14 = 0;
  p_m_queueMutex = &this->WriteBegin.m_queueMutex;
  v15 = &this->WriteBegin.m_queueMutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->WriteBegin.m_queueMutex);
  v14 = 1;
  p_m_eventQueue = &this->WriteBegin.m_eventQueue;
  Mylast = p_m_eventQueue->_Mypair._Myval2._Mylast;
  if ( &rhs >= (AgPointer<AgPlayer> *)Mylast
    || p_m_eventQueue->_Mypair._Myval2._Myfirst > (AgMountWriteBeginEvent *)&rhs )
  {
    if ( Mylast == p_m_eventQueue->_Mypair._Myval2._Myend )
      std::vector<AgMountWriteBeginEvent>::_Reserve(p_m_eventQueue, 1ui64);
    v12 = (AgPointer<AgPlayer> *)p_m_eventQueue->_Mypair._Myval2._Mylast;
    if ( v12 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(v12, &rhs);
  }
  else
  {
    v9 = (char *)&rhs - (char *)p_m_eventQueue->_Mypair._Myval2._Myfirst;
    if ( Mylast == p_m_eventQueue->_Mypair._Myval2._Myend )
      std::vector<AgMountWriteBeginEvent>::_Reserve(p_m_eventQueue, 1ui64);
    v10 = (AgPointer<AgPlayer> *)p_m_eventQueue->_Mypair._Myval2._Mylast;
    v11 = (const AgPointer<AgPlayer> *)((char *)p_m_eventQueue->_Mypair._Myval2._Myfirst + (v9 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v10 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(v10, v11);
  }
  ++p_m_eventQueue->_Mypair._Myval2._Mylast;
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_queueMutex);
  v14 = 0;
  LeaveCriticalSection(v5);
  v16 = 0;
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&rhs);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)mount);
}

void __fastcall AgFileSystem::onWriteEnd(AgFileSystem *this, AgPointer<AgMount> *mount)
{
  AgMount *m_ptr; // rsi
  _RTL_CRITICAL_SECTION *v5; // r15
  int v6; // er12
  AgMutex *p_m_queueMutex; // rbp
  std::vector<AgMountWriteEndEvent> *p_m_eventQueue; // rbx
  AgMountWriteEndEvent *Mylast; // rcx
  signed __int64 v10; // rdi
  AgPointer<AgPlayer> *v11; // rcx
  const AgPointer<AgPlayer> *v12; // rdi
  AgPointer<AgPlayer> *v13; // rcx
  AgPointer<AgPlayer> rhs; // [rsp+28h] [rbp-70h] BYREF
  int v15; // [rsp+38h] [rbp-60h]
  AgMutex *v16; // [rsp+40h] [rbp-58h]
  int v17; // [rsp+48h] [rbp-50h]
  unsigned __int8 *v18; // [rsp+50h] [rbp-48h]

  rhs = 0i64;
  AgPointer<AgMount>::operator=((AgPointer<AgMount> *)&rhs, mount);
  v17 = 0;
  m_ptr = (AgMount *)rhs.m_ptr;
  v5 = (_RTL_CRITICAL_SECTION *)&rhs.m_ptr->m_mutex.m_data.m_criticalSection.data[8];
  v18 = &rhs.m_ptr->m_mutex.m_data.m_criticalSection.data[8];
  EnterCriticalSection((LPCRITICAL_SECTION)&rhs.m_ptr->m_mutex.m_data.m_criticalSection.data[8]);
  v17 = 1;
  v6 = AgAtomicDecrement(&m_ptr->m_activeWriteOperations);
  v15 = 0;
  p_m_queueMutex = &this->WriteEnd.m_queueMutex;
  v16 = &this->WriteEnd.m_queueMutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->WriteEnd.m_queueMutex);
  v15 = 1;
  p_m_eventQueue = &this->WriteEnd.m_eventQueue;
  Mylast = p_m_eventQueue->_Mypair._Myval2._Mylast;
  if ( &rhs >= (AgPointer<AgPlayer> *)Mylast || p_m_eventQueue->_Mypair._Myval2._Myfirst > (AgMountWriteEndEvent *)&rhs )
  {
    if ( Mylast == p_m_eventQueue->_Mypair._Myval2._Myend )
      std::vector<AgMountWriteEndEvent>::_Reserve(p_m_eventQueue, 1ui64);
    v13 = (AgPointer<AgPlayer> *)p_m_eventQueue->_Mypair._Myval2._Mylast;
    if ( v13 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(v13, &rhs);
  }
  else
  {
    v10 = (char *)&rhs - (char *)p_m_eventQueue->_Mypair._Myval2._Myfirst;
    if ( Mylast == p_m_eventQueue->_Mypair._Myval2._Myend )
      std::vector<AgMountWriteEndEvent>::_Reserve(p_m_eventQueue, 1ui64);
    v11 = (AgPointer<AgPlayer> *)p_m_eventQueue->_Mypair._Myval2._Mylast;
    v12 = (const AgPointer<AgPlayer> *)((char *)p_m_eventQueue->_Mypair._Myval2._Myfirst + (v10 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v11 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(v11, v12);
  }
  ++p_m_eventQueue->_Mypair._Myval2._Mylast;
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_queueMutex);
  v15 = 0;
  if ( !v6 )
    AgMount::signalFinishedWriting(m_ptr);
  LeaveCriticalSection(v5);
  v17 = 0;
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&rhs);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)mount);
}

AgPointer<AgFile> *__fastcall AgFileSystem::open(
        AgFileSystem *this,
        AgPointer<AgFile> *result,
        const AgPath *path,
        unsigned int accessMode)
{
  const AgStringRef *RootName; // rax
  const AgString *MountName; // rax
  unsigned __int64 v10; // rdx
  unsigned __int64 v11; // rdx
  AgString mountPoint; // [rsp+30h] [rbp-38h] BYREF
  AgPointer<AgMount> v14; // [rsp+40h] [rbp-28h] BYREF
  AgString resulta; // [rsp+50h] [rbp-18h] BYREF

  RootName = AgPath::getRootName((AgPath *)path, (AgStringRef *)&resulta);
  AgString::AgString(&mountPoint, RootName);
  if ( !(unsigned int)AgString::getLength(&mountPoint) )
  {
    MountName = AgFileSystem::getMountName(&resulta, AgMountPoint_Content);
    AgString::operator=(&mountPoint, MountName);
    AgString::~AgString(&resulta, v10);
  }
  AgFileSystem::getMount(this, &v14, &mountPoint);
  if ( v14.m_ptr )
  {
    ((void (__fastcall *)(AgMount *, AgPointer<AgFile> *, const AgPath *, _QWORD, _DWORD, __int64))v14.m_ptr->open)(
      v14.m_ptr,
      result,
      path,
      accessMode,
      0,
      -2i64);
  }
  else
  {
    result->m_ref = 0i64;
    result->m_ptr = 0i64;
  }
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v14);
  AgString::~AgString(&mountPoint, v11);
  return result;
}

void __fastcall std::vector<AgMountEvent>::push_back(std::vector<AgMountEvent> *this, const AgMountEvent *_Val)
{
  AgMountEvent *Mylast; // rax
  AgMountEvent *Myfirst; // rcx
  signed __int64 v6; // rdi
  AgMountEvent *v7; // rcx
  const AgPointer<AgPlayer> *v8; // rdi
  AgMountEvent *v9; // rcx

  Mylast = this->_Mypair._Myval2._Mylast;
  if ( _Val >= Mylast || (Myfirst = this->_Mypair._Myval2._Myfirst, Myfirst > _Val) )
  {
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgMountEvent>::_Reserve(this, 1ui64);
    v9 = this->_Mypair._Myval2._Mylast;
    if ( v9 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
        (AgPointer<AgPlayer> *)v9,
        (const AgPointer<AgPlayer> *)_Val);
  }
  else
  {
    v6 = (char *)_Val - (char *)Myfirst;
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgMountEvent>::_Reserve(this, 1ui64);
    v7 = this->_Mypair._Myval2._Mylast;
    v8 = (const AgPointer<AgPlayer> *)((char *)this->_Mypair._Myval2._Myfirst + (v6 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v7 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>((AgPointer<AgPlayer> *)v7, v8);
  }
  ++this->_Mypair._Myval2._Mylast;
}

void __fastcall std::vector<AgUnmountEvent>::push_back(std::vector<AgUnmountEvent> *this, const AgUnmountEvent *_Val)
{
  AgUnmountEvent *Mylast; // rax
  AgUnmountEvent *Myfirst; // rcx
  signed __int64 v6; // rdi
  AgUnmountEvent *v7; // rcx
  const AgPointer<AgPlayer> *v8; // rdi
  AgUnmountEvent *v9; // rcx

  Mylast = this->_Mypair._Myval2._Mylast;
  if ( _Val >= Mylast || (Myfirst = this->_Mypair._Myval2._Myfirst, Myfirst > _Val) )
  {
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgUnmountEvent>::_Reserve(this, 1ui64);
    v9 = this->_Mypair._Myval2._Mylast;
    if ( v9 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
        (AgPointer<AgPlayer> *)v9,
        (const AgPointer<AgPlayer> *)_Val);
  }
  else
  {
    v6 = (char *)_Val - (char *)Myfirst;
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgUnmountEvent>::_Reserve(this, 1ui64);
    v7 = this->_Mypair._Myval2._Mylast;
    v8 = (const AgPointer<AgPlayer> *)((char *)this->_Mypair._Myval2._Myfirst + (v6 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v7 )
      AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>((AgPointer<AgPlayer> *)v7, v8);
  }
  ++this->_Mypair._Myval2._Mylast;
}

void __fastcall std::vector<AgDelegate1<AgMountErrorEvent const &,void>>::push_back(
        std::vector<AgDelegate1<AgMountErrorEvent const &,void>> *this,
        const AgDelegate1<AgMountErrorEvent const &,void> *_Val)
{
  AgDelegate1<AgMountErrorEvent const &,void> *Mylast; // rax
  AgDelegate1<AgMountErrorEvent const &,void> *Myfirst; // rcx
  signed __int64 v6; // rdi
  AgDelegate1<AgMountErrorEvent const &,void> *v7; // rcx
  detail::GenericClass **v8; // rdi
  AgDelegate1<AgMountErrorEvent const &,void> *v9; // rcx

  Mylast = this->_Mypair._Myval2._Mylast;
  if ( _Val >= Mylast || (Myfirst = this->_Mypair._Myval2._Myfirst, Myfirst > _Val) )
  {
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgDelegate1<AgMountErrorEvent const &,void>>::_Reserve(this, 1ui64);
    v9 = this->_Mypair._Myval2._Mylast;
    if ( v9 )
    {
      v9->m_Closure.m_pthis = 0i64;
      v9->m_Closure.m_pFunction = 0i64;
      v9->m_Closure.m_pFunction = _Val->m_Closure.m_pFunction;
      v9->m_Closure.m_pthis = _Val->m_Closure.m_pthis;
    }
  }
  else
  {
    v6 = (char *)_Val - (char *)Myfirst;
    if ( Mylast == this->_Mypair._Myval2._Myend )
      std::vector<AgDelegate1<AgMountErrorEvent const &,void>>::_Reserve(this, 1ui64);
    v7 = this->_Mypair._Myval2._Mylast;
    v8 = (detail::GenericClass **)((char *)&this->_Mypair._Myval2._Myfirst->m_Closure.m_pthis
                                 + (v6 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v7 )
    {
      v7->m_Closure.m_pthis = 0i64;
      v7->m_Closure.m_pFunction = 0i64;
      v7->m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))v8[1];
      v7->m_Closure.m_pthis = *v8;
    }
  }
  ++this->_Mypair._Myval2._Mylast;
}

void __fastcall AgFileSystem::registerSaveErrorHandler(AgFileSystem *this)
{
  AgAsyncEventDispatcher<AgMountErrorEvent> *p_Error; // rbx
  AgDelegate1<AgMountErrorEvent const &,void> _Val; // [rsp+38h] [rbp-20h] BYREF

  p_Error = &this->Error;
  _Val.m_Closure.m_pFunction = (void (__fastcall *)(detail::GenericClass *))AgFileSystem::_mountError;
  _Val.m_Closure.m_pthis = (detail::GenericClass *)this;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->Error);
  std::vector<AgDelegate1<AgMountErrorEvent const &,void>>::push_back(&p_Error->m_bindings, &_Val);
  LeaveCriticalSection((LPCRITICAL_SECTION)p_Error);
}

void __fastcall AgAsyncEventDispatcher<AgMountErrorEvent>::run(AgAsyncEventDispatcher<AgMountErrorEvent> *this)
{
  std::vector<AgMountErrorEvent> *p_m_eventQueue; // rcx
  const AgMountErrorEvent *Myfirst; // rbx
  AgMountErrorEvent *Mylast; // rdi
  std::vector<AgMountErrorEvent> v5; // [rsp+28h] [rbp-20h] BYREF

  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  memset(&v5, 0, sizeof(v5));
  p_m_eventQueue = &this->m_eventQueue;
  if ( &v5 == &this->m_eventQueue )
  {
    Mylast = v5._Mypair._Myval2._Mylast;
    Myfirst = v5._Mypair._Myval2._Myfirst;
  }
  else
  {
    Myfirst = p_m_eventQueue->_Mypair._Myval2._Myfirst;
    v5._Mypair._Myval2._Myfirst = p_m_eventQueue->_Mypair._Myval2._Myfirst;
    p_m_eventQueue->_Mypair._Myval2._Myfirst = 0i64;
    Mylast = this->m_eventQueue._Mypair._Myval2._Mylast;
    v5._Mypair._Myval2._Mylast = Mylast;
    this->m_eventQueue._Mypair._Myval2._Mylast = 0i64;
    v5._Mypair._Myval2._Myend = this->m_eventQueue._Mypair._Myval2._Myend;
    this->m_eventQueue._Mypair._Myval2._Myend = 0i64;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  for ( ; Myfirst != Mylast; ++Myfirst )
    AgEventDispatcherBase<AgMountErrorEvent>::call(this, Myfirst);
  std::vector<AgMountErrorEvent>::_Tidy(&v5);
}

void __fastcall AgAsyncEventDispatcher<AgMountEvent>::run(AgAsyncEventDispatcher<AgMountEvent> *this)
{
  AgMountEvent *Myend; // r14
  std::vector<AgMountEvent> *p_m_eventQueue; // rax
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rsi
  AgMountEvent *Mylast; // rdi
  const AgMountEvent *v6; // rbx
  AgPointer<KOFApplication> *v7; // rbx
  __int128 v8; // [rsp+28h] [rbp-30h] BYREF
  AgMountEvent *v9; // [rsp+38h] [rbp-20h]

  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  v8 = 0i64;
  Myend = 0i64;
  v9 = 0i64;
  p_m_eventQueue = &this->m_eventQueue;
  if ( &v8 == (__int128 *)&this->m_eventQueue )
  {
    Mylast = (AgMountEvent *)*((_QWORD *)&v8 + 1);
    Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)v8;
  }
  else
  {
    Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)p_m_eventQueue->_Mypair._Myval2._Myfirst;
    *(_QWORD *)&v8 = p_m_eventQueue->_Mypair._Myval2._Myfirst;
    p_m_eventQueue->_Mypair._Myval2._Myfirst = 0i64;
    Mylast = this->m_eventQueue._Mypair._Myval2._Mylast;
    *((_QWORD *)&v8 + 1) = Mylast;
    this->m_eventQueue._Mypair._Myval2._Mylast = 0i64;
    Myend = this->m_eventQueue._Mypair._Myval2._Myend;
    v9 = Myend;
    this->m_eventQueue._Mypair._Myval2._Myend = 0i64;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  v6 = (const AgMountEvent *)Myfirst;
  if ( Myfirst != (AgDelegate1<AgUserUpdatedEvent const &,void> *)Mylast )
  {
    do
      AgEventDispatcherBase<AgMountEvent>::call(this, v6++);
    while ( v6 != Mylast );
  }
  if ( Myfirst )
  {
    v7 = (AgPointer<KOFApplication> *)Myfirst;
    if ( Myfirst != (AgDelegate1<AgUserUpdatedEvent const &,void> *)Mylast )
    {
      do
        AgPointer<AgUser>::~AgPointer<AgUser>(v7++);
      while ( v7 != (AgPointer<KOFApplication> *)Mylast );
    }
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&v8,
      Myfirst,
      ((char *)Myend - (char *)Myfirst) >> 4);
  }
}

void __fastcall AgAsyncEventDispatcher<AgMountWriteBeginEvent>::run(
        AgAsyncEventDispatcher<AgMountWriteBeginEvent> *this)
{
  AgMountWriteBeginEvent *Myend; // r14
  std::vector<AgMountWriteBeginEvent> *p_m_eventQueue; // rax
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rsi
  AgMountWriteBeginEvent *Mylast; // rdi
  const AgMountWriteBeginEvent *v6; // rbx
  AgPointer<KOFApplication> *v7; // rbx
  __int128 v8; // [rsp+28h] [rbp-30h] BYREF
  AgMountWriteBeginEvent *v9; // [rsp+38h] [rbp-20h]

  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  v8 = 0i64;
  Myend = 0i64;
  v9 = 0i64;
  p_m_eventQueue = &this->m_eventQueue;
  if ( &v8 == (__int128 *)&this->m_eventQueue )
  {
    Mylast = (AgMountWriteBeginEvent *)*((_QWORD *)&v8 + 1);
    Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)v8;
  }
  else
  {
    Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)p_m_eventQueue->_Mypair._Myval2._Myfirst;
    *(_QWORD *)&v8 = p_m_eventQueue->_Mypair._Myval2._Myfirst;
    p_m_eventQueue->_Mypair._Myval2._Myfirst = 0i64;
    Mylast = this->m_eventQueue._Mypair._Myval2._Mylast;
    *((_QWORD *)&v8 + 1) = Mylast;
    this->m_eventQueue._Mypair._Myval2._Mylast = 0i64;
    Myend = this->m_eventQueue._Mypair._Myval2._Myend;
    v9 = Myend;
    this->m_eventQueue._Mypair._Myval2._Myend = 0i64;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  v6 = (const AgMountWriteBeginEvent *)Myfirst;
  if ( Myfirst != (AgDelegate1<AgUserUpdatedEvent const &,void> *)Mylast )
  {
    do
      AgEventDispatcherBase<AgMountWriteBeginEvent>::call(this, v6++);
    while ( v6 != Mylast );
  }
  if ( Myfirst )
  {
    v7 = (AgPointer<KOFApplication> *)Myfirst;
    if ( Myfirst != (AgDelegate1<AgUserUpdatedEvent const &,void> *)Mylast )
    {
      do
        AgPointer<AgUser>::~AgPointer<AgUser>(v7++);
      while ( v7 != (AgPointer<KOFApplication> *)Mylast );
    }
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&v8,
      Myfirst,
      ((char *)Myend - (char *)Myfirst) >> 4);
  }
}

void __fastcall AgAsyncEventDispatcher<AgMountWriteEndEvent>::run(AgAsyncEventDispatcher<AgMountWriteEndEvent> *this)
{
  AgMountWriteEndEvent *Myend; // r14
  std::vector<AgMountWriteEndEvent> *p_m_eventQueue; // rax
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rsi
  AgMountWriteEndEvent *Mylast; // rdi
  const AgMountWriteEndEvent *v6; // rbx
  AgPointer<KOFApplication> *v7; // rbx
  __int128 v8; // [rsp+28h] [rbp-30h] BYREF
  AgMountWriteEndEvent *v9; // [rsp+38h] [rbp-20h]

  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  v8 = 0i64;
  Myend = 0i64;
  v9 = 0i64;
  p_m_eventQueue = &this->m_eventQueue;
  if ( &v8 == (__int128 *)&this->m_eventQueue )
  {
    Mylast = (AgMountWriteEndEvent *)*((_QWORD *)&v8 + 1);
    Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)v8;
  }
  else
  {
    Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)p_m_eventQueue->_Mypair._Myval2._Myfirst;
    *(_QWORD *)&v8 = p_m_eventQueue->_Mypair._Myval2._Myfirst;
    p_m_eventQueue->_Mypair._Myval2._Myfirst = 0i64;
    Mylast = this->m_eventQueue._Mypair._Myval2._Mylast;
    *((_QWORD *)&v8 + 1) = Mylast;
    this->m_eventQueue._Mypair._Myval2._Mylast = 0i64;
    Myend = this->m_eventQueue._Mypair._Myval2._Myend;
    v9 = Myend;
    this->m_eventQueue._Mypair._Myval2._Myend = 0i64;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  v6 = (const AgMountWriteEndEvent *)Myfirst;
  if ( Myfirst != (AgDelegate1<AgUserUpdatedEvent const &,void> *)Mylast )
  {
    do
      AgEventDispatcherBase<AgMountWriteEndEvent>::call(this, v6++);
    while ( v6 != Mylast );
  }
  if ( Myfirst )
  {
    v7 = (AgPointer<KOFApplication> *)Myfirst;
    if ( Myfirst != (AgDelegate1<AgUserUpdatedEvent const &,void> *)Mylast )
    {
      do
        AgPointer<AgUser>::~AgPointer<AgUser>(v7++);
      while ( v7 != (AgPointer<KOFApplication> *)Mylast );
    }
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&v8,
      Myfirst,
      ((char *)Myend - (char *)Myfirst) >> 4);
  }
}

void __fastcall AgAsyncEventDispatcher<AgUnmountEvent>::run(AgAsyncEventDispatcher<AgUnmountEvent> *this)
{
  AgUnmountEvent *Myend; // r14
  std::vector<AgUnmountEvent> *p_m_eventQueue; // rax
  AgDelegate1<AgUserUpdatedEvent const &,void> *Myfirst; // rsi
  AgUnmountEvent *Mylast; // rdi
  const AgUnmountEvent *v6; // rbx
  AgPointer<KOFApplication> *v7; // rbx
  __int128 v8; // [rsp+28h] [rbp-30h] BYREF
  AgUnmountEvent *v9; // [rsp+38h] [rbp-20h]

  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  v8 = 0i64;
  Myend = 0i64;
  v9 = 0i64;
  p_m_eventQueue = &this->m_eventQueue;
  if ( &v8 == (__int128 *)&this->m_eventQueue )
  {
    Mylast = (AgUnmountEvent *)*((_QWORD *)&v8 + 1);
    Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)v8;
  }
  else
  {
    Myfirst = (AgDelegate1<AgUserUpdatedEvent const &,void> *)p_m_eventQueue->_Mypair._Myval2._Myfirst;
    *(_QWORD *)&v8 = p_m_eventQueue->_Mypair._Myval2._Myfirst;
    p_m_eventQueue->_Mypair._Myval2._Myfirst = 0i64;
    Mylast = this->m_eventQueue._Mypair._Myval2._Mylast;
    *((_QWORD *)&v8 + 1) = Mylast;
    this->m_eventQueue._Mypair._Myval2._Mylast = 0i64;
    Myend = this->m_eventQueue._Mypair._Myval2._Myend;
    v9 = Myend;
    this->m_eventQueue._Mypair._Myval2._Myend = 0i64;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_queueMutex);
  v6 = (const AgUnmountEvent *)Myfirst;
  if ( Myfirst != (AgDelegate1<AgUserUpdatedEvent const &,void> *)Mylast )
  {
    do
      AgEventDispatcherBase<AgUnmountEvent>::call(this, v6++);
    while ( v6 != Mylast );
  }
  if ( Myfirst )
  {
    v7 = (AgPointer<KOFApplication> *)Myfirst;
    if ( Myfirst != (AgDelegate1<AgUserUpdatedEvent const &,void> *)Mylast )
    {
      do
        AgPointer<AgUser>::~AgPointer<AgUser>(v7++);
      while ( v7 != (AgPointer<KOFApplication> *)Mylast );
    }
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&v8,
      Myfirst,
      ((char *)Myend - (char *)Myfirst) >> 4);
  }
}

void __fastcall AgFileSystem::setMountPointPath(AgMountPoint mountPoint, const AgPath *path, int overwrite)
{
  __int64 v3; // rbx

  v3 = mountPoint;
  if ( overwrite || !(unsigned int)AgString::getLength(&AgFileSystem::ms_mountPointPaths[mountPoint].m_path) )
    AgString::operator=(&AgFileSystem::ms_mountPointPaths[v3].m_path, &path->m_path);
}

void __fastcall AgFileSystem::update(AgFileSystem *this)
{
  AgMutex *p_m_mutex; // rsi
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Myhead; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Left; // rbx
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *Right; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *j; // rax
  std::_Tree_node<std::pair<AgString const ,AgPointer<AgMount> >,void *> *i; // rax

  p_m_mutex = &this->m_mutex;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_mutex);
  AgAsyncEventDispatcher<AgMountErrorEvent>::run(&this->Error);
  AgAsyncEventDispatcher<AgMountEvent>::run(&this->Mount);
  AgAsyncEventDispatcher<AgUnmountEvent>::run(&this->Unmount);
  AgAsyncEventDispatcher<AgMountWriteBeginEvent>::run(&this->WriteBegin);
  AgAsyncEventDispatcher<AgMountWriteEndEvent>::run(&this->WriteEnd);
  Myhead = this->m_mounts._Mypair._Myval2._Myval2._Myhead;
  Left = Myhead->_Left;
  if ( Myhead->_Left != Myhead )
  {
    do
    {
      Left->_Myval.second.m_ptr->update(Left->_Myval.second.m_ptr);
      if ( !Left->_Isnil )
      {
        Right = Left->_Right;
        if ( Right->_Isnil )
        {
          for ( i = Left->_Parent; !i->_Isnil; i = i->_Parent )
          {
            if ( Left != i->_Right )
              break;
            Left = i;
          }
          Left = i;
        }
        else
        {
          Left = Left->_Right;
          for ( j = Right->_Left; !j->_Isnil; j = j->_Left )
            Left = j;
        }
      }
    }
    while ( Left != this->m_mounts._Mypair._Myval2._Myval2._Myhead );
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_mutex);
}

