#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/filesystem/agdirectory.h"
#include "dev/silverware/git/sdk/memory/agbuffer.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steamclientpublic.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "dev/silverware/git/sdk/memory/agallocators.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "dev/silverware/git/sdk/agmemorystream.h"
#include "dev/silverware/git/sdk/agringbuffer.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "dev/silverware/git/sdk/agreferenceinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "dev/silverware/git/sdk/util/agperformancecounter.h"
#include "dev/silverware/git/sdk/audio/agaudiochannel.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "dev/silverware/git/sdk/agvector3.h"
#include "dev/silverware/git/sdk/system/agusermanager.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "dev/silverware/git/sdk/agfactory.h"
#include "dev/silverware/git/sdk/agpointer.h"
#include "dev/silverware/git/sdk/aghash.h"
#include "dev/silverware/git/sdk/agstringutils.h"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/silverware/git/sdk/util/agworkerpool.h"
#include "dev/silverware/git/sdk/agthreadpool.h"
#include "dev/silverware/git/sdk/util/agservice.h"
#include "dev/silverware/git/sdk/agsemaphore.h"
#include "dev/silverware/git/sdk/agmath.h"
#include "dev/silverware/git/sdk/agthread.h"
#include "dev/silverware/git/sdk/3rdparty/steam/isteamhtmlsurface.h"
#include "dev/silverware/git/sdk/input/aginputmanager.h"
#include "dev/silverware/git/sdk/agvector2.h"
#include "dev/silverware/git/sdk/audio/agaudiomanager.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "dev/silverware/git/sdk/audio/agaudiotypes.h"
#include "dev/silverware/git/sdk/input/agcontrollerbuttoncomponent.h"
#include "dev/silverware/git/sdk/util/agdelegate.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "dev/silverware/git/sdk/services/agsessionmanager.h"
#include "dev/silverware/git/sdk/services/agsession.h"
#include "dev/silverware/git/sdk/system/agplayermanager.h"
#include "dev/silverware/git/sdk/system/agplayer.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "dev/silverware/git/sdk/util/agjsondata.h"
#include "dev/silverware/git/sdk/system/agsystemmanager.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steam_api_internal.h"
#include "dev/silverware/git/sdk/input/agcontrollercomponent.h"
#include "dev/silverware/git/sdk/system/agdialogmanager.h"
#include "dev/silverware/git/sdk/input/agcontroller.h"
#include "dev/silverware/git/sdk/system/agnetworkmanager.h"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/list"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "dev/silverware/git/sdk/system/agprofilemanager.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steam_api.h"
#include "dev/silverware/git/sdk/system/agexceptionhandler.h"
#include "dev/silverware/git/sdk/system/agprofile.h"
#include "dev/silverware/git/sdk/services/agserviceeventmanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "dev/silverware/git/sdk/agcondition.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "dev/silverware/git/sdk/util/agservicecommand.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "dev/silverware/git/sdk/audio/agaudioeffects.h"
#include "dev/silverware/git/sdk/filesystem/agfile.h"
#include "dev/silverware/git/sdk/agcondition.h"
#include "dev/silverware/git/sdk/3rdparty/steam/matchmakingtypes.h"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "dev/silverware/git/sdk/filesystem/agmount.h"
#include "dev/silverware/git/sdk/filesystem/agpath.h"
#include "dev/silverware/git/sdk/agclock.h"
#include "dev/silverware/git/sdk/agsemaphore.inl"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "dev/silverware/git/sdk/aghashtable.h"
#include "dev/silverware/git/sdk/system/agsystemconfig.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "dev/silverware/git/sdk/util/agdebugchannels.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "dev/silverware/git/sdk/agmutex.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "dev/silverware/git/sdk/agcurve.h"
#include "dev/silverware/git/sdk/services/agleaderboardmanager.h"
#include "dev/silverware/git/sdk/services/agleaderboard.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "dev/silverware/git/sdk/services/agleaderboardranking.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"

long AgSilverware::initialize(AgStringRef titleId, AgStringRef serviceId, unsigned long long flags); // 0x140659520
class AgUpdateSystemThread :
	AgIThreadHost
{
public:
	AgUpdateSystemThread(AgUpdateSystemThread &);
	AgUpdateSystemThread(const AgUpdateSystemThread &);
	AgUpdateSystemThread();
	virtual void onExecuteThread();
	virtual long getThreadIsRunning();
	virtual void onJoinThread();
	virtual void onDetachThread();
private:
	long m_running; // 0x8
public:
	virtual ~AgUpdateSystemThread();
	AgUpdateSystemThread & operator=(AgUpdateSystemThread &);
	AgUpdateSystemThread & operator=(const AgUpdateSystemThread &);
};
std::piecewise_construct_t std::piecewise_construct; // 0x140864098
void(*AgSilverware::itleId$initializer$::operator^)(); // 0x140740688
AgSilverware::erviceId$initializer$::operator~(); // 0x140740690
AgString AgSilverware::TitleId; // 0x140A8FD08
AgString AgSilverware::ServiceId; // 0x140A8FD18
unsigned long long AgSilverware::Systems; // 0x140A8FCD8
AgClock AgSilverware::ms_clock; // 0x140A8FCE0
void(*??ms_clock$initializer$@AgSilverware@@0P6AXXZEA@@3P6AXXZEA)(); // 0x140740680
typedef AgPointer<AgStream> AgStreamPtr;
void AgUpdateSystemThread::onExecuteThread(); // 0x140659BD0
typedef unsigned long long AgDialogResult;
typedef long AgPlayerId;
typedef std::vector<AgPointer<AgUser>,std::allocator<AgPointer<AgUser> > > AgUserArray;
typedef AgPointer<AgPlayer> AgPlayerPtr;
typedef std::map<unsigned __int64,AgPointer<AgProfile>,std::less<unsigned __int64>,std::allocator<std::pair<unsigned __int64 const ,AgPointer<AgProfile> > > > AgProfileMap;
typedef std::vector<AgPointer<AgController>,std::allocator<AgPointer<AgController> > > AgControllerArray;
typedef AgPointer<AgDialog> AgDialogPtr;
typedef std::vector<AgPointer<AgPlayer>,std::allocator<AgPointer<AgPlayer> > > AgPlayerArray;
typedef AgDelegate1<AgPointer<AgDialog>,void> AgDialogHandler;
long AgUpdateSystemThread::getThreadIsRunning(); // 0x140030600
typedef std::map<__int64,AgPointer<AgProfile>,std::less<__int64>,std::allocator<std::pair<__int64 const ,AgPointer<AgProfile> > > > AgUserProfileMap;
typedef AgPointer<AgSession> AgSessionPtr;
typedef unsigned long long AgProfileId;
AgSingleton<AgUserManager> * AgSingleton<AgUserManager>::ms_instance; // 0x140A8FD28
AgSingleton<AgExceptionHandler> * AgSingleton<AgExceptionHandler>::ms_instance; // 0x140A8FD48
AgSingleton<AgNetworkManager> * AgSingleton<AgNetworkManager>::ms_instance; // 0x140A8FD40
AgSingleton<AgLeaderboardManager> * AgSingleton<AgLeaderboardManager>::ms_instance; // 0x140A8FD60
AgSingleton<AgDialogManager> * AgSingleton<AgDialogManager>::ms_instance; // 0x140A8FD30
AgSingleton<AgSessionManager> * AgSingleton<AgSessionManager>::ms_instance; // 0x140A8FD58
AgSingleton<AgProfileManager> * AgSingleton<AgProfileManager>::ms_instance; // 0x140A8FD38
void AgUpdateSystemThread::onDetachThread(); // 0x140659BC0
AgSingleton<AgServiceEventManager> * AgSingleton<AgServiceEventManager>::ms_instance; // 0x140A8FD50
AgUpdateSystemThread::~AgUpdateSystemThread(); // 0x140659110
long AgSilverware::cleanup(); // 0x140659200
void AgSilverware::preUpdate(); // 0x140659C60
void AgSilverware::postUpdate(); // 0x140659C40
long AgSilverware::steamAvailable(); // 0x140659DB0//decompilation failure at 140864098!
//decompilation failure at 140740688!
//decompilation failure at 140740690!
//decompilation failure at 140A8FD08!
//decompilation failure at 140A8FD18!
//decompilation failure at 140A8FCD8!
//decompilation failure at 140A8FCE0!
//decompilation failure at 140740680!
//decompilation failure at 140A8FD28!
//decompilation failure at 140A8FD48!
//decompilation failure at 140A8FD40!
//decompilation failure at 140A8FD60!
//decompilation failure at 140A8FD30!
//decompilation failure at 140A8FD58!
//decompilation failure at 140A8FD38!
//decompilation failure at 140A8FD50!
void __fastcall AgPointer<AgService>::AgPointer<AgService>(AgPointer<AgService> *this, AgService *t)
{
  AgReferenceCount *v4; // rax
  int v5; // ecx
  AgReferenceCount *m_refCount; // rsi

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  if ( t )
  {
    if ( t->m_refCount )
    {
      v5 = 0;
    }
    else
    {
      v4 = (AgReferenceCount *)AgReferenceCount::operator new(0x10ui64);
      v5 = 1;
      if ( v4 )
      {
        v4->m_strongCount = 1;
        v4->m_weakCount = 1;
        v4->m_data = t;
      }
      else
      {
        v4 = 0i64;
      }
      t->m_refCount = v4;
    }
    m_refCount = t->m_refCount;
    if ( !v5 )
      AgReferenceCount::incRef(t->m_refCount);
    this->m_ref = m_refCount;
    this->m_ptr = t;
  }
}

void __fastcall std::vector<AgServiceCommandBase *>::vector<AgServiceCommandBase *>(
        std::vector<AgServiceCommandBase *> *this,
        unsigned __int64 _Count)
{
  AgServiceCommandBase **v4; // rax
  size_t v5; // rdi

  this->_Mypair._Myval2._Myfirst = 0i64;
  this->_Mypair._Myval2._Mylast = 0i64;
  this->_Mypair._Myval2._Myend = 0i64;
  if ( _Count )
  {
    if ( _Count > 0x1FFFFFFFFFFFFFFFi64 )
      std::_Xlength_error("vector<T> too long");
    v4 = (AgServiceCommandBase **)std::allocator<AgServiceCommandBase *>::allocate(
                                    (std::allocator<AgLogger *> *)this,
                                    _Count);
    this->_Mypair._Myval2._Myfirst = v4;
    this->_Mypair._Myval2._Mylast = v4;
    v5 = 8 * _Count;
    this->_Mypair._Myval2._Myend = &v4[v5 / 8];
    memset(this->_Mypair._Myval2._Myfirst, 0, v5);
    this->_Mypair._Myval2._Mylast = (AgServiceCommandBase **)((char *)this->_Mypair._Myval2._Mylast + v5);
  }
}

void __fastcall AgService::AgService(AgService *this, AgStringRef *name, unsigned __int64 reserved)
{
  unsigned __int64 i; // rdx
  AgStringRef v6; // [rsp+30h] [rbp-28h] BYREF

  this->m_refCount = 0i64;
  for ( i = reserved & -(__int64)reserved; i < reserved; i *= 2i64 )
    ;
  std::vector<AgServiceCommandBase *>::vector<AgServiceCommandBase *>(&this->m_commands, i);
  this->m_command = 0i64;
  this->m_commandListMask = this->m_commands._Mypair._Myval2._Mylast - this->m_commands._Mypair._Myval2._Myfirst - 1;
  this->m_read = 0;
  this->m_write = 0;
  InitializeCriticalSection((LPCRITICAL_SECTION)&this->m_condition);
  this->m_condition.m_conditionVariable.m_mutex = &this->m_condition.m_mutex;
  InitializeConditionVariable((PCONDITION_VARIABLE)&this->m_condition.m_conditionVariable.m_data);
  v6 = *name;
  AgSilverWareDebugChannel::AgSilverWareDebugChannel(&this->m_channel, &v6);
}

void __fastcall AgSilverWareDebugChannel::AgSilverWareDebugChannel(AgSilverWareDebugChannel *this, AgStringRef *name)
{
  const AgString *v4; // rax
  AgStringRef *v5; // rax
  AgDebugChannels *Instance; // rax
  unsigned __int64 v7; // rax
  AgString s1; // [rsp+28h] [rbp-50h] BYREF
  AgStringRef v9; // [rsp+40h] [rbp-38h] BYREF
  AgString result; // [rsp+50h] [rbp-28h] BYREF
  AgStringRef v11; // [rsp+60h] [rbp-18h] BYREF

  AgString::AgString(&s1, "SilverWare.", -1);
  v4 = operator+(&result, &s1, name);
  AgStringRef::AgStringRef(&v11, v4);
  v9 = *v5;
  Instance = AgDebugChannels::getInstance();
  this->m_data = AgDebugChannels::get(Instance, &v9);
  this->m_counter.m_startTime = 0.0;
  this->m_counter.m_frameCount = 120;
  this->m_counter.m_deltaIndex = 0;
  v7 = 480i64;
  if ( !is_mul_ok(0x78ui64, 4ui64) )
    v7 = -1i64;
  this->m_counter.m_deltaTime = (float *)operator new[](v7);
  AgPerformanceCounter::reset(&this->m_counter);
  AgString::~AgString(&result);
  AgString::~AgString(&s1);
}

void __fastcall AgWorkerPool::AgWorkerPool(AgWorkerPool *this)
{
  AgService *v2; // rax
  AgService *v3; // rdi
  AgStringRef *v4; // rax
  AgStringRef v5; // [rsp+30h] [rbp-28h] BYREF
  AgStringRef v6; // [rsp+40h] [rbp-18h] BYREF

  this->__vftable = (AgWorkerPool_vtbl *)&AgSingleton<AgWorkerPool>::`vftable';
  this->__vftable = (AgWorkerPool_vtbl *)&AgWorkerPool::`vftable';
  AgThreadPool::AgThreadPool(&this->m_threadPool);
  v2 = (AgService *)operator new(0xA8ui64);
  v3 = v2;
  if ( v2 )
  {
    AgStringRef::AgStringRef(&v6, "WorkerPool");
    v5 = *v4;
    AgService::AgService(v3, &v5, 0x80ui64);
  }
  AgPointer<AgService>::AgPointer<AgService>(&this->m_service, v2);
}

void __fastcall AgSingleton<AgWorkerPool>::~AgSingleton<AgWorkerPool>(AgSingleton<AgWorkerPool> *this)
{
  this->__vftable = (AgSingleton<AgWorkerPool>_vtbl *)&AgSingleton<AgWorkerPool>::`vftable';
}

void __fastcall AgUpdateSystemThread::~AgUpdateSystemThread(AgUpdateSystemThread *this)
{
  this->__vftable = (AgUpdateSystemThread_vtbl *)&AgIThreadHost::`vftable';
}

AgLogger **__fastcall std::allocator<AgServiceCommandBase *>::allocate(
        std::allocator<AgLogger *> *this,
        unsigned __int64 _Count)
{
  AgLogger **result; // rax
  unsigned __int64 v3; // rcx
  AgLogger *v4; // rax
  AgLogger *v5; // rcx

  if ( !_Count )
    return 0i64;
  if ( _Count > 0x1FFFFFFFFFFFFFFFi64 )
    std::_Xbad_alloc();
  v3 = 8 * _Count;
  if ( 8 * _Count < 0x1000 )
  {
    result = (AgLogger **)operator new(v3);
    if ( !result )
      invalid_parameter_noinfo_noreturn();
  }
  else
  {
    if ( v3 + 39 <= v3 )
      std::_Xbad_alloc();
    v4 = (AgLogger *)operator new(v3 + 39);
    v5 = v4;
    if ( !v4 )
      invalid_parameter_noinfo_noreturn();
    result = (AgLogger **)(((unsigned __int64)&v4[4].__vftable + 7) & 0xFFFFFFFFFFFFFFE0ui64);
    *(result - 1) = v5;
  }
  return result;
}

__int64 __fastcall AgSilverware::cleanup()
{
  AgSingleton<AgWorkerPool> *v0; // rbx
  AgSingleton<AgAudioManager> *v1; // rbx
  AgSingleton<AgPlayerManager> *v2; // rbx
  AgSingleton<AgInputManager> *v3; // rbx
  AgSingleton<AgFileSystem> *v4; // rbx
  AgSingleton<AgProfileManager> *v5; // rbx
  AgSingleton<AgLeaderboardManager> *v6; // rbx
  AgSingleton<AgServiceEventManager> *v7; // rbx
  AgSingleton<AgSessionManager> *v8; // rbx
  AgSingleton<AgUserManager> *v9; // rbx
  AgSingleton<AgNetworkManager> *v10; // rbx
  AgSingleton<AgDialogManager> *v11; // rbx
  AgSingleton<AgExceptionHandler> *v12; // rbx
  AgIThreadHost v14; // [rsp+38h] [rbp-40h] BYREF
  int v15; // [rsp+40h] [rbp-38h]
  AgThread v16; // [rsp+48h] [rbp-30h] BYREF

  v14.__vftable = (AgIThreadHost_vtbl *)&AgUpdateSystemThread::`vftable';
  v15 = 1;
  AgThread::AgThread(&v16, &v14, 0x100000ui64, -1, "AgThread");
  if ( (AgSilverware::Systems & 2) != 0 )
  {
    v0 = AgSingleton<AgWorkerPool>::ms_instance;
    if ( AgSingleton<AgWorkerPool>::ms_instance )
    {
      AgSingleton<AgWorkerPool>::ms_instance->onSingletonExit(AgSingleton<AgWorkerPool>::ms_instance);
      AgSingleton<AgWorkerPool>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgWorkerPool> *, __int64))v0->~AgSingleton<AgWorkerPool>)(v0, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 0x1000) != 0 )
  {
    v1 = AgSingleton<AgAudioManager>::ms_instance;
    if ( AgSingleton<AgAudioManager>::ms_instance )
    {
      AgSingleton<AgAudioManager>::ms_instance->onSingletonExit(AgSingleton<AgAudioManager>::ms_instance);
      AgSingleton<AgAudioManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgAudioManager> *, __int64))v1->~AgSingleton<AgAudioManager>)(v1, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 0x20) != 0 )
  {
    v2 = AgSingleton<AgPlayerManager>::ms_instance;
    if ( AgSingleton<AgPlayerManager>::ms_instance )
    {
      AgSingleton<AgPlayerManager>::ms_instance->onSingletonExit(AgSingleton<AgPlayerManager>::ms_instance);
      AgSingleton<AgPlayerManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgPlayerManager> *, __int64))v2->~AgSingleton<AgPlayerManager>)(v2, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 0x10) != 0 )
  {
    v3 = AgSingleton<AgInputManager>::ms_instance;
    if ( AgSingleton<AgInputManager>::ms_instance )
    {
      AgSingleton<AgInputManager>::ms_instance->onSingletonExit(AgSingleton<AgInputManager>::ms_instance);
      AgSingleton<AgInputManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgInputManager> *, __int64))v3->~AgSingleton<AgInputManager>)(v3, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 0x40) != 0 )
  {
    v4 = AgSingleton<AgFileSystem>::ms_instance;
    if ( AgSingleton<AgFileSystem>::ms_instance )
    {
      AgSingleton<AgFileSystem>::ms_instance->onSingletonExit(AgSingleton<AgFileSystem>::ms_instance);
      AgSingleton<AgFileSystem>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgFileSystem> *, __int64))v4->~AgSingleton<AgFileSystem>)(v4, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 8) != 0 )
  {
    v5 = AgSingleton<AgProfileManager>::ms_instance;
    if ( AgSingleton<AgProfileManager>::ms_instance )
    {
      AgSingleton<AgProfileManager>::ms_instance->onSingletonExit(AgSingleton<AgProfileManager>::ms_instance);
      AgSingleton<AgProfileManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgProfileManager> *, __int64))v5->~AgSingleton<AgProfileManager>)(v5, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 0x100) != 0 )
  {
    v6 = AgSingleton<AgLeaderboardManager>::ms_instance;
    if ( AgSingleton<AgLeaderboardManager>::ms_instance )
    {
      AgSingleton<AgLeaderboardManager>::ms_instance->onSingletonExit(AgSingleton<AgLeaderboardManager>::ms_instance);
      AgSingleton<AgLeaderboardManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgLeaderboardManager> *, __int64))v6->~AgSingleton<AgLeaderboardManager>)(
        v6,
        1i64);
    }
    v7 = AgSingleton<AgServiceEventManager>::ms_instance;
    if ( AgSingleton<AgServiceEventManager>::ms_instance )
    {
      AgSingleton<AgServiceEventManager>::ms_instance->onSingletonExit(AgSingleton<AgServiceEventManager>::ms_instance);
      AgSingleton<AgServiceEventManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgServiceEventManager> *, __int64))v7->~AgSingleton<AgServiceEventManager>)(
        v7,
        1i64);
    }
    v8 = AgSingleton<AgSessionManager>::ms_instance;
    if ( AgSingleton<AgSessionManager>::ms_instance )
    {
      AgSingleton<AgSessionManager>::ms_instance->onSingletonExit(AgSingleton<AgSessionManager>::ms_instance);
      AgSingleton<AgSessionManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgSessionManager> *, __int64))v8->~AgSingleton<AgSessionManager>)(v8, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 4) != 0 )
  {
    v9 = AgSingleton<AgUserManager>::ms_instance;
    if ( AgSingleton<AgUserManager>::ms_instance )
    {
      AgSingleton<AgUserManager>::ms_instance->onSingletonExit(AgSingleton<AgUserManager>::ms_instance);
      AgSingleton<AgUserManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgUserManager> *, __int64))v9->~AgSingleton<AgUserManager>)(v9, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 0x80u) != 0i64 )
  {
    v10 = AgSingleton<AgNetworkManager>::ms_instance;
    if ( AgSingleton<AgNetworkManager>::ms_instance )
    {
      AgSingleton<AgNetworkManager>::ms_instance->onSingletonExit(AgSingleton<AgNetworkManager>::ms_instance);
      AgSingleton<AgNetworkManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgNetworkManager> *, __int64))v10->~AgSingleton<AgNetworkManager>)(v10, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 0x200) != 0 )
  {
    v11 = AgSingleton<AgDialogManager>::ms_instance;
    if ( AgSingleton<AgDialogManager>::ms_instance )
    {
      AgSingleton<AgDialogManager>::ms_instance->onSingletonExit(AgSingleton<AgDialogManager>::ms_instance);
      AgSingleton<AgDialogManager>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgDialogManager> *, __int64))v11->~AgSingleton<AgDialogManager>)(v11, 1i64);
    }
  }
  if ( (AgSilverware::Systems & 0x8000) != 0 )
  {
    v12 = AgSingleton<AgExceptionHandler>::ms_instance;
    if ( AgSingleton<AgExceptionHandler>::ms_instance )
    {
      AgSingleton<AgExceptionHandler>::ms_instance->onSingletonExit(AgSingleton<AgExceptionHandler>::ms_instance);
      AgSingleton<AgExceptionHandler>::ms_instance = 0i64;
      ((void (__fastcall *)(AgSingleton<AgExceptionHandler> *, __int64))v12->~AgSingleton<AgExceptionHandler>)(
        v12,
        1i64);
    }
  }
  AgThread::join(&v16);
  AgThread::~AgThread(&v16);
  return 1i64;
}

__int64 __fastcall AgSimpleThreadHost::getThreadIsStopping(
        Concurrency::details::ThreadProxyFactory<Concurrency::details::FreeThreadProxy> *this)
{
  return this->m_executionResourceTlsIndex;
}

__int64 __fastcall AgSilverware::initialize(AgStringRef *titleId, AgStringRef *serviceId, unsigned __int64 flags)
{
  AgPointer<KOFApplication> *v4; // rax
  AgDebugChannels *Instance; // rax
  AgSingleton<AgPlayerManager> *v6; // rdi
  unsigned __int64 v7; // rdx
  AgExceptionHandler *Singleton; // rbx
  AgWorkerPool *v9; // rax
  AgSingleton<AgWorkerPool> *v10; // rax
  AgSingleton<AgWorkerPool> *v11; // rbx
  AgDialogManager *v12; // rbx
  AgNetworkManager *v13; // rbx
  AgUserManager *v14; // rbx
  AgProfileManager *v15; // rbx
  AgFileSystem *v16; // rbx
  AgInputManager *v17; // rbx
  AgPlayerManager *v18; // rax
  AgSingleton<AgPlayerManager> *v19; // rax
  AgServiceEventManager *v20; // rbx
  AgSessionManager *v21; // rbx
  AgLeaderboardManager *v22; // rbx
  AgAudioManager *v23; // rbx
  AgPointer<KOFApplication> v25; // [rsp+38h] [rbp-19h] BYREF
  AgStringRef v26; // [rsp+48h] [rbp-9h] BYREF
  AgDebugChannel<1> v27; // [rsp+58h] [rbp+7h] BYREF

  AgSilverware::Systems = flags;
  AgString::operator=(&AgSilverware::TitleId, titleId);
  AgString::operator=(&AgSilverware::ServiceId, serviceId);
  AgClock::setMaxElapsedFrameTime(&AgSilverware::ms_clock, 0.0);
  AgStringRef::AgStringRef(&v26, "SilverWare");
  v25 = *v4;
  Instance = AgDebugChannels::getInstance();
  v27.m_data = AgDebugChannels::get(Instance, (AgStringRef *)&v25);
  v27.m_counter.m_startTime = 0.0;
  v27.m_counter.m_frameCount = 120;
  v6 = 0i64;
  v27.m_counter.m_deltaIndex = 0;
  v27.m_counter.m_deltaTime = (float *)operator new[](saturated_mul(0x78ui64, 4ui64));
  AgPerformanceCounter::reset(&v27.m_counter);
  if ( (AgSilverware::Systems & 0x8000) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Exception Handler");
    }
    if ( !AgSingleton<AgExceptionHandler>::ms_instance )
    {
      Singleton = AgExceptionHandler::createSingleton();
      Singleton->onSingletonInit(Singleton);
      AgSingleton<AgExceptionHandler>::ms_instance = Singleton;
    }
  }
  if ( (AgSilverware::Systems & 1) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Math");
    }
    AgMath::initialize();
  }
  if ( (AgSilverware::Systems & 2) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Worker Pool");
    }
    if ( !AgSingleton<AgWorkerPool>::ms_instance )
    {
      v9 = (AgWorkerPool *)operator new(0x100ui64);
      if ( v9 )
      {
        AgWorkerPool::AgWorkerPool(v9);
        v11 = v10;
      }
      else
      {
        v11 = 0i64;
      }
      v11->onSingletonInit(v11);
      AgSingleton<AgWorkerPool>::ms_instance = v11;
    }
  }
  if ( (AgSilverware::Systems & 0x200) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Dialog Manager");
    }
    if ( !AgSingleton<AgDialogManager>::ms_instance )
    {
      v12 = AgDialogManager::createSingleton();
      v12->onSingletonInit(v12);
      AgSingleton<AgDialogManager>::ms_instance = v12;
    }
  }
  if ( (AgSilverware::Systems & 0x80u) != 0i64 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Network Manager");
    }
    if ( !AgSingleton<AgNetworkManager>::ms_instance )
    {
      v13 = AgNetworkManager::createSingleton();
      v13->onSingletonInit(v13);
      AgSingleton<AgNetworkManager>::ms_instance = v13;
    }
  }
  if ( (AgSilverware::Systems & 4) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing User Manager");
    }
    if ( !AgSingleton<AgUserManager>::ms_instance )
    {
      v14 = AgUserManager::createSingleton();
      v14->onSingletonInit(v14);
      AgSingleton<AgUserManager>::ms_instance = v14;
    }
  }
  if ( (AgSilverware::Systems & 8) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Profile Manager");
    }
    if ( !AgSingleton<AgProfileManager>::ms_instance )
    {
      v15 = AgProfileManager::createSingleton();
      v15->onSingletonInit(v15);
      AgSingleton<AgProfileManager>::ms_instance = v15;
    }
  }
  if ( (AgSilverware::Systems & 0x40) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Filesystem");
    }
    if ( !AgSingleton<AgFileSystem>::ms_instance )
    {
      v16 = AgFileSystem::createSingleton();
      v16->onSingletonInit(v16);
      AgSingleton<AgFileSystem>::ms_instance = v16;
    }
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Mounting content folder");
    }
    ((void (__fastcall *)(AgSingleton<AgFileSystem> *, AgPointer<KOFApplication> *, __int64))AgSingleton<AgFileSystem>::ms_instance->__vftable[1].~AgSingleton<AgFileSystem>)(
      AgSingleton<AgFileSystem>::ms_instance,
      &v25,
      1i64);
    AgPointer<AgUser>::~AgPointer<AgUser>(&v25);
    ((void (__fastcall *)(AgSingleton<AgFileSystem> *, AgPointer<KOFApplication> *, __int64))AgSingleton<AgFileSystem>::ms_instance->__vftable[1].~AgSingleton<AgFileSystem>)(
      AgSingleton<AgFileSystem>::ms_instance,
      &v25,
      4i64);
    AgPointer<AgUser>::~AgPointer<AgUser>(&v25);
    AgPCSystemConfig::deserialize(&AgSystemManager::ms_config);
  }
  if ( (AgSilverware::Systems & 0x10) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Input");
    }
    if ( !AgSingleton<AgInputManager>::ms_instance )
    {
      v17 = AgInputManager::createSingleton();
      v17->onSingletonInit(v17);
      AgSingleton<AgInputManager>::ms_instance = v17;
    }
  }
  if ( (AgSilverware::Systems & 0x20) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Player Manager");
    }
    if ( !AgSingleton<AgPlayerManager>::ms_instance )
    {
      v18 = (AgPlayerManager *)operator new(0x120ui64);
      if ( v18 )
      {
        AgPlayerManager::AgPlayerManager(v18);
        v6 = v19;
      }
      v6->onSingletonInit(v6);
      AgSingleton<AgPlayerManager>::ms_instance = v6;
    }
  }
  if ( (AgSilverware::Systems & 0x100) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Services");
    }
    if ( !AgSingleton<AgServiceEventManager>::ms_instance )
    {
      v20 = AgServiceEventManager::createSingleton();
      v20->onSingletonInit(v20);
      AgSingleton<AgServiceEventManager>::ms_instance = v20;
    }
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Sessions");
    }
    if ( !AgSingleton<AgSessionManager>::ms_instance )
    {
      v21 = AgSessionManager::createSingleton();
      v21->onSingletonInit(v21);
      AgSingleton<AgSessionManager>::ms_instance = v21;
    }
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Leaderboards");
    }
    if ( !AgSingleton<AgLeaderboardManager>::ms_instance )
    {
      v22 = AgLeaderboardManager::createSingleton();
      v22->onSingletonInit(v22);
      AgSingleton<AgLeaderboardManager>::ms_instance = v22;
    }
  }
  if ( (AgSilverware::Systems & 0x1000) != 0 )
  {
    if ( AgDebugChannelData::isEnabled(v27.m_data)
      && AgDebugChannelData::getVerbosity(v27.m_data) >= AgLogVerbosity_Info )
    {
      AgDebugChannel<1>::log(&v27, AgLogVerbosity_Info, "[SilverWare Init] Initializing Audio Manager");
    }
    if ( !AgSingleton<AgAudioManager>::ms_instance )
    {
      v23 = AgAudioManager::createSingleton();
      v23->onSingletonInit(v23);
      AgSingleton<AgAudioManager>::ms_instance = v23;
    }
  }
  operator delete(v27.m_counter.m_deltaTime, v7);
  return 1i64;
}

void AgDebugChannel<1>::log(AgDebugChannel<1> *this, AgLogVerbosity verbosity, const char *text, ...)
{
  va_list args; // [rsp+48h] [rbp+20h] BYREF

  va_start(args, text);
  AgDebugChannelData::log(this->m_data, verbosity, text, args);
}

void __fastcall AgUpdateSystemThread::onJoinThread(AgUpdateSystemThread *this)
{
  this->m_running = 0;
}

void __fastcall AgUpdateSystemThread::onExecuteThread(AgUpdateSystemThread *this)
{
  while ( this->m_running )
  {
    AgSingleton<AgSystemManager>::ms_instance->__vftable[1].onSingletonExit(AgSingleton<AgSystemManager>::ms_instance);
    AgThread::sleep(0xAu);
  }
}

__int64 __fastcall AgWorkerPool::onSingletonExit(AgWorkerPool *this)
{
  if ( this->m_threadPool.m_threads._Mypair._Myval2._Myfirst != this->m_threadPool.m_threads._Mypair._Myval2._Mylast )
    AgThreadPool::free(&this->m_threadPool);
  return 1i64;
}

__int64 __fastcall AgUser::isSignedIn(Concurrency::details::ThreadInternalContext *this)
{
  return 1i64;
}

void AgSilverware::postUpdate(void)
{
  if ( (AgSilverware::Systems & 0x10) != 0 )
    AgSingleton<AgInputManager>::ms_instance->__vftable[1].onSingletonInit(AgSingleton<AgInputManager>::ms_instance);
}

void AgSilverware::preUpdate(void)
{
  __int16 v0; // ax
  AgSingleton<AgWorkerPool> *v1; // rbx
  AgService *v2; // rbx
  volatile int m_write; // edi

  AgClock::tick(&AgSilverware::ms_clock);
  AgClock::getElapsedFrameTime(&AgSilverware::ms_clock);
  AgSingleton<AgSystemManager>::ms_instance->__vftable[1].onSingletonExit(AgSingleton<AgSystemManager>::ms_instance);
  v0 = AgSilverware::Systems;
  if ( (AgSilverware::Systems & 0x40) != 0 )
  {
    AgSingleton<AgFileSystem>::ms_instance->__vftable[1].onSingletonInit(AgSingleton<AgFileSystem>::ms_instance);
    v0 = AgSilverware::Systems;
  }
  if ( (v0 & 0x80u) != 0 )
  {
    AgSingleton<AgNetworkManager>::ms_instance->__vftable[1].~AgSingleton<AgNetworkManager>(AgSingleton<AgNetworkManager>::ms_instance);
    v0 = AgSilverware::Systems;
  }
  if ( (v0 & 4) != 0 )
  {
    AgSingleton<AgUserManager>::ms_instance->__vftable[1].~AgSingleton<AgUserManager>(AgSingleton<AgUserManager>::ms_instance);
    v0 = AgSilverware::Systems;
  }
  if ( (v0 & 0x10) != 0 )
  {
    AgSingleton<AgInputManager>::ms_instance->__vftable[1].~AgSingleton<AgInputManager>(AgSingleton<AgInputManager>::ms_instance);
    v0 = AgSilverware::Systems;
  }
  if ( (v0 & 0x20) != 0 )
  {
    AgSingleton<AgPlayerManager>::ms_instance->__vftable[1].~AgSingleton<AgPlayerManager>(AgSingleton<AgPlayerManager>::ms_instance);
    v0 = AgSilverware::Systems;
  }
  if ( (v0 & 0x100) != 0 )
  {
    AgSingleton<AgSessionManager>::ms_instance->__vftable[1].~AgSingleton<AgSessionManager>(AgSingleton<AgSessionManager>::ms_instance);
    AgLeaderboardManager::update((AgLeaderboardManager *)AgSingleton<AgLeaderboardManager>::ms_instance);
    v0 = AgSilverware::Systems;
  }
  if ( (v0 & 0x1000) != 0 )
  {
    AgAudioManager::update((AgAudioManager *)AgSingleton<AgAudioManager>::ms_instance);
    LOBYTE(v0) = AgSilverware::Systems;
  }
  if ( (v0 & 2) != 0 )
  {
    v1 = AgSingleton<AgWorkerPool>::ms_instance;
    if ( AgSingleton<AgWorkerPool>::ms_instance[17].__vftable != AgSingleton<AgWorkerPool>::ms_instance[18].__vftable )
      AgThreadPool::processCompletedJobs((AgThreadPool *)&AgSingleton<AgWorkerPool>::ms_instance[1]);
    v2 = (AgService *)v1[31].__vftable;
    m_write = v2->m_write;
    while ( AgService::runOne(v2, 0) && v2->m_read != m_write )
      ;
  }
}

// attributes: thunk
int __fastcall AgSilverware::steamAvailable()
{
  return AgSteamworks::isAvailable();
}

