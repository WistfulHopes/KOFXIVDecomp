#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/globalheapmemory.h"
#include "dev/silverware/git/sdk/audio/agaudiomanager.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/fixmemory.h"
#include "dev/silverware/git/sdk/input/agsdlmappingparser.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/matrix4unaligned.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/quat_aos.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_refcount.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_memory.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_memoryheap.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_stats.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_timer.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_sse.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steamclientpublic.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_types.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "dev/silverware/git/sdk/audio/agaudiotypes.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/variableheapmemorybase.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector2unaligned.h"
#include "dev/silverware/git/sdk/agmemorystream.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_sysalloc.h"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_functions.h"
#include "dev/silverware/git/sdk/input/agcontrollerbuttoncomponent.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_threads.h"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_types.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/network/matchingsystem.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/physicalheapmemory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "dev/silverware/git/sdk/agsemaphore.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "dev/silverware/git/sdk/agsemaphore.inl"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "dev/silverware/git/sdk/agreferenceinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/deque"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_allocinfo.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/boolinvec.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/thread/jobmanager.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/windows kits/8.1/include/shared/guiddef.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector3unaligned.h"
#include "program files (x86)/windows kits/8.1/include/shared/stralign.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/util/resourcemanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "dev/silverware/git/sdk/3rdparty/steam/isteamhtmlsurface.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/vec_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/list"
#include "dev/kof/master/development/source/baseproject/jni/framework/network/titlestoragesystem.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/boolinvec.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "dev/silverware/git/sdk/agcurve.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/vectormath_aos.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "program files (x86)/windows kits/8.1/include/um/winnt.h"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "dev/silverware/git/sdk/agpointer.h"
#include "program files (x86)/windows kits/8.1/include/shared/basetsd.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/heapmh/heapmh_sysallocmalloc.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "dev/kof/master/development/source/baseproject/jni/framework/network/voicechatpc.h"
#include "dev/silverware/git/sdk/audio/agaudiochannel.h"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "dev/silverware/git/sdk/agvector3.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/mat_aos.h"
#include "dev/silverware/git/sdk/agthread.h"
#include "dev/silverware/git/sdk/agmutex.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/array"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steam_api_internal.h"
#include "dev/kof/master/development/source/ps4project/baseproject/pcutil/pccontrolsmanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/algorithm"
#include "dev/silverware/git/sdk/input/aginputmanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector4unaligned.h"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/vecidx_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "program files (x86)/windows kits/8.1/include/um/winuser.h"
#include "dev/silverware/git/sdk/memory/agallocators.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/floatinvec.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "dev/silverware/git/sdk/input/agcontrollercomponent.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steam_api.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "dev/kof/master/development/source/ps4project/baseproject/pcutil/pcdummy.h"
#include "dev/silverware/git/sdk/util/agdelegate.h"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/quat_aos.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/floatinvec.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "dev/silverware/git/sdk/agvector2.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_vec64.h"
#include "dev/silverware/git/sdk/agmath.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_array.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_allocator.h"
#include "dev/silverware/git/sdk/input/agcontroller.h"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_atomic.h"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_math.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "dev/kof/master/development/source/baseproject/jni/framework/libcommon.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/vec_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "dev/silverware/git/sdk/3rdparty/steam/matchmakingtypes.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "program files (x86)/windows kits/8.1/include/um/winbase.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/mat_aos.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/debug/logging.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/heapmemory.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/thread/mutex.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "dev/silverware/git/sdk/audio/agaudioeffects.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/heapmemory.cpp"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/replace.cpp"

AgSingleton<AgAudioManager> * AgSingleton<AgAudioManager>::ms_instance; // 0x140ACAB20
void(*??m_VoiceQos$initializer$@VoiceChat@Fw@@0P6AXXZEA@@3P6AXXZEA)(); // 0x140740790
void(*??m_VoiceChatMutex$initializer$@VoiceChat@Fw@@0P6AXXZEA@@3P6AXXZEA)(); // 0x140740798
std::piecewise_construct_t std::piecewise_construct; // 0x14088949E
Fw::VoiceChat::VoiceQos::~VoiceQos(); // 0x140050900
bool Fw::VoiceChat::Initialize(Fw::HeapMemory & rHeap); // 0x140050920
bool Fw::VoiceChat::addConnect(char idx); // 0x1400509C0
void Fw::VoiceChat::delConnect(char idx); // 0x140050AF0
void Fw::VoiceChat::delAllConnect(); // 0x140050BE0
bool Fw::VoiceChat::getVoiceMessage(char idx, unsigned char * dataBuf, unsigned long * bufSize); // 0x140050DE0
bool Fw::VoiceChat::setVoiceMessage(char idx, unsigned char * dataBuf, unsigned long * bufSize); // 0x140050E70//decompilation failure at 140ACAB20!
//decompilation failure at 140740790!
//decompilation failure at 140740798!
//decompilation failure at 14088949E!
void __fastcall AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
        AgPointer<AgPlayer> *this,
        const AgPointer<AgPlayer> *rhs)
{
  AgReferenceCount *m_ref; // rsi
  int m_strongCount; // ebx

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  m_ref = rhs->m_ref;
  if ( rhs->m_ref )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( m_ref->m_strongCount )
    {
      while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
      {
        m_strongCount = m_ref->m_strongCount;
        if ( !m_ref->m_strongCount )
          return;
      }
      if ( m_strongCount != -1 )
      {
        this->m_ref = rhs->m_ref;
        this->m_ptr = rhs->m_ptr;
      }
    }
  }
}

AgPointer<AgStream> *__fastcall AgPointer<AgMemoryStream>::operator<AgStream> AgPointer<AgStream>(
        AgPointer<AgMemoryStream> *this,
        AgPointer<AgStream> *result)
{
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
    (AgPointer<AgPlayer> *)result,
    (const AgPointer<AgPlayer> *)this);
  return result;
}

void __fastcall AgPointer<AgUser>::AgPointer<AgUser>(AgPointer<AgUser> *this, AgUser *t)
{
  int ReferenceCounter; // eax
  AgReferenceCount *m_refCount; // rbx

  this->m_ref = 0i64;
  this->m_ptr = 0i64;
  if ( t )
  {
    ReferenceCounter = AgReferencedObject::createReferenceCounter(&t->AgReferencedObject, t);
    m_refCount = t->m_refCount;
    if ( !ReferenceCounter )
      AgReferenceCount::incRef(t->m_refCount);
    this->m_ref = m_refCount;
    this->m_ptr = t;
  }
}

void __fastcall Fw::VoiceChat::VoiceQos::VoiceQos(Fw::VoiceChat::VoiceQos *this)
{
  this->source.m_ref = 0i64;
  this->source.m_ptr = 0i64;
  AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
    (AgPointer<AgPlayer> *)&this->channel,
    (const AgPointer<AgPlayer> *)&this->channel);
  *(_WORD *)&this->bConnected = 0;
  this->bRejectMute = 0;
  *(_QWORD *)&this->sendCount = 0i64;
}

void __fastcall AgPointer<AgUser>::~AgPointer<AgUser>(AgPointer<KOFApplication> *this)
{
  KOFApplication *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v3; // esi

  m_ptr = this->m_ptr;
  this->m_ptr = 0i64;
  m_ref = this->m_ref;
  if ( this->m_ref )
  {
    this->m_ref = 0i64;
    v3 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v3 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(KOFApplication *, __int64))m_ptr->~AgIThreadHost)(m_ptr, 1i64);
      if ( v3 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
}

void __fastcall Fw::VoiceChat::VoiceQos::~VoiceQos(Fw::VoiceChat::VoiceQos *this)
{
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&this->channel);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&this->source);
}

void __fastcall AgMemoryStream::operator delete(void *p)
{
  EnterCriticalSection((LPCRITICAL_SECTION)&AgMemoryStream::s_pool.m_lock);
  *(_QWORD *)p = AgMemoryStream::s_pool.m_free;
  --AgMemoryStream::s_pool.m_used;
  AgMemoryStream::s_pool.m_free = (unsigned __int8 *)p;
  LeaveCriticalSection((LPCRITICAL_SECTION)&AgMemoryStream::s_pool.m_lock);
}

AgPointer<AgFile> *__fastcall AgPointer<AgAudioChannel>::operator=(AgPointer<AgFile> *this, AgPointer<AgFile> *rhs)
{
  AgReferenceCount *m_ref; // r9
  AgFile *m_ptr; // r8
  AgReferenceCount *v5; // rdx
  AgFile *v6; // rax
  AgPointer<KOFApplication> v8; // [rsp+20h] [rbp-18h] BYREF

  m_ref = rhs->m_ref;
  m_ptr = rhs->m_ptr;
  rhs->m_ref = 0i64;
  rhs->m_ptr = 0i64;
  v5 = this->m_ref;
  v6 = this->m_ptr;
  this->m_ref = m_ref;
  this->m_ptr = m_ptr;
  v8.m_ref = v5;
  v8.m_ptr = (KOFApplication *)v6;
  AgPointer<AgUser>::~AgPointer<AgUser>(&v8);
  return this;
}

AgPointer<AgController> *__fastcall AgPointer<AgThread>::operator=(AgPointer<AgController> *this, AgController *t)
{
  AgController *m_ptr; // rdi
  int ReferenceCounter; // eax
  AgReferenceCount *m_refCount; // rbx
  AgController *v6; // rax
  AgPointer<KOFApplication> v8; // [rsp+20h] [rbp-18h] BYREF

  m_ptr = t;
  v8 = 0i64;
  if ( t )
  {
    ReferenceCounter = AgReferencedObject::createReferenceCounter(&t->AgReferencedObject, t);
    m_refCount = m_ptr->m_refCount;
    if ( !ReferenceCounter )
      AgReferenceCount::incRef(m_ptr->m_refCount);
  }
  else
  {
    m_ptr = (AgController *)v8.m_ptr;
    m_refCount = v8.m_ref;
  }
  v6 = this->m_ptr;
  v8.m_ref = this->m_ref;
  this->m_ref = m_refCount;
  this->m_ptr = m_ptr;
  v8.m_ptr = (KOFApplication *)v6;
  AgPointer<AgUser>::~AgPointer<AgUser>(&v8);
  return this;
}

char __fastcall Fw::VoiceChat::Initialize(Fw::HeapMemory *rHeap)
{
  __int64 v1; // rdx
  __int64 v2; // rax

  if ( Fw::VoiceChat::m_Initialized )
    return 1;
  Fw::VoiceChat::m_pBuffer = aligned_malloc(0x44Cui64, 0x20ui64);
  if ( Fw::VoiceChat::m_pBuffer )
  {
    Fw::VoiceChat::m_pDecompressBuffer = aligned_malloc(0x5800ui64, 0x20ui64);
    if ( Fw::VoiceChat::m_pDecompressBuffer )
    {
      v2 = SteamInternal_ContextInit(&`SteamInternal_ModuleContext'::`2'::s_CallbackCounterAndContext, v1);
      Fw::VoiceChat::m_optimalSampleRate = (*(__int64 (__fastcall **)(_QWORD))(**(_QWORD **)(v2 + 8) + 96i64))(*(_QWORD *)(v2 + 8));
      Fw::VoiceChat::m_Initialized = 1;
      return 1;
    }
  }
  Fw::VoiceChat::delAllConnect();
  if ( Fw::VoiceChat::m_pBuffer )
  {
    aligned_free(Fw::VoiceChat::m_pBuffer);
    Fw::VoiceChat::m_pBuffer = 0i64;
  }
  return 0;
}

unsigned __int8 *__fastcall AgMemoryPoolImpl<AgMutex,AgMutex>::_alloc(AgMemoryPoolImpl<AgMutex,AgMutex> *this)
{
  AgMutex *p_m_lock; // rsi
  signed int m_growPercent; // eax
  unsigned int v4; // eax
  unsigned int v5; // edx
  unsigned __int8 *m_free; // rdi

  p_m_lock = &this->m_lock;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_lock);
  if ( !this->m_free )
  {
    m_growPercent = this->m_growPercent;
    if ( m_growPercent )
    {
      v4 = (int)(float)((float)((float)m_growPercent * (float)(int)this->m_capacity) * 0.0099999998);
      v5 = 4;
      if ( v4 > 4 )
        v5 = v4;
      AgMemoryPoolImpl<AgMutex,AgMutex>::_grow((AgMemoryPoolImpl<void,int> *)this, v5);
    }
  }
  m_free = this->m_free;
  if ( this->m_free )
  {
    this->m_free = *(unsigned __int8 **)m_free;
    ++this->m_used;
  }
  LeaveCriticalSection((LPCRITICAL_SECTION)p_m_lock);
  return m_free;
}

void __fastcall AgMemoryPoolImpl<AgMutex,AgMutex>::_grow(AgMemoryPoolImpl<void,int> *this, unsigned int num)
{
  AgMemoryPoolImpl<void,int>::BlockHeader *v4; // r8
  unsigned int v5; // edx
  unsigned __int8 *v6; // rcx

  if ( num )
  {
    v4 = (AgMemoryPoolImpl<void,int>::BlockHeader *)operator new[](num * this->m_itemSize + 16i64);
    v5 = num;
    v4->m_next = this->m_blocks;
    v4->m_num = num;
    this->m_blocks = v4;
    do
    {
      v6 = (unsigned __int8 *)&v4[1] + --v5 * this->m_itemSize;
      *(_QWORD *)v6 = this->m_free;
      this->m_free = v6;
    }
    while ( v5 );
    this->m_capacity += num;
  }
}

bool __fastcall Fw::VoiceChat::addConnect(char idx)
{
  Fw::VoiceChat::VoiceQos *v1; // rbx
  Fw::VoiceChat::VoiceQos *v2; // rdi
  AgPointer<AgAudioSource> *v3; // rax
  AgReferenceCount *m_ref; // r8
  AgAudioSource *m_ptr; // rdx
  KOFApplication *v6; // rax
  AgPointer<AgAudioChannel> *Channel; // rax
  AgReferenceCount *v8; // r8
  AgAudioChannel *v9; // rdx
  KOFApplication *v10; // rax
  __int64 v11; // rdx
  bool v12; // al
  bool v13; // zf
  __int64 v14; // rax
  AgPointer<KOFApplication> v15; // [rsp+30h] [rbp-28h] BYREF
  AgPointer<AgAudioSource> result; // [rsp+40h] [rbp-18h] BYREF

  v1 = Fw::VoiceChat::m_VoiceQos;
  v2 = &Fw::VoiceChat::m_VoiceQos[idx];
  if ( v2->bConnected )
    return 1;
  v3 = AgAudioManager::createRuntimeSource(
         (AgAudioManager *)AgSingleton<AgAudioManager>::ms_instance,
         &result,
         Fw::VoiceChat::m_optimalSampleRate,
         0,
         1.0);
  m_ref = v3->m_ref;
  m_ptr = v3->m_ptr;
  v3->m_ref = 0i64;
  v3->m_ptr = 0i64;
  v6 = (KOFApplication *)v2->source.m_ptr;
  v15.m_ref = v2->source.m_ref;
  v2->source.m_ref = m_ref;
  v2->source.m_ptr = m_ptr;
  v15.m_ptr = v6;
  AgPointer<AgUser>::~AgPointer<AgUser>(&v15);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&result);
  Channel = AgAudioSource::createChannel(v2->source.m_ptr, (AgPointer<AgAudioChannel> *)&result);
  v8 = Channel->m_ref;
  v9 = Channel->m_ptr;
  Channel->m_ref = 0i64;
  Channel->m_ptr = 0i64;
  v10 = (KOFApplication *)v2->channel.m_ptr;
  v15.m_ref = v2->channel.m_ref;
  v2->channel.m_ref = v8;
  v2->channel.m_ptr = v9;
  v15.m_ptr = v10;
  AgPointer<AgUser>::~AgPointer<AgUser>(&v15);
  AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&result);
  v12 = 0;
  v2->bConnected = 1;
  while ( 1 )
  {
    if ( v1->bConnected )
    {
      v13 = !v12;
      v12 = 1;
      if ( !v13 )
        break;
    }
    if ( (__int64)++v1 >= (__int64)&Fw::VoiceChat::m_VoiceChatMutex )
    {
      v14 = SteamInternal_ContextInit(&`SteamInternal_ModuleContext'::`2'::s_CallbackCounterAndContext, v11);
      (*(void (__fastcall **)(_QWORD))(**(_QWORD **)(v14 + 8) + 56i64))(*(_QWORD *)(v14 + 8));
      return 1;
    }
  }
  return v12;
}

void __fastcall Fw::VoiceChat::delAllConnect(__int64 a1, __int64 a2)
{
  int i; // er15
  Fw::VoiceChat::VoiceQos *v3; // rdi
  AgAudioChannel *m_ptr; // rcx
  AgReferenceCount *m_ref; // rbx
  AgAudioChannel *v6; // rsi
  int v7; // ebp
  volatile int *p_m_strongCount; // rsi
  int v9; // ebx
  AgReferenceCount *v10; // rbx
  AgAudioSource *v11; // rsi
  int v12; // edi
  Fw::VoiceChat::VoiceQos *v13; // rax
  __int64 v14; // rax
  AgPointer<AgAudioSource> source; // [rsp+28h] [rbp-40h] BYREF

  for ( i = 0; i < 12; ++i )
  {
    v3 = &Fw::VoiceChat::m_VoiceQos[(char)i];
    v3->bConnected = 0;
    m_ptr = v3->channel.m_ptr;
    if ( m_ptr )
    {
      AgAudioChannel::stop(m_ptr);
      m_ref = v3->channel.m_ref;
      v6 = v3->channel.m_ptr;
      v3->channel.m_ref = 0i64;
      v3->channel.m_ptr = 0i64;
      if ( m_ref )
      {
        v7 = 0;
        if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
        {
          if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
            v7 = 1;
          m_ref->m_data = 0i64;
          if ( v6 )
            ((void (__fastcall *)(AgAudioChannel *, __int64))v6->~AgAudioChannel)(v6, 1i64);
          if ( v7 )
            AgReferenceCount::operator delete(m_ref);
        }
      }
    }
    if ( v3->source.m_ptr )
    {
      source = 0i64;
      p_m_strongCount = &v3->source.m_ref->m_strongCount;
      if ( p_m_strongCount )
      {
        v9 = *p_m_strongCount;
        if ( *p_m_strongCount )
        {
          while ( AgAtomicCompareExchange(p_m_strongCount, v9, v9 + 1) != v9 )
          {
            v9 = *p_m_strongCount;
            if ( !*p_m_strongCount )
              goto LABEL_19;
          }
          if ( v9 != -1 )
            source = v3->source;
        }
      }
LABEL_19:
      AgSession::pauseUser((AgSession *)AgSingleton<AgAudioManager>::ms_instance, (AgPointer<AgUser> *)&source);
      v10 = v3->source.m_ref;
      v11 = v3->source.m_ptr;
      v3->source.m_ref = 0i64;
      v3->source.m_ptr = 0i64;
      if ( v10 )
      {
        v12 = 0;
        if ( !AgAtomicDecrement(&v10->m_strongCount) )
        {
          if ( !AgAtomicDecrement(&v10->m_weakCount) )
            v12 = 1;
          v10->m_data = 0i64;
          if ( v11 )
            ((void (__fastcall *)(AgAudioSource *, __int64))v11->~AgAudioSource)(v11, 1i64);
          if ( v12 )
            AgReferenceCount::operator delete(v10);
        }
      }
    }
    v13 = Fw::VoiceChat::m_VoiceQos;
    while ( !v13->bConnected )
    {
      if ( (__int64)++v13 >= (__int64)&Fw::VoiceChat::m_VoiceChatMutex )
      {
        v14 = SteamInternal_ContextInit(&`SteamInternal_ModuleContext'::`2'::s_CallbackCounterAndContext, a2);
        (*(void (__fastcall **)(_QWORD))(**(_QWORD **)(v14 + 8) + 64i64))(*(_QWORD *)(v14 + 8));
        break;
      }
    }
  }
}

void __fastcall Fw::VoiceChat::delConnect(char idx, __int64 a2)
{
  Fw::VoiceChat::VoiceQos *v2; // rbx
  Fw::VoiceChat::VoiceQos *v3; // rdi
  AgAudioChannel *m_ptr; // rcx
  KOFApplication *v5; // rax
  AgPointer<AgUser> *v6; // rax
  KOFApplication *v7; // rax
  __int64 v8; // rax
  AgPointer<KOFApplication> v9; // [rsp+20h] [rbp-18h] BYREF

  v2 = Fw::VoiceChat::m_VoiceQos;
  v3 = &Fw::VoiceChat::m_VoiceQos[idx];
  m_ptr = v3->channel.m_ptr;
  v3->bConnected = 0;
  if ( m_ptr )
  {
    AgAudioChannel::stop(m_ptr);
    v5 = (KOFApplication *)v3->channel.m_ptr;
    v9.m_ref = v3->channel.m_ref;
    v3->channel.m_ref = 0i64;
    v3->channel.m_ptr = 0i64;
    v9.m_ptr = v5;
    AgPointer<AgUser>::~AgPointer<AgUser>(&v9);
  }
  if ( v3->source.m_ptr )
  {
    AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>(
      (AgPointer<AgPlayer> *)&v9,
      (const AgPointer<AgPlayer> *)&v3->source);
    AgSession::pauseUser((AgSession *)AgSingleton<AgAudioManager>::ms_instance, v6);
    v7 = (KOFApplication *)v3->source.m_ptr;
    v9.m_ref = v3->source.m_ref;
    v3->source.m_ref = 0i64;
    v3->source.m_ptr = 0i64;
    v9.m_ptr = v7;
    AgPointer<AgUser>::~AgPointer<AgUser>(&v9);
  }
  while ( !v2->bConnected )
  {
    if ( (__int64)++v2 >= (__int64)&Fw::VoiceChat::m_VoiceChatMutex )
    {
      v8 = SteamInternal_ContextInit(&`SteamInternal_ModuleContext'::`2'::s_CallbackCounterAndContext, a2);
      (*(void (__fastcall **)(_QWORD))(**(_QWORD **)(v8 + 8) + 64i64))(*(_QWORD *)(v8 + 8));
      return;
    }
  }
}

char __fastcall Fw::VoiceChat::getVoiceMessage(char idx, unsigned __int8 *dataBuf, unsigned int *bufSize)
{
  Fw::VoiceChat::VoiceQos *v5; // rbx
  unsigned int v6; // eax
  const void *v8; // rdx

  if ( Fw::VoiceChat::m_bMutedMic )
    return 0;
  v5 = &Fw::VoiceChat::m_VoiceQos[idx];
  if ( !v5->bConnected || *(_WORD *)&v5->bStateMute || !v5->bConnected )
    return 0;
  v6 = Fw::VoiceChat::m_bufferWritten;
  v8 = Fw::VoiceChat::m_pBuffer;
  if ( *bufSize < Fw::VoiceChat::m_bufferWritten )
    v6 = *bufSize;
  *bufSize = v6;
  memmove(dataBuf, v8, v6);
  if ( !*bufSize )
    return 0;
  ++v5->sendCount;
  return 1;
}

char __fastcall Fw::VoiceChat::setVoiceMessage(char idx, unsigned __int8 *dataBuf, unsigned int *bufSize)
{
  Fw::VoiceChat::VoiceQos *v5; // rbp
  __int64 v6; // rbx
  __int64 v7; // rdx
  __int64 *v8; // rdi
  __int64 v9; // rsi
  int v10; // eax
  AgMemoryStream *v11; // rax
  AgMemoryStream *v12; // rax
  AgMemoryStream *m_ptr; // rdi
  int ReferenceCounter; // eax
  AgReferenceCount *m_refCount; // rbx
  AgPointer<AgStream> *v16; // rax
  AgPointer<AgMemoryStream> v18; // [rsp+48h] [rbp-40h] BYREF
  AgPointer<AgStream> result; // [rsp+58h] [rbp-30h] BYREF

  if ( Fw::VoiceChat::m_bMutedSpeakers )
    return 0;
  v5 = &Fw::VoiceChat::m_VoiceQos[idx];
  if ( !v5->bConnected )
    return 0;
  if ( *(_WORD *)&v5->bStateMute )
    return 0;
  v6 = *(_QWORD *)(SteamInternal_ContextInit(&`SteamInternal_ModuleContext'::`2'::s_CallbackCounterAndContext, dataBuf)
                 + 8);
  v8 = *(__int64 **)(SteamInternal_ContextInit(&`SteamInternal_ModuleContext'::`2'::s_CallbackCounterAndContext, v7) + 8);
  v9 = *v8;
  v10 = (*(__int64 (__fastcall **)(__int64))(*(_QWORD *)v6 + 96i64))(v6);
  if ( (*(unsigned int (__fastcall **)(__int64 *, unsigned __int8 *, _QWORD, void *, int, unsigned int *, int))(v9 + 88))(
         v8,
         dataBuf,
         *bufSize,
         Fw::VoiceChat::m_pDecompressBuffer,
         22528,
         bufSize,
         v10) )
  {
    return 0;
  }
  if ( v5->source.m_ptr )
  {
    v11 = (AgMemoryStream *)AgMemoryPoolImpl<AgMutex,AgMutex>::_alloc(&AgMemoryStream::s_pool);
    if ( v11 )
    {
      AgMemoryStream::AgMemoryStream(v11);
      m_ptr = v12;
    }
    else
    {
      m_ptr = 0i64;
    }
    v18 = 0i64;
    if ( m_ptr )
    {
      ReferenceCounter = AgReferencedObject::createReferenceCounter(&m_ptr->AgReferencedObject, m_ptr);
      m_refCount = m_ptr->m_refCount;
      if ( !ReferenceCounter )
        AgReferenceCount::incRef(m_ptr->m_refCount);
      v18.m_ref = m_refCount;
      v18.m_ptr = m_ptr;
    }
    else
    {
      m_ptr = v18.m_ptr;
    }
    m_ptr->write(m_ptr, (const unsigned __int8 *)Fw::VoiceChat::m_pDecompressBuffer, *bufSize);
    v16 = AgPointer<AgMemoryStream>::operator<AgStream> AgPointer<AgStream>(&v18, &result);
    AgAudioSource::pushRuntimeStream(v5->source.m_ptr, v16);
    if ( !AgAudioChannel::getIsPlaying(v5->channel.m_ptr) )
      AgAudioChannel::play(v5->channel.m_ptr, 1u);
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&v18);
  }
  ++v5->recvCount;
  return 1;
}

