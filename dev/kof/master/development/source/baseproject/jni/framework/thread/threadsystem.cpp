#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/globalheapmemory.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/fixmemory.h"
#include "dev/silverware/git/sdk/input/agsdlmappingparser.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/matrix4unaligned.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/quat_aos.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_refcount.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_memory.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_memoryheap.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_stats.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_timer.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_sse.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steamclientpublic.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_types.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/variableheapmemorybase.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector2unaligned.h"
#include "dev/silverware/git/sdk/agmemorystream.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_sysalloc.h"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_functions.h"
#include "dev/silverware/git/sdk/input/agcontrollerbuttoncomponent.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_threads.h"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_types.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/physicalheapmemory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "dev/silverware/git/sdk/agsemaphore.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "dev/silverware/git/sdk/agsemaphore.inl"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/deque"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_allocinfo.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/boolinvec.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/thread/jobmanager.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/windows kits/8.1/include/shared/guiddef.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector3unaligned.h"
#include "program files (x86)/windows kits/8.1/include/shared/stralign.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/util/resourcemanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "dev/silverware/git/sdk/3rdparty/steam/isteamhtmlsurface.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/vec_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/list"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/boolinvec.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/vectormath_aos.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "program files (x86)/windows kits/8.1/include/um/winnt.h"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "dev/silverware/git/sdk/agpointer.h"
#include "program files (x86)/windows kits/8.1/include/shared/basetsd.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/heapmh/heapmh_sysallocmalloc.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/mat_aos.h"
#include "dev/silverware/git/sdk/agthread.h"
#include "dev/silverware/git/sdk/agmutex.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/array"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steam_api_internal.h"
#include "dev/kof/master/development/source/ps4project/baseproject/pcutil/pccontrolsmanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/algorithm"
#include "dev/silverware/git/sdk/input/aginputmanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector4unaligned.h"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/vecidx_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "program files (x86)/windows kits/8.1/include/um/winuser.h"
#include "dev/silverware/git/sdk/memory/agallocators.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/floatinvec.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "dev/silverware/git/sdk/input/agcontrollercomponent.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steam_api.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "dev/kof/master/development/source/ps4project/baseproject/pcutil/pcdummy.h"
#include "dev/silverware/git/sdk/util/agdelegate.h"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/quat_aos.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/floatinvec.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "dev/silverware/git/sdk/agvector2.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_vec64.h"
#include "dev/silverware/git/sdk/agmath.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_array.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_allocator.h"
#include "dev/silverware/git/sdk/input/agcontroller.h"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_atomic.h"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_math.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "dev/kof/master/development/source/baseproject/jni/framework/libcommon.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/vec_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "dev/silverware/git/sdk/3rdparty/steam/matchmakingtypes.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "program files (x86)/windows kits/8.1/include/um/winbase.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/mat_aos.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/debug/logging.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/heapmemory.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/thread/mutex.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "dev/kof/master/development/source/baseproject/jni/framework/thread/mutex.cpp"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/heapmemory.cpp"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/replace.cpp"

bool Fw::ThreadSystem::Startup(Fw::HeapMemory & rHeap); // 0x1400950A0
void Fw::ThreadSystem::Shutdown(); // 0x140095210
Fw::THREAD_HANDLE Fw::ThreadSystem::Create(void(*rFunc)(void *), void * pParam, const char * name, unsigned long long * mask, const unsigned long opt); // 0x1400952F0
unsigned long Fw::ThreadSystem::ThreadProcAlt(void * pAltParam); // 0x1400953C0
Fw::ThreadSystem::cWork * Fw::ThreadSystem::GetCurrentWork(); // 0x140095440
class WorkerThreadHost :
	AgSimpleThreadHost
{
public:
	WorkerThreadHost(WorkerThreadHost &);
	WorkerThreadHost(const WorkerThreadHost &);
	WorkerThreadHost(void *);
	virtual void onExecuteThread();
private:
	void * m_pWork; // 0x10
public:
	virtual ~WorkerThreadHost();
	WorkerThreadHost & operator=(WorkerThreadHost &);
	WorkerThreadHost & operator=(const WorkerThreadHost &);
};
std::piecewise_construct_t std::piecewise_construct; // 0x14088A4E2
void(*??m_Mutex$initializer$@ThreadSystem@Fw@@0P6AXXZEA@@3P6AXXZEA)(); // 0x1407407A0
void WorkerThreadHost::onExecuteThread(); // 0x1400954C0
bool Fw::ThreadSystem::BeginWork(Fw::ThreadSystem::cWork * pWork, const char * name); // 0x140095510//decompilation failure at 14088A4E2!
//decompilation failure at 1407407A0!
void __fastcall AgPointer<AgController>::AgPointer<AgController>(AgPointer<AgMemoryStream> *this)
{
  this->m_ref = 0i64;
  this->m_ptr = 0i64;
}

void __fastcall AgPointer<AgUser>::~AgPointer<AgUser>(AgPointer<KOFApplication> *this)
{
  KOFApplication *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v3; // esi

  m_ptr = this->m_ptr;
  this->m_ptr = 0i64;
  m_ref = this->m_ref;
  if ( this->m_ref )
  {
    this->m_ref = 0i64;
    v3 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v3 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
        ((void (__fastcall *)(KOFApplication *, __int64))m_ptr->~AgIThreadHost)(m_ptr, 1i64);
      if ( v3 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
}

void __fastcall Scaleform::Lock::Unlock(Scaleform::Lock *this)
{
  LeaveCriticalSection(this->cs);
}

AgPointer<AgController> *__fastcall AgPointer<AgThread>::operator=(AgPointer<AgController> *this, AgController *t)
{
  AgController *m_ptr; // rdi
  int ReferenceCounter; // eax
  AgReferenceCount *m_refCount; // rbx
  AgController *v6; // rax
  AgPointer<KOFApplication> v8; // [rsp+20h] [rbp-18h] BYREF

  m_ptr = t;
  v8 = 0i64;
  if ( t )
  {
    ReferenceCounter = AgReferencedObject::createReferenceCounter(&t->AgReferencedObject, t);
    m_refCount = m_ptr->m_refCount;
    if ( !ReferenceCounter )
      AgReferenceCount::incRef(m_ptr->m_refCount);
  }
  else
  {
    m_ptr = (AgController *)v8.m_ptr;
    m_refCount = v8.m_ref;
  }
  v6 = this->m_ptr;
  v8.m_ref = this->m_ref;
  this->m_ref = m_refCount;
  this->m_ptr = m_ptr;
  v8.m_ptr = (KOFApplication *)v6;
  AgPointer<AgUser>::~AgPointer<AgUser>(&v8);
  return this;
}

char __fastcall Fw::ThreadSystem::BeginWork(Fw::ThreadSystem::cWork *pWork, const char *name)
{
  AgIThreadHost *v3; // rbx
  AgController *v4; // rax
  AgThread *v6; // [rsp+58h] [rbp+10h]

  v3 = (AgIThreadHost *)operator new(0x18ui64);
  v3->__vftable = (AgIThreadHost_vtbl *)&AgSimpleThreadHost::`vftable';
  LODWORD(v3[1].__vftable) = 0;
  HIDWORD(v3[1].__vftable) = 1;
  v3->__vftable = (AgIThreadHost_vtbl *)&WorkerThreadHost::`vftable';
  v3[2].__vftable = (AgIThreadHost_vtbl *)pWork;
  v6 = (AgThread *)operator new(0x28ui64);
  AgThread::AgThread(v6, v3, 0x100000ui64, -1, "EffectThread");
  AgPointer<AgThread>::operator=((AgPointer<AgController> *)&pWork->m_ThreadId, v4);
  return 1;
}

__int64 __fastcall Fw::ThreadSystem::Create(
        void (__fastcall *rFunc)(void *),
        void *pParam,
        const char *name,
        unsigned __int64 *mask)
{
  unsigned int v5; // edi
  unsigned int v6; // eax
  const char *v7; // rdx
  Fw::ThreadSystem::cWork **v8; // rcx
  Fw::ThreadSystem::cWork *v9; // rbx
  unsigned int v10; // esi

  EnterCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
  v5 = 0;
  if ( !Fw::ThreadSystem::m_AllThreadCleanupFlag )
  {
    v6 = 0;
    v7 = (const char *)(unsigned int)Fw::ThreadSystem::m_WorkNum;
    if ( (_DWORD)Fw::ThreadSystem::m_WorkNum )
    {
      v8 = Fw::ThreadSystem::m_pWork;
      while ( 1 )
      {
        v9 = *v8;
        if ( (*v8)->m_Handle == THREAD_HANDLE_INVALID )
          break;
        ++v6;
        ++v8;
        if ( v6 >= (unsigned int)Fw::ThreadSystem::m_WorkNum )
          goto LABEL_13;
      }
      if ( v9 )
      {
        v10 = Fw::ThreadSystem::m_CycleThreadHandle + 1;
        if ( Fw::ThreadSystem::m_CycleThreadHandle == -1 )
          v10 = 1;
        Fw::ThreadSystem::m_CycleThreadHandle = v10;
        v9->m_Handle = v10;
        v9->m_pFunc = Fw::cJobManager::jobThread;
        v9->m_pParam = pParam;
        if ( Fw::ThreadSystem::BeginWork(v9, v7) )
          v5 = v10;
        else
          v9->m_Handle = THREAD_HANDLE_INVALID;
      }
    }
  }
LABEL_13:
  LeaveCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
  return v5;
}

Fw::ThreadSystem::cWork *__fastcall Fw::ThreadSystem::GetCurrentWork()
{
  unsigned __int64 CurrentId; // rax
  unsigned int v1; // edx
  __int64 v2; // rbx
  unsigned __int64 v3; // rdi
  Fw::ThreadSystem::cWork *v4; // rcx

  CurrentId = AgThread::getCurrentId();
  v1 = (unsigned int)Fw::ThreadSystem::m_WorkNum;
  v2 = 0i64;
  v3 = CurrentId;
  if ( !(_DWORD)Fw::ThreadSystem::m_WorkNum )
    return 0i64;
  while ( 1 )
  {
    v4 = Fw::ThreadSystem::m_pWork[v2];
    if ( v4->m_Handle )
      break;
LABEL_5:
    v2 = (unsigned int)(v2 + 1);
    if ( (unsigned int)v2 >= v1 )
      return 0i64;
  }
  if ( AgThread::getId(v4->m_ThreadId.m_ptr) != v3 )
  {
    v1 = (unsigned int)Fw::ThreadSystem::m_WorkNum;
    goto LABEL_5;
  }
  return Fw::ThreadSystem::m_pWork[v2];
}

void Fw::ThreadSystem::Shutdown(void)
{
  unsigned int v0; // ecx
  unsigned int i; // ebx
  unsigned int v2; // ebx
  void **v3; // rdi

  EnterCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
  Fw::ThreadSystem::m_AllThreadCleanupFlag = 1;
  LeaveCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
  v0 = (unsigned int)Fw::ThreadSystem::m_WorkNum;
  for ( i = 0; i < (unsigned int)Fw::ThreadSystem::m_WorkNum; ++i )
  {
    EnterCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
    LeaveCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
    v0 = (unsigned int)Fw::ThreadSystem::m_WorkNum;
  }
  v2 = 0;
  if ( v0 )
  {
    do
    {
      v3 = (void **)&Fw::ThreadSystem::m_pWork[v2];
      if ( *v3 )
      {
        aligned_free(*v3);
        v0 = (unsigned int)Fw::ThreadSystem::m_WorkNum;
        *v3 = 0i64;
      }
      ++v2;
    }
    while ( v2 < v0 );
    Fw::ThreadSystem::m_Mutex.m_InitializeFlag = 0;
    LODWORD(Fw::ThreadSystem::m_WorkNum) = 0;
  }
  else
  {
    Fw::ThreadSystem::m_Mutex.m_InitializeFlag = 0;
    LODWORD(Fw::ThreadSystem::m_WorkNum) = 0;
  }
}

char __fastcall Fw::ThreadSystem::Startup(Fw::HeapMemory *rHeap)
{
  int v1; // ebx
  Fw::ThreadSystem::cWork **v2; // rdi
  Fw::ThreadSystem::cWork *v3; // rax
  unsigned int v4; // edi
  __int64 v5; // r15
  Fw::ThreadSystem::cWork *v6; // rax
  AgReferenceCount *m_ref; // rbx
  AgThread *m_ptr; // rsi
  int v9; // ebp
  Fw::ThreadSystem::cWork *v10; // rax

  if ( Fw::ThreadSystem::m_Mutex.m_InitializeFlag )
    return 0;
  Fw::ThreadSystem::m_Mutex.m_InitializeFlag = 1;
  if ( (_DWORD)Fw::ThreadSystem::m_WorkNum )
    return 0;
  v1 = 0;
  v2 = Fw::ThreadSystem::m_pWork;
  do
  {
    v3 = (Fw::ThreadSystem::cWork *)aligned_malloc(0x28ui64, 0x20ui64);
    if ( v3 )
    {
      v3->m_ThreadId.m_ref = 0i64;
      v3->m_ThreadId.m_ptr = 0i64;
    }
    else
    {
      v3 = 0i64;
    }
    *v2 = v3;
    if ( !v3 )
    {
      Fw::ThreadSystem::Shutdown();
      return 0;
    }
    ++v1;
    ++v2;
  }
  while ( v1 < 16 );
  LODWORD(Fw::ThreadSystem::m_WorkNum) = 16;
  v4 = 0;
  do
  {
    v5 = v4;
    v6 = Fw::ThreadSystem::m_pWork[v5];
    v6->m_Handle = THREAD_HANDLE_INVALID;
    m_ref = v6->m_ThreadId.m_ref;
    m_ptr = v6->m_ThreadId.m_ptr;
    v6->m_ThreadId.m_ref = 0i64;
    v6->m_ThreadId.m_ptr = 0i64;
    if ( m_ref )
    {
      v9 = 0;
      if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
      {
        if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
          v9 = 1;
        m_ref->m_data = 0i64;
        if ( m_ptr )
          ((void (__fastcall *)(AgThread *, __int64))m_ptr->~AgThread)(m_ptr, 1i64);
        if ( v9 )
          AgReferenceCount::operator delete(m_ref);
      }
    }
    v10 = Fw::ThreadSystem::m_pWork[v5];
    v10->m_pFunc = 0i64;
    v10->m_pParam = 0i64;
    ++v4;
  }
  while ( v4 < (unsigned int)Fw::ThreadSystem::m_WorkNum );
  Fw::ThreadSystem::m_CycleThreadHandle = 0;
  Fw::ThreadSystem::m_AllThreadCleanupFlag = 0;
  return 1;
}

__int64 __fastcall Fw::ThreadSystem::ThreadProcAlt(void *pAltParam)
{
  void (__fastcall *v2)(__int64); // rdi
  __int64 v3; // rbx
  Fw::ThreadSystem::cWork *CurrentWork; // rax

  EnterCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
  v2 = (void (__fastcall *)(__int64))*((_QWORD *)pAltParam + 3);
  v3 = *((_QWORD *)pAltParam + 4);
  LeaveCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
  v2(v3);
  EnterCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
  CurrentWork = Fw::ThreadSystem::GetCurrentWork();
  if ( CurrentWork )
    CurrentWork->m_Handle = THREAD_HANDLE_INVALID;
  LeaveCriticalSection((LPCRITICAL_SECTION)&Fw::ThreadSystem::m_Mutex);
  return 0i64;
}

void __fastcall WorkerThreadHost::onExecuteThread(WorkerThreadHost *this)
{
  Fw::ThreadSystem::ThreadProcAlt(this->m_pWork);
  this->m_running = 0;
}

