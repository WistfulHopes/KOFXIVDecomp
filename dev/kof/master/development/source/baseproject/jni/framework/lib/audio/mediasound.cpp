#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/globalheapmemory.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/fixmemory.h"
#include "dev/silverware/git/sdk/input/agsdlmappingparser.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/matrix4unaligned.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/quat_aos.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_refcount.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_memory.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_memoryheap.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_stats.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_timer.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_sse.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steamclientpublic.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_types.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "dev/silverware/git/sdk/util/agservicecommand.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/variableheapmemorybase.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector2unaligned.h"
#include "dev/silverware/git/sdk/util/agdebugchannels.h"
#include "dev/silverware/git/sdk/util/agperformancecounter.h"
#include "dev/silverware/git/sdk/agclock.h"
#include "dev/silverware/git/sdk/agmemorystream.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_sysalloc.h"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_functions.h"
#include "dev/silverware/git/sdk/input/agcontrollerbuttoncomponent.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_threads.h"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_types.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/physicalheapmemory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "dev/silverware/git/sdk/agsemaphore.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "dev/silverware/git/sdk/agsemaphore.inl"
#include "dev/silverware/git/sdk/agconditionvariable.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/condition_variable"
#include "dev/silverware/git/sdk/agcondition.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/lib/audio/mediasound.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/deque"
#include "dev/silverware/git/sdk/filesystem/agfile.h"
#include "dev/silverware/git/sdk/filesystem/agpath.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/silverware/git/sdk/filesystem/agmount.h"
#include "dev/silverware/git/sdk/filesystem/agdirectory.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_allocinfo.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/boolinvec.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/thread/jobmanager.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/windows kits/8.1/include/shared/guiddef.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector3unaligned.h"
#include "program files (x86)/windows kits/8.1/include/shared/stralign.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/util/resourcemanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "dev/silverware/git/sdk/3rdparty/steam/isteamhtmlsurface.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/vec_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/list"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/boolinvec.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "dev/silverware/git/sdk/agcondition.inl"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/vectormath_aos.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "program files (x86)/windows kits/8.1/include/um/winnt.h"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "dev/silverware/git/sdk/agpointer.h"
#include "dev/silverware/git/sdk/system/agusermanager.h"
#include "program files (x86)/windows kits/8.1/include/shared/basetsd.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/heapmh/heapmh_sysallocmalloc.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "dev/silverware/git/sdk/util/agservice.h"
#include "dev/silverware/git/sdk/agthreadpool.h"
#include "dev/silverware/git/sdk/agconditionvariable.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/mat_aos.h"
#include "dev/silverware/git/sdk/agthread.h"
#include "dev/silverware/git/sdk/agmutex.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/array"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steam_api_internal.h"
#include "dev/kof/master/development/source/ps4project/baseproject/pcutil/pccontrolsmanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/algorithm"
#include "dev/silverware/git/sdk/input/aginputmanager.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector4unaligned.h"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/vecidx_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "program files (x86)/windows kits/8.1/include/um/winuser.h"
#include "dev/silverware/git/sdk/memory/agallocators.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/floatinvec.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "dev/silverware/git/sdk/input/agcontrollercomponent.h"
#include "dev/silverware/git/sdk/3rdparty/steam/steam_api.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "dev/kof/master/development/source/ps4project/baseproject/pcutil/pcdummy.h"
#include "dev/silverware/git/sdk/util/agdelegate.h"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/lib/audio/mediamanager.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/quat_aos.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/floatinvec.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/lib/audio/audiopresenter.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "dev/silverware/git/sdk/agvector2.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "dev/kof/master/development/source/baseproject/jni/framework/lib/etc/math.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_vec64.h"
#include "dev/silverware/git/sdk/agmath.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_array.h"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_allocator.h"
#include "dev/silverware/git/sdk/input/agcontroller.h"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "dev/kof/master/development/source/middleware/autodesk/scaleform/gfx_sdk/src/kernel/sf_atomic.h"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_math.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "dev/silverware/git/sdk/agsharedinstance.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "dev/kof/master/development/source/baseproject/jni/framework/libcommon.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/vec_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "dev/silverware/git/sdk/3rdparty/steam/matchmakingtypes.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "program files (x86)/windows kits/8.1/include/um/winbase.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/mat_aos.h"
#include "dev/silverware/git/sdk/agreferenceinl.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/debug/logging.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/memory/heapmemory.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/thread/mutex.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "dev/kof/master/development/source/baseproject/jni/framework/libcommon.cpp"
#include "dev/kof/master/development/source/baseproject/jni/framework/util/cfile.cpp"

std::piecewise_construct_t std::piecewise_construct; // 0x140888B18
unsigned long getHashCode(const char * s); // 0x1400392D0
CMediaSound::CMediaSound(); // 0x1400393C0
void CMediaSound::finalize(); // 0x140039480
unsigned char CMediaSound::CreatePlayerFromFile(const _SND_BANK_DATA * bank, const char * filename, long searchType, unsigned char bUseThread); // 0x140039570//decompilation failure at 140888B18!
void __fastcall AgPointer<AgSharedInstance<AgMutex>>::AgPointer<AgSharedInstance<AgMutex>>(
        AgPointer<AgSharedInstance<AgMutex> > *this,
        const AgPointer<AgSharedInstance<AgMutex> > *rhs)
{
  AgReferenceCount *m_ref; // rdi
  int m_strongCount; // ebx

  m_ref = rhs->m_ref;
  m_strongCount = rhs->m_ref->m_strongCount;
  if ( m_strongCount )
  {
    while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
    {
      m_strongCount = m_ref->m_strongCount;
      if ( !m_ref->m_strongCount )
        return;
    }
    if ( m_strongCount != -1 )
    {
      this->m_ref = rhs->m_ref;
      this->m_ptr = rhs->m_ptr;
    }
  }
}

void __fastcall CMediaSound::CMediaSound(CMediaSound *this)
{
  char *v2; // [rsp+58h] [rbp+10h]

  this->m_ThreadMutex.m_ref = 0i64;
  this->m_ThreadMutex.m_ptr = 0i64;
  this->m_BankInfo.bufferPtr = 0i64;
  this->m_BankInfo.freq = 0.0;
  this->m_BankInfo.bufferID = 0;
  this->m_BankInfo.originPtr = 0i64;
  this->m_BankInfo.end = 0.0;
  this->m_ThreadState = 0i64;
  memset(this, 0, 0x100ui64);
  v2 = (char *)operator new(0x30ui64);
  *((_QWORD *)v2 + 1) = 0i64;
  *((_QWORD *)v2 + 2) = 0i64;
  *((_QWORD *)v2 + 3) = 0i64;
  *((_QWORD *)v2 + 4) = 0i64;
  *((_QWORD *)v2 + 5) = 0i64;
  *(_QWORD *)v2 = 0i64;
  InitializeCriticalSection((LPCRITICAL_SECTION)(v2 + 8));
  AgPointer<AgSharedInstance<AgMutex>>::operator=(&this->m_ThreadMutex, (AgSharedInstance<AgMutex> *)v2);
}

void __fastcall AgPointer<AgSharedInstance<AgMutex>>::~AgPointer<AgSharedInstance<AgMutex>>(
        AgPointer<AgSharedInstance<AgMutex> > *this)
{
  AgSharedInstance<AgMutex> *m_ptr; // rdi
  AgReferenceCount *m_ref; // rbx
  int v3; // esi

  m_ptr = this->m_ptr;
  this->m_ptr = 0i64;
  m_ref = this->m_ref;
  if ( this->m_ref )
  {
    this->m_ref = 0i64;
    v3 = 0;
    if ( !AgAtomicDecrement(&m_ref->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&m_ref->m_weakCount) )
        v3 = 1;
      m_ref->m_data = 0i64;
      if ( m_ptr )
      {
        DeleteCriticalSection((LPCRITICAL_SECTION)&m_ptr->m_object);
        operator delete(m_ptr, 0x30ui64);
      }
      if ( v3 )
        AgReferenceCount::operator delete(m_ref);
    }
  }
}

AgPointer<AgSharedInstance<AgMutex> > *__fastcall AgPointer<AgSharedInstance<AgMutex>>::operator=(
        AgPointer<AgSharedInstance<AgMutex> > *this,
        AgSharedInstance<AgMutex> *t)
{
  AgSharedInstance<AgMutex> *m_ptr; // rbx
  int ReferenceCounter; // eax
  AgReferenceCount *m_refCount; // rsi
  AgSharedInstance<AgMutex> *v6; // rax
  AgPointer<AgSharedInstance<AgMutex> > v8; // [rsp+20h] [rbp-18h] BYREF

  m_ptr = t;
  v8 = 0i64;
  if ( t )
  {
    ReferenceCounter = AgReferencedObject::createReferenceCounter(t, t);
    m_refCount = m_ptr->m_refCount;
    if ( !ReferenceCounter )
      AgReferenceCount::incRef(m_ptr->m_refCount);
  }
  else
  {
    m_ptr = v8.m_ptr;
    m_refCount = v8.m_ref;
  }
  v6 = this->m_ptr;
  v8.m_ref = this->m_ref;
  this->m_ref = m_refCount;
  this->m_ptr = m_ptr;
  v8.m_ptr = v6;
  AgPointer<AgSharedInstance<AgMutex>>::~AgPointer<AgSharedInstance<AgMutex>>(&v8);
  return this;
}

unsigned __int8 __fastcall CMediaSound::CreatePlayerFromFile(
        CMediaSound *this,
        const _SND_BANK_DATA *bank,
        const char *filename,
        int searchType)
{
  int v7; // esi
  int v8; // er8
  int v9; // er9
  __int64 v10; // rax
  __int64 v11; // rdx
  unsigned __int64 v12; // rdx
  int v13; // ebx
  AgMutex *p_m_object; // r15
  int *v15; // rax
  AgPointer<AgSharedInstance<AgMutex> > *v16; // rcx
  AgPointer<AgSharedInstance<AgMutex> > *v17; // rax
  int v18; // edx
  __int16 *v19; // rbx
  int v20; // er14
  __int16 v21; // ax
  int v22; // er14
  int v23; // er9
  int v24; // ecx
  int v25; // eax
  int v26; // er8
  __int64 v27; // rax
  int v28; // edx
  int v29; // ecx
  int v30; // edx
  int v31; // er11
  float v32; // xmm2_4
  int v33; // er8
  float start; // xmm1_4
  unsigned __int8 *buf; // [rsp+48h] [rbp-21h] BYREF
  __int128 v37; // [rsp+50h] [rbp-19h] BYREF
  int v38; // [rsp+60h] [rbp-9h] BYREF
  int v39; // [rsp+68h] [rbp-1h] BYREF
  AgPointer<AgSharedInstance<AgMutex> > v40; // [rsp+70h] [rbp+7h] BYREF
  __int64 v41; // [rsp+80h] [rbp+17h]
  int v42; // [rsp+88h] [rbp+1Fh]
  AgMutex *v43; // [rsp+90h] [rbp+27h]

  v41 = -2i64;
  v7 = 0;
  buf = 0i64;
  this->m_oggFlg = 0;
  CMediaSound::finalize(this);
  v37 = 0ui64;
  v10 = -1i64;
  do
    ++v10;
  while ( filename[v10] );
  v11 = (int)v10 - 4;
  if ( *(_DWORD *)&filename[v11] == *(_DWORD *)".ogg" )
  {
    v13 = CFile::ResourceDataLoaderNew(filename, v11, v8, v9, &buf);
    if ( v13 )
    {
      this->m_oggFlg = 1;
      *(_QWORD *)&v37 = 0i64;
      p_m_object = &this->m_ThreadMutex.m_ptr->m_object;
      v43 = p_m_object;
      EnterCriticalSection((LPCRITICAL_SECTION)p_m_object);
      v42 = 1;
      v15 = (int *)operator new(4ui64);
      this->m_ThreadState = v15;
      *v15 = 1;
      v40 = 0i64;
      v16 = &v40;
      if ( this->m_ThreadMutex.m_ref )
      {
        AgPointer<AgSharedInstance<AgMutex>>::AgPointer<AgSharedInstance<AgMutex>>(&v40, &this->m_ThreadMutex);
        v16 = v17;
      }
      v18 = v13;
      v19 = (__int16 *)buf;
      v20 = stb_vorbis_decode_memory_plus(
              buf,
              v18,
              &v38,
              &v39,
              &this->m_ThreadState,
              &this->m_LoadCount,
              v16,
              (__int16 **)&v37);
      LeaveCriticalSection((LPCRITICAL_SECTION)p_m_object);
      if ( v20 > 0 )
      {
        v21 = v38;
        v22 = 2 * v38 * v20;
        v23 = v39;
        v12 = 16i64;
        v24 = 0;
        v19 = (__int16 *)v37;
        goto LABEL_20;
      }
      goto $_ERROR;
    }
    goto LABEL_31;
  }
  v25 = CFile::ResourceDataLoaderNew(filename, v11, v8, v9, &buf);
  v26 = v25;
  if ( !v25 )
  {
LABEL_31:
    v19 = (__int16 *)buf;
    goto $_ERROR;
  }
  this->m_ThreadState = 0i64;
  v19 = (__int16 *)buf;
  if ( *(_DWORD *)buf != 1179011410 )
    goto $_ERROR;
  v12 = 12i64;
  if ( *((_DWORD *)buf + 2) != 1163280727 || v25 <= 12 )
    goto $_ERROR;
  while ( 1 )
  {
    v27 = (int)v12;
    v28 = v12 + 4;
    if ( *(_DWORD *)&buf[v27] != *(_DWORD *)"fmt " )
      break;
    v29 = *(_DWORD *)&buf[v28];
    v30 = v28 + 4;
    v37 = *(_OWORD *)&buf[v30];
    v12 = (unsigned int)(v29 + v30);
LABEL_17:
    if ( (int)v12 >= v26 )
      goto $_ERROR;
  }
  if ( *(_DWORD *)&buf[v27] != *(_DWORD *)"data" )
  {
    v12 = (unsigned int)(*(_DWORD *)&buf[v28] + v28 + 4);
    goto LABEL_17;
  }
  v22 = *(_DWORD *)&buf[v28];
  v24 = v28 + 4;
  v12 = HIWORD(v37);
  v23 = DWORD1(v37);
  v21 = WORD1(v37);
LABEL_20:
  if ( v22 )
  {
    v31 = v21 * (__int16)v12 / 8;
    this->m_BankInfo.sizeofsecond = v31 * v23;
    v32 = (float)(v31 * v23);
    v33 = (int)(float)(v32 * bank->end) - (int)(float)(v32 * bank->end) % v31;
    if ( v33 <= 0 || v33 > v22 )
      v33 = v22;
    if ( this->m_oggFlg )
    {
      this->m_BankInfo.originPtr = 0i64;
      this->m_BankInfo.bufferPtr = v19;
    }
    else
    {
      this->m_BankInfo.originPtr = (unsigned __int8 *)v19;
      this->m_BankInfo.bufferPtr = (__int16 *)((char *)v19 + v24);
    }
    start = bank->start;
    if ( bank->start <= 0.0 )
    {
      this->m_BankInfo.offset = 0.0;
      this->m_BankInfo.introSize = 0;
    }
    else
    {
      v7 = (int)(float)(start * v32) - (int)(float)(start * v32) % v31;
      this->m_BankInfo.offset = start;
      this->m_BankInfo.introSize = v7;
    }
    this->m_BankInfo.channel = v21;
    this->m_BankInfo.bufferSize = v33;
    this->m_BankInfo.loopSize = v33 - v7;
    this->m_BankInfo.freq = (float)v23;
    this->m_BankInfo.start = bank->start;
    this->m_BankInfo.end = (float)v33 / v32;
    this->m_BankInfo.loop = bank->loop;
    this->m_BankInfo.vol = bank->vol;
    this->m_BankInfo.total = (float)v22 / (float)(v31 * v23);
    return 1;
  }
$_ERROR:
  if ( this->m_oggFlg )
  {
    if ( v19 )
      operator delete(v19, v12);
  }
  else if ( v19 )
  {
    Framework::MemoryManager::release(&Framework::GLManager::glm->allocateSound, this->m_BankInfo.bufferPtr);
    this->m_BankInfo.bufferPtr = 0i64;
  }
  return 0;
}

__int64 __fastcall AgReferencedObject::createReferenceCounter(AgReferencedObject *this, void *thing)
{
  AgReferenceCount *v4; // rax

  if ( this->m_refCount )
    return 0i64;
  v4 = (AgReferenceCount *)AgReferenceCount::operator new(0x10ui64);
  if ( v4 )
  {
    v4->m_strongCount = 1;
    v4->m_weakCount = 1;
    v4->m_data = thing;
    this->m_refCount = v4;
  }
  else
  {
    this->m_refCount = 0i64;
  }
  return 1i64;
}

void __fastcall CMediaSound::finalize(CMediaSound *this)
{
  int *m_ThreadState; // rax
  unsigned __int8 *originPtr; // rdx
  __int16 *bufferPtr; // rdx
  CMediaSound *v5; // rax
  __int64 v6; // rdx
  CAudioPresenter *v7; // rcx

  if ( !this->m_BankInfo.bufferID )
    return;
  EnterCriticalSection((LPCRITICAL_SECTION)&this->m_ThreadMutex.m_ptr->m_object);
  m_ThreadState = this->m_ThreadState;
  if ( m_ThreadState )
  {
    *m_ThreadState = 0;
  }
  else
  {
    originPtr = this->m_BankInfo.originPtr;
    if ( originPtr )
    {
      Framework::MemoryManager::release(&Framework::GLManager::glm->allocateSound, originPtr);
      this->m_BankInfo.originPtr = 0i64;
    }
    else
    {
      bufferPtr = this->m_BankInfo.bufferPtr;
      if ( !bufferPtr )
        goto LABEL_9;
      Framework::MemoryManager::release(&Framework::GLManager::glm->allocateSound, bufferPtr);
    }
  }
  this->m_BankInfo.bufferPtr = 0i64;
LABEL_9:
  LeaveCriticalSection((LPCRITICAL_SECTION)&this->m_ThreadMutex.m_ptr->m_object);
  v5 = this;
  this->m_BankInfo.freq = 0.0;
  v6 = 32i64;
  do
  {
    v7 = v5->m_pRef[0];
    if ( v5->m_pRef[0] )
    {
      if ( v7->m_Sound == this )
        v7->m_Sound = 0i64;
      v5->m_pRef[0] = 0i64;
    }
    v5 = (CMediaSound *)((char *)v5 + 8);
    --v6;
  }
  while ( v6 );
  this->m_BankInfo.bufferID = 0;
}

__int64 __fastcall getHashCode(const char *s)
{
  unsigned __int64 v2; // r8
  __int64 v3; // rax
  int v4; // er11
  int v5; // ebp
  int v6; // esi
  unsigned __int64 v7; // r10
  const char *v8; // rbx
  __int64 v9; // rdi
  char v10; // cl
  int v11; // edx
  char v12; // cl

  if ( !s )
    return 0i64;
  v2 = -1i64;
  v3 = -1i64;
  do
    ++v3;
  while ( s[v3] );
  if ( !v3 )
    return 0i64;
  v4 = 0;
  v5 = 0;
  v6 = 0;
  do
    ++v2;
  while ( s[v2] );
  v7 = 0i64;
  if ( v2 >= 2 )
  {
    v8 = s + 1;
    v9 = -(__int64)s;
    do
    {
      v10 = v7 & 3;
      v7 += 2i64;
      v4 += *(v8 - 1) << (8 * v10);
      v11 = *v8;
      v12 = ((_BYTE)v8 + v9) & 3;
      v8 += 2;
      v6 += v11 << (8 * v12);
    }
    while ( v7 < v2 - 1 );
  }
  if ( v7 < v2 )
    v5 = s[v7] << (8 * (v7 & 3));
  return (unsigned int)(v5 + v6 + v4);
}

__int64 __fastcall AgReferenceCount::incRef(AgReferenceCount *this)
{
  int m_strongCount; // ebx

  m_strongCount = this->m_strongCount;
  if ( !this->m_strongCount )
    return 0i64;
  while ( AgAtomicCompareExchange(&this->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
  {
    m_strongCount = this->m_strongCount;
    if ( !this->m_strongCount )
      return 0i64;
  }
  return (unsigned int)(m_strongCount + 1);
}

