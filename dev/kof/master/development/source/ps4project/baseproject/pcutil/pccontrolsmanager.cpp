#include "program files (x86)/microsoft visual studio 14.0/vc/include/array"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/algorithm"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/boolinvec.h"
#include "dev/silverware/git/sdk/agreferencedobjectinl.h"
#include "dev/silverware/git/sdk/input/agcontrolleraxiscomponent.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xfacet"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector3unaligned.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/functional"
#include "dev/silverware/git/sdk/input/agsdlmappingparser.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/list"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory"
#include "dev/silverware/git/sdk/agstring.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtgmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtr1common"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/string"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_typeinfo.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdlib.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/ios"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/vec_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocnum"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/boolinvec.h"
#include "dev/silverware/git/sdk/input/agcontroller.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/stdexcept"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thr/xthread"
#include "dev/silverware/git/sdk/system/aguser.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/exception"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/type_traits"
#include "dev/silverware/git/sdk/agpointer.h"
#include "dev/silverware/git/sdk/util/agjsondata.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/vectormath_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xtree"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstddef"
#include "dev/silverware/git/sdk/agreferencedobject.h"
#include "dev/silverware/git/sdk/util/ageventdispatcher.h"
#include "dev/silverware/git/sdk/agreferencecount.h"
#include "dev/silverware/git/sdk/agmutex.h"
#include "dev/silverware/git/sdk/agscopedlock.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xatomic0.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/system_error"
#include "dev/silverware/git/sdk/agmemorystream.h"
#include "dev/silverware/git/sdk/agmemorypool.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wio.h"
#include "dev/silverware/git/sdk/input/agcontrollerbuttoncomponent.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/mat_aos.h"
#include "dev/silverware/git/sdk/agstream.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstring.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/map"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector4unaligned.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/thread"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/time.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/tuple"
#include "dev/silverware/git/sdk/input/agcontrollercomponent.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/memory"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xutility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/utility"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/iosfwd"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/vecidx_aos.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/floatinvec.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/mutex"
#include "dev/silverware/git/sdk/input/agcontrollerrumblecomponent.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/chrono"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocinfo"
#include "dev/silverware/git/sdk/system/agsystemmanager.h"
#include "dev/silverware/git/sdk/system/agsystemconfig.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/quat_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xiosbase"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/ctype.h"
#include "dev/silverware/git/sdk/util/agdebugchannels.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xlocale"
#include "dev/silverware/git/sdk/util/agperformancecounter.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/floatinvec.h"
#include "dev/silverware/git/sdk/system/agsysteminfo.h"
#include "dev/silverware/git/sdk/agclock.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/string.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memory.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_memcpy_s.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_vec64.h"
#include "dev/silverware/git/sdk/agreferencecountinl.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_math.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/vec_aos.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vector"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/malloc.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/mat_aos.h"
#include "dev/silverware/git/sdk/platforms/pc/system/agpcsysteminfo.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/cmath"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/math.h"
#include "dev/silverware/git/sdk/agmutex.inl"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/matrix4unaligned.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/scalar_cpp/quat_aos.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/sys/stat.h"
#include "dev/silverware/git/sdk/agpointerinl.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xstring"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/xmemory0"
#include "dev/silverware/git/sdk/util/agdelegate.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_sse.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_types.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/stdio.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wstdio.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_new.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_stdio_config.h"
#include "dev/kof/master/development/source/ps4project/toolkit/geommath/vector2unaligned.h"
#include "dev/kof/master/development/source/ps4project/baseproject/pcutil/pccontrolsmanager.h"
#include "dev/silverware/git/sdk/input/aginputmanager.h"
#include "dev/silverware/git/sdk/agsingleton.h"
#include "dev/kof/master/development/source/baseproject/jni/framework/ag/3rdparty/vectormath/cpp/internal/internal_functions.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/wchar.h"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wconio.h"
#include "dev/silverware/git/sdk/agvector2.h"
#include "dev/silverware/git/sdk/agmath.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vadefs.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/vcruntime_exception.h"
#include "program files (x86)/microsoft visual studio 14.0/vc/include/limits"
#include "program files (x86)/windows kits/10/include/10.0.10240.0/ucrt/corecrt_wtime.h"

std::piecewise_construct_t std::piecewise_construct; // 0x1408AFCCE
std::map<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> > >::~map<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> > >(); // 0x1400985D0
void Framework::Input::ControllerContext::initialize(); // 0x1402C7ED0
void Framework::Input::ControllerContext::onControllerAdded(const AgControllerAddedEvent & e); // 0x1402C8450
void Framework::Input::ControllerContext::onControllerRemoved(const AgControllerRemovedEvent & e); // 0x1402C8510
sce::Vectormath::Scalar::Aos::Vector2 Framework::Input::ControllerContext::getLeftStick(long userIndex); // 0x1402C8560
sce::Vectormath::Scalar::Aos::Vector2 Framework::Input::ControllerContext::getAnalogLR2(long userIndex); // 0x1402C86A0
void Framework::Input::ControllerContext::setVibration(long userIndex, double vibSec, unsigned char largeMotor, unsigned char smallMotor); // 0x1402C87E0
void Framework::Input::ControllerContext::stopVibration(long userIndex); // 0x1402C88B0
bool Framework::Input::ControllerContext::isButtonDown(long userIndex, unsigned long buttons, Framework::Input::ButtonEventPattern pattern); // 0x1402C8970
bool Framework::Input::ControllerContext::isKeyboardButtonDown(unsigned short buttons, Framework::Input::ButtonEventPattern pattern); // 0x1402C8B40
bool Framework::Input::ControllerContext::isKeyboardButtonPressedNoRepeat(unsigned short buttons, Framework::Input::ButtonEventPattern pattern); // 0x1402C8BE0
bool Framework::Input::ControllerContext::isKeyboardButtonReleasedNoRepeat(unsigned short buttons, Framework::Input::ButtonEventPattern pattern); // 0x1402C8CB0
void Framework::Input::ControllerContext::update(); // 0x1402C8D80
AgPointer<AgController> Framework::Input::ControllerContext::getControllerByValidDeviceID(long deviceIndex); // 0x1402C8E30//decompilation failure at 1408AFCCE!
std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *__fastcall std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
        std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *this,
        const char (*<_Val_0>)[14],
        AgGamepadButton *<_Val_1>)
{
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v5; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v6; // rdi
  std::pair<AgStringRef const ,enum AgGamepadButton> *p_Myval; // rbx

  v5 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode0(this);
  v6 = v5;
  *(_WORD *)&v5->_Color = 0;
  p_Myval = &v5->_Myval;
  if ( v5 != (std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *)-32i64 )
  {
    AgStringRef::AgStringRef((AgStringRef *)&v5->_Myval.first, (const char *)<_Val_0>);
    p_Myval->second = *<_Val_1>;
  }
  return v6;
}

std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *__fastcall std::_Tree_comp_alloc<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Buynode<std::piecewise_construct_t const &,std::tuple<enum AgGamepadButton const &>,std::tuple<>>(
        std::_Tree_comp_alloc<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const ,int> >,0> > *this,
        const std::piecewise_construct_t *<_Val_0>,
        std::tuple<enum AgGamepadButton const &> *<_Val_1>,
        std::tuple<> *<_Val_2>)
{
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *result; // rax

  result = std::_Tree_comp_alloc<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Buynode0(this);
  *(_WORD *)&result->_Color = 0;
  if ( result != (std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *)-28i64 )
    result->_Myval = (std::pair<enum AgGamepadButton const ,int>)*(unsigned int *)<_Val_1>->_Myfirst._Val;
  return result;
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *__fastcall std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_at<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
        std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *result,
        bool _Addleft,
        std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *_Wherenode,
        std::pair<AgStringRef const ,enum AgGamepadButton> *_Val,
        std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *_Node)
{
  unsigned __int64 Mysize; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Myhead; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v10; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Parent; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v12; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Left; // rdx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Right; // rdx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v15; // rdx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v16; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v17; // rdx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v18; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v19; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v20; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v21; // rdx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v22; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v23; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v24; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v25; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v26; // rcx
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *v27; // rax

  Mysize = this->_Mypair._Myval2._Myval2._Mysize;
  if ( Mysize >= 0x492492492492491i64 )
  {
    operator delete(_Node);
    std::_Xlength_error("map/set<T> too long");
  }
  this->_Mypair._Myval2._Myval2._Mysize = Mysize + 1;
  _Node->_Parent = _Wherenode;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = _Node;
    this->_Mypair._Myval2._Myval2._Myhead->_Left = _Node;
    Myhead = this->_Mypair._Myval2._Myval2._Myhead;
LABEL_8:
    Myhead->_Right = _Node;
    goto LABEL_9;
  }
  if ( !_Addleft )
  {
    _Wherenode->_Right = _Node;
    Myhead = this->_Mypair._Myval2._Myval2._Myhead;
    if ( _Wherenode != this->_Mypair._Myval2._Myval2._Myhead->_Right )
      goto LABEL_9;
    goto LABEL_8;
  }
  _Wherenode->_Left = _Node;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead->_Left )
    this->_Mypair._Myval2._Myval2._Myhead->_Left = _Node;
LABEL_9:
  v10 = _Node;
  while ( !v10->_Parent->_Color )
  {
    Parent = v10->_Parent;
    v12 = Parent->_Parent;
    Left = v12->_Left;
    if ( Parent == v12->_Left )
    {
      Right = v12->_Right;
      if ( Right->_Color )
      {
        if ( v10 == Parent->_Right )
        {
          v15 = Parent->_Right;
          v10 = v10->_Parent;
          Parent->_Right = v15->_Left;
          if ( !v15->_Left->_Isnil )
            v15->_Left->_Parent = Parent;
          v15->_Parent = Parent->_Parent;
          if ( Parent == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
          {
            this->_Mypair._Myval2._Myval2._Myhead->_Parent = v15;
          }
          else
          {
            v16 = Parent->_Parent;
            if ( v10 == v16->_Left )
              v16->_Left = v15;
            else
              v16->_Right = v15;
          }
          v15->_Left = v10;
          v10->_Parent = v15;
        }
        v10->_Parent->_Color = 1;
        v10->_Parent->_Parent->_Color = 0;
        v17 = v10->_Parent->_Parent;
        v18 = v17->_Left;
        v17->_Left = v17->_Left->_Right;
        v19 = v18->_Right;
        if ( !v19->_Isnil )
          v19->_Parent = v17;
        v18->_Parent = v17->_Parent;
        if ( v17 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
        {
          this->_Mypair._Myval2._Myval2._Myhead->_Parent = v18;
          v18->_Right = v17;
        }
        else
        {
          v20 = v17->_Parent;
          if ( v17 == v20->_Right )
            v20->_Right = v18;
          else
            v20->_Left = v18;
          v18->_Right = v17;
        }
LABEL_49:
        v17->_Parent = v18;
        continue;
      }
      Parent->_Color = 1;
      Right->_Color = 1;
      v10->_Parent->_Parent->_Color = 0;
      v10 = v10->_Parent->_Parent;
    }
    else
    {
      if ( Left->_Color )
      {
        if ( v10 == Parent->_Left )
        {
          v21 = Parent->_Left;
          v10 = v10->_Parent;
          Parent->_Left = Parent->_Left->_Right;
          v22 = v21->_Right;
          if ( !v22->_Isnil )
            v22->_Parent = v10;
          v21->_Parent = v10->_Parent;
          if ( v10 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
          {
            this->_Mypair._Myval2._Myval2._Myhead->_Parent = v21;
          }
          else
          {
            v23 = v10->_Parent;
            if ( v10 == v23->_Right )
              v23->_Right = v21;
            else
              v23->_Left = v21;
          }
          v21->_Right = v10;
          v10->_Parent = v21;
        }
        v10->_Parent->_Color = 1;
        v10->_Parent->_Parent->_Color = 0;
        v17 = v10->_Parent->_Parent;
        v18 = v17->_Right;
        v17->_Right = v18->_Left;
        if ( !v18->_Left->_Isnil )
          v18->_Left->_Parent = v17;
        v18->_Parent = v17->_Parent;
        if ( v17 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
        {
          this->_Mypair._Myval2._Myval2._Myhead->_Parent = v18;
        }
        else
        {
          v24 = v17->_Parent;
          if ( v17 == v24->_Left )
            v24->_Left = v18;
          else
            v24->_Right = v18;
        }
        v18->_Left = v17;
        goto LABEL_49;
      }
      Parent->_Color = 1;
      Left->_Color = 1;
      v10->_Parent->_Parent->_Color = 0;
      v10 = v10->_Parent->_Parent;
    }
  }
  v25 = this->_Mypair._Myval2._Myval2._Myhead;
  result->_Ptr = _Node;
  v26 = v25->_Parent;
  v27 = result;
  v26->_Color = 1;
  return v27;
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > > *__fastcall std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
        std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const ,int> >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > > *result,
        bool _Addleft,
        std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *_Wherenode,
        std::pair<enum AgGamepadButton const ,int> *_Val,
        std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *_Node)
{
  unsigned __int64 Mysize; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Myhead; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v10; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Parent; // rcx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v12; // r8
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Left; // rdx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Right; // rdx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v15; // rdx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v16; // rcx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v17; // rdx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v18; // r8
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v19; // rcx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v20; // rcx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v21; // rdx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v22; // rcx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v23; // rcx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v24; // rcx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v25; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v26; // rcx
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > > *v27; // rax

  Mysize = this->_Mypair._Myval2._Myval2._Mysize;
  if ( Mysize >= 0x666666666666665i64 )
  {
    operator delete(_Node);
    std::_Xlength_error("map/set<T> too long");
  }
  this->_Mypair._Myval2._Myval2._Mysize = Mysize + 1;
  _Node->_Parent = _Wherenode;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = _Node;
    this->_Mypair._Myval2._Myval2._Myhead->_Left = _Node;
    Myhead = this->_Mypair._Myval2._Myval2._Myhead;
LABEL_8:
    Myhead->_Right = _Node;
    goto LABEL_9;
  }
  if ( !_Addleft )
  {
    _Wherenode->_Right = _Node;
    Myhead = this->_Mypair._Myval2._Myval2._Myhead;
    if ( _Wherenode != this->_Mypair._Myval2._Myval2._Myhead->_Right )
      goto LABEL_9;
    goto LABEL_8;
  }
  _Wherenode->_Left = _Node;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead->_Left )
    this->_Mypair._Myval2._Myval2._Myhead->_Left = _Node;
LABEL_9:
  v10 = _Node;
  while ( !v10->_Parent->_Color )
  {
    Parent = v10->_Parent;
    v12 = Parent->_Parent;
    Left = v12->_Left;
    if ( Parent == v12->_Left )
    {
      Right = v12->_Right;
      if ( Right->_Color )
      {
        if ( v10 == Parent->_Right )
        {
          v15 = Parent->_Right;
          v10 = v10->_Parent;
          Parent->_Right = v15->_Left;
          if ( !v15->_Left->_Isnil )
            v15->_Left->_Parent = Parent;
          v15->_Parent = Parent->_Parent;
          if ( Parent == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
          {
            this->_Mypair._Myval2._Myval2._Myhead->_Parent = v15;
          }
          else
          {
            v16 = Parent->_Parent;
            if ( v10 == v16->_Left )
              v16->_Left = v15;
            else
              v16->_Right = v15;
          }
          v15->_Left = v10;
          v10->_Parent = v15;
        }
        v10->_Parent->_Color = 1;
        v10->_Parent->_Parent->_Color = 0;
        v17 = v10->_Parent->_Parent;
        v18 = v17->_Left;
        v17->_Left = v17->_Left->_Right;
        v19 = v18->_Right;
        if ( !v19->_Isnil )
          v19->_Parent = v17;
        v18->_Parent = v17->_Parent;
        if ( v17 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
        {
          this->_Mypair._Myval2._Myval2._Myhead->_Parent = v18;
          v18->_Right = v17;
        }
        else
        {
          v20 = v17->_Parent;
          if ( v17 == v20->_Right )
            v20->_Right = v18;
          else
            v20->_Left = v18;
          v18->_Right = v17;
        }
LABEL_49:
        v17->_Parent = v18;
        continue;
      }
      Parent->_Color = 1;
      Right->_Color = 1;
      v10->_Parent->_Parent->_Color = 0;
      v10 = v10->_Parent->_Parent;
    }
    else
    {
      if ( Left->_Color )
      {
        if ( v10 == Parent->_Left )
        {
          v21 = Parent->_Left;
          v10 = v10->_Parent;
          Parent->_Left = Parent->_Left->_Right;
          v22 = v21->_Right;
          if ( !v22->_Isnil )
            v22->_Parent = v10;
          v21->_Parent = v10->_Parent;
          if ( v10 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
          {
            this->_Mypair._Myval2._Myval2._Myhead->_Parent = v21;
          }
          else
          {
            v23 = v10->_Parent;
            if ( v10 == v23->_Right )
              v23->_Right = v21;
            else
              v23->_Left = v21;
          }
          v21->_Right = v10;
          v10->_Parent = v21;
        }
        v10->_Parent->_Color = 1;
        v10->_Parent->_Parent->_Color = 0;
        v17 = v10->_Parent->_Parent;
        v18 = v17->_Right;
        v17->_Right = v18->_Left;
        if ( !v18->_Left->_Isnil )
          v18->_Left->_Parent = v17;
        v18->_Parent = v17->_Parent;
        if ( v17 == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
        {
          this->_Mypair._Myval2._Myval2._Myhead->_Parent = v18;
        }
        else
        {
          v24 = v17->_Parent;
          if ( v17 == v24->_Left )
            v24->_Left = v18;
          else
            v24->_Right = v18;
        }
        v18->_Left = v17;
        goto LABEL_49;
      }
      Parent->_Color = 1;
      Left->_Color = 1;
      v10->_Parent->_Parent->_Color = 0;
      v10 = v10->_Parent->_Parent;
    }
  }
  v25 = this->_Mypair._Myval2._Myval2._Myhead;
  result->_Ptr = _Node;
  v26 = v25->_Parent;
  v27 = result;
  v26->_Color = 1;
  return v27;
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > > *__fastcall std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_hint<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
        std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const ,int> >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > > *result,
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > > _Where,
        std::pair<enum AgGamepadButton const ,int> *_Val,
        std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *_Newnode)
{
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Myhead; // rcx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Right; // r9
  AgGamepadButton first; // edi
  AgGamepadButton v12; // er11
  bool v13; // cc
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Ptr; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Left; // r9
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *j; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *i; // rdx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v18; // r9
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v19; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *m; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *k; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *v22; // [rsp+20h] [rbp-38h]
  std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > >,bool> resulta; // [rsp+38h] [rbp-20h] BYREF

  if ( !this->_Mypair._Myval2._Myval2._Mysize )
  {
    std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
      this,
      result,
      1,
      this->_Mypair._Myval2._Myval2._Myhead,
      (std::pair<enum AgGamepadButton const ,int> *)v22,
      _Newnode);
    return result;
  }
  Myhead = this->_Mypair._Myval2._Myval2._Myhead;
  if ( _Where._Ptr == Myhead->_Left )
  {
    if ( _Val->first < _Where._Ptr->_Myval.first )
    {
      std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
        this,
        result,
        1,
        _Where._Ptr,
        (std::pair<enum AgGamepadButton const ,int> *)v22,
        _Newnode);
      return result;
    }
    goto LABEL_43;
  }
  if ( _Where._Ptr == Myhead )
  {
    Right = Myhead->_Right;
    if ( Right->_Myval.first < _Val->first )
    {
      std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
        this,
        result,
        0,
        Right,
        (std::pair<enum AgGamepadButton const ,int> *)v22,
        _Newnode);
      return result;
    }
    goto LABEL_43;
  }
  first = _Val->first;
  v12 = _Where._Ptr->_Myval.first;
  v13 = v12 < _Val->first;
  if ( v12 > _Val->first )
  {
    Ptr = _Where._Ptr;
    if ( _Where._Ptr->_Isnil )
    {
      Left = _Where._Ptr->_Right;
    }
    else
    {
      Left = _Where._Ptr->_Left;
      if ( _Where._Ptr->_Left->_Isnil )
      {
        for ( i = _Where._Ptr->_Parent; !i->_Isnil; i = i->_Parent )
        {
          if ( Ptr != i->_Left )
            break;
          Ptr = i;
        }
        Left = Ptr;
        if ( !Ptr->_Isnil )
          Left = i;
      }
      else
      {
        for ( j = Left->_Right; !j->_Isnil; j = j->_Right )
          Left = j;
      }
    }
    if ( Left->_Myval.first < first )
    {
      if ( Left->_Right->_Isnil )
        std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
          this,
          result,
          0,
          Left,
          (std::pair<enum AgGamepadButton const ,int> *)v22,
          _Newnode);
      else
        std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
          this,
          result,
          1,
          _Where._Ptr,
          (std::pair<enum AgGamepadButton const ,int> *)v22,
          _Newnode);
      return result;
    }
    v13 = v12 < first;
  }
  if ( !v13 )
    goto LABEL_43;
  v18 = _Where._Ptr;
  if ( !_Where._Ptr->_Isnil )
  {
    v19 = _Where._Ptr->_Right;
    if ( v19->_Isnil )
    {
      for ( k = _Where._Ptr->_Parent; !k->_Isnil; k = k->_Parent )
      {
        if ( v18 != k->_Right )
          break;
        v18 = k;
      }
      v18 = k;
    }
    else
    {
      v18 = _Where._Ptr->_Right;
      for ( m = v19->_Left; !m->_Isnil; m = m->_Left )
        v18 = m;
    }
  }
  if ( v18 != Myhead && first >= v18->_Myval.first )
  {
LABEL_43:
    result->_Ptr = (std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *)std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_nohint<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
                                                                                           this,
                                                                                           &resulta,
                                                                                           (bool)_Where._Ptr,
                                                                                           _Val,
                                                                                           _Newnode)->first;
    return result;
  }
  if ( _Where._Ptr->_Right->_Isnil )
    std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
      this,
      result,
      0,
      _Where._Ptr,
      (std::pair<enum AgGamepadButton const ,int> *)v22,
      _Newnode);
  else
    std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
      this,
      result,
      1,
      v18,
      (std::pair<enum AgGamepadButton const ,int> *)v22,
      _Newnode);
  return result;
}

std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >,bool> *__fastcall std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
        std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *this,
        std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >,bool> *result,
        bool _Leftish,
        std::pair<AgStringRef const ,enum AgGamepadButton> *_Val,
        std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *_Newnode)
{
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Myhead; // rsi
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Parent; // rbx
  bool v10; // di
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Right; // rbx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *j; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *i; // rax
  std::pair<AgStringRef const ,enum AgGamepadButton> *v15; // [rsp+20h] [rbp-48h]
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > resulta; // [rsp+70h] [rbp+8h] BYREF

  Myhead = this->_Mypair._Myval2._Myval2._Myhead;
  Parent = this->_Mypair._Myval2._Myval2._Myhead->_Parent;
  v10 = 1;
  while ( !Parent->_Isnil )
  {
    Myhead = Parent;
    v10 = operator<(&_Val->first, &Parent->_Myval.first);
    if ( v10 )
      Parent = Parent->_Left;
    else
      Parent = Parent->_Right;
  }
  Right = Myhead;
  if ( v10 )
  {
    if ( Myhead == this->_Mypair._Myval2._Myval2._Myhead->_Left )
    {
      result->first = (std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >)std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_at<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(this, &resulta, 1, Myhead, v15, _Newnode)->_Ptr;
      result->second = 1;
      return result;
    }
    if ( Myhead->_Isnil )
    {
      Right = Myhead->_Right;
    }
    else if ( Myhead->_Left->_Isnil )
    {
      for ( i = Myhead->_Parent; !i->_Isnil; i = i->_Parent )
      {
        if ( Right != i->_Left )
          break;
        Right = i;
      }
      if ( !Right->_Isnil )
        Right = i;
    }
    else
    {
      Right = Myhead->_Left;
      for ( j = Myhead->_Left->_Right; !j->_Isnil; j = j->_Right )
        Right = j;
    }
  }
  if ( operator<(&Right->_Myval.first, &_Val->first) )
  {
    result->first = (std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >)std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_at<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(this, &resulta, v10, Myhead, v15, _Newnode)->_Ptr;
    result->second = 1;
  }
  else
  {
    operator delete(_Newnode);
    result->first._Ptr = Right;
    result->second = 0;
  }
  return result;
}

std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > >,bool> *__fastcall std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_nohint<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
        std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const ,int> >,0> > *this,
        std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > >,bool> *result,
        bool _Leftish,
        std::pair<enum AgGamepadButton const ,int> *_Val,
        std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *_Newnode)
{
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Parent; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Myhead; // r9
  bool v9; // r8
  AgGamepadButton first; // edx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Right; // rbx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *j; // rax
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *i; // rax
  std::pair<enum AgGamepadButton const ,int> *v15; // [rsp+20h] [rbp-28h]
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > > resulta; // [rsp+50h] [rbp+8h] BYREF

  Parent = this->_Mypair._Myval2._Myval2._Myhead->_Parent;
  Myhead = this->_Mypair._Myval2._Myval2._Myhead;
  v9 = 1;
  if ( !Parent->_Isnil )
  {
    first = _Val->first;
    do
    {
      Myhead = Parent;
      v9 = first < Parent->_Myval.first;
      if ( first >= Parent->_Myval.first )
        Parent = Parent->_Right;
      else
        Parent = Parent->_Left;
    }
    while ( !Parent->_Isnil );
  }
  Right = Myhead;
  if ( v9 )
  {
    if ( Myhead == this->_Mypair._Myval2._Myval2._Myhead->_Left )
    {
      result->first = (std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > >)std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(this, &resulta, 1, Myhead, v15, _Newnode)->_Ptr;
      result->second = 1;
      return result;
    }
    if ( Myhead->_Isnil )
    {
      Right = Myhead->_Right;
    }
    else if ( Myhead->_Left->_Isnil )
    {
      for ( i = Myhead->_Parent; !i->_Isnil; i = i->_Parent )
      {
        if ( Right != i->_Left )
          break;
        Right = i;
      }
      if ( !Right->_Isnil )
        Right = i;
    }
    else
    {
      Right = Myhead->_Left;
      for ( j = Myhead->_Left->_Right; !j->_Isnil; j = j->_Right )
        Right = j;
    }
  }
  if ( Right->_Myval.first >= _Val->first )
  {
    operator delete(_Newnode);
    result->first._Ptr = Right;
    result->second = 0;
  }
  else
  {
    result->first = (std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > >)std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_at<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(this, &resulta, v9, Myhead, v15, _Newnode)->_Ptr;
    result->second = 1;
  }
  return result;
}

void __fastcall AgSDLMappingParser::AgSDLMappingParser(
        AgSDLMappingParser *this,
        const AgPointer<AgController> *controller)
{
  int FirstIndexOf; // eax
  unsigned int v5; // edi
  int v6; // eax
  unsigned int v7; // esi
  int v8; // ebx
  std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *v9; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *_Newnode; // rax
  bool v11; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v12; // rax
  bool v13; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v14; // rax
  bool v15; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v16; // rax
  bool v17; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v18; // rax
  bool v19; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v20; // rax
  bool v21; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v22; // rax
  bool v23; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v24; // rax
  bool v25; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v26; // rax
  bool v27; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v28; // rax
  bool v29; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v30; // rax
  bool v31; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v32; // rax
  bool v33; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v34; // rax
  bool v35; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v36; // rax
  bool v37; // r8
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v38; // rax
  bool v39; // r8
  int v40; // eax
  int v41; // edi
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Myhead; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Parent; // rdi
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v44; // rbx
  bool v45; // zf
  __ExceptionPtr *CString; // rax
  int v47; // edi
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v48; // rdi
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v49; // rsi
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v50; // rbx
  std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > v51; // [rsp+38h] [rbp-31h] BYREF
  AgString s1; // [rsp+48h] [rbp-21h] BYREF
  AgStringRef s2; // [rsp+58h] [rbp-11h] BYREF
  std::pair<std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >,bool> v54; // [rsp+68h] [rbp-1h] BYREF
  AgStringRef result; // [rsp+78h] [rbp+Fh] BYREF
  AgStringRef v56; // [rsp+88h] [rbp+1Fh] BYREF
  AgGamepadButton v57; // [rsp+D8h] [rbp+6Fh] BYREF

  this->m_buttonIdLUT._Mypair._Myval2._Myval2._Myhead = 0i64;
  this->m_buttonIdLUT._Mypair._Myval2._Myval2._Mysize = 0i64;
  this->m_buttonIdLUT._Mypair._Myval2._Myval2._Myhead = std::_Tree_comp_alloc<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Buyheadnode(&this->m_buttonIdLUT);
  controller->m_ptr->getMappingString(controller->m_ptr, &s1);
  if ( operator!=(&s1, &pnewText) )
  {
    FirstIndexOf = AgString::getFirstIndexOf(&s1, 44, 0);
    v5 = FirstIndexOf + 1;
    AgString::getSubString(&s1, &result, 0, FirstIndexOf);
    v6 = AgString::getFirstIndexOf(&s1, 44, v5);
    v7 = v6 + 1;
    AgString::getSubString(&s1, &v56, v5, v6 - v5);
    v8 = AgString::getFirstIndexOf(&s1, 44, v7);
    v51._Mypair._Myval2._Myval2._Mysize = 0i64;
    v51._Mypair._Myval2._Myval2._Myhead = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buyheadnode(v9);
    v57 = AgGamepadButton_A;
    _Newnode = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
                 &v51,
                 (const char (*)[14])"a",
                 &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v11,
      &_Newnode->_Myval,
      _Newnode);
    v57 = AgGamepadButton_B;
    v12 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"b",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v13,
      &v12->_Myval,
      v12);
    v57 = AgGamepadButton_X;
    v14 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"x",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v15,
      &v14->_Myval,
      v14);
    v57 = AgGamepadButton_Y;
    v16 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"y",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v17,
      &v16->_Myval,
      v16);
    v57 = AgGamepadButton_Select;
    v18 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"back",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v19,
      &v18->_Myval,
      v18);
    v57 = AgGamepadButton_L3;
    v20 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"leftstick",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v21,
      &v20->_Myval,
      v20);
    v57 = AgGamepadButton_R3;
    v22 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"rightstick",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v23,
      &v22->_Myval,
      v22);
    v57 = AgGamepadButton_LB;
    v24 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"leftshoulder",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v25,
      &v24->_Myval,
      v24);
    v57 = AgGamepadButton_RB;
    v26 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"rightshoulder",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v27,
      &v26->_Myval,
      v26);
    v57 = AgGamepadButton_Up;
    v28 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"dpup",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v29,
      &v28->_Myval,
      v28);
    v57 = AgGamepadButton_Left;
    v30 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"dpleft",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v31,
      &v30->_Myval,
      v30);
    v57 = AgGamepadButton_Down;
    v32 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"dpdown",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v33,
      &v32->_Myval,
      v32);
    v57 = AgGamepadButton_Right;
    v34 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"dpright",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v35,
      &v34->_Myval,
      v34);
    v57 = -1;
    v36 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"lefttrigger",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v37,
      &v36->_Myval,
      v36);
    v57 = -2;
    v38 = std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode<char const (&)[10],enum AgGamepadButton>(
            &v51,
            (const char (*)[14])"righttrigger",
            &v57);
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Insert_nohint<std::pair<AgStringRef const,enum AgGamepadButton> &,std::_Tree_node<std::pair<AgStringRef const,enum AgGamepadButton>,void *> *>(
      (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v51,
      &v54,
      v39,
      &v38->_Myval,
      v38);
    for ( ; v8 != -1; v7 = v8 + 1 )
    {
      v40 = AgString::getFirstIndexOf(&s1, 58, v7);
      v41 = v40;
      if ( v40 == -1 )
        break;
      AgString::getSubString(&s1, &s2, v7, v40 - v7);
      AgString::getSubString(&s1, (AgStringRef *)&v54, v41 + 1, v8 - v41 - 1);
      Myhead = v51._Mypair._Myval2._Myval2._Myhead;
      Parent = v51._Mypair._Myval2._Myval2._Myhead->_Parent;
      v44 = v51._Mypair._Myval2._Myval2._Myhead;
      if ( Parent->_Isnil )
        goto LABEL_11;
      do
      {
        if ( operator<(&Parent->_Myval.first, &s2) )
        {
          Parent = Parent->_Right;
        }
        else
        {
          v44 = Parent;
          Parent = Parent->_Left;
        }
      }
      while ( !Parent->_Isnil );
      Myhead = v51._Mypair._Myval2._Myval2._Myhead;
      if ( v44 == v51._Mypair._Myval2._Myval2._Myhead
        || (v45 = !operator<(&s2, &v44->_Myval.first), Myhead = v51._Mypair._Myval2._Myval2._Myhead, !v45) )
      {
LABEL_11:
        v44 = Myhead;
      }
      if ( v44 != Myhead )
      {
        CString = AgStringRef::getCString((std::shared_ptr<__ExceptionPtr> *)&v54);
        v47 = strtol((const char *)&CString->m_Record.ExceptionCode + 1, 0i64, 0);
        *std::map<enum AgGamepadButton,int>::operator[](&this->m_buttonIdLUT, &v44->_Myval.second) = v47;
      }
      v8 = AgString::getFirstIndexOf(&s1, 44, v7);
    }
    v48 = v51._Mypair._Myval2._Myval2._Myhead;
    v49 = v51._Mypair._Myval2._Myval2._Myhead->_Parent;
    v50 = v49;
    if ( !v49->_Isnil )
    {
      do
      {
        std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Erase(
          (std::_Tree<std::_Tmap_traits<_SDL_Joystick *,__int64,std::less<_SDL_Joystick *>,std::allocator<std::pair<_SDL_Joystick * const,__int64> >,0> > *)&v51,
          (std::_Tree_node<std::pair<_SDL_Joystick * const,__int64>,void *> *)v50->_Right);
        v50 = v50->_Left;
        operator delete(v49);
        v49 = v50;
      }
      while ( !v50->_Isnil );
      v48 = v51._Mypair._Myval2._Myval2._Myhead;
    }
    v48->_Parent = v48;
    v51._Mypair._Myval2._Myval2._Myhead->_Left = v51._Mypair._Myval2._Myval2._Myhead;
    v51._Mypair._Myval2._Myval2._Myhead->_Right = v51._Mypair._Myval2._Myval2._Myhead;
    v51._Mypair._Myval2._Myval2._Mysize = 0i64;
    operator delete(v51._Mypair._Myval2._Myval2._Myhead);
  }
  AgString::~AgString(&s1);
}

void __fastcall SaveRecord_ButtonConfigUser::~SaveRecord_ButtonConfigUser(
        std::map<AgStringRef,enum AgGamepadButton> *this)
{
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > result; // [rsp+30h] [rbp+8h] BYREF

  std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::erase(
    this,
    &result,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >)this->_Mypair._Myval2._Myval2._Myhead->_Left,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >)this->_Mypair._Myval2._Myval2._Myhead);
  operator delete(this->_Mypair._Myval2._Myval2._Myhead);
}

AgPointer<AgController> *__fastcall AgPointer<AgController>::operator=(
        AgPointer<AgController> *this,
        const AgPointer<AgController> *rhs)
{
  AgReferenceCount *m_ref; // rdi
  int m_strongCount; // ebx
  AgReferenceCount *v6; // r8
  AgController *m_ptr; // rdx
  AgController *v8; // rax
  AgPointer<KOFApplication> v10; // [rsp+20h] [rbp-18h] BYREF

  m_ref = rhs->m_ref;
  v10 = 0i64;
  if ( !m_ref )
    goto LABEL_5;
  m_strongCount = m_ref->m_strongCount;
  if ( !m_ref->m_strongCount )
    goto LABEL_5;
  while ( AgAtomicCompareExchange(&m_ref->m_strongCount, m_strongCount, m_strongCount + 1) != m_strongCount )
  {
    m_strongCount = m_ref->m_strongCount;
    if ( !m_ref->m_strongCount )
      goto LABEL_5;
  }
  if ( m_strongCount != -1 )
  {
    v6 = rhs->m_ref;
    m_ptr = rhs->m_ptr;
  }
  else
  {
LABEL_5:
    v6 = v10.m_ref;
    m_ptr = (AgController *)v10.m_ptr;
  }
  v8 = this->m_ptr;
  v10.m_ref = this->m_ref;
  this->m_ref = v6;
  this->m_ptr = m_ptr;
  v10.m_ptr = (KOFApplication *)v8;
  AgPointer<AgUser>::~AgPointer<AgUser>(&v10);
  return this;
}

const AgGamepadButton *__fastcall std::map<enum AgGamepadButton,int>::operator[](
        std::map<enum AgGamepadButton,int> *this,
        const AgGamepadButton *_Keyval,
        __int64 a3,
        std::tuple<> *a4)
{
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Myhead; // rbx
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Parent; // r8
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *_Newnode; // rax
  std::tuple<enum AgGamepadButton const &> v9; // [rsp+40h] [rbp+8h] BYREF

  Myhead = this->_Mypair._Myval2._Myval2._Myhead;
  Parent = this->_Mypair._Myval2._Myval2._Myhead->_Parent;
  if ( !Parent->_Isnil )
  {
    a4 = (std::tuple<> *)*(unsigned int *)_Keyval;
    do
    {
      if ( Parent->_Myval.first >= (int)a4 )
      {
        Myhead = Parent;
        Parent = Parent->_Left;
      }
      else
      {
        Parent = Parent->_Right;
      }
    }
    while ( !Parent->_Isnil );
  }
  if ( Myhead != this->_Mypair._Myval2._Myval2._Myhead && *_Keyval >= Myhead->_Myval.first )
    return (const AgGamepadButton *)&Myhead->_Myval.second;
  v9._Myfirst._Val = _Keyval;
  _Newnode = std::_Tree_comp_alloc<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Buynode<std::piecewise_construct_t const &,std::tuple<enum AgGamepadButton const &>,std::tuple<>>(
               this,
               (const std::piecewise_construct_t *)_Keyval,
               &v9,
               a4);
  std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Insert_hint<std::pair<enum AgGamepadButton const,int> &,std::_Tree_node<std::pair<enum AgGamepadButton const,int>,void *> *>(
    this,
    (std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > > *)&v9,
    (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<enum AgGamepadButton const ,int> > > >)Myhead,
    &_Newnode->_Myval,
    _Newnode);
  return v9._Myfirst._Val + 8;
}

std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *__fastcall std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buyheadnode(
        std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *this)
{
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *result; // rax

  result = (std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *)operator new(0x38ui64);
  if ( result )
    result->_Left = result;
  if ( result != (std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *)-8i64 )
    result->_Parent = result;
  if ( result != (std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *)-16i64 )
    result->_Right = result;
  *(_WORD *)&result->_Color = 257;
  return result;
}

std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *__fastcall std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::_Buynode0(
        std::_Tree_comp_alloc<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *this)
{
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *result; // rax

  result = (std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *)operator new(0x38ui64);
  if ( result )
    result->_Left = this->_Mypair._Myval2._Myval2._Myhead;
  if ( result != (std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *)-8i64 )
    result->_Parent = this->_Mypair._Myval2._Myval2._Myhead;
  if ( result != (std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *)-16i64 )
    result->_Right = this->_Mypair._Myval2._Myval2._Myhead;
  return result;
}

std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *__fastcall std::_Tree_comp_alloc<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::_Buynode0(
        std::_Tree_comp_alloc<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const ,int> >,0> > *this)
{
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *result; // rax

  result = (std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *)operator new(0x28ui64);
  if ( result )
    result->_Left = this->_Mypair._Myval2._Myval2._Myhead;
  if ( result != (std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *)-8i64 )
    result->_Parent = this->_Mypair._Myval2._Myval2._Myhead;
  if ( result != (std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *)-16i64 )
    result->_Right = this->_Mypair._Myval2._Myval2._Myhead;
  return result;
}

void __fastcall std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Erase(
        std::_Tree<std::_Tmap_traits<_SDL_Joystick *,__int64,std::less<_SDL_Joystick *>,std::allocator<std::pair<_SDL_Joystick * const,__int64> >,0> > *this,
        std::_Tree_node<std::pair<_SDL_Joystick * const,__int64>,void *> *_Rootnode)
{
  std::_Tree_node<std::pair<_SDL_Joystick * const,__int64>,void *> *v2; // rdi
  std::_Tree_node<std::pair<_SDL_Joystick * const,__int64>,void *> *i; // rbx

  v2 = _Rootnode;
  for ( i = _Rootnode; !i->_Isnil; v2 = i )
  {
    std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Erase(
      this,
      i->_Right);
    i = i->_Left;
    operator delete(v2);
  }
}

void __fastcall std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Lrotate(
        std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *this,
        std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *_Wherenode)
{
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Right; // r8
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Parent; // rax

  Right = _Wherenode->_Right;
  _Wherenode->_Right = Right->_Left;
  if ( !Right->_Left->_Isnil )
    Right->_Left->_Parent = _Wherenode;
  Right->_Parent = _Wherenode->_Parent;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = Right;
    Right->_Left = _Wherenode;
    _Wherenode->_Parent = Right;
  }
  else
  {
    Parent = _Wherenode->_Parent;
    if ( _Wherenode == Parent->_Left )
      Parent->_Left = Right;
    else
      Parent->_Right = Right;
    Right->_Left = _Wherenode;
    _Wherenode->_Parent = Right;
  }
}

void __fastcall std::_Tree<std::_Tmap_traits<enum AgControllerComponentType,std::list<AgControllerComponent *>,std::less<enum AgControllerComponentType>,std::allocator<std::pair<enum AgControllerComponentType const,std::list<AgControllerComponent *>>>,0>>::_Rrotate(
        std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *this,
        std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *_Wherenode)
{
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Left; // r8
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Right; // rax
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *Parent; // rax

  Left = _Wherenode->_Left;
  _Wherenode->_Left = _Wherenode->_Left->_Right;
  Right = Left->_Right;
  if ( !Right->_Isnil )
    Right->_Parent = _Wherenode;
  Left->_Parent = _Wherenode->_Parent;
  if ( _Wherenode == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = Left;
    Left->_Right = _Wherenode;
    _Wherenode->_Parent = Left;
  }
  else
  {
    Parent = _Wherenode->_Parent;
    if ( _Wherenode == Parent->_Right )
      Parent->_Right = Left;
    else
      Parent->_Left = Left;
    Left->_Right = _Wherenode;
    _Wherenode->_Parent = Left;
  }
}

void __fastcall std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::clear(
        std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *this)
{
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Parent; // rsi
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *i; // rbx

  Parent = this->_Mypair._Myval2._Myval2._Myhead->_Parent;
  for ( i = Parent; !i->_Isnil; Parent = i )
  {
    std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Erase(
      (std::_Tree<std::_Tmap_traits<_SDL_Joystick *,__int64,std::less<_SDL_Joystick *>,std::allocator<std::pair<_SDL_Joystick * const,__int64> >,0> > *)this,
      (std::_Tree_node<std::pair<_SDL_Joystick * const,__int64>,void *> *)i->_Right);
    i = i->_Left;
    operator delete(Parent);
  }
  this->_Mypair._Myval2._Myval2._Myhead->_Parent = this->_Mypair._Myval2._Myval2._Myhead;
  this->_Mypair._Myval2._Myval2._Myhead->_Left = this->_Mypair._Myval2._Myval2._Myhead;
  this->_Mypair._Myval2._Myval2._Myhead->_Right = this->_Mypair._Myval2._Myval2._Myhead;
  this->_Mypair._Myval2._Myval2._Mysize = 0i64;
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *__fastcall std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::erase(
        std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *result,
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > _First,
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > _Last)
{
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *v6; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v7; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Right; // rdx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *j; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *i; // rcx
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > resulta; // [rsp+30h] [rbp+8h] BYREF
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v12; // [rsp+40h] [rbp+18h]
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Ptr; // [rsp+48h] [rbp+20h]

  Ptr = _Last._Ptr;
  v12 = _First._Ptr;
  if ( _First._Ptr == this->_Mypair._Myval2._Myval2._Myhead->_Left
    && _Last._Ptr == this->_Mypair._Myval2._Myval2._Myhead )
  {
    std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::clear(this);
    v6 = result;
    result->_Ptr = this->_Mypair._Myval2._Myval2._Myhead->_Left;
  }
  else
  {
    if ( _First._Ptr != _Last._Ptr )
    {
      do
      {
        v7 = _First._Ptr;
        if ( !_First._Ptr->_Isnil )
        {
          Right = _First._Ptr->_Right;
          if ( Right->_Isnil )
          {
            for ( i = _First._Ptr->_Parent; !i->_Isnil; i = i->_Parent )
            {
              if ( _First._Ptr != i->_Right )
                break;
              v12 = i;
              _First._Ptr = i;
            }
            v12 = i;
          }
          else
          {
            for ( j = Right->_Left; !j->_Isnil; j = j->_Left )
              Right = j;
            v12 = Right;
          }
        }
        std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::erase(
          this,
          &resulta,
          (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >)v7);
        _First._Ptr = v12;
      }
      while ( v12 != Ptr );
    }
    v6 = result;
    result->_Ptr = _First._Ptr;
  }
  return v6;
}

std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *__fastcall std::_Tree<std::_Tmap_traits<enum AgGamepadButton,int,std::less<enum AgGamepadButton>,std::allocator<std::pair<enum AgGamepadButton const,int>>,0>>::erase(
        std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *this,
        std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *result,
        std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > _Where)
{
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v5; // r11
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Right; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *j; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *i; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v9; // r10
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Parent; // r9
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *k; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Left; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Myhead; // rdx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v14; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *m; // rcx
  std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *v16; // rax
  char Color; // cl
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v18; // rdi
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v19; // rsi
  std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *v20; // rdx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v21; // rcx
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *v22; // rax
  unsigned __int64 Mysize; // rax
  std::_Tree_node<std::pair<AgStringRef const ,enum AgGamepadButton>,void *> *Ptr; // [rsp+50h] [rbp+18h]

  Ptr = _Where._Ptr;
  v5 = _Where._Ptr;
  if ( !_Where._Ptr->_Isnil )
  {
    Right = _Where._Ptr->_Right;
    if ( Right->_Isnil )
    {
      for ( i = _Where._Ptr->_Parent; !i->_Isnil; i = i->_Parent )
      {
        if ( _Where._Ptr != i->_Right )
          break;
        _Where._Ptr = i;
      }
      _Where._Ptr = i;
      Ptr = i;
    }
    else
    {
      _Where._Ptr = _Where._Ptr->_Right;
      for ( j = Right->_Left; !j->_Isnil; j = j->_Left )
        _Where._Ptr = j;
      Ptr = _Where._Ptr;
    }
  }
  if ( v5->_Left->_Isnil )
  {
    v9 = v5->_Right;
LABEL_15:
    Parent = v5->_Parent;
    if ( !v9->_Isnil )
      v9->_Parent = Parent;
    if ( this->_Mypair._Myval2._Myval2._Myhead->_Parent == v5 )
    {
      this->_Mypair._Myval2._Myval2._Myhead->_Parent = v9;
    }
    else if ( Parent->_Left == v5 )
    {
      Parent->_Left = v9;
    }
    else
    {
      Parent->_Right = v9;
    }
    if ( this->_Mypair._Myval2._Myval2._Myhead->_Left == v5 )
    {
      if ( v9->_Isnil )
      {
        k = Parent;
      }
      else
      {
        Left = v9->_Left;
        for ( k = v9; !Left->_Isnil; Left = Left->_Left )
          k = Left;
      }
      this->_Mypair._Myval2._Myval2._Myhead->_Left = k;
    }
    Myhead = this->_Mypair._Myval2._Myval2._Myhead;
    if ( this->_Mypair._Myval2._Myval2._Myhead->_Right == v5 )
    {
      if ( v9->_Isnil )
      {
        Myhead->_Right = Parent;
      }
      else
      {
        v14 = v9->_Right;
        for ( m = v9; !v14->_Isnil; v14 = v14->_Right )
          m = v14;
        Myhead->_Right = m;
      }
    }
    goto LABEL_45;
  }
  if ( v5->_Right->_Isnil )
  {
    v9 = v5->_Left;
    goto LABEL_15;
  }
  v9 = _Where._Ptr->_Right;
  if ( _Where._Ptr == v5 )
    goto LABEL_15;
  v5->_Left->_Parent = _Where._Ptr;
  _Where._Ptr->_Left = v5->_Left;
  if ( _Where._Ptr == v5->_Right )
  {
    Parent = _Where._Ptr;
  }
  else
  {
    Parent = _Where._Ptr->_Parent;
    if ( !v9->_Isnil )
      v9->_Parent = Parent;
    Parent->_Left = v9;
    _Where._Ptr->_Right = v5->_Right;
    v5->_Right->_Parent = _Where._Ptr;
  }
  if ( this->_Mypair._Myval2._Myval2._Myhead->_Parent == v5 )
  {
    this->_Mypair._Myval2._Myval2._Myhead->_Parent = _Where._Ptr;
  }
  else
  {
    v16 = (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > *)v5->_Parent;
    if ( v16->_Ptr == v5 )
      v16->_Ptr = _Where._Ptr;
    else
      v16[2]._Ptr = _Where._Ptr;
  }
  _Where._Ptr->_Parent = v5->_Parent;
  Color = _Where._Ptr->_Color;
  _Where._Ptr->_Color = v5->_Color;
  v5->_Color = Color;
LABEL_45:
  if ( v5->_Color == 1 )
  {
    if ( v9 != this->_Mypair._Myval2._Myval2._Myhead->_Parent )
    {
      do
      {
        v18 = Parent;
        v19 = Parent;
        if ( v9->_Color != 1 )
          break;
        v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Left;
        if ( v9 == Parent->_Left )
        {
          v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Right;
          if ( !v20->_Color )
          {
            v20->_Color = 1;
            v21 = Parent->_Right;
            Parent->_Color = 0;
            Parent->_Right = v21->_Left;
            if ( !v21->_Left->_Isnil )
              v21->_Left->_Parent = Parent;
            v21->_Parent = Parent->_Parent;
            if ( Parent == this->_Mypair._Myval2._Myval2._Myhead->_Parent )
            {
              this->_Mypair._Myval2._Myval2._Myhead->_Parent = v21;
            }
            else
            {
              v22 = Parent->_Parent;
              if ( Parent == v22->_Left )
                v22->_Left = v21;
              else
                v22->_Right = v21;
            }
            v21->_Left = Parent;
            v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Right;
            Parent->_Parent = v21;
          }
          if ( v20->_Isnil )
            goto LABEL_70;
          if ( v20->_Left->_Color != 1 || v20->_Right->_Color != 1 )
          {
            if ( v20->_Right->_Color == 1 )
            {
              v20->_Left->_Color = 1;
              v20->_Color = 0;
              std::_Tree<std::_Tmap_traits<enum AgControllerComponentType,std::list<AgControllerComponent *>,std::less<enum AgControllerComponentType>,std::allocator<std::pair<enum AgControllerComponentType const,std::list<AgControllerComponent *>>>,0>>::_Rrotate(
                (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
                v20);
              v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Right;
            }
            v20->_Color = Parent->_Color;
            Parent->_Color = 1;
            v20->_Right->_Color = 1;
            std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Lrotate(
              (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
              (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent);
            break;
          }
        }
        else
        {
          if ( !v20->_Color )
          {
            v20->_Color = 1;
            Parent->_Color = 0;
            std::_Tree<std::_Tmap_traits<enum AgControllerComponentType,std::list<AgControllerComponent *>,std::less<enum AgControllerComponentType>,std::allocator<std::pair<enum AgControllerComponentType const,std::list<AgControllerComponent *>>>,0>>::_Rrotate(
              (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
              (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent);
            v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Left;
          }
          if ( v20->_Isnil )
            goto LABEL_70;
          if ( v20->_Right->_Color != 1 || v20->_Left->_Color != 1 )
          {
            if ( v20->_Left->_Color == 1 )
            {
              v20->_Right->_Color = 1;
              v20->_Color = 0;
              std::_Tree<std::_Tmap_traits<AgControllerUID,FighterOperationMapper,std::less<AgControllerUID>,std::allocator<std::pair<AgControllerUID const,FighterOperationMapper>>,0>>::_Lrotate(
                (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
                v20);
              v20 = (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent->_Left;
            }
            v20->_Color = Parent->_Color;
            Parent->_Color = 1;
            v20->_Left->_Color = 1;
            std::_Tree<std::_Tmap_traits<enum AgControllerComponentType,std::list<AgControllerComponent *>,std::less<enum AgControllerComponentType>,std::allocator<std::pair<enum AgControllerComponentType const,std::list<AgControllerComponent *>>>,0>>::_Rrotate(
              (std::_Tree<std::_Tmap_traits<AgStringRef,AgJsonNode,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,AgJsonNode> >,0> > *)this,
              (std::_Tree_node<std::pair<AgStringRef const ,AgJsonNode>,void *> *)Parent);
            break;
          }
        }
        v20->_Color = 0;
LABEL_70:
        v9 = v19;
        Parent = Parent->_Parent;
      }
      while ( v18 != this->_Mypair._Myval2._Myval2._Myhead->_Parent );
    }
    v9->_Color = 1;
  }
  operator delete(v5);
  Mysize = this->_Mypair._Myval2._Myval2._Mysize;
  if ( Mysize )
    this->_Mypair._Myval2._Myval2._Mysize = Mysize - 1;
  result->_Ptr = Ptr;
  return result;
}

sce::Vectormath::Scalar::Aos::Vector2 *__fastcall Framework::Input::ControllerContext::getAnalogLR2(
        Framework::Input::ControllerContext *this,
        sce::Vectormath::Scalar::Aos::Vector2 *result,
        int userIndex)
{
  __int64 v4; // r10
  __int64 *v5; // rcx
  __int64 *v6; // rax
  int *v7; // rdx
  bool v8; // zf
  std::list<AgControllerComponent *> *v9; // r8
  std::list<AgControllerComponent *> *v10; // rcx
  std::_List_node<AgControllerComponent *,void *> *Myhead; // rcx
  std::_List_node<AgControllerComponent *,void *> *Next; // rax
  AgControllerComponent *Myval; // rdx
  float v14; // xmm0_4
  float v15; // xmm1_4
  __int64 *v16; // rcx
  __int64 *v17; // rax
  int *v18; // rdx
  std::_List_node<AgControllerComponent *,void *> *v19; // rax
  AgControllerComponent *v20; // rdx
  sce::Vectormath::Scalar::Aos::Vector2 *v21; // rax

  if ( userIndex >= 1
    && (unsigned int)userIndex <= 4
    && (v4 = *((_QWORD *)&this->m_keyboard.m_ptr + 2 * userIndex)) != 0 )
  {
    v5 = *(__int64 **)(v4 + 32);
    v6 = v5;
    v7 = (int *)v5[1];
    while ( !*((_BYTE *)v7 + 25) )
    {
      if ( v7[8] >= 2 )
      {
        v6 = (__int64 *)v7;
        v7 = *(int **)v7;
      }
      else
      {
        v7 = (int *)*((_QWORD *)v7 + 2);
      }
    }
    if ( v6 == v5 || *((int *)v6 + 8) > 2 )
      v6 = *(__int64 **)(v4 + 32);
    v8 = v6 == v5;
    v9 = &AgController::ms_emptyControllerComponentList;
    v10 = (std::list<AgControllerComponent *> *)(v6 + 5);
    if ( v8 )
      v10 = &AgController::ms_emptyControllerComponentList;
    Myhead = v10->_Mypair._Myval2._Myhead;
    Next = Myhead->_Next;
    if ( Myhead->_Next == Myhead )
    {
LABEL_17:
      Myval = &AgController::ms_emptyControllerComponent;
    }
    else
    {
      while ( 1 )
      {
        Myval = Next->_Myval;
        if ( Myval->m_id == 9 )
          break;
        Next = Next->_Next;
        if ( Next == Myhead )
          goto LABEL_17;
      }
    }
    v14 = 0.0;
    if ( Myval->m_type )
      v15 = *(float *)&Myval[1].m_type;
    else
      v15 = 0.0;
    v16 = *(__int64 **)(v4 + 32);
    v17 = v16;
    v18 = (int *)v16[1];
    while ( !*((_BYTE *)v18 + 25) )
    {
      if ( v18[8] >= 2 )
      {
        v17 = (__int64 *)v18;
        v18 = *(int **)v18;
      }
      else
      {
        v18 = (int *)*((_QWORD *)v18 + 2);
      }
    }
    if ( v17 == v16 || *((int *)v17 + 8) > 2 )
      v17 = *(__int64 **)(v4 + 32);
    if ( v17 != v16 )
      v9 = (std::list<AgControllerComponent *> *)(v17 + 5);
    v19 = v9->_Mypair._Myval2._Myhead->_Next;
    if ( v19 == v9->_Mypair._Myval2._Myhead )
    {
LABEL_34:
      v20 = &AgController::ms_emptyControllerComponent;
    }
    else
    {
      while ( 1 )
      {
        v20 = v19->_Myval;
        if ( v20->m_id == 6 )
          break;
        v19 = v19->_Next;
        if ( v19 == v9->_Mypair._Myval2._Myhead )
          goto LABEL_34;
      }
    }
    if ( v20->m_type )
      v14 = *(float *)&v20[1].m_type;
    result->mX = v14;
    v21 = result;
    result->mY = v15;
  }
  else
  {
    *result = 0i64;
    return result;
  }
  return v21;
}

AgPointer<AgController> *__fastcall Framework::Input::ControllerContext::getControllerByValidDeviceID(
        Framework::Input::ControllerContext *this,
        AgPointer<AgController> *result,
        int deviceIndex)
{
  const AgPointer<AgPlayer> *p_m_gamepad; // rdx
  AgPointer<AgController> *v5; // rax
  int v6; // ecx
  const AgPointer<AgPlayer> *i; // rax

  p_m_gamepad = (const AgPointer<AgPlayer> *)this;
  if ( !deviceIndex )
  {
LABEL_2:
    AgPointer<AgBuffer<AgAllocator<1>>>::AgPointer<AgBuffer<AgAllocator<1>>>((AgPointer<AgPlayer> *)result, p_m_gamepad);
    return result;
  }
  p_m_gamepad = (const AgPointer<AgPlayer> *)&this->m_gamepad;
  v6 = 0;
  for ( i = p_m_gamepad + 4; p_m_gamepad != i; ++p_m_gamepad )
  {
    ++v6;
    if ( p_m_gamepad->m_ptr )
    {
      if ( v6 == deviceIndex )
        goto LABEL_2;
    }
  }
  result->m_ref = 0i64;
  v5 = result;
  result->m_ptr = 0i64;
  return v5;
}

sce::Vectormath::Scalar::Aos::Vector2 *__fastcall Framework::Input::ControllerContext::getLeftStick(
        Framework::Input::ControllerContext *this,
        sce::Vectormath::Scalar::Aos::Vector2 *result,
        int userIndex)
{
  __int64 v4; // r10
  __int64 *v5; // rcx
  __int64 *v6; // rax
  int *v7; // rdx
  bool v8; // zf
  std::list<AgControllerComponent *> *v9; // r8
  std::list<AgControllerComponent *> *v10; // rcx
  std::_List_node<AgControllerComponent *,void *> *Myhead; // rcx
  std::_List_node<AgControllerComponent *,void *> *Next; // rax
  AgControllerComponent *Myval; // rdx
  float v14; // xmm0_4
  float v15; // xmm1_4
  __int64 *v16; // rcx
  __int64 *v17; // rax
  int *v18; // rdx
  std::_List_node<AgControllerComponent *,void *> *v19; // rax
  AgControllerComponent *v20; // rdx
  sce::Vectormath::Scalar::Aos::Vector2 *v21; // rax

  if ( userIndex >= 1
    && (unsigned int)userIndex <= 4
    && (v4 = *((_QWORD *)&this->m_keyboard.m_ptr + 2 * userIndex)) != 0 )
  {
    v5 = *(__int64 **)(v4 + 32);
    v6 = v5;
    v7 = (int *)v5[1];
    while ( !*((_BYTE *)v7 + 25) )
    {
      if ( v7[8] >= 2 )
      {
        v6 = (__int64 *)v7;
        v7 = *(int **)v7;
      }
      else
      {
        v7 = (int *)*((_QWORD *)v7 + 2);
      }
    }
    if ( v6 == v5 || *((int *)v6 + 8) > 2 )
      v6 = *(__int64 **)(v4 + 32);
    v8 = v6 == v5;
    v9 = &AgController::ms_emptyControllerComponentList;
    v10 = (std::list<AgControllerComponent *> *)(v6 + 5);
    if ( v8 )
      v10 = &AgController::ms_emptyControllerComponentList;
    Myhead = v10->_Mypair._Myval2._Myhead;
    Next = Myhead->_Next;
    if ( Myhead->_Next == Myhead )
    {
LABEL_17:
      Myval = &AgController::ms_emptyControllerComponent;
    }
    else
    {
      while ( 1 )
      {
        Myval = Next->_Myval;
        if ( Myval->m_id == 5 )
          break;
        Next = Next->_Next;
        if ( Next == Myhead )
          goto LABEL_17;
      }
    }
    v14 = 0.0;
    if ( Myval->m_type )
      v15 = *(float *)&Myval[1].m_type;
    else
      v15 = 0.0;
    v16 = *(__int64 **)(v4 + 32);
    v17 = v16;
    v18 = (int *)v16[1];
    while ( !*((_BYTE *)v18 + 25) )
    {
      if ( v18[8] >= 2 )
      {
        v17 = (__int64 *)v18;
        v18 = *(int **)v18;
      }
      else
      {
        v18 = (int *)*((_QWORD *)v18 + 2);
      }
    }
    if ( v17 == v16 || *((int *)v17 + 8) > 2 )
      v17 = *(__int64 **)(v4 + 32);
    if ( v17 != v16 )
      v9 = (std::list<AgControllerComponent *> *)(v17 + 5);
    v19 = v9->_Mypair._Myval2._Myhead->_Next;
    if ( v19 == v9->_Mypair._Myval2._Myhead )
    {
LABEL_34:
      v20 = &AgController::ms_emptyControllerComponent;
    }
    else
    {
      while ( 1 )
      {
        v20 = v19->_Myval;
        if ( v20->m_id == 4 )
          break;
        v19 = v19->_Next;
        if ( v19 == v9->_Mypair._Myval2._Myhead )
          goto LABEL_34;
      }
    }
    if ( v20->m_type )
      v14 = *(float *)&v20[1].m_type;
    result->mX = v14;
    v21 = result;
    result->mY = v15;
  }
  else
  {
    *result = 0i64;
    return result;
  }
  return v21;
}

void __fastcall Framework::Input::ControllerContext::initialize(Framework::Input::ControllerContext *this)
{
  Framework::Input::ControllerContext *v1; // r12
  AgSingleton<AgInputManager> *v2; // rsi
  int i; // ebx
  AgPointer<AgController> *FirstController; // rax
  AgReferenceCount *m_ref; // rdx
  AgController *m_ptr; // rcx
  unsigned __int64 v7; // r14
  AgReferenceCount *v8; // rbx
  AgController *v9; // rdi
  int v10; // er15
  AgController *v11; // rdi
  AgReferenceCount *v12; // rbx
  int v13; // er15
  AgPointer<AgController> *Myfirst; // rbx
  AgPointer<AgController> *j; // rdi
  unsigned __int64 PairedUserId; // rax
  AgPointer<AgController> *v17; // rdx
  AgReferenceCount *v18; // rax
  AgController *v19; // rcx
  AgReferenceCount *v20; // rsi
  AgController *v21; // r15
  int v22; // er12
  AgSingleton<AgInputManager>_vtbl *v23; // rdx
  AgSingleton<AgInputManager>_vtbl *v24; // rcx
  unsigned __int64 v25; // rdi
  AgSingleton<AgInputManager>_vtbl *v26; // r9
  __int64 v27; // rdx
  unsigned __int64 v28; // rdx
  unsigned __int64 v29; // r9
  unsigned __int64 v30; // r8
  AgSingleton<AgInputManager>_vtbl *v31; // rcx
  void (__fastcall **v32)(AgSingleton<AgInputManager> *); // rdi
  AgSingleton<AgInputManager>_vtbl *v33; // r9
  AgSingleton<AgInputManager>_vtbl *v34; // rcx
  __int64 v35; // rdx
  unsigned __int64 v36; // rdx
  unsigned __int64 v37; // r9
  unsigned __int64 v38; // r8
  _QWORD *v39; // rax
  __int64 v40; // rsi
  std::_Wrap_alloc<std::allocator<AgDelegate1<AgControllerRemovedEvent const &,void> > > *v41; // r9
  unsigned __int64 v42; // rdx
  unsigned __int64 v43; // rcx
  unsigned __int64 v44; // rdi
  __int64 v45; // r8
  __int64 v46; // rdx
  unsigned __int64 v47; // rdx
  unsigned __int64 v48; // r8
  unsigned __int64 v49; // rcx
  _QWORD *v50; // rcx
  _QWORD *v51; // rdi
  __int64 v52; // rcx
  __int64 v53; // r8
  __int64 v54; // rdx
  unsigned __int64 v55; // rdx
  unsigned __int64 v56; // rcx
  Framework::Input::ControllerContext **v57; // rax
  AgPointer<AgController> *v58; // rbx
  AgPointer<AgController> *Mylast; // rdi
  AgPointer<AgController> result; // [rsp+28h] [rbp-41h] BYREF
  __int64 v61[2]; // [rsp+38h] [rbp-31h] BYREF
  __int64 v62[2]; // [rsp+48h] [rbp-21h] BYREF
  int v63; // [rsp+58h] [rbp-11h]
  AgSingleton<AgInputManager> *v64; // [rsp+60h] [rbp-9h]
  int v65; // [rsp+68h] [rbp-1h]
  __int64 v66; // [rsp+70h] [rbp+7h]
  std::vector<AgPointer<AgController>> controllers; // [rsp+78h] [rbp+Fh] BYREF
  AgSingleton<AgInputManager> *v69; // [rsp+D8h] [rbp+6Fh]

  v1 = this;
  v2 = AgSingleton<AgInputManager>::ms_instance;
  v69 = AgSingleton<AgInputManager>::ms_instance;
  for ( i = 113; i <= 135; ++i )
    AgInputManager::addKeyToLastUsedIgnores((AgInputManager *)v2, (AgKeyboardButton)i);
  FirstController = AgInputManager::getFirstController((AgInputManager *)v2, &result, AgControllerType_Keyboard);
  m_ref = FirstController->m_ref;
  m_ptr = FirstController->m_ptr;
  v7 = 0i64;
  FirstController->m_ref = 0i64;
  FirstController->m_ptr = 0i64;
  v8 = v1->m_keyboard.m_ref;
  v9 = v1->m_keyboard.m_ptr;
  v1->m_keyboard.m_ref = m_ref;
  v1->m_keyboard.m_ptr = m_ptr;
  if ( v8 )
  {
    v10 = 0;
    if ( !AgAtomicDecrement(&v8->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v8->m_weakCount) )
        v10 = 1;
      v8->m_data = 0i64;
      if ( v9 )
        ((void (__fastcall *)(AgController *, __int64))v9->~AgController)(v9, 1i64);
      if ( v10 )
        AgReferenceCount::operator delete(v8);
    }
  }
  v11 = result.m_ptr;
  result.m_ptr = 0i64;
  v12 = result.m_ref;
  if ( result.m_ref )
  {
    result.m_ref = 0i64;
    v13 = 0;
    if ( !AgAtomicDecrement(&v12->m_strongCount) )
    {
      if ( !AgAtomicDecrement(&v12->m_weakCount) )
        v13 = 1;
      v12->m_data = 0i64;
      if ( v11 )
        ((void (__fastcall *)(AgController *, __int64))v11->~AgController)(v11, 1i64);
      if ( v13 )
        AgReferenceCount::operator delete(v12);
    }
  }
  memset(&controllers, 0, sizeof(controllers));
  AgInputManager::getControllersByType((AgInputManager *)v2, AgControllerType_Gamepad, &controllers);
  Myfirst = controllers._Mypair._Myval2._Myfirst;
  for ( j = controllers._Mypair._Myval2._Mylast; Myfirst != j; ++Myfirst )
  {
    PairedUserId = AgInputManager::getPairedUserId((AgInputManager *)v2, Myfirst->m_ptr->m_id);
    if ( PairedUserId < 4 )
    {
      v17 = &v1->m_gamepad._Elems[PairedUserId];
      v18 = Myfirst->m_ref;
      v19 = Myfirst->m_ptr;
      Myfirst->m_ref = 0i64;
      Myfirst->m_ptr = 0i64;
      v20 = v17->m_ref;
      v21 = v17->m_ptr;
      v17->m_ref = v18;
      v17->m_ptr = v19;
      if ( v20 )
      {
        v22 = 0;
        if ( !AgAtomicDecrement(&v20->m_strongCount) )
        {
          if ( !AgAtomicDecrement(&v20->m_weakCount) )
            v22 = 1;
          v20->m_data = 0i64;
          if ( v21 )
            ((void (__fastcall *)(AgController *, __int64))v21->~AgController)(v21, 1i64);
          if ( v22 )
            AgReferenceCount::operator delete(v20);
        }
        v1 = this;
      }
      v2 = v69;
    }
  }
  v61[1] = (__int64)Framework::Input::ControllerContext::onControllerAdded;
  v61[0] = (__int64)v1;
  v64 = v2 + 20;
  EnterCriticalSection((LPCRITICAL_SECTION)&v2[20]);
  v63 = 1;
  v23 = v2[26].__vftable;
  if ( v61 >= (__int64 *)v23 || (v24 = v2[25].__vftable, v24 > (AgSingleton<AgInputManager>_vtbl *)v61) )
  {
    v33 = v2[27].__vftable;
    if ( v23 == v33 && !(((char *)v33 - (char *)v23) >> 4) )
    {
      v34 = v2[25].__vftable;
      v35 = ((char *)v23 - (char *)v34) >> 4;
      if ( v35 == 0xFFFFFFFFFFFFFFFi64 )
        std::_Xlength_error("vector<T> too long");
      v36 = v35 + 1;
      v37 = ((char *)v33 - (char *)v34) >> 4;
      v38 = 0i64;
      if ( 0xFFFFFFFFFFFFFFFi64 - (v37 >> 1) >= v37 )
        v38 = v37 + (v37 >> 1);
      if ( v38 >= v36 )
        v36 = v38;
      std::vector<AgDelegate1<AgControllerAddedEvent const &,void>>::_Reallocate(
        (std::vector<AgDelegate1<AgControllerAddedEvent const &,void>> *)&v2[25],
        v36);
    }
    v39 = &v2[26].~AgSingleton<AgInputManager>;
    if ( v39 )
    {
      v39[1] = Framework::Input::ControllerContext::onControllerAdded;
      *v39 = v1;
    }
  }
  else
  {
    v25 = (char *)v61 - (char *)v24;
    v26 = v2[27].__vftable;
    if ( v23 == v26 && !(((char *)v26 - (char *)v23) >> 4) )
    {
      v27 = ((char *)v23 - (char *)v24) >> 4;
      if ( v27 == 0xFFFFFFFFFFFFFFFi64 )
        std::_Xlength_error("vector<T> too long");
      v28 = v27 + 1;
      v29 = ((char *)v26 - (char *)v24) >> 4;
      v30 = 0i64;
      if ( 0xFFFFFFFFFFFFFFFi64 - (v29 >> 1) >= v29 )
        v30 = v29 + (v29 >> 1);
      if ( v30 >= v28 )
        v28 = v30;
      std::vector<AgDelegate1<AgControllerAddedEvent const &,void>>::_Reallocate(
        (std::vector<AgDelegate1<AgControllerAddedEvent const &,void>> *)&v2[25],
        v28);
    }
    v31 = v2[26].__vftable;
    v32 = (void (__fastcall **)(AgSingleton<AgInputManager> *))((char *)&v2[25].~AgSingleton<AgInputManager>
                                                              + (v25 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v31 )
    {
      v31->~AgSingleton<AgInputManager> = 0i64;
      v31->onSingletonInit = 0i64;
      v31->onSingletonInit = (int (__fastcall *)(AgSingleton<AgInputManager> *))v32[1];
      v31->~AgSingleton<AgInputManager> = *v32;
    }
  }
  v2[26].__vftable = (AgSingleton<AgInputManager>_vtbl *)((char *)v2[26].__vftable + 16);
  LeaveCriticalSection((LPCRITICAL_SECTION)&v2[20]);
  v40 = (__int64)&v2[36];
  v62[1] = (__int64)Framework::Input::ControllerContext::onControllerRemoved;
  v62[0] = (__int64)v1;
  v66 = v40;
  EnterCriticalSection((LPCRITICAL_SECTION)v40);
  v65 = 1;
  v42 = *(_QWORD *)(v40 + 48);
  if ( (unsigned __int64)v62 >= v42 || (v43 = *(_QWORD *)(v40 + 40), v43 > (unsigned __int64)v62) )
  {
    v52 = *(_QWORD *)(v40 + 56);
    if ( v42 == v52 && !((__int64)(v52 - v42) >> 4) )
    {
      v53 = *(_QWORD *)(v40 + 40);
      v54 = (__int64)(v42 - v53) >> 4;
      if ( v54 == 0xFFFFFFFFFFFFFFFi64 )
        std::_Xlength_error("vector<T> too long");
      v55 = v54 + 1;
      v56 = (v52 - v53) >> 4;
      if ( 0xFFFFFFFFFFFFFFFi64 - (v56 >> 1) >= v56 )
        v7 = v56 + (v56 >> 1);
      if ( v7 >= v55 )
        v55 = v7;
      std::vector<AgDelegate1<AgTypingInputEvent const &,void>>::_Reallocate(
        (std::vector<AgDelegate1<AgControllerRemovedEvent const &,void>> *)(v40 + 40),
        v55,
        v53,
        v41);
    }
    v57 = *(Framework::Input::ControllerContext ***)(v40 + 48);
    if ( v57 )
    {
      v57[1] = (Framework::Input::ControllerContext *)Framework::Input::ControllerContext::onControllerRemoved;
      *v57 = v1;
    }
  }
  else
  {
    v44 = (unsigned __int64)v62 - v43;
    v45 = *(_QWORD *)(v40 + 56);
    if ( v42 == v45 && !((__int64)(v45 - v42) >> 4) )
    {
      v46 = (__int64)(v42 - v43) >> 4;
      if ( v46 == 0xFFFFFFFFFFFFFFFi64 )
        std::_Xlength_error("vector<T> too long");
      v47 = v46 + 1;
      v48 = (__int64)(v45 - v43) >> 4;
      v49 = 0i64;
      if ( 0xFFFFFFFFFFFFFFFi64 - (v48 >> 1) >= v48 )
        v49 = v48 + (v48 >> 1);
      if ( v49 >= v47 )
        v47 = v49;
      std::vector<AgDelegate1<AgTypingInputEvent const &,void>>::_Reallocate(
        (std::vector<AgDelegate1<AgControllerRemovedEvent const &,void>> *)(v40 + 40),
        v47,
        v48,
        v41);
    }
    v50 = *(_QWORD **)(v40 + 48);
    v51 = (_QWORD *)(*(_QWORD *)(v40 + 40) + (v44 & 0xFFFFFFFFFFFFFFF0ui64));
    if ( v50 )
    {
      *v50 = 0i64;
      v50[1] = 0i64;
      v50[1] = v51[1];
      *v50 = *v51;
    }
  }
  *(_QWORD *)(v40 + 48) += 16i64;
  LeaveCriticalSection((LPCRITICAL_SECTION)v40);
  v58 = controllers._Mypair._Myval2._Myfirst;
  if ( controllers._Mypair._Myval2._Myfirst )
  {
    Mylast = controllers._Mypair._Myval2._Mylast;
    if ( controllers._Mypair._Myval2._Myfirst != controllers._Mypair._Myval2._Mylast )
    {
      do
        AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)v58++);
      while ( v58 != Mylast );
      v58 = controllers._Mypair._Myval2._Myfirst;
    }
    std::_Wrap_alloc<std::allocator<AgDelegate1<AgSuspendingEvent const &,void>>>::deallocate(
      (std::_Wrap_alloc<std::allocator<AgDelegate1<AgUserUpdatedEvent const &,void> > > *)&controllers,
      (AgDelegate1<AgUserUpdatedEvent const &,void> *)v58,
      controllers._Mypair._Myval2._Myend - v58);
  }
}

bool __fastcall Framework::Input::ControllerContext::isButtonDown(
        Framework::Input::ControllerContext *this,
        int userIndex,
        unsigned int buttons,
        Framework::Input::ButtonEventPattern pattern)
{
  __int64 v4; // r9
  __int64 *v5; // rcx
  __int64 *v6; // rax
  int *v7; // rdx
  bool v8; // zf
  std::list<AgControllerComponent *> *v9; // rcx
  std::_List_node<AgControllerComponent *,void *> *Myhead; // rcx
  std::_List_node<AgControllerComponent *,void *> *i; // rax
  AgControllerComponent *Myval; // rdx
  std::list<AgControllerComponent *> *v14; // rcx
  std::_List_node<AgControllerComponent *,void *> *v15; // rcx
  std::_List_node<AgControllerComponent *,void *> *Next; // rax
  std::list<AgControllerComponent *> *v17; // rcx
  std::_List_node<AgControllerComponent *,void *> *v18; // rcx
  std::_List_node<AgControllerComponent *,void *> *v19; // rax
  AgControllerComponent *v20; // rdx

  if ( userIndex < 1 )
    return 0;
  if ( (unsigned __int64)userIndex > 4 )
    return 0;
  v4 = *((_QWORD *)&this->m_keyboard.m_ptr + 2 * userIndex);
  if ( !v4 )
    return 0;
  v5 = *(__int64 **)(v4 + 32);
  v6 = v5;
  v7 = (int *)v5[1];
  if ( buttons == 14 )
  {
    while ( !*((_BYTE *)v7 + 25) )
    {
      if ( v7[8] >= 2 )
      {
        v6 = (__int64 *)v7;
        v7 = *(int **)v7;
      }
      else
      {
        v7 = (int *)*((_QWORD *)v7 + 2);
      }
    }
    if ( v6 == v5 || *((int *)v6 + 8) > 2 )
      v6 = *(__int64 **)(v4 + 32);
    v8 = v6 == v5;
    v9 = (std::list<AgControllerComponent *> *)(v6 + 5);
    if ( v8 )
      v9 = &AgController::ms_emptyControllerComponentList;
    Myhead = v9->_Mypair._Myval2._Myhead;
    for ( i = Myhead->_Next; i != Myhead; i = i->_Next )
    {
      Myval = i->_Myval;
      if ( Myval->m_id == 6 )
        return Myval->m_type && *(float *)&Myval[1].m_type != 0.0;
    }
LABEL_18:
    Myval = &AgController::ms_emptyControllerComponent;
    return Myval->m_type && *(float *)&Myval[1].m_type != 0.0;
  }
  if ( buttons == 15 )
  {
    while ( !*((_BYTE *)v7 + 25) )
    {
      if ( v7[8] >= 2 )
      {
        v6 = (__int64 *)v7;
        v7 = *(int **)v7;
      }
      else
      {
        v7 = (int *)*((_QWORD *)v7 + 2);
      }
    }
    if ( v6 == v5 || *((int *)v6 + 8) > 2 )
      v6 = *(__int64 **)(v4 + 32);
    v8 = v6 == v5;
    v14 = (std::list<AgControllerComponent *> *)(v6 + 5);
    if ( v8 )
      v14 = &AgController::ms_emptyControllerComponentList;
    v15 = v14->_Mypair._Myval2._Myhead;
    Next = v15->_Next;
    if ( v15->_Next != v15 )
    {
      while ( 1 )
      {
        Myval = Next->_Myval;
        if ( Myval->m_id == 9 )
          return Myval->m_type && *(float *)&Myval[1].m_type != 0.0;
        Next = Next->_Next;
        if ( Next == v15 )
          goto LABEL_18;
      }
    }
    goto LABEL_18;
  }
  while ( !*((_BYTE *)v7 + 25) )
  {
    if ( v7[8] >= 1 )
    {
      v6 = (__int64 *)v7;
      v7 = *(int **)v7;
    }
    else
    {
      v7 = (int *)*((_QWORD *)v7 + 2);
    }
  }
  if ( v6 == v5 || *((int *)v6 + 8) > 1 )
    v6 = *(__int64 **)(v4 + 32);
  v8 = v6 == v5;
  v17 = (std::list<AgControllerComponent *> *)(v6 + 5);
  if ( v8 )
    v17 = &AgController::ms_emptyControllerComponentList;
  v18 = v17->_Mypair._Myval2._Myhead;
  v19 = v18->_Next;
  if ( v18->_Next == v18 )
  {
LABEL_51:
    v20 = &AgController::ms_emptyControllerComponent;
  }
  else
  {
    while ( 1 )
    {
      v20 = v19->_Myval;
      if ( !v20->m_id )
        break;
      v19 = v19->_Next;
      if ( v19 == v18 )
        goto LABEL_51;
    }
  }
  return ((1 << (buttons & 0x1F)) & *(_DWORD *)(*(_QWORD *)&v20[1]
                                              + 4 * ((unsigned __int64)(unsigned __int16)buttons >> 5))) != 0;
}

bool __fastcall Framework::Input::ControllerContext::isKeyboardButtonDown(
        Framework::Input::ControllerContext *this,
        unsigned __int16 buttons,
        Framework::Input::ButtonEventPattern pattern)
{
  AgController *m_ptr; // r9
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *Myhead; // rcx
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *v6; // rax
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *Parent; // r8
  bool v8; // zf
  std::list<AgControllerComponent *> *p_second; // rcx
  std::_List_node<AgControllerComponent *,void *> *v10; // rcx
  std::_List_node<AgControllerComponent *,void *> *Next; // rax
  AgControllerComponent *Myval; // rdx

  m_ptr = this->m_keyboard.m_ptr;
  Myhead = m_ptr->m_components._Mypair._Myval2._Myval2._Myhead;
  v6 = Myhead;
  Parent = Myhead->_Parent;
  while ( !Parent->_Isnil )
  {
    if ( Parent->_Myval.first >= AgControllerComponentType_Buttons )
    {
      v6 = Parent;
      Parent = Parent->_Left;
    }
    else
    {
      Parent = Parent->_Right;
    }
  }
  if ( v6 == Myhead || v6->_Myval.first > AgControllerComponentType_Buttons )
    v6 = m_ptr->m_components._Mypair._Myval2._Myval2._Myhead;
  v8 = v6 == Myhead;
  p_second = &v6->_Myval.second;
  if ( v8 )
    p_second = &AgController::ms_emptyControllerComponentList;
  v10 = p_second->_Mypair._Myval2._Myhead;
  Next = v10->_Next;
  if ( v10->_Next == v10 )
  {
LABEL_14:
    Myval = &AgController::ms_emptyControllerComponent;
  }
  else
  {
    while ( 1 )
    {
      Myval = Next->_Myval;
      if ( !Myval->m_id )
        break;
      Next = Next->_Next;
      if ( Next == v10 )
        goto LABEL_14;
    }
  }
  return ((1 << (buttons & 0x1F)) & *(_DWORD *)(*(_QWORD *)&Myval[1] + 4 * ((unsigned __int64)buttons >> 5))) != 0;
}

bool __fastcall Framework::Input::ControllerContext::isKeyboardButtonPressedNoRepeat(
        Framework::Input::ControllerContext *this,
        unsigned __int16 buttons,
        Framework::Input::ButtonEventPattern pattern)
{
  AgController *m_ptr; // r9
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *Myhead; // rcx
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *v5; // rax
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *Parent; // r8
  bool v7; // zf
  std::list<AgControllerComponent *> *p_second; // rcx
  std::_List_node<AgControllerComponent *,void *> *v9; // rcx
  std::_List_node<AgControllerComponent *,void *> *Next; // rax
  AgControllerComponent *Myval; // r8

  m_ptr = this->m_keyboard.m_ptr;
  Myhead = m_ptr->m_components._Mypair._Myval2._Myval2._Myhead;
  v5 = Myhead;
  Parent = Myhead->_Parent;
  while ( !Parent->_Isnil )
  {
    if ( Parent->_Myval.first >= AgControllerComponentType_Buttons )
    {
      v5 = Parent;
      Parent = Parent->_Left;
    }
    else
    {
      Parent = Parent->_Right;
    }
  }
  if ( v5 == Myhead || v5->_Myval.first > AgControllerComponentType_Buttons )
    v5 = m_ptr->m_components._Mypair._Myval2._Myval2._Myhead;
  v7 = v5 == Myhead;
  p_second = &v5->_Myval.second;
  if ( v7 )
    p_second = &AgController::ms_emptyControllerComponentList;
  v9 = p_second->_Mypair._Myval2._Myhead;
  Next = v9->_Next;
  if ( v9->_Next == v9 )
  {
LABEL_14:
    Myval = &AgController::ms_emptyControllerComponent;
  }
  else
  {
    while ( 1 )
    {
      Myval = Next->_Myval;
      if ( !Myval->m_id )
        break;
      Next = Next->_Next;
      if ( Next == v9 )
        goto LABEL_14;
    }
  }
  return ((1 << (buttons & 0x1F)) & *(_DWORD *)(*(_QWORD *)&Myval[5] + 4 * ((unsigned __int64)buttons >> 5))) == 0
      && ((1 << (buttons & 0x1F)) & *(_DWORD *)(*(_QWORD *)&Myval[1] + 4 * ((unsigned __int64)buttons >> 5))) != 0;
}

bool __fastcall Framework::Input::ControllerContext::isKeyboardButtonReleasedNoRepeat(
        Framework::Input::ControllerContext *this,
        unsigned __int16 buttons,
        Framework::Input::ButtonEventPattern pattern)
{
  AgController *m_ptr; // r9
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *Myhead; // rcx
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *v5; // rax
  std::_Tree_node<std::pair<enum AgControllerComponentType const ,std::list<AgControllerComponent *> >,void *> *Parent; // r8
  bool v7; // zf
  std::list<AgControllerComponent *> *p_second; // rcx
  std::_List_node<AgControllerComponent *,void *> *v9; // rcx
  std::_List_node<AgControllerComponent *,void *> *Next; // rax
  AgControllerComponent *Myval; // r8

  m_ptr = this->m_keyboard.m_ptr;
  Myhead = m_ptr->m_components._Mypair._Myval2._Myval2._Myhead;
  v5 = Myhead;
  Parent = Myhead->_Parent;
  while ( !Parent->_Isnil )
  {
    if ( Parent->_Myval.first >= AgControllerComponentType_Buttons )
    {
      v5 = Parent;
      Parent = Parent->_Left;
    }
    else
    {
      Parent = Parent->_Right;
    }
  }
  if ( v5 == Myhead || v5->_Myval.first > AgControllerComponentType_Buttons )
    v5 = m_ptr->m_components._Mypair._Myval2._Myval2._Myhead;
  v7 = v5 == Myhead;
  p_second = &v5->_Myval.second;
  if ( v7 )
    p_second = &AgController::ms_emptyControllerComponentList;
  v9 = p_second->_Mypair._Myval2._Myhead;
  Next = v9->_Next;
  if ( v9->_Next == v9 )
  {
LABEL_14:
    Myval = &AgController::ms_emptyControllerComponent;
  }
  else
  {
    while ( 1 )
    {
      Myval = Next->_Myval;
      if ( !Myval->m_id )
        break;
      Next = Next->_Next;
      if ( Next == v9 )
        goto LABEL_14;
    }
  }
  return ((1 << (buttons & 0x1F)) & *(_DWORD *)(*(_QWORD *)&Myval[5] + 4 * ((unsigned __int64)buttons >> 5))) != 0
      && ((1 << (buttons & 0x1F)) & *(_DWORD *)(*(_QWORD *)&Myval[1] + 4 * ((unsigned __int64)buttons >> 5))) == 0;
}

void __fastcall Framework::Input::ControllerContext::onControllerAdded(
        Framework::Input::ControllerContext *this,
        const AgControllerAddedEvent *e)
{
  unsigned __int64 pairedId; // rcx
  AgSDLMappingParser *p_m_genericMappings; // rbx
  Framework::Input::ControllerContext *v6; // rax
  Framework::Input::ControllerContext *v7; // rdi
  std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *Myhead; // rdx
  unsigned __int64 Mysize; // rdx
  AgSDLMappingParser v10; // [rsp+20h] [rbp-18h] BYREF
  std::_Tree_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > > result; // [rsp+48h] [rbp+10h] BYREF

  if ( e->controller.m_ptr->m_type == AgControllerType_Gamepad )
  {
    pairedId = e->pairedId;
    if ( pairedId < 4 )
    {
      AgPointer<AgController>::operator=(&this->m_gamepad._Elems[pairedId], &e->controller);
      if ( !e->pairedId )
      {
        AgSDLMappingParser::AgSDLMappingParser(&v10, &e->controller);
        p_m_genericMappings = &this->m_genericMappings;
        v7 = v6;
        if ( &this->m_genericMappings != (AgSDLMappingParser *)v6 )
        {
          std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::clear((std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&this->m_genericMappings);
          Myhead = p_m_genericMappings->m_buttonIdLUT._Mypair._Myval2._Myval2._Myhead;
          p_m_genericMappings->m_buttonIdLUT._Mypair._Myval2._Myval2._Myhead = (std::_Tree_node<std::pair<enum AgGamepadButton const ,int>,void *> *)v7->m_keyboard.m_ref;
          v7->m_keyboard.m_ref = (AgReferenceCount *)Myhead;
          Mysize = this->m_genericMappings.m_buttonIdLUT._Mypair._Myval2._Myval2._Mysize;
          this->m_genericMappings.m_buttonIdLUT._Mypair._Myval2._Myval2._Mysize = (unsigned __int64)v7->m_keyboard.m_ptr;
          v7->m_keyboard.m_ptr = (AgController *)Mysize;
        }
        std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const,enum AgGamepadButton>>,0>>::erase(
          (std::_Tree<std::_Tmap_traits<AgStringRef,enum AgGamepadButton,std::less<AgStringRef>,std::allocator<std::pair<AgStringRef const ,enum AgGamepadButton> >,0> > *)&v10,
          &result,
          (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >)v10.m_buttonIdLUT._Mypair._Myval2._Myval2._Myhead->_Left,
          (std::_Tree_const_iterator<std::_Tree_val<std::_Tree_simple_types<std::pair<AgStringRef const ,enum AgGamepadButton> > > >)v10.m_buttonIdLUT._Mypair._Myval2._Myval2._Myhead);
        operator delete(v10.m_buttonIdLUT._Mypair._Myval2._Myval2._Myhead);
      }
    }
  }
}

void __fastcall Framework::Input::ControllerContext::onControllerRemoved(
        Framework::Input::ControllerContext *this,
        const AgControllerRemovedEvent *e)
{
  unsigned __int64 pairedId; // rdx
  AgPointer<AgController> *v3; // rdx
  KOFApplication *m_ptr; // rax
  AgPointer<KOFApplication> v5; // [rsp+20h] [rbp-18h] BYREF

  if ( e->controller.m_ptr->m_type == AgControllerType_Gamepad )
  {
    pairedId = e->pairedId;
    if ( pairedId < 4 )
    {
      v3 = &this->m_gamepad._Elems[pairedId];
      m_ptr = (KOFApplication *)v3->m_ptr;
      v5.m_ref = v3->m_ref;
      v3->m_ref = 0i64;
      v3->m_ptr = 0i64;
      v5.m_ptr = m_ptr;
      AgPointer<AgUser>::~AgPointer<AgUser>(&v5);
    }
  }
}

void __fastcall Framework::Input::ControllerContext::setVibration(
        Framework::Input::ControllerContext *this,
        int userIndex,
        long double vibSec,
        unsigned __int8 largeMotor)
{
  __int64 v4; // r8
  __int64 *v5; // rcx
  __int64 *v6; // rax
  int *v7; // rdx
  bool v8; // zf
  std::list<AgControllerComponent *> *v9; // rcx
  std::_List_node<AgControllerComponent *,void *> *Myhead; // rcx
  std::_List_node<AgControllerComponent *,void *> *Next; // rax
  AgControllerComponent *Myval; // rdx

  if ( userIndex >= 1 && (unsigned int)userIndex <= 4 )
  {
    v4 = *((_QWORD *)&this->m_keyboard.m_ptr + 2 * userIndex);
    if ( v4 )
    {
      v5 = *(__int64 **)(v4 + 32);
      v6 = v5;
      v7 = (int *)v5[1];
      while ( !*((_BYTE *)v7 + 25) )
      {
        if ( v7[8] >= 4 )
        {
          v6 = (__int64 *)v7;
          v7 = *(int **)v7;
        }
        else
        {
          v7 = (int *)*((_QWORD *)v7 + 2);
        }
      }
      if ( v6 == v5 || *((int *)v6 + 8) > 4 )
        v6 = *(__int64 **)(v4 + 32);
      v8 = v6 == v5;
      v9 = (std::list<AgControllerComponent *> *)(v6 + 5);
      if ( v8 )
        v9 = &AgController::ms_emptyControllerComponentList;
      Myhead = v9->_Mypair._Myval2._Myhead;
      Next = Myhead->_Next;
      if ( Myhead->_Next == Myhead )
      {
LABEL_17:
        Myval = &AgController::ms_emptyControllerComponent;
      }
      else
      {
        while ( 1 )
        {
          Myval = Next->_Myval;
          if ( !Myval->m_id )
            break;
          Next = Next->_Next;
          if ( Next == Myhead )
            goto LABEL_17;
        }
      }
      if ( Myval[2].m_type )
      {
        if ( Myval->m_type )
        {
          Myval[1].m_id = (int)(vibSec * 1000.0);
          *(float *)&Myval[1].m_type = (float)largeMotor / 255.0;
        }
      }
    }
  }
}

void __fastcall Framework::Input::ControllerContext::stopVibration(
        Framework::Input::ControllerContext *this,
        int userIndex)
{
  __int64 v2; // r8
  __int64 *v3; // rcx
  __int64 *v4; // rax
  int *v5; // rdx
  bool v6; // zf
  std::list<AgControllerComponent *> *v7; // rcx
  std::_List_node<AgControllerComponent *,void *> *Myhead; // rcx
  std::_List_node<AgControllerComponent *,void *> *Next; // rax
  AgControllerComponent *Myval; // rdx

  if ( userIndex >= 1 && (unsigned int)userIndex <= 4 )
  {
    v2 = *((_QWORD *)&this->m_keyboard.m_ptr + 2 * userIndex);
    if ( v2 )
    {
      v3 = *(__int64 **)(v2 + 32);
      v4 = v3;
      v5 = (int *)v3[1];
      while ( !*((_BYTE *)v5 + 25) )
      {
        if ( v5[8] >= 4 )
        {
          v4 = (__int64 *)v5;
          v5 = *(int **)v5;
        }
        else
        {
          v5 = (int *)*((_QWORD *)v5 + 2);
        }
      }
      if ( v4 == v3 || *((int *)v4 + 8) > 4 )
        v4 = *(__int64 **)(v2 + 32);
      v6 = v4 == v3;
      v7 = (std::list<AgControllerComponent *> *)(v4 + 5);
      if ( v6 )
        v7 = &AgController::ms_emptyControllerComponentList;
      Myhead = v7->_Mypair._Myval2._Myhead;
      Next = Myhead->_Next;
      if ( Myhead->_Next == Myhead )
      {
LABEL_17:
        Myval = &AgController::ms_emptyControllerComponent;
      }
      else
      {
        while ( 1 )
        {
          Myval = Next->_Myval;
          if ( !Myval->m_id )
            break;
          Next = Next->_Next;
          if ( Next == Myhead )
            goto LABEL_17;
        }
      }
      if ( Myval[2].m_type )
      {
        if ( Myval->m_type )
        {
          Myval[1].m_type = AgControllerComponentType_Unknown;
          Myval[1].m_id = -1;
        }
      }
    }
  }
}

void __fastcall Framework::Input::ControllerContext::update(Framework::Input::ControllerContext *this)
{
  AgController *m_ptr; // rdx
  AgControllerType *p_m_lastUsedContType; // rcx
  std::array<AgPointer<AgController>,4> *p_m_gamepad; // r8
  AgControllerHardwareType m_hardwareType; // eax
  std::array<AgPointer<AgController>,4> *v6; // rax
  AgPointer<AgController> result; // [rsp+20h] [rbp-18h] BYREF

  AgInputManager::getLastUsedController((AgInputManager *)AgSingleton<AgInputManager>::ms_instance, &result);
  m_ptr = result.m_ptr;
  if ( result.m_ptr )
  {
    p_m_lastUsedContType = &this->m_lastUsedContType;
    this->m_lastUsedContType = result.m_ptr->m_type;
    p_m_gamepad = &this->m_gamepad;
    m_hardwareType = m_ptr->m_hardwareType;
    if ( m_hardwareType == AgControllerHardwareType_Default )
      m_hardwareType = AgControllerHardwareType_Generic;
    this->m_lastUsedContHWType = m_hardwareType;
    v6 = &this->m_gamepad;
    if ( p_m_gamepad != (std::array<AgPointer<AgController>,4> *)p_m_lastUsedContType )
    {
      do
      {
        if ( v6->_Elems[0].m_ref == result.m_ref )
          break;
        v6 = (std::array<AgPointer<AgController>,4> *)((char *)v6 + 16);
      }
      while ( v6 != (std::array<AgPointer<AgController>,4> *)p_m_lastUsedContType );
    }
    if ( v6 == (std::array<AgPointer<AgController>,4> *)p_m_lastUsedContType )
      this->m_lastUsedContIndex = 0;
    else
      this->m_lastUsedContIndex = (((char *)v6 - (char *)p_m_gamepad) >> 4) + 1;
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&result);
  }
  else
  {
    *(_QWORD *)&this->m_lastUsedContType = 0i64;
    this->m_lastUsedContIndex = 0;
    AgPointer<AgUser>::~AgPointer<AgUser>((AgPointer<KOFApplication> *)&result);
  }
}

